<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="light-content">
  <meta name="apple-mobile-web-app-title" content="DCloud">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#007AFF">
  <title>DCloud - Premium Cloud Storage</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ebee 100%);
            color: #1d1d1f;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            /* iOS safe area support */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .premium-button {
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        .premium-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 122, 255, 0.4);
        }

        .floating-add {
            position: fixed;
            bottom: calc(32px + env(safe-area-inset-bottom));
            right: calc(32px + env(safe-area-inset-right));
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(0, 122, 255, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        .floating-add:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 40px rgba(0, 122, 255, 0.5);
        }

        .sidebar {
            width: 280px;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            padding: 24px;
            padding-top: calc(24px + env(safe-area-inset-top));
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .sidebar-item:hover {
            background: rgba(0, 122, 255, 0.1);
        }

        .sidebar-item.active {
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            color: white;
        }

        .main-content {
            margin-left: 280px;
            padding: 32px;
            padding-top: calc(32px + env(safe-area-inset-top));
            padding-bottom: calc(32px + env(safe-area-inset-bottom));
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .storage-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .storage-progress {
            height: 100%;
            background: linear-gradient(90deg, #34C759 0%, #30D158 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal {
            transform: scale(1);
        }

        .input-field {
            width: 100%;
            padding: 16px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        .input-field:focus {
            outline: none;
            border-color: #007AFF;
            background: white;
        }

        .note-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .note-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .image-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .image-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .drop-zone {
            border: 2px dashed #007AFF;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            background: rgba(0, 122, 255, 0.05);
            transition: all 0.3s ease;
        }

        .drop-zone.dragover {
            background: rgba(0, 122, 255, 0.1);
            border-color: #5856D6;
        }

        .toast {
            position: fixed;
            top: 32px;
            right: 32px;
            background: white;
            color: #1d1d1f;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .ps-code-display {
            background: linear-gradient(135deg, #FF9500 0%, #FF6B35 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 18px;
            font-weight: 600;
            letter-spacing: 2px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .ps-code-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        .calendar-day {
            background: white;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-day:hover {
            background: rgba(0, 122, 255, 0.1);
        }

        .calendar-day.has-event {
            background: rgba(0, 122, 255, 0.2);
            font-weight: 600;
        }

        .location-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .location-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .share-button {
            background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .share-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(52, 199, 89, 0.3);
        }

        .shared-note-view {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .backup-section {
            background: linear-gradient(135deg, #8E8E93 0%, #636366 100%);
            color: white;
            padding: 24px;
            border-radius: 16px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                width: 100%;
                max-width: 320px;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 20px;
                padding-top: calc(20px + env(safe-area-inset-top));
                padding-bottom: calc(20px + env(safe-area-inset-bottom));
            }
            
            .floating-add {
                bottom: calc(20px + env(safe-area-inset-bottom));
                right: calc(20px + env(safe-area-inset-right));
            }
            
            .glass-card {
                margin: 0 10px;
            }
            
            .modal {
                margin: 20px;
                max-width: calc(100% - 40px);
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><!-- Login Screen -->
  <div id="loginScreen" class="h-full flex items-center justify-center p-8" style="padding-top: calc(2rem + env(safe-area-inset-top)); padding-bottom: calc(2rem + env(safe-area-inset-bottom));">
   <div class="glass-card p-12 w-full max-w-md text-center fade-in">
    <div class="mb-8">
     <div class="text-6xl mb-4">
      ☁️
     </div>
     <h1 id="appTitle" class="text-3xl font-bold mb-2">DCloud</h1>
     <p id="tagline" class="text-gray-600">Your personal cloud storage</p>
    </div><button id="googleLoginBtn" class="premium-button w-full flex items-center justify-center gap-3">
     <svg width="20" height="20" viewbox="0 0 24 24"><path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" /> <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
     </svg> Sign in with Google </button>
   </div>
  </div><!-- Profile Setup Screen -->
  <div id="profileSetupScreen" class="hidden h-full flex items-center justify-center p-8 overflow-y-auto" style="padding-top: calc(2rem + env(safe-area-inset-top)); padding-bottom: calc(2rem + env(safe-area-inset-bottom)); -webkit-overflow-scrolling: touch;">
   <div class="glass-card p-12 w-full max-w-2xl fade-in">
    <div class="text-center mb-8">
     <div class="text-5xl mb-4">
      👤
     </div>
     <h2 class="text-2xl font-bold mb-2">Complete Your Profile</h2>
     <p class="text-gray-600">Let's set up your DCloud account</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
     <div><label class="block text-sm font-semibold mb-2">Full Name</label> <input type="text" id="profileName" class="input-field" placeholder="Enter your name">
     </div>
     <div><label class="block text-sm font-semibold mb-2">Mobile Number</label> <input type="tel" id="profileMobile" class="input-field" placeholder="Your mobile number">
     </div>
     <div><label class="block text-sm font-semibold mb-2">Email Address</label> <input type="email" id="profileEmail" class="input-field" readonly>
     </div>
     <div><label class="block text-sm font-semibold mb-2">Date of Birth</label> <input type="date" id="profileDob" class="input-field">
     </div>
    </div>
    <div class="mt-8">
     <h3 class="text-lg font-semibold mb-4">🔐 Your Personal Security Code</h3>
     <div class="ps-code-display mb-4"><span id="psCode"></span>
     </div>
     <div class="flex gap-3"><button id="copyPsCode" class="premium-button flex-1">📋 Copy Code</button> <button id="screenshotPsCode" class="premium-button flex-1">📸 Screenshot</button>
     </div>
     <p class="text-sm text-gray-600 mt-3 text-center">⚠️ Save this code securely. You'll need it for account recovery.</p>
    </div><button id="completeSetup" class="premium-button w-full mt-8">Complete Setup</button>
   </div>
  </div><!-- Main Dashboard -->
  <div id="dashboard" class="hidden"><!-- Sidebar -->
   <div class="sidebar">
    <div class="mb-8">
     <div class="flex items-center gap-3 mb-2">
      <div class="text-2xl">
       ☁️
      </div>
      <h1 class="text-xl font-bold">DCloud</h1>
     </div>
     <p id="welcomeText" class="text-sm text-gray-600">Welcome back</p>
    </div>
    <nav class="space-y-2">
     <div class="sidebar-item active" data-tab="notes">
      <svg width="20" height="20" fill="currentColor" viewbox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
      </svg><span>Notes</span>
     </div>
     <div class="sidebar-item" data-tab="images">
      <svg width="20" height="20" fill="currentColor" viewbox="0 0 24 24"><path d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z" />
      </svg><span>Images</span>
     </div>
     <div class="sidebar-item" data-tab="calendar">
      <svg width="20" height="20" fill="currentColor" viewbox="0 0 24 24"><path d="M19,3H18V1H16V3H8V1H6V3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z" />
      </svg><span>Calendar</span>
     </div>
     <div class="sidebar-item" data-tab="maps">
      <svg width="20" height="20" fill="currentColor" viewbox="0 0 24 24"><path d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z" />
      </svg><span>Locations</span>
     </div>
     <div class="sidebar-item" data-tab="settings">
      <svg width="20" height="20" fill="currentColor" viewbox="0 0 24 24"><path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" />
      </svg><span>Settings</span>
     </div>
    </nav>
    <div class="mt-8 pt-6 border-t border-gray-200">
     <div class="flex items-center gap-3 mb-4"><img id="userAvatar" class="w-10 h-10 rounded-full" alt="User">
      <div>
       <p id="userName" class="font-semibold text-sm"></p>
       <p class="text-xs text-gray-600">Premium Account</p>
      </div>
     </div><button id="logoutBtn" class="w-full text-left text-sm text-gray-600 hover:text-red-500 transition-colors"> 🚪 Sign Out </button>
    </div>
   </div><!-- Main Content -->
   <div class="main-content"><!-- Notes Tab -->
    <div id="notesTab" class="tab-content">
     <div class="flex justify-between items-center mb-8">
      <div>
       <h2 class="text-3xl font-bold mb-2">Notes</h2>
       <p class="text-gray-600">Your thoughts, organized beautifully</p>
      </div>
     </div>
     <div id="notesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Notes will be loaded here -->
     </div>
    </div><!-- Images Tab -->
    <div id="imagesTab" class="tab-content hidden">
     <div class="flex justify-between items-center mb-8">
      <div>
       <h2 class="text-3xl font-bold mb-2">Images</h2>
       <p class="text-gray-600">Your memories in the cloud</p>
      </div>
     </div>
     <div id="dropZone" class="drop-zone mb-8">
      <div class="text-4xl mb-4">
       📸
      </div>
      <h3 class="text-xl font-semibold mb-2">Drop images here</h3>
      <p class="text-gray-600 mb-4">Or click to browse files</p><input type="file" id="fileInput" accept="image/*" multiple class="hidden"> <button id="browseBtn" class="premium-button">Browse Files</button>
     </div>
     <div id="imagesList" class="image-grid"><!-- Images will be loaded here -->
     </div>
    </div><!-- Calendar Tab -->
    <div id="calendarTab" class="tab-content hidden">
     <div class="flex justify-between items-center mb-8">
      <div>
       <h2 class="text-3xl font-bold mb-2">Calendar</h2>
       <p class="text-gray-600">Stay organized with your schedule</p>
      </div>
     </div>
     <div class="glass-card p-6 mb-6">
      <div id="calendarView" class="calendar-grid"><!-- Calendar will be generated here -->
      </div>
     </div>
     <div id="eventsList" class="space-y-4"><!-- Events will be loaded here -->
     </div>
    </div><!-- Maps Tab -->
    <div id="mapsTab" class="tab-content hidden">
     <div class="flex justify-between items-center mb-8">
      <div>
       <h2 class="text-3xl font-bold mb-2">Locations</h2>
       <p class="text-gray-600">Places you've been and want to remember</p>
      </div>
     </div>
     <div id="locationsList" class="grid grid-cols-1 md:grid-cols-2 gap-6"><!-- Locations will be loaded here -->
     </div>
    </div><!-- Settings Tab -->
    <div id="settingsTab" class="tab-content hidden">
     <div class="mb-8">
      <h2 class="text-3xl font-bold mb-2">Settings</h2>
      <p class="text-gray-600">Manage your account and preferences</p>
     </div>
     <div class="space-y-6"><!-- Personal Information -->
      <div class="glass-card p-6">
       <h3 class="text-xl font-semibold mb-4">Personal Information</h3>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div><label class="block text-sm font-medium mb-1">Name</label>
         <p id="settingsName" class="text-gray-800"></p>
        </div>
        <div><label class="block text-sm font-medium mb-1">Email</label>
         <p id="settingsEmail" class="text-gray-800"></p>
        </div>
        <div><label class="block text-sm font-medium mb-1">Mobile</label>
         <p id="settingsMobile" class="text-gray-800"></p>
        </div>
        <div><label class="block text-sm font-medium mb-1">Date of Birth</label>
         <p id="settingsDob" class="text-gray-800"></p>
        </div>
       </div>
      </div><!-- Account Storage -->
      <div class="glass-card p-6">
       <h3 class="text-xl font-semibold mb-4">Account Storage</h3>
       <div class="mb-4">
        <div class="flex justify-between items-center mb-2"><span class="text-sm font-medium">Used Storage</span> <span id="storageText" class="text-sm text-gray-600">0 GB / 20 GB</span>
        </div>
        <div class="storage-bar">
         <div id="storageProgress" class="storage-progress" style="width: 0%"></div>
        </div>
       </div>
       <p class="text-sm text-gray-600">You have 20 GB of free storage available.</p>
      </div><!-- PS Code -->
      <div class="glass-card p-6">
       <h3 class="text-xl font-semibold mb-4">Personal Security Code</h3>
       <div class="ps-code-display mb-4"><span id="settingsPsCode"></span>
       </div>
       <div class="flex gap-3"><button id="copySettingsPsCode" class="premium-button">📋 Copy Code</button> <button id="screenshotSettingsPsCode" class="premium-button">📸 Screenshot</button>
       </div>
       <p class="text-sm text-gray-600 mt-3">Keep this code safe. It's required for account recovery.</p>
      </div><!-- Backup & Export -->
      <div class="backup-section">
       <h3 class="text-xl font-semibold mb-4">Backup &amp; Export</h3>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><button id="exportNotesBtn" class="premium-button">📝 Export Notes</button> <button id="exportImagesBtn" class="premium-button">🖼️ Export Images</button> <button id="exportCalendarBtn" class="premium-button">📅 Export Calendar</button> <button id="exportAllBtn" class="premium-button">💾 Export All Data</button>
       </div>
       <p class="text-sm opacity-80 mt-3">Download your data in JSON format for backup or migration.</p>
      </div>
     </div>
    </div>
   </div><!-- Floating Add Button --> <button class="floating-add" id="floatingAdd">+</button>
  </div><!-- Shared Note View -->
  <div id="sharedNoteView" class="hidden">
   <div class="shared-note-view">
    <div class="glass-card p-8">
     <div class="text-center mb-6">
      <div class="text-4xl mb-4">
       📝
      </div>
      <h1 class="text-2xl font-bold mb-2">Shared Note</h1>
      <p class="text-gray-600">Read-only view</p>
     </div>
     <div id="sharedNoteContent"><!-- Shared note content will be loaded here -->
     </div>
     <div class="text-center mt-8"><button id="backToApp" class="premium-button">← Back to DCloud</button>
     </div>
    </div>
   </div>
  </div><!-- Modals -->
  <div id="noteModal" class="modal-overlay">
   <div class="modal">
    <h3 class="text-2xl font-bold mb-6">Create Note</h3>
    <div class="space-y-4"><input type="text" id="noteTitle" placeholder="Note title..." class="input-field"> <textarea id="noteContent" placeholder="Start writing..." rows="8" class="input-field resize-none"></textarea>
     <div class="flex gap-3"><button id="saveNote" class="premium-button flex-1">Save Note</button> <button id="cancelNote" class="premium-button flex-1" style="background: #8E8E93;">Cancel</button>
     </div>
    </div>
   </div>
  </div>
  <div id="eventModal" class="modal-overlay">
   <div class="modal">
    <h3 class="text-2xl font-bold mb-6">Create Event</h3>
    <div class="space-y-4"><input type="text" id="eventTitle" placeholder="Event title..." class="input-field"> <input type="date" id="eventDate" class="input-field"> <input type="time" id="eventTime" class="input-field"> <textarea id="eventDescription" placeholder="Event description..." rows="4" class="input-field resize-none"></textarea>
     <div class="flex gap-3"><button id="saveEvent" class="premium-button flex-1">Save Event</button> <button id="cancelEvent" class="premium-button flex-1" style="background: #8E8E93;">Cancel</button>
     </div>
    </div>
   </div>
  </div>
  <div id="locationModal" class="modal-overlay">
   <div class="modal">
    <h3 class="text-2xl font-bold mb-6">Add Location</h3>
    <div class="space-y-4"><input type="text" id="locationName" placeholder="Location name..." class="input-field"> <input type="text" id="locationAddress" placeholder="Address or coordinates..." class="input-field"> <button id="getCurrentLocation" class="premium-button w-full">📍 Use Current Location</button> <textarea id="locationNotes" placeholder="Notes about this location..." rows="3" class="input-field resize-none"></textarea>
     <div class="flex gap-3"><button id="saveLocation" class="premium-button flex-1">Save Location</button> <button id="cancelLocation" class="premium-button flex-1" style="background: #8E8E93;">Cancel</button>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC30TcmMVhP_8HdFYS1WufRiZwSDYNMTF0",
            authDomain: "pulse2-92372.firebaseapp.com",
            databaseURL: "https://pulse2-92372-default-rtdb.firebaseio.com",
            projectId: "pulse2-92372",
            storageBucket: "pulse2-92372.firebasestorage.app",
            messagingSenderId: "276235725177",
            appId: "1:276235725177:web:0f4e0789fae80a435927a8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Global variables
        let currentUser = null;
        let userProfile = null;
        let currentTab = 'notes';

        // Default config for Element SDK
        const defaultConfig = {
            app_title: "DCloud",
            tagline: "Your personal cloud storage",
            welcome_text: "Welcome back"
        };

        // Element SDK Implementation
        const element = {
            defaultConfig,
            render: async (config) => {
                document.getElementById('appTitle').textContent = config.app_title || defaultConfig.app_title;
                document.getElementById('tagline').textContent = config.tagline || defaultConfig.tagline;
                document.getElementById('welcomeText').textContent = config.welcome_text || defaultConfig.welcome_text;
            },
            mapToCapabilities: (config) => ({
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            }),
            mapToEditPanelValues: (config) => new Map([
                ["app_title", config.app_title || defaultConfig.app_title],
                ["tagline", config.tagline || defaultConfig.tagline],
                ["welcome_text", config.welcome_text || defaultConfig.welcome_text]
            ])
        };

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init(element);
        }

        // Utility Functions
        function generatePSCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 16; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function generateNoteId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            
            if (type === 'error') {
                toast.style.background = '#FF3B30';
                toast.style.color = 'white';
            }
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!');
            }).catch(() => {
                showToast('Failed to copy', 'error');
            });
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Cache Management
        function saveToCache(key, data) {
            try {
                localStorage.setItem(`dcloud_${key}`, JSON.stringify(data));
            } catch (e) {
                console.warn('Cache save failed:', e);
            }
        }

        function loadFromCache(key) {
            try {
                const data = localStorage.getItem(`dcloud_${key}`);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.warn('Cache load failed:', e);
                return null;
            }
        }

        // Authentication
        document.getElementById('googleLoginBtn').addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then((result) => {
                currentUser = result.user;
                checkUserProfile();
            }).catch((error) => {
                showToast('Login failed: ' + error.message, 'error');
            });
        });

        function checkUserProfile() {
            database.ref(`users/${currentUser.uid}/profile`).once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    userProfile = snapshot.val();
                    showDashboard();
                } else {
                    showProfileSetup();
                }
            });
        }

        function showProfileSetup() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('profileSetupScreen').classList.remove('hidden');
            
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('psCode').textContent = generatePSCode();
        }

        document.getElementById('completeSetup').addEventListener('click', () => {
            const name = document.getElementById('profileName').value;
            const mobile = document.getElementById('profileMobile').value;
            const dob = document.getElementById('profileDob').value;
            const psCode = document.getElementById('psCode').textContent;

            if (!name || !mobile || !dob) {
                showToast('Please fill all fields', 'error');
                return;
            }

            userProfile = {
                name,
                mobile,
                email: currentUser.email,
                dob,
                psCode,
                createdAt: Date.now(),
                storageUsed: 0
            };

            database.ref(`users/${currentUser.uid}/profile`).set(userProfile).then(() => {
                showDashboard();
                showToast('Profile created successfully!');
            });
        });

        // Copy PS Code
        document.getElementById('copyPsCode').addEventListener('click', () => {
            copyToClipboard(document.getElementById('psCode').textContent);
        });

        document.getElementById('copySettingsPsCode').addEventListener('click', () => {
            copyToClipboard(document.getElementById('settingsPsCode').textContent);
        });

        // Screenshot PS Code
        document.getElementById('screenshotPsCode').addEventListener('click', () => {
            showToast('Screenshot feature would capture the PS Code area');
        });

        document.getElementById('screenshotSettingsPsCode').addEventListener('click', () => {
            showToast('Screenshot feature would capture the PS Code area');
        });

        // Dashboard
        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('profileSetupScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            
            document.getElementById('userName').textContent = userProfile.name;
            document.getElementById('userAvatar').src = currentUser.photoURL;
            
            updateStorageInfo();
            loadAllData();
        }

        function updateStorageInfo() {
            const usedGB = (userProfile.storageUsed / (1024 * 1024 * 1024)).toFixed(2);
            const percentage = (userProfile.storageUsed / (20 * 1024 * 1024 * 1024)) * 100;
            
            document.getElementById('storageText').textContent = `${usedGB} GB / 20 GB`;
            document.getElementById('storageProgress').style.width = `${Math.min(percentage, 100)}%`;
        }

        // Tab Navigation
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', () => {
                const tab = item.dataset.tab;
                switchTab(tab);
            });
        });

        function switchTab(tab) {
            // Update sidebar
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tab}Tab`).classList.remove('hidden');
            
            currentTab = tab;
        }

        // Floating Add Button
        document.getElementById('floatingAdd').addEventListener('click', () => {
            if (currentTab === 'notes') {
                showModal('noteModal');
            } else if (currentTab === 'images') {
                document.getElementById('fileInput').click();
            } else if (currentTab === 'calendar') {
                showModal('eventModal');
            } else if (currentTab === 'maps') {
                showModal('locationModal');
            }
        });

        // Notes Management
        document.getElementById('saveNote').addEventListener('click', () => {
            const title = document.getElementById('noteTitle').value;
            const content = document.getElementById('noteContent').value;
            
            if (!title || !content) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            const noteId = generateNoteId();
            const noteData = {
                id: noteId,
                title,
                content,
                createdAt: Date.now(),
                shared: false
            };
            
            database.ref(`users/${currentUser.uid}/notes/${noteId}`).set(noteData).then(() => {
                hideModal('noteModal');
                document.getElementById('noteTitle').value = '';
                document.getElementById('noteContent').value = '';
                loadNotes();
                showToast('Note saved successfully!');
            });
        });

        document.getElementById('cancelNote').addEventListener('click', () => {
            hideModal('noteModal');
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').value = '';
        });

        function loadNotes() {
            database.ref(`users/${currentUser.uid}/notes`).on('value', (snapshot) => {
                const notes = snapshot.val() || {};
                const notesList = document.getElementById('notesList');
                notesList.innerHTML = '';
                
                // Load from cache first for offline support
                const cachedNotes = loadFromCache('notes') || {};
                
                Object.entries(notes).forEach(([key, note]) => {
                    const noteCard = createNoteCard(key, note);
                    notesList.appendChild(noteCard);
                });
                
                // Save to cache
                saveToCache('notes', notes);
            });
        }

        function createNoteCard(key, note) {
            const noteCard = document.createElement('div');
            noteCard.className = 'note-card fade-in';
            noteCard.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <h3 class="font-semibold text-lg">${note.title}</h3>
                    <div class="flex gap-2">
                        <button onclick="shareNote('${key}')" class="share-button">Share</button>
                        <button onclick="deleteNote('${key}')" class="text-red-500 hover:text-red-700">🗑️</button>
                    </div>
                </div>
                <p class="text-gray-600 mb-3 line-clamp-3">${note.content}</p>
                <p class="text-xs text-gray-400">${new Date(note.createdAt).toLocaleDateString()}</p>
            `;
            return noteCard;
        }

        function shareNote(noteKey) {
            database.ref(`users/${currentUser.uid}/notes/${noteKey}`).once('value').then((snapshot) => {
                const note = snapshot.val();
                if (note) {
                    // Create shared note
                    const sharedNoteData = {
                        title: note.title,
                        content: note.content,
                        createdAt: note.createdAt,
                        sharedBy: userProfile.name
                    };
                    
                    database.ref(`shared_notes/${note.id}`).set(sharedNoteData).then(() => {
                        const shareUrl = `${window.location.origin}${window.location.pathname}#${note.id}`;
                        copyToClipboard(shareUrl);
                        showToast('Share link copied to clipboard!');
                    });
                }
            });
        }

        function deleteNote(noteKey) {
            if (confirm('Are you sure you want to delete this note?')) {
                database.ref(`users/${currentUser.uid}/notes/${noteKey}`).remove().then(() => {
                    showToast('Note deleted successfully!');
                });
            }
        }

        // Images Management
        document.getElementById('browseBtn').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });

        // Drag and Drop
        const dropZone = document.getElementById('dropZone');
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            handleFileUpload(files);
        });

        document.getElementById('fileInput').addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleFileUpload(files);
        });

        function handleFileUpload(files) {
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    if (file.size > 10 * 1024 * 1024) {
                        showToast('File size should be less than 10MB', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const imageData = {
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            data: e.target.result,
                            uploadedAt: Date.now()
                        };
                        
                        database.ref(`users/${currentUser.uid}/images`).push(imageData).then(() => {
                            userProfile.storageUsed += file.size;
                            database.ref(`users/${currentUser.uid}/profile/storageUsed`).set(userProfile.storageUsed);
                            updateStorageInfo();
                            loadImages();
                            showToast('Image uploaded successfully!');
                        });
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function loadImages() {
            database.ref(`users/${currentUser.uid}/images`).on('value', (snapshot) => {
                const images = snapshot.val() || {};
                const imagesList = document.getElementById('imagesList');
                imagesList.innerHTML = '';
                
                Object.entries(images).forEach(([key, image]) => {
                    const imageCard = createImageCard(key, image);
                    imagesList.appendChild(imageCard);
                });
                
                saveToCache('images', images);
            });
        }

        function createImageCard(key, image) {
            const imageCard = document.createElement('div');
            imageCard.className = 'image-card fade-in';
            imageCard.innerHTML = `
                <img src="${image.data}" alt="${image.name}" class="w-full h-48 object-cover">
                <div class="p-4">
                    <h3 class="font-semibold truncate">${image.name}</h3>
                    <p class="text-sm text-gray-600">${(image.size / 1024).toFixed(1)} KB</p>
                    <p class="text-xs text-gray-400">${new Date(image.uploadedAt).toLocaleDateString()}</p>
                    <button onclick="deleteImage('${key}', ${image.size})" class="mt-2 text-red-500 hover:text-red-700 text-sm">Delete</button>
                </div>
            `;
            return imageCard;
        }

        function deleteImage(imageKey, size) {
            if (confirm('Are you sure you want to delete this image?')) {
                database.ref(`users/${currentUser.uid}/images/${imageKey}`).remove().then(() => {
                    userProfile.storageUsed -= size;
                    database.ref(`users/${currentUser.uid}/profile/storageUsed`).set(userProfile.storageUsed);
                    updateStorageInfo();
                    showToast('Image deleted successfully!');
                });
            }
        }

        // Calendar Management
        document.getElementById('saveEvent').addEventListener('click', () => {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value;
            
            if (!title || !date) {
                showToast('Please fill required fields', 'error');
                return;
            }
            
            const eventData = {
                title,
                date,
                time,
                description,
                createdAt: Date.now()
            };
            
            database.ref(`users/${currentUser.uid}/events`).push(eventData).then(() => {
                hideModal('eventModal');
                document.getElementById('eventTitle').value = '';
                document.getElementById('eventDate').value = '';
                document.getElementById('eventTime').value = '';
                document.getElementById('eventDescription').value = '';
                loadEvents();
                showToast('Event saved successfully!');
            });
        });

        document.getElementById('cancelEvent').addEventListener('click', () => {
            hideModal('eventModal');
        });

        function loadEvents() {
            database.ref(`users/${currentUser.uid}/events`).on('value', (snapshot) => {
                const events = snapshot.val() || {};
                const eventsList = document.getElementById('eventsList');
                eventsList.innerHTML = '';
                
                Object.entries(events).forEach(([key, event]) => {
                    const eventCard = createEventCard(key, event);
                    eventsList.appendChild(eventCard);
                });
                
                generateCalendar(events);
                saveToCache('events', events);
            });
        }

        function createEventCard(key, event) {
            const eventCard = document.createElement('div');
            eventCard.className = 'glass-card p-4 fade-in';
            eventCard.innerHTML = `
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="font-semibold text-lg">${event.title}</h3>
                        <p class="text-blue-600 text-sm">📅 ${event.date} ${event.time ? '⏰ ' + event.time : ''}</p>
                        ${event.description ? `<p class="text-gray-600 text-sm mt-2">${event.description}</p>` : ''}
                    </div>
                    <button onclick="deleteEvent('${key}')" class="text-red-500 hover:text-red-700">🗑️</button>
                </div>
            `;
            return eventCard;
        }

        function generateCalendar(events) {
            const calendarView = document.getElementById('calendarView');
            calendarView.innerHTML = '';
            
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // Generate calendar days (simplified version)
            for (let day = 1; day <= 31; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // Check if day has events
                const dayStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const hasEvent = Object.values(events).some(event => event.date === dayStr);
                
                if (hasEvent) {
                    dayElement.classList.add('has-event');
                }
                
                calendarView.appendChild(dayElement);
            }
        }

        function deleteEvent(eventKey) {
            if (confirm('Are you sure you want to delete this event?')) {
                database.ref(`users/${currentUser.uid}/events/${eventKey}`).remove().then(() => {
                    showToast('Event deleted successfully!');
                });
            }
        }

        // Location Management
        document.getElementById('getCurrentLocation').addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    document.getElementById('locationAddress').value = `${lat}, ${lng}`;
                    showToast('Current location added!');
                }, (error) => {
                    showToast('Unable to get location', 'error');
                });
            } else {
                showToast('Geolocation not supported', 'error');
            }
        });

        document.getElementById('saveLocation').addEventListener('click', () => {
            const name = document.getElementById('locationName').value;
            const address = document.getElementById('locationAddress').value;
            const notes = document.getElementById('locationNotes').value;
            
            if (!name || !address) {
                showToast('Please fill required fields', 'error');
                return;
            }
            
            const locationData = {
                name,
                address,
                notes,
                createdAt: Date.now()
            };
            
            database.ref(`users/${currentUser.uid}/locations`).push(locationData).then(() => {
                hideModal('locationModal');
                document.getElementById('locationName').value = '';
                document.getElementById('locationAddress').value = '';
                document.getElementById('locationNotes').value = '';
                loadLocations();
                showToast('Location saved successfully!');
            });
        });

        document.getElementById('cancelLocation').addEventListener('click', () => {
            hideModal('locationModal');
        });

        function loadLocations() {
            database.ref(`users/${currentUser.uid}/locations`).on('value', (snapshot) => {
                const locations = snapshot.val() || {};
                const locationsList = document.getElementById('locationsList');
                locationsList.innerHTML = '';
                
                Object.entries(locations).forEach(([key, location]) => {
                    const locationCard = createLocationCard(key, location);
                    locationsList.appendChild(locationCard);
                });
                
                saveToCache('locations', locations);
            });
        }

        function createLocationCard(key, location) {
            const locationCard = document.createElement('div');
            locationCard.className = 'location-card fade-in';
            locationCard.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <h3 class="font-semibold text-lg">${location.name}</h3>
                    <button onclick="deleteLocation('${key}')" class="text-red-500 hover:text-red-700">🗑️</button>
                </div>
                <p class="text-blue-600 text-sm mb-2">📍 ${location.address}</p>
                ${location.notes ? `<p class="text-gray-600 text-sm mb-3">${location.notes}</p>` : ''}
                <p class="text-xs text-gray-400 mb-3">${new Date(location.createdAt).toLocaleDateString()}</p>
                <button onclick="openInMaps('${location.address}')" class="premium-button text-sm">Open in Maps</button>
            `;
            return locationCard;
        }

        function deleteLocation(locationKey) {
            if (confirm('Are you sure you want to delete this location?')) {
                database.ref(`users/${currentUser.uid}/locations/${locationKey}`).remove().then(() => {
                    showToast('Location deleted successfully!');
                });
            }
        }

        function openInMaps(address) {
            const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`;
            window.open(url, '_blank', 'noopener,noreferrer');
        }

        // Settings
        function loadSettings() {
            document.getElementById('settingsName').textContent = userProfile.name;
            document.getElementById('settingsEmail').textContent = userProfile.email;
            document.getElementById('settingsMobile').textContent = userProfile.mobile;
            document.getElementById('settingsDob').textContent = userProfile.dob;
            document.getElementById('settingsPsCode').textContent = userProfile.psCode;
        }

        // Export Functions
        document.getElementById('exportNotesBtn').addEventListener('click', () => {
            database.ref(`users/${currentUser.uid}/notes`).once('value').then((snapshot) => {
                const notes = snapshot.val() || {};
                downloadJSON(notes, 'dcloud-notes.json');
                showToast('Notes exported successfully!');
            });
        });

        document.getElementById('exportImagesBtn').addEventListener('click', () => {
            database.ref(`users/${currentUser.uid}/images`).once('value').then((snapshot) => {
                const images = snapshot.val() || {};
                downloadJSON(images, 'dcloud-images.json');
                showToast('Images exported successfully!');
            });
        });

        document.getElementById('exportCalendarBtn').addEventListener('click', () => {
            database.ref(`users/${currentUser.uid}/events`).once('value').then((snapshot) => {
                const events = snapshot.val() || {};
                downloadJSON(events, 'dcloud-calendar.json');
                showToast('Calendar exported successfully!');
            });
        });

        document.getElementById('exportAllBtn').addEventListener('click', () => {
            Promise.all([
                database.ref(`users/${currentUser.uid}/notes`).once('value'),
                database.ref(`users/${currentUser.uid}/images`).once('value'),
                database.ref(`users/${currentUser.uid}/events`).once('value'),
                database.ref(`users/${currentUser.uid}/locations`).once('value')
            ]).then(([notesSnapshot, imagesSnapshot, eventsSnapshot, locationsSnapshot]) => {
                const allData = {
                    profile: userProfile,
                    notes: notesSnapshot.val() || {},
                    images: imagesSnapshot.val() || {},
                    events: eventsSnapshot.val() || {},
                    locations: locationsSnapshot.val() || {},
                    exportedAt: new Date().toISOString()
                };
                downloadJSON(allData, 'dcloud-backup.json');
                showToast('All data exported successfully!');
            });
        });

        function downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Load all data
        function loadAllData() {
            loadNotes();
            loadImages();
            loadEvents();
            loadLocations();
            loadSettings();
        }

        // Shared Note Handling
        function checkForSharedNote() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                database.ref(`shared_notes/${hash}`).once('value').then((snapshot) => {
                    if (snapshot.exists()) {
                        const note = snapshot.val();
                        showSharedNote(note);
                    }
                });
            }
        }

        function showSharedNote(note) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('sharedNoteView').classList.remove('hidden');
            
            document.getElementById('sharedNoteContent').innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold mb-2">${note.title}</h2>
                    <p class="text-sm text-gray-600">Shared by ${note.sharedBy} on ${new Date(note.createdAt).toLocaleDateString()}</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="whitespace-pre-wrap">${note.content}</p>
                </div>
            `;
        }

        document.getElementById('backToApp').addEventListener('click', () => {
            window.location.hash = '';
            document.getElementById('sharedNoteView').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            auth.signOut().then(() => {
                currentUser = null;
                userProfile = null;
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                showToast('Signed out successfully!');
            });
        });

        // Auth state observer
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                checkUserProfile();
            } else {
                checkForSharedNote();
            }
        });

        // Initialize
        checkForSharedNote();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98ff1fadb20dabaa',t:'MTc2MDY5NzA2MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
