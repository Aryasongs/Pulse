<!doctype html>
<html lang="hi">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mailbee - Email System</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Google Sans', 'Roboto', Arial, sans-serif;
      background: #f5f5f5;
      height: 100%;
      overflow: hidden;
    }

    html {
      height: 100%;
    }

    * {
      box-sizing: border-box;
    }

    .container {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .auth-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      width: 100%;
      max-width: 450px;
      padding: 40px;
      max-height: 90%;
      overflow-y: auto;
    }

    .logo {
      text-align: center;
      margin-bottom: 30px;
    }

    .logo h1 {
      color: #667eea;
      font-size: 36px;
      margin: 0;
      font-weight: 700;
    }

    .logo p {
      color: #666;
      margin: 5px 0 0 0;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
      font-size: 14px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn {
      width: 100%;
      padding: 14px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
      margin-top: 10px;
    }

    .btn:hover {
      background: #5568d3;
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
    }

    .btn-secondary:hover {
      background: #f5f7ff;
    }

    .link-btn {
      background: none;
      border: none;
      color: #667eea;
      cursor: pointer;
      text-decoration: underline;
      font-size: 14px;
      padding: 5px;
      margin-top: 15px;
    }

    .email-suggestions {
      margin-top: 10px;
      padding: 10px;
      background: #f5f7ff;
      border-radius: 8px;
    }

    .email-suggestion {
      padding: 8px;
      margin: 5px 0;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
      font-size: 14px;
    }

    .email-suggestion:hover {
      background: #e8ebff;
    }

    .custom-email-input {
      display: flex;
      gap: 5px;
      align-items: center;
    }

    .custom-email-input input {
      flex: 1;
    }

    .custom-email-input span {
      color: #666;
      font-weight: 500;
    }

    /* Gmail-like Interface */
    .gmail-container {
      height: 100%;
      display: flex;
      flex-direction: column;
      background: #ffffff;
    }

    .gmail-header {
      background: #ffffff;
      border-bottom: 1px solid #e0e0e0;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 64px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .menu-btn {
      background: none;
      border: none;
      padding: 8px;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.2s;
    }

    .menu-btn:hover {
      background: #f1f3f4;
    }

    .gmail-logo {
      font-size: 22px;
      font-weight: 400;
      color: #5f6368;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .search-bar {
      flex: 1;
      max-width: 720px;
      margin: 0 16px;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 12px 16px 12px 48px;
      border: 1px solid #e0e0e0;
      border-radius: 24px;
      background: #f1f3f4;
      font-size: 16px;
      transition: all 0.2s;
    }

    .search-input:focus {
      outline: none;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #5f6368;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .header-btn {
      background: none;
      border: none;
      padding: 8px;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.2s;
      color: #5f6368;
    }

    .header-btn:hover {
      background: #f1f3f4;
    }

    .profile-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #667eea;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 500;
      cursor: pointer;
      overflow: hidden;
    }

    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .gmail-body {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .sidebar {
      width: 256px;
      background: #ffffff;
      border-right: 1px solid #e0e0e0;
      padding: 8px 0;
      overflow-y: auto;
    }

    .compose-btn {
      margin: 8px 16px 16px 16px;
      padding: 12px 24px;
      background: #c2e7ff;
      color: #001d35;
      border: none;
      border-radius: 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.2s;
      box-shadow: 0 1px 2px rgba(60,64,67,0.3), 0 1px 3px rgba(60,64,67,0.15);
    }

    .compose-btn:hover {
      box-shadow: 0 1px 3px rgba(60,64,67,0.3), 0 4px 8px rgba(60,64,67,0.15);
    }

    .sidebar-nav {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .nav-item {
      display: flex;
      align-items: center;
      padding: 8px 16px 8px 28px;
      cursor: pointer;
      transition: background 0.2s;
      font-size: 14px;
      color: #202124;
      gap: 12px;
      border-radius: 0 16px 16px 0;
      margin-right: 8px;
    }

    .nav-item:hover {
      background: #f1f3f4;
    }

    .nav-item.active {
      background: #fce8e6;
      color: #d93025;
      font-weight: 500;
    }

    .nav-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    .nav-count {
      margin-left: auto;
      font-size: 12px;
      color: #5f6368;
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: #ffffff;
    }

    .content-header {
      padding: 8px 16px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 48px;
    }

    .content-title {
      font-size: 20px;
      font-weight: 400;
      color: #202124;
    }

    .content-actions {
      display: flex;
      gap: 8px;
    }

    .action-btn {
      background: none;
      border: none;
      padding: 8px;
      border-radius: 4px;
      cursor: pointer;
      color: #5f6368;
      transition: background 0.2s;
    }

    .action-btn:hover {
      background: #f1f3f4;
    }

    .email-list {
      flex: 1;
      overflow-y: auto;
    }

    .email-item {
      display: flex;
      align-items: center;
      padding: 8px 16px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      transition: background 0.2s;
      gap: 12px;
    }

    .email-item:hover {
      box-shadow: inset 1px 0 0 #dadce0, inset -1px 0 0 #dadce0, 0 1px 2px rgba(60,64,67,0.3), 0 1px 3px rgba(60,64,67,0.15);
      z-index: 1;
    }

    .email-item.unread {
      background: #ffffff;
      font-weight: 500;
    }

    .email-checkbox {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .email-star {
      width: 20px;
      height: 20px;
      cursor: pointer;
      color: #5f6368;
    }

    .email-star.starred {
      color: #fbbc04;
    }

    .email-sender {
      width: 200px;
      font-size: 14px;
      color: #202124;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .email-content {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
      overflow: hidden;
    }

    .email-subject {
      font-size: 14px;
      color: #202124;
      font-weight: inherit;
    }

    .email-snippet {
      font-size: 14px;
      color: #5f6368;
      margin-left: 4px;
    }

    .email-time {
      width: 80px;
      text-align: right;
      font-size: 12px;
      color: #5f6368;
      flex-shrink: 0;
    }

    .verified-badge {
      width: 16px;
      height: 16px;
      margin-left: 4px;
    }

    /* Compose Modal */
    .compose-modal {
      position: fixed;
      bottom: 0;
      right: 48px;
      width: 500px;
      background: white;
      border-radius: 8px 8px 0 0;
      box-shadow: 0 8px 10px rgba(0,0,0,0.14), 0 3px 14px rgba(0,0,0,0.12), 0 5px 5px rgba(0,0,0,0.2);
      z-index: 1000;
      display: none;
      flex-direction: column;
      max-height: 90%;
    }

    .compose-modal.active {
      display: flex;
    }

    .compose-header {
      background: #404040;
      color: white;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 8px 8px 0 0;
    }

    .compose-title {
      font-size: 14px;
      font-weight: 500;
    }

    .compose-actions {
      display: flex;
      gap: 8px;
    }

    .compose-action-btn {
      background: none;
      border: none;
      color: white;
      padding: 4px;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.2s;
    }

    .compose-action-btn:hover {
      background: rgba(255,255,255,0.1);
    }

    .compose-body {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .compose-fields {
      border-bottom: 1px solid #e0e0e0;
    }

    .compose-field {
      display: flex;
      align-items: center;
      padding: 8px 16px;
      border-bottom: 1px solid #f0f0f0;
    }

    .compose-field:last-child {
      border-bottom: none;
    }

    .field-label {
      width: 60px;
      font-size: 14px;
      color: #5f6368;
      flex-shrink: 0;
    }

    .field-input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 14px;
      padding: 4px 0;
    }

    .compose-editor {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .editor-toolbar {
      padding: 8px 16px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }

    .toolbar-btn {
      background: none;
      border: none;
      padding: 6px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      color: #5f6368;
      transition: background 0.2s;
    }

    .toolbar-btn:hover {
      background: #f1f3f4;
    }

    .toolbar-btn.active {
      background: #e8f0fe;
      color: #1a73e8;
    }

    .font-select {
      border: none;
      background: none;
      padding: 6px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      color: #5f6368;
    }

    .editor-content {
      flex: 1;
      padding: 16px;
      border: none;
      outline: none;
      font-size: 14px;
      font-family: inherit;
      resize: none;
      overflow-y: auto;
    }

    .compose-footer {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-top: 1px solid #e0e0e0;
    }

    .send-btn {
      background: #1a73e8;
      color: white;
      border: none;
      padding: 8px 24px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .send-btn:hover {
      background: #1557b0;
    }

    .footer-actions {
      display: flex;
      gap: 8px;
    }

    .footer-btn {
      background: none;
      border: none;
      padding: 8px;
      border-radius: 4px;
      cursor: pointer;
      color: #5f6368;
      transition: background 0.2s;
    }

    .footer-btn:hover {
      background: #f1f3f4;
    }

    /* Email View Modal */
    .email-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .email-modal.active {
      display: flex;
    }

    .email-modal-content {
      background: white;
      border-radius: 8px;
      width: 100%;
      max-width: 800px;
      max-height: 90%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .email-modal-header {
      padding: 16px 24px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .email-modal-title {
      font-size: 20px;
      font-weight: 400;
      color: #202124;
    }

    .close-btn {
      background: none;
      border: none;
      padding: 8px;
      border-radius: 50%;
      cursor: pointer;
      color: #5f6368;
      transition: background 0.2s;
    }

    .close-btn:hover {
      background: #f1f3f4;
    }

    .email-modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }

    .email-header-info {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e0e0e0;
    }

    .email-from {
      font-size: 16px;
      font-weight: 500;
      color: #202124;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .email-to {
      font-size: 14px;
      color: #5f6368;
      margin-bottom: 4px;
    }

    .email-date {
      font-size: 14px;
      color: #5f6368;
    }

    .email-body-content {
      font-size: 14px;
      line-height: 1.6;
      color: #202124;
      white-space: pre-wrap;
      margin-bottom: 24px;
    }

    .email-attachments {
      margin-bottom: 24px;
    }

    .attachment-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .attachment-item:hover {
      background: #f8f9fa;
    }

    .attachment-icon {
      width: 24px;
      height: 24px;
      color: #5f6368;
    }

    .attachment-info {
      flex: 1;
    }

    .attachment-name {
      font-size: 14px;
      color: #202124;
      font-weight: 500;
    }

    .attachment-size {
      font-size: 12px;
      color: #5f6368;
    }

    .reply-section {
      border-top: 1px solid #e0e0e0;
      padding-top: 24px;
    }

    .reply-suggestions {
      margin-bottom: 16px;
    }

    .reply-suggestion {
      display: inline-block;
      padding: 8px 16px;
      margin: 4px 8px 4px 0;
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-radius: 16px;
      font-size: 14px;
      color: #202124;
      cursor: pointer;
      transition: all 0.2s;
    }

    .reply-suggestion:hover {
      background: #e8f0fe;
      border-color: #1a73e8;
    }

    .reply-form {
      display: none;
    }

    .reply-form.active {
      display: block;
    }

    .reply-editor {
      width: 100%;
      min-height: 120px;
      padding: 12px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      resize: vertical;
      margin-bottom: 12px;
    }

    .reply-actions {
      display: flex;
      gap: 8px;
    }

    .reply-btn {
      background: #1a73e8;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .reply-btn:hover {
      background: #1557b0;
    }

    .cancel-btn {
      background: none;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 14px;
      color: #5f6368;
      cursor: pointer;
      transition: background 0.2s;
    }

    .cancel-btn:hover {
      background: #f1f3f4;
    }

    /* File Upload */
    .file-upload-area {
      border: 2px dashed #e0e0e0;
      border-radius: 8px;
      padding: 24px;
      text-align: center;
      margin: 16px 0;
      transition: all 0.2s;
    }

    .file-upload-area.dragover {
      border-color: #1a73e8;
      background: #e8f0fe;
    }

    .file-upload-text {
      font-size: 14px;
      color: #5f6368;
      margin-bottom: 8px;
    }

    .file-input {
      display: none;
    }

    .file-btn {
      background: #1a73e8;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .file-btn:hover {
      background: #1557b0;
    }

    .uploaded-files {
      margin-top: 16px;
    }

    .uploaded-file {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 12px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .file-icon {
      width: 20px;
      height: 20px;
      color: #5f6368;
    }

    .file-info {
      flex: 1;
    }

    .file-name {
      font-size: 14px;
      color: #202124;
    }

    .file-size {
      font-size: 12px;
      color: #5f6368;
    }

    .remove-file {
      background: none;
      border: none;
      color: #5f6368;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: background 0.2s;
    }

    .remove-file:hover {
      background: #e0e0e0;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -256px;
        top: 64px;
        height: calc(100% - 64px);
        z-index: 100;
        transition: left 0.3s;
        box-shadow: 2px 0 8px rgba(0,0,0,0.1);
      }

      .sidebar.open {
        left: 0;
      }

      .main-content {
        width: 100%;
      }

      .search-bar {
        display: none;
      }

      .compose-modal {
        right: 16px;
        width: calc(100% - 32px);
        max-width: 500px;
      }

      .email-sender {
        width: 120px;
      }

      .email-time {
        width: 60px;
      }

      .auth-card {
        padding: 30px 20px;
      }
    }

    @media (max-width: 480px) {
      .gmail-header {
        padding: 8px 12px;
      }

      .compose-modal {
        right: 8px;
        width: calc(100% - 16px);
        bottom: 0;
        border-radius: 0;
      }

      .email-item {
        padding: 12px 8px;
      }

      .email-sender {
        width: 100px;
      }

      .email-time {
        width: 50px;
        font-size: 11px;
      }
    }

    .error-message {
      background: #fce8e6;
      color: #d93025;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 14px;
      display: none;
    }

    .error-message.active {
      display: block;
    }

    .success-message {
      background: #e6f4ea;
      color: #137333;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 14px;
      display: none;
    }

    .success-message.active {
      display: block;
    }

    .profile-pic-upload {
      text-align: center;
      margin-bottom: 20px;
    }

    .profile-pic-preview {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: #f0f0f0;
      margin: 0 auto 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      color: #999;
      overflow: hidden;
    }

    .profile-pic-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .file-input-label {
      display: inline-block;
      padding: 10px 20px;
      background: #f0f0f0;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      color: #666;
      transition: background 0.3s;
    }

    .file-input-label:hover {
      background: #e0e0e0;
    }

    input[type="file"] {
      display: none;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #5f6368;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
      color: #dadce0;
    }

    .empty-state-text {
      font-size: 18px;
      font-weight: 400;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #5f6368;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div id="app"></div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC30TcmMVhP_8HdFYS1WufRiZwSDYNMTF0",
      authDomain: "pulse2-92372.firebaseapp.com",
      databaseURL: "https://pulse2-92372-default-rtdb.firebaseio.com",
      projectId: "pulse2-92372",
      storageBucket: "pulse2-92372.firebasestorage.app",
      messagingSenderId: "276235725177",
      appId: "1:276235725177:web:0f4e0789fae80a435927a8"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const defaultConfig = {
      app_title: "Mailbee",
      welcome_message: "Welcome to Mailbee",
      primary_color: "#1a73e8",
      secondary_color: "#34a853",
      text_color: "#202124",
      background_color: "#ffffff"
    };

    let config = { ...defaultConfig };
    let currentUser = null;
    let currentView = 'login';
    let signupData = {};
    let currentFolder = 'inbox';
    let emails = [];
    let sidebarOpen = false;
    let composeFiles = [];
    let currentFont = 'Arial';
    let currentLanguage = 'en';
    let passwordResetData = {};
    let folders = [
      { id: 'inbox', name: 'Inbox', icon: 'inbox', count: 0 },
      { id: 'starred', name: 'Starred', icon: 'star', count: 0 },
      { id: 'sent', name: 'Sent', icon: 'send', count: 0 },
      { id: 'drafts', name: 'Drafts', icon: 'draft', count: 0 },
      { id: 'spam', name: 'Spam', icon: 'report', count: 0 },
      { id: 'trash', name: 'Trash', icon: 'delete', count: 0 }
    ];

    const translations = {
      en: {
        // App branding
        appTitle: "Mailbee",
        welcomeMessage: "Welcome to Mailbee",
        
        // Authentication
        login: "Login",
        signup: "Create New Account",
        emailId: "Email ID",
        password: "Password",
        enterPassword: "Enter your password",
        forgotPassword: "Forgot Password?",
        
        // Signup process
        createAccount: "Create New Account",
        yourName: "Your Name",
        enterFullName: "Enter your full name",
        dateOfBirth: "Date of Birth",
        nextStep: "Next Step",
        alreadyHaveAccount: "Already have an account? Login",
        
        // Step 2
        moreInfo: "More Information",
        gender: "Gender",
        selectGender: "Select Gender",
        male: "Male",
        female: "Female",
        other: "Other",
        mobileNumber: "Mobile Number",
        tenDigitNumber: "10 digit number",
        
        // Step 3
        chooseEmail: "Choose Email ID",
        suggestedEmails: "Suggested Email IDs:",
        createCustomEmail: "Or Create Your Own Email ID",
        username: "username",
        useThisEmail: "Use This Email",
        
        // Step 4
        setPassword: "Set Password",
        yourEmailId: "Your Email ID:",
        strongPassword: "Enter a strong password",
        confirmPassword: "Confirm Password",
        reenterPassword: "Re-enter password",
        
        // Step 5
        profilePicture: "Profile Picture (Optional)",
        uploadProfilePic: "Upload Profile Picture",
        createAccount: "Create Account",
        skip: "Skip",
        
        // Main interface
        compose: "Compose",
        inbox: "Inbox",
        starred: "Starred",
        sent: "Sent",
        drafts: "Drafts",
        spam: "Spam",
        trash: "Trash",
        settings: "Settings",
        
        // Compose email
        newMessage: "New Message",
        from: "From",
        to: "To",
        subject: "Subject",
        send: "Send",
        
        // Email actions
        reply: "Reply",
        cancel: "Cancel",
        
        // Messages
        emailSent: "Email sent successfully!",
        replySent: "Reply sent successfully!",
        loginError: "Email ID not found. Please create an account first.",
        wrongPassword: "Wrong password. Please try again.",
        loginFailed: "Login failed. Please try again.",
        emailExists: "This email ID already exists. Please choose another one.",
        passwordMismatch: "Passwords don't match. Please try again.",
        noEmails: "No emails found",
        
        // Settings
        language: "Language",
        english: "English",
        hindi: "Hindi",
        changePassword: "Change Password",
        currentPassword: "Current Password",
        newPassword: "New Password",
        updatePassword: "Update Password",
        backToInbox: "Back to Inbox",
        passwordUpdated: "Password updated successfully!",
        wrongCurrentPassword: "Current password is incorrect.",
        
        // Password Recovery
        resetPassword: "Reset Password",
        enterEmailForReset: "Enter your email ID to reset password",
        verifyDetails: "Verify Your Details",
        enterMobileAndDob: "Enter your registered mobile number and date of birth",
        registeredMobile: "Registered Mobile Number",
        verify: "Verify",
        setNewPassword: "Set New Password",
        enterNewPassword: "Enter your new password",
        passwordReset: "Password reset successfully!",
        userNotFound: "User not found with this email ID.",
        verificationFailed: "Mobile number or date of birth doesn't match.",
        backToLogin: "Back to Login",
        
        // Multi-recipient
        multipleRecipients: "Multiple Recipients",
        separateWithCommas: "Separate email addresses with commas",
        recipientNotFound: "One or more recipients not found.",
        emailSentToMultiple: "Email sent to {count} recipients!"
      },
      hi: {
        // App branding
        appTitle: "Mailbee",
        welcomeMessage: "Mailbee mein aapka swagat hai",
        
        // Authentication
        login: "Login",
        signup: "Naya Account Banayein",
        emailId: "Email ID",
        password: "Password",
        enterPassword: "Aapna password enter karein",
        forgotPassword: "Password Bhul Gaye?",
        
        // Signup process
        createAccount: "Naya Account Banayein",
        yourName: "Aapka Naam",
        enterFullName: "Pura naam enter karein",
        dateOfBirth: "Janm Tithi",
        nextStep: "Aage Badhein",
        alreadyHaveAccount: "Pehle se account hai? Login karein",
        
        // Step 2
        moreInfo: "Aur Jaankari",
        gender: "Gender",
        selectGender: "Select karein",
        male: "Male",
        female: "Female",
        other: "Other",
        mobileNumber: "Mobile Number",
        tenDigitNumber: "10 digit number",
        
        // Step 3
        chooseEmail: "Email ID Choose Karein",
        suggestedEmails: "Suggested Email IDs:",
        createCustomEmail: "Ya Apni Khud Ki Email ID Banayein",
        username: "username",
        useThisEmail: "Yeh Email Use Karein",
        
        // Step 4
        setPassword: "Password Set Karein",
        yourEmailId: "Aapki Email ID:",
        strongPassword: "Strong password enter karein",
        confirmPassword: "Confirm Password",
        reenterPassword: "Password phir se enter karein",
        
        // Step 5
        profilePicture: "Profile Picture (Optional)",
        uploadProfilePic: "Profile Picture Upload Karein",
        createAccount: "Account Banayein",
        skip: "Skip Karein",
        
        // Main interface
        compose: "Compose",
        inbox: "Inbox",
        starred: "Starred",
        sent: "Sent",
        drafts: "Drafts",
        spam: "Spam",
        trash: "Trash",
        settings: "Settings",
        
        // Compose email
        newMessage: "New Message",
        from: "From",
        to: "To",
        subject: "Subject",
        send: "Send",
        
        // Email actions
        reply: "Reply",
        cancel: "Cancel",
        
        // Messages
        emailSent: "Email bhej diya gaya!",
        replySent: "Reply bhej diya gaya!",
        loginError: "Email ID nahi mili. Pehle account banayein.",
        wrongPassword: "Galat password. Phir se try karein.",
        loginFailed: "Login mein error. Phir se try karein.",
        emailExists: "Yeh email ID pehle se hai. Dusri choose karein.",
        passwordMismatch: "Password match nahi ho rahe. Phir se try karein.",
        noEmails: "Koi email nahi hai",
        
        // Settings
        language: "Bhasha",
        english: "English",
        hindi: "Hindi",
        changePassword: "Password Change Karein",
        currentPassword: "Current Password",
        newPassword: "New Password",
        updatePassword: "Password Update Karein",
        backToInbox: "Inbox Par Wapas Jayen",
        passwordUpdated: "Password successfully update ho gaya!",
        wrongCurrentPassword: "Current password galat hai.",
        
        // Password Recovery
        resetPassword: "Password Reset Karein",
        enterEmailForReset: "Password reset karne ke liye email ID enter karein",
        verifyDetails: "Aapki Details Verify Karein",
        enterMobileAndDob: "Aapka registered mobile number aur janm tithi enter karein",
        registeredMobile: "Registered Mobile Number",
        verify: "Verify Karein",
        setNewPassword: "Naya Password Set Karein",
        enterNewPassword: "Aapna naya password enter karein",
        passwordReset: "Password successfully reset ho gaya!",
        userNotFound: "Is email ID se koi user nahi mila.",
        verificationFailed: "Mobile number ya janm tithi match nahi kar rahi.",
        backToLogin: "Login Par Wapas Jayen",
        
        // Multi-recipient
        multipleRecipients: "Multiple Recipients",
        separateWithCommas: "Email addresses ko comma se separate karein",
        recipientNotFound: "Ek ya zyada recipients nahi mile.",
        emailSentToMultiple: "{count} recipients ko email bhej diya gaya!"
      }
    };

    function t(key) {
      return translations[currentLanguage][key] || key;
    }

    function switchLanguage(lang) {
      currentLanguage = lang;
      render();
    }

    const replySuggestions = [
      "Thank you!",
      "Sounds good!",
      "I'll get back to you.",
      "Thanks for letting me know.",
      "Got it, thanks!",
      "Will do!",
      "Perfect!",
      "Understood.",
      "Thanks for the update.",
      "Appreciate it!"
    ];

    async function onConfigChange(newConfig) {
      config = { ...newConfig };
      
      const titleElements = document.querySelectorAll('.logo h1, .gmail-logo');
      titleElements.forEach(el => {
        el.textContent = config.app_title || defaultConfig.app_title;
      });

      const welcomeElements = document.querySelectorAll('.logo p');
      welcomeElements.forEach(el => {
        el.textContent = config.welcome_message || defaultConfig.welcome_message;
      });
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["app_title", config.app_title || defaultConfig.app_title],
          ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
        ])
      });
    }

    function getSVGIcon(iconName) {
      const icons = {
        menu: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>',
        search: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>',
        settings: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>',
        apps: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6,8c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM12,20c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM6,20c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM6,14c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM12,14c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM16,6c0,1.1 0.9,2 2,2s2,-0.9 2,-2 -0.9,-2 -2,-2 -2,0.9 -2,2zM12,8c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM18,14c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM18,20c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2z"/></svg>',
        inbox: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H4.99c-1.11 0-1.99.89-1.99 2L3 19c0 1.1.88 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2zm0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H5V5h14v10z"/></svg>',
        star: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>',
        send: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>',
        draft: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M21.99 8c0-.72-.37-1.35-.94-1.7L12 1 2.95 6.3C2.38 6.65 2 7.28 2 8v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2l-.01-10zM12 13L3.74 7.84 12 3l8.26 4.84L12 13z"/></svg>',
        report: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27L15.73 3zM12 17.3c-.72 0-1.3-.58-1.3-1.3 0-.72.58-1.3 1.3-1.3.72 0 1.3.58 1.3 1.3 0 .72-.58 1.3-1.3 1.3zm1-4.3h-2V7h2v6z"/></svg>',
        delete: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>',
        edit: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',
        attach: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/></svg>',
        link: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>',
        close: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>',
        minimize: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h12v2H6z"/></svg>',
        expand: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>',
        bold: '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"/></svg>',
        italic: '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"/></svg>',
        underline: '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/></svg>',
        color: '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8z"/></svg>',
        list: '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/></svg>',
        file: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"/></svg>',
        pdf: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v1h-1.5V7h3v1.5zM9 9.5h1v-1H9v1z"/></svg>',
        image: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>',
        reply: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"/></svg>'
      };
      return icons[iconName] || icons.inbox;
    }

    function generateEmailSuggestions(name) {
      const cleanName = name.toLowerCase().replace(/\s+/g, '');
      const suggestions = [
        `${cleanName}@dozera.com`,
        `${cleanName}123@dozera.com`,
        `${cleanName}${Math.floor(Math.random() * 1000)}@dozera.com`
      ];
      return suggestions;
    }

    async function checkEmailExists(email) {
      const snapshot = await database.ref('users').orderByChild('email').equalTo(email).once('value');
      return snapshot.exists();
    }

    async function sendWelcomeEmail(userEmail, userName) {
      try {
        const welcomeEmailId = `welcome_${Date.now()}`;
        const welcomeEmailData = {
          id: welcomeEmailId,
          from: 'mailbee@dozera.com',
          fromName: 'Mailbee Dozera',
          to: userEmail,
          subject: 'Welcome to Mailbee - Aapka naya email experience!',
          body: `Namaste ${userName}!\n\nMailbee mein aapka swagat hai! ðŸŽ‰\n\nAap ab Dozera ke sabse advanced email system ka hissa hain. Yahan aap:\n\nâœ… Rich text emails bhej aur receive kar sakte hain\nâœ… Files, PDFs, aur images attach kar sakte hain\nâœ… Professional email experience le sakte hain\nâœ… Smart reply suggestions use kar sakte hain\nâœ… Links share kar sakte hain\n\nAapki email ID: ${userEmail}\n\nKoi bhi sawal ho to hume contact karein. Mailbee team aapki madad ke liye hamesha tayyar hai!\n\nDhanyawad,\nMailbee Dozera Team\n\n---\nYeh ek automated message hai. Please reply na karein.`,
          attachments: [],
          timestamp: Date.now(),
          read: false,
          folder: 'inbox',
          isWelcome: true,
          font: 'Arial'
        };

        await database.ref('emails/' + welcomeEmailId).set(welcomeEmailData);
      } catch (error) {
        console.error('Welcome email error:', error);
      }
    }

    async function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const errorDiv = document.getElementById('loginError');

      errorDiv.classList.remove('active');

      try {
        const snapshot = await database.ref('users').orderByChild('email').equalTo(email).once('value');
        
        if (!snapshot.exists()) {
          errorDiv.textContent = t('loginError');
          errorDiv.classList.add('active');
          return;
        }

        const userData = Object.values(snapshot.val())[0];
        
        if (userData.password !== password) {
          errorDiv.textContent = t('wrongPassword');
          errorDiv.classList.add('active');
          return;
        }

        currentUser = userData;
        currentView = 'inbox';
        loadEmails();
        render();
      } catch (error) {
        errorDiv.textContent = t('loginFailed');
        errorDiv.classList.add('active');
      }
    }

    function showForgotPassword() {
      currentView = 'forgot-password-step1';
      passwordResetData = {};
      render();
    }

    async function handleForgotPasswordStep1(e) {
      e.preventDefault();
      const email = document.getElementById('resetEmail').value;
      const errorDiv = document.getElementById('resetError');

      errorDiv.classList.remove('active');

      try {
        const snapshot = await database.ref('users').orderByChild('email').equalTo(email).once('value');
        
        if (!snapshot.exists()) {
          errorDiv.textContent = t('userNotFound');
          errorDiv.classList.add('active');
          return;
        }

        passwordResetData.email = email;
        passwordResetData.userData = Object.values(snapshot.val())[0];
        currentView = 'forgot-password-step2';
        render();
      } catch (error) {
        errorDiv.textContent = t('loginFailed');
        errorDiv.classList.add('active');
      }
    }

    function handleForgotPasswordStep2(e) {
      e.preventDefault();
      const mobile = document.getElementById('verifyMobile').value;
      const dob = document.getElementById('verifyDob').value;
      const errorDiv = document.getElementById('verifyError');

      errorDiv.classList.remove('active');

      if (passwordResetData.userData.mobile !== mobile || passwordResetData.userData.birthdate !== dob) {
        errorDiv.textContent = t('verificationFailed');
        errorDiv.classList.add('active');
        return;
      }

      currentView = 'forgot-password-step3';
      render();
    }

    async function handleForgotPasswordStep3(e) {
      e.preventDefault();
      const newPassword = document.getElementById('newPasswordReset').value;
      const confirmPassword = document.getElementById('confirmPasswordReset').value;
      const errorDiv = document.getElementById('newPasswordError');

      errorDiv.classList.remove('active');

      if (newPassword !== confirmPassword) {
        errorDiv.textContent = t('passwordMismatch');
        errorDiv.classList.add('active');
        return;
      }

      try {
        const userId = passwordResetData.userData.id;
        await database.ref('users/' + userId).update({ password: newPassword });
        
        showMessage(t('passwordReset'), 'success');
        currentView = 'login';
        passwordResetData = {};
        render();
      } catch (error) {
        errorDiv.textContent = t('loginFailed');
        errorDiv.classList.add('active');
      }
    }

    async function handleChangePassword(e) {
      e.preventDefault();
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPasswordSettings').value;
      const confirmPassword = document.getElementById('confirmPasswordSettings').value;
      const errorDiv = document.getElementById('settingsError');
      const successDiv = document.getElementById('settingsSuccess');

      errorDiv.classList.remove('active');
      successDiv.classList.remove('active');

      if (currentUser.password !== currentPassword) {
        errorDiv.textContent = t('wrongCurrentPassword');
        errorDiv.classList.add('active');
        return;
      }

      if (newPassword !== confirmPassword) {
        errorDiv.textContent = t('passwordMismatch');
        errorDiv.classList.add('active');
        return;
      }

      try {
        await database.ref('users/' + currentUser.id).update({ password: newPassword });
        currentUser.password = newPassword;
        
        successDiv.textContent = t('passwordUpdated');
        successDiv.classList.add('active');
        
        document.getElementById('changePasswordForm').reset();
      } catch (error) {
        errorDiv.textContent = t('loginFailed');
        errorDiv.classList.add('active');
      }
    }

    function showSignup() {
      currentView = 'signup-step1';
      signupData = {};
      render();
    }

    function handleSignupStep1(e) {
      e.preventDefault();
      signupData.name = document.getElementById('signupName').value;
      signupData.birthdate = document.getElementById('signupBirthdate').value;
      currentView = 'signup-step2';
      render();
    }

    function handleSignupStep2(e) {
      e.preventDefault();
      signupData.gender = document.getElementById('signupGender').value;
      signupData.mobile = document.getElementById('signupMobile').value;
      currentView = 'signup-step3';
      render();
    }

    async function selectEmail(email) {
      const exists = await checkEmailExists(email);
      if (exists) {
        const errorDiv = document.getElementById('emailError');
        errorDiv.textContent = t('emailExists');
        errorDiv.classList.add('active');
        return;
      }
      signupData.email = email;
      currentView = 'signup-step4';
      render();
    }

    async function handleCustomEmail(e) {
      e.preventDefault();
      const username = document.getElementById('customUsername').value;
      const email = `${username}@dozera.com`;
      
      const exists = await checkEmailExists(email);
      if (exists) {
        const errorDiv = document.getElementById('emailError');
        errorDiv.textContent = t('emailExists');
        errorDiv.classList.add('active');
        return;
      }
      
      signupData.email = email;
      currentView = 'signup-step4';
      render();
    }

    function handleSignupStep4(e) {
      e.preventDefault();
      signupData.password = document.getElementById('signupPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (signupData.password !== confirmPassword) {
        const errorDiv = document.getElementById('passwordError');
        errorDiv.textContent = t('passwordMismatch');
        errorDiv.classList.add('active');
        return;
      }
      
      currentView = 'signup-step5';
      render();
    }

    function handleProfilePicUpload(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          signupData.profilePic = event.target.result;
          document.getElementById('profilePicPreview').innerHTML = `<img src="${event.target.result}" alt="Profile">`;
        };
        reader.readAsDataURL(file);
      }
    }

    async function completeSignup() {
      try {
        const userId = Date.now().toString();
        const userData = {
          id: userId,
          name: signupData.name,
          email: signupData.email,
          password: signupData.password,
          birthdate: signupData.birthdate,
          gender: signupData.gender,
          mobile: signupData.mobile,
          profilePic: signupData.profilePic || '',
          createdAt: Date.now()
        };

        await database.ref('users/' + userId).set(userData);
        
        // Send welcome email
        await sendWelcomeEmail(signupData.email, signupData.name);
        
        currentUser = userData;
        currentView = 'inbox';
        loadEmails();
        render();
      } catch (error) {
        console.error('Signup error:', error);
      }
    }

    function toggleSidebar() {
      sidebarOpen = !sidebarOpen;
      const sidebar = document.querySelector('.sidebar');
      if (sidebar) {
        sidebar.classList.toggle('open', sidebarOpen);
      }
    }

    function showCompose() {
      document.getElementById('composeModal').classList.add('active');
      composeFiles = [];
      updateComposeFromField();
    }

    function closeCompose() {
      document.getElementById('composeModal').classList.remove('active');
      document.getElementById('composeForm').reset();
      composeFiles = [];
      currentFont = 'Arial';
    }

    function updateComposeFromField() {
      const fromField = document.getElementById('composeFrom');
      if (fromField && currentUser) {
        fromField.value = currentUser.email;
      }
    }

    function formatText(command, value = null) {
      document.execCommand(command, false, value);
      updateToolbarState();
    }

    function updateToolbarState() {
      const commands = ['bold', 'italic', 'underline'];
      commands.forEach(cmd => {
        const btn = document.querySelector(`[data-command="${cmd}"]`);
        if (btn) {
          btn.classList.toggle('active', document.queryCommandState(cmd));
        }
      });
    }

    function changeFont(font) {
      currentFont = font;
      const editor = document.getElementById('composeEditor');
      if (editor) {
        editor.style.fontFamily = font;
      }
    }

    function handleFileUpload(e) {
      const files = Array.from(e.target.files);
      files.forEach(file => {
        if (file.size <= 25 * 1024 * 1024) { // 25MB limit
          const reader = new FileReader();
          reader.onload = function(event) {
            composeFiles.push({
              name: file.name,
              size: file.size,
              type: file.type,
              data: event.target.result
            });
            updateFileList();
          };
          reader.readAsDataURL(file);
        } else {
          showMessage('File size 25MB se zyada nahi honi chahiye.', 'error');
        }
      });
    }

    function updateFileList() {
      const container = document.getElementById('uploadedFiles');
      if (!container) return;

      container.innerHTML = composeFiles.map((file, index) => `
        <div class="uploaded-file">
          <div class="file-icon">${getSVGIcon(getFileIcon(file.type))}</div>
          <div class="file-info">
            <div class="file-name">${file.name}</div>
            <div class="file-size">${formatFileSize(file.size)}</div>
          </div>
          <button class="remove-file" onclick="removeFile(${index})" type="button">
            ${getSVGIcon('close')}
          </button>
        </div>
      `).join('');
    }

    function removeFile(index) {
      composeFiles.splice(index, 1);
      updateFileList();
    }

    function getFileIcon(mimeType) {
      if (mimeType.startsWith('image/')) return 'image';
      if (mimeType === 'application/pdf') return 'pdf';
      return 'file';
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function insertLink() {
      const url = prompt('Link URL enter karein:');
      if (url) {
        const text = prompt('Link text enter karein:') || url;
        const editor = document.getElementById('composeEditor');
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const link = document.createElement('a');
          link.href = url;
          link.textContent = text;
          link.target = '_blank';
          link.rel = 'noopener noreferrer';
          range.deleteContents();
          range.insertNode(link);
        }
      }
    }

    async function sendEmail(e) {
      e.preventDefault();
      const toField = document.getElementById('composeTo').value;
      const subject = document.getElementById('composeSubject').value;
      const editor = document.getElementById('composeEditor');
      const body = editor.innerHTML || editor.textContent;

      // Parse multiple recipients
      const recipients = toField.split(',').map(email => email.trim()).filter(email => email);
      
      if (recipients.length === 0) {
        showMessage(t('recipientNotFound'), 'error');
        return;
      }

      // Check if all recipients exist
      const recipientChecks = await Promise.all(recipients.map(email => checkEmailExists(email)));
      const invalidRecipients = recipients.filter((email, index) => !recipientChecks[index]);
      
      if (invalidRecipients.length > 0) {
        showMessage(t('recipientNotFound'), 'error');
        return;
      }

      try {
        // Send email to each recipient
        const emailPromises = recipients.map(async (recipient) => {
          const emailId = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
          const emailData = {
            id: emailId,
            from: currentUser.email,
            fromName: currentUser.name,
            to: recipient,
            subject: subject,
            body: body,
            attachments: composeFiles,
            timestamp: Date.now(),
            read: false,
            font: currentFont
          };

          return database.ref('emails/' + emailId).set(emailData);
        });

        await Promise.all(emailPromises);
        
        closeCompose();
        
        if (recipients.length === 1) {
          showMessage(t('emailSent'), 'success');
        } else {
          showMessage(t('emailSentToMultiple').replace('{count}', recipients.length), 'success');
        }
        
        if (currentFolder === 'sent') {
          loadEmails();
        }
      } catch (error) {
        console.error('Send email error:', error);
        showMessage(t('loginFailed'), 'error');
      }
    }

    async function loadEmails() {
      try {
        let allEmails = [];
        
        // Load received emails
        const receivedQuery = database.ref('emails').orderByChild('to').equalTo(currentUser.email);
        const receivedSnapshot = await receivedQuery.once('value');
        
        if (receivedSnapshot.exists()) {
          receivedSnapshot.forEach(child => {
            allEmails.push(child.val());
          });
        }
        
        // Load sent emails
        const sentQuery = database.ref('emails').orderByChild('from').equalTo(currentUser.email);
        const sentSnapshot = await sentQuery.once('value');
        
        if (sentSnapshot.exists()) {
          sentSnapshot.forEach(child => {
            const email = child.val();
            email.isSent = true;
            allEmails.push(email);
          });
        }
        
        // Filter emails based on current folder
        emails = allEmails.filter(email => {
          if (currentFolder === 'inbox') {
            return !email.isSent;
          } else if (currentFolder === 'sent') {
            return email.isSent;
          } else if (currentFolder === 'starred') {
            return email.starred;
          } else {
            return !email.isSent && email.folder === currentFolder;
          }
        });
        
        emails.sort((a, b) => b.timestamp - a.timestamp);
        updateFolderCounts(allEmails);
        renderEmails();
      } catch (error) {
        console.error('Load emails error:', error);
      }
    }

    function updateFolderCounts(allEmails) {
      folders.forEach(folder => {
        if (folder.id === 'inbox') {
          folder.count = allEmails.filter(e => !e.isSent && !e.read).length;
        } else if (folder.id === 'sent') {
          folder.count = allEmails.filter(e => e.isSent).length;
        } else if (folder.id === 'starred') {
          folder.count = allEmails.filter(e => e.starred && !e.read).length;
        } else {
          folder.count = allEmails.filter(e => !e.isSent && e.folder === folder.id && !e.read).length;
        }
      });
    }

    function renderEmails() {
      const container = document.getElementById('emailsList');
      
      if (emails.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">${getSVGIcon('inbox')}</div>
            <div class="empty-state-text">${t('noEmails')}</div>
          </div>
        `;
        return;
      }

      container.innerHTML = emails.map(email => `
        <div class="email-item ${!email.read && !email.isSent ? 'unread' : ''}" onclick="openEmail('${email.id}')">
          <input type="checkbox" class="email-checkbox" onclick="event.stopPropagation()">
          <div class="email-star ${email.starred ? 'starred' : ''}" onclick="event.stopPropagation(); toggleStar('${email.id}')">
            ${getSVGIcon('star')}
          </div>
          <div class="email-sender">
            ${email.isSent ? email.to : email.fromName}
            ${email.isWelcome ? '<img src="https://pulse.oriontec.xyz/tick-mark.png" class="verified-badge" alt="Verified">' : ''}
          </div>
          <div class="email-content">
            <span class="email-subject">${email.subject}</span>
            <span class="email-snippet"> - ${email.body.replace(/<[^>]*>/g, '').substring(0, 100)}...</span>
          </div>
          <div class="email-time">${formatTime(email.timestamp)}</div>
        </div>
      `).join('');
    }

    async function toggleStar(emailId) {
      const email = emails.find(e => e.id === emailId);
      if (email) {
        email.starred = !email.starred;
        await database.ref('emails/' + emailId).update({ starred: email.starred });
        renderEmails();
      }
    }

    async function openEmail(emailId) {
      const email = emails.find(e => e.id === emailId);
      if (!email) return;

      if (!email.isSent && !email.read) {
        email.read = true;
        await database.ref('emails/' + emailId).update({ read: true });
      }

      const modal = document.getElementById('emailModal');
      document.getElementById('emailModalTitle').textContent = email.subject;
      document.getElementById('emailFrom').innerHTML = `${email.fromName} <${email.from}> ${email.isWelcome ? '<img src="https://pulse.oriontec.xyz/tick-mark.png" class="verified-badge" alt="Verified">' : ''}`;
      document.getElementById('emailTo').textContent = `To: ${email.to}`;
      document.getElementById('emailDate').textContent = formatTime(email.timestamp);
      
      const bodyContent = document.getElementById('emailBodyContent');
      bodyContent.innerHTML = email.body;
      if (email.font) {
        bodyContent.style.fontFamily = email.font;
      }
      
      // Show attachments
      const attachmentsContainer = document.getElementById('emailAttachments');
      if (email.attachments && email.attachments.length > 0) {
        attachmentsContainer.innerHTML = `
          <h4>Attachments:</h4>
          ${email.attachments.map(attachment => `
            <div class="attachment-item" onclick="downloadAttachment('${attachment.data}', '${attachment.name}')">
              <div class="attachment-icon">${getSVGIcon(getFileIcon(attachment.type))}</div>
              <div class="attachment-info">
                <div class="attachment-name">${attachment.name}</div>
                <div class="attachment-size">${formatFileSize(attachment.size)}</div>
              </div>
            </div>
          `).join('')}
        `;
      } else {
        attachmentsContainer.innerHTML = '';
      }

      // Show reply suggestions
      const suggestionsContainer = document.getElementById('replySuggestions');
      if (!email.isSent) {
        suggestionsContainer.innerHTML = replySuggestions.map(suggestion => 
          `<span class="reply-suggestion" onclick="selectReplySuggestion('${suggestion}')">${suggestion}</span>`
        ).join('');
      } else {
        suggestionsContainer.innerHTML = '';
      }

      modal.classList.add('active');
      loadEmails();
    }

    function downloadAttachment(data, filename) {
      const link = document.createElement('a');
      link.href = data;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function selectReplySuggestion(suggestion) {
      const replyEditor = document.getElementById('replyEditor');
      replyEditor.value = suggestion;
      showReplyForm();
    }

    function showReplyForm() {
      document.getElementById('replyForm').classList.add('active');
    }

    function hideReplyForm() {
      document.getElementById('replyForm').classList.remove('active');
      document.getElementById('replyEditor').value = '';
    }

    async function sendReply() {
      const replyText = document.getElementById('replyEditor').value;
      if (!replyText.trim()) return;

      const originalEmail = emails.find(e => e.id === document.getElementById('emailModal').dataset.emailId);
      if (!originalEmail) return;

      try {
        const replyId = Date.now().toString();
        const replyData = {
          id: replyId,
          from: currentUser.email,
          fromName: currentUser.name,
          to: originalEmail.from,
          subject: `Re: ${originalEmail.subject}`,
          body: replyText,
          attachments: [],
          timestamp: Date.now(),
          read: false,
          font: 'Arial',
          isReply: true,
          originalEmailId: originalEmail.id
        };

        await database.ref('emails/' + replyId).set(replyData);
        
        hideReplyForm();
        closeModal('emailModal');
        showMessage('Reply bhej diya gaya!', 'success');
        
        if (currentFolder === 'sent') {
          loadEmails();
        }
      } catch (error) {
        console.error('Reply error:', error);
        showMessage('Reply bhejne mein error.', 'error');
      }
    }

    function formatTime(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diff = now - date;
      
      if (diff < 60000) return 'Abhi';
      if (diff < 3600000) return `${Math.floor(diff / 60000)} min`;
      if (diff < 86400000) return `${Math.floor(diff / 3600000)} ghante`;
      
      return date.toLocaleDateString('hi-IN');
    }

    function switchFolder(folderId) {
      currentFolder = folderId;
      loadEmails();
      
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      document.querySelector(`[data-folder="${folderId}"]`).classList.add('active');
      
      const folderName = folders.find(f => f.id === folderId)?.name || 'Inbox';
      document.getElementById('contentTitle').textContent = folderName;
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    function showMessage(message, type) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `${type}-message active`;
      messageDiv.textContent = message;
      messageDiv.style.position = 'fixed';
      messageDiv.style.top = '20px';
      messageDiv.style.right = '20px';
      messageDiv.style.zIndex = '9999';
      messageDiv.style.padding = '12px 24px';
      messageDiv.style.borderRadius = '8px';
      messageDiv.style.fontSize = '14px';
      messageDiv.style.fontWeight = '500';
      
      if (type === 'success') {
        messageDiv.style.background = '#e6f4ea';
        messageDiv.style.color = '#137333';
        messageDiv.style.border = '1px solid #34a853';
      } else {
        messageDiv.style.background = '#fce8e6';
        messageDiv.style.color = '#d93025';
        messageDiv.style.border = '1px solid #ea4335';
      }
      
      document.body.appendChild(messageDiv);
      
      setTimeout(() => {
        messageDiv.remove();
      }, 3000);
    }

    function showSettings() {
      currentView = 'settings';
      render();
    }

    function logout() {
      currentUser = null;
      currentView = 'login';
      emails = [];
      render();
    }

    function render() {
      const app = document.getElementById('app');

      if (currentView === 'login') {
        app.innerHTML = `
          <div class="container">
            <div class="auth-card">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div class="logo">
                  <h1>${t('appTitle')}</h1>
                  <p>${t('welcomeMessage')}</p>
                </div>
                <div style="display: flex; gap: 5px;">
                  <button type="button" class="btn ${currentLanguage === 'en' ? '' : 'btn-secondary'}" style="padding: 8px 12px; font-size: 12px;" onclick="switchLanguage('en')">EN</button>
                  <button type="button" class="btn ${currentLanguage === 'hi' ? '' : 'btn-secondary'}" style="padding: 8px 12px; font-size: 12px;" onclick="switchLanguage('hi')">à¤¹à¤¿</button>
                </div>
              </div>
              <div id="loginError" class="error-message"></div>
              <form onsubmit="handleLogin(event)">
                <div class="form-group">
                  <label>${t('emailId')}</label>
                  <input type="email" id="loginEmail" placeholder="your@dozera.com" required>
                </div>
                <div class="form-group">
                  <label>${t('password')}</label>
                  <input type="password" id="loginPassword" placeholder="${t('enterPassword')}" required>
                </div>
                <button type="submit" class="btn">${t('login')}</button>
                <button type="button" class="btn btn-secondary" onclick="showSignup()">${t('signup')}</button>
                <button type="button" class="link-btn" onclick="showForgotPassword()">${t('forgotPassword')}</button>
              </form>
            </div>
          </div>
        `;
      } else if (currentView === 'forgot-password-step1') {
        app.innerHTML = `
          <div class="container">
            <div class="auth-card">
              <div class="logo">
                <h1>${t('appTitle')}</h1>
                <p>${t('resetPassword')}</p>
              </div>
              <div id="resetError" class="error-message"></div>
              <form onsubmit="handleForgotPasswordStep1(event)">
                <div class="form-group">
                  <label>${t('emailId')}</label>
                  <input type="email" id="resetEmail" placeholder="${t('enterEmailForReset')}" required>
                </div>
                <button type="submit" class="btn">${t('nextStep')}</button>
                <button type="button" class="link-btn" onclick="currentView='login'; render();">${t('backToLogin')}</button>
              </form>
            </div>
          </div>
        `;
      } else if (currentView === 'forgot-password-step2') {
        app.innerHTML = `
          <div class="container">
            <div class="auth-card">
              <div class="logo">
                <h1>${t('appTitle')}</h1>
                <p>${t('verifyDetails')}</p>
              </div>
              <div id="verifyError" class="error-message"></div>
              <p style="margin-bottom: 20px; color: #666;">${t('enterMobileAndDob')}</p>
              <form onsubmit="handleForgotPasswordStep2(event)">
                <div class="form-group">
                  <label>${t('registeredMobile')}</label>
                  <input type="tel" id="verifyMobile" placeholder="${t('tenDigitNumber')}" pattern="[0-9]{10}" required>
                </div>
                <div class="form-group">
                  <label>${t('dateOfBirth')}</label>
                  <input type="date" id="verifyDob" required>
                </div>
                <button type="submit" class="btn">${t('verify')}</button>
                <button type="button" class="link-btn" onclick="currentView='login'; render();">${t('backToLogin')}</button>
              </form>
            </div>
          </div>
        `;
      } else if (currentView === 'forgot-password-step3') {
        app.innerHTML = `
          <div class="container">
            <div class="auth-card">
              <div class="logo">
                <h1>${t('appTitle')}</h1>
                <p>${t('setNewPassword')}</p>
              </div>
              <div id="newPasswordError" class="error-message"></div>
              <form onsubmit="handleForgotPasswordStep3(event)">
                <div class="form-group">
                  <label>${t('newPassword')}</label>
                  <input type="password" id="newPasswordReset" placeholder="${t('enterNewPassword')}" minlength="6" required>
                </div>
                <div class="form-group">
                  <label>${t('confirmPassword')}</label>
                  <input type="password" id="confirmPasswordReset" placeholder="${t('reenterPassword')}" minlength="6" required>
                </div>
                <button type="submit" class="btn">${t('updatePassword')}</button>
              </form>
            </div>
          </div>
        `;
      } else if (currentView === 'signup-step1') {
        app.innerHTML = `
          <div class="container">
            <div class="auth-card">
              <div class="logo">
                <h1>${t('appTitle')}</h1>
                <p>${t('createAccount')}</p>
              </div>
              <form onsubmit="handleSignupStep1(event)">
                <div class="form-group">
                  <label>${t('yourName')}</label>
                  <input type="text" id="signupName" placeholder="${t('enterFullName')}" required>
                </div>
                <div class="form-group">
                  <label>${t('dateOfBirth')}</label>
                  <input type="date" id="signupBirthdate" required>
                </div>
                <button type="submit" class="btn">${t('nextStep')}</button>
                <button type="button" class="link-btn" onclick="currentView='login'; render();">${t('alreadyHaveAccount')}</button>
              </form>
            </div>
          </div>
        `;
      } else if (currentView === 'signup-step2') {
        app.innerHTML = `
          <div class="container">
            <div class="auth-card">
              <div class="logo">
                <h1>${t('appTitle')}</h1>
                <p>${t('moreInfo')}</p>
              </div>
              <form onsubmit="handleSignupStep2(event)">
                <div class="form-group">
                  <label>${t('gender')}</label>
                  <select id="signupGender" required>
                    <option value="">${t('selectGender')}</option>
                    <option value="male">${t('male')}</option>
                    <option value="female">${t('female')}</option>
                    <option value="other">${t('other')}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>${t('mobileNumber')}</label>
                  <input type="tel" id="signupMobile" placeholder="${t('tenDigitNumber')}" pattern="[0-9]{10}" required>
                </div>
                <button type="submit" class="btn">${t('nextStep')}</button>
              </form>
            </div>
          </div>
        `;
      } else if (currentView === 'signup-step3') {
        const suggestions = generateEmailSuggestions(signupData.name);
        app.innerHTML = `
          <div class="container">
            <div class="auth-card">
              <div class="logo">
                <h1>${t('appTitle')}</h1>
                <p>${t('chooseEmail')}</p>
              </div>
              <div id="emailError" class="error-message"></div>
              <div class="email-suggestions">
                <p style="margin: 0 0 10px 0; font-weight: 500;">${t('suggestedEmails')}</p>
                ${suggestions.map(email => `
                  <div class="email-suggestion" onclick="selectEmail('${email}')">${email}</div>
                `).join('')}
              </div>
              <form onsubmit="handleCustomEmail(event)" style="margin-top: 20px;">
                <div class="form-group">
                  <label>${t('createCustomEmail')}</label>
                  <div class="custom-email-input">
                    <input type="text" id="customUsername" placeholder="${t('username')}" required>
                    <span>@dozera.com</span>
                  </div>
                </div>
                <button type="submit" class="btn">${t('useThisEmail')}</button>
              </form>
            </div>
          </div>
        `;
      } else if (currentView === 'signup-step4') {
        app.innerHTML = `
          <div class="container">
            <div class="auth-card">
              <div class="logo">
                <h1>${t('appTitle')}</h1>
                <p>${t('setPassword')}</p>
              </div>
              <div id="passwordError" class="error-message"></div>
              <p style="margin-bottom: 20px; color: #666;">${t('yourEmailId')} <strong>${signupData.email}</strong></p>
              <form onsubmit="handleSignupStep4(event)">
                <div class="form-group">
                  <label>${t('password')}</label>
                  <input type="password" id="signupPassword" placeholder="${t('strongPassword')}" minlength="6" required>
                </div>
                <div class="form-group">
                  <label>${t('confirmPassword')}</label>
                  <input type="password" id="confirmPassword" placeholder="${t('reenterPassword')}" minlength="6" required>
                </div>
                <button type="submit" class="btn">${t('nextStep')}</button>
              </form>
            </div>
          </div>
        `;
      } else if (currentView === 'signup-step5') {
        app.innerHTML = `
          <div class="container">
            <div class="auth-card">
              <div class="logo">
                <h1>${t('appTitle')}</h1>
                <p>${t('profilePicture')}</p>
              </div>
              <div class="profile-pic-upload">
                <div class="profile-pic-preview" id="profilePicPreview">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                  </svg>
                </div>
                <label for="profilePicInput" class="file-input-label">${t('uploadProfilePic')}</label>
                <input type="file" id="profilePicInput" accept="image/*" onchange="handleProfilePicUpload(event)">
              </div>
              <button class="btn" onclick="completeSignup()">${t('createAccount')}</button>
              <button class="btn btn-secondary" onclick="signupData.profilePic=''; completeSignup();">${t('skip')}</button>
            </div>
          </div>
        `;
      } else if (currentView === 'inbox') {
        app.innerHTML = `
          <div class="gmail-container">
            <div class="gmail-header">
              <div class="header-left">
                <button class="menu-btn" onclick="toggleSidebar()">
                  ${getSVGIcon('menu')}
                </button>
                <div class="gmail-logo">
                  ${getSVGIcon('inbox')}
                  ${config.app_title || defaultConfig.app_title}
                </div>
              </div>
              <div class="search-bar">
                <div class="search-icon">${getSVGIcon('search')}</div>
                <input type="text" class="search-input" placeholder="Search mail">
              </div>
              <div class="header-right">
                <button class="header-btn" onclick="showSettings()">${getSVGIcon('settings')}</button>
                <button class="header-btn">${getSVGIcon('apps')}</button>
                <div class="profile-avatar" onclick="logout()">
                  ${currentUser.profilePic ? `<img src="${currentUser.profilePic}" alt="${currentUser.name}">` : currentUser.name.charAt(0).toUpperCase()}
                </div>
              </div>
            </div>
            
            <div class="gmail-body">
              <div class="sidebar">
                <button class="compose-btn" onclick="showCompose()">
                  ${getSVGIcon('edit')}
                  ${t('compose')}
                </button>
                
                <ul class="sidebar-nav">
                  ${folders.map(folder => `
                    <li class="nav-item ${folder.id === currentFolder ? 'active' : ''}" 
                        data-folder="${folder.id}" 
                        onclick="switchFolder('${folder.id}')">
                      <div class="nav-icon">${getSVGIcon(folder.icon)}</div>
                      <span>${t(folder.id)}</span>
                      ${folder.count > 0 ? `<span class="nav-count">${folder.count}</span>` : ''}
                    </li>
                  `).join('')}
                </ul>
              </div>
              
              <div class="main-content">
                <div class="content-header">
                  <div class="content-title" id="contentTitle">
                    ${folders.find(f => f.id === currentFolder)?.name || 'Inbox'}
                  </div>
                  <div class="content-actions">
                    <button class="action-btn">${getSVGIcon('settings')}</button>
                  </div>
                </div>
                
                <div class="email-list" id="emailsList">
                  <div class="loading">Emails load ho rahe hain...</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Compose Modal -->
          <div id="composeModal" class="compose-modal">
            <div class="compose-header">
              <div class="compose-title">${t('newMessage')}</div>
              <div class="compose-actions">
                <button class="compose-action-btn" onclick="closeCompose()">${getSVGIcon('minimize')}</button>
                <button class="compose-action-btn" onclick="closeCompose()">${getSVGIcon('close')}</button>
              </div>
            </div>
            
            <form id="composeForm" onsubmit="sendEmail(event)" class="compose-body">
              <div class="compose-fields">
                <div class="compose-field">
                  <div class="field-label">${t('from')}</div>
                  <input type="email" id="composeFrom" class="field-input" readonly>
                </div>
                <div class="compose-field">
                  <div class="field-label">${t('to')}</div>
                  <input type="text" id="composeTo" class="field-input" placeholder="${t('separateWithCommas')}" required>
                </div>
                <div class="compose-field">
                  <div class="field-label">${t('subject')}</div>
                  <input type="text" id="composeSubject" class="field-input" placeholder="${t('subject')}" required>
                </div>
              </div>
              
              <div class="compose-editor">
                <div class="editor-toolbar">
                  <select class="font-select" onchange="changeFont(this.value)">
                    <option value="Arial">Arial</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Verdana">Verdana</option>
                  </select>
                  <button type="button" class="toolbar-btn" data-command="bold" onclick="formatText('bold')">${getSVGIcon('bold')}</button>
                  <button type="button" class="toolbar-btn" data-command="italic" onclick="formatText('italic')">${getSVGIcon('italic')}</button>
                  <button type="button" class="toolbar-btn" data-command="underline" onclick="formatText('underline')">${getSVGIcon('underline')}</button>
                  <button type="button" class="toolbar-btn" onclick="insertLink()">${getSVGIcon('link')}</button>
                  <button type="button" class="toolbar-btn" onclick="formatText('insertUnorderedList')">${getSVGIcon('list')}</button>
                </div>
                
                <div id="composeEditor" class="editor-content" contenteditable="true" placeholder="Compose email..."></div>
                
                <div class="file-upload-area">
                  <div class="file-upload-text">Files attach karne ke liye yahan drop karein ya click karein</div>
                  <input type="file" id="fileInput" class="file-input" multiple onchange="handleFileUpload(event)" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif">
                  <button type="button" class="file-btn" onclick="document.getElementById('fileInput').click()">Choose Files</button>
                  <div id="uploadedFiles" class="uploaded-files"></div>
                </div>
              </div>
              
              <div class="compose-footer">
                <button type="submit" class="send-btn">${t('send')}</button>
                <div class="footer-actions">
                  <button type="button" class="footer-btn">${getSVGIcon('attach')}</button>
                  <button type="button" class="footer-btn" onclick="closeCompose()">${getSVGIcon('delete')}</button>
                </div>
              </div>
            </form>
          </div>

          <!-- Email View Modal -->
          <div id="emailModal" class="email-modal">
            <div class="email-modal-content">
              <div class="email-modal-header">
                <div class="email-modal-title" id="emailModalTitle"></div>
                <button class="close-btn" onclick="closeModal('emailModal')">${getSVGIcon('close')}</button>
              </div>
              
              <div class="email-modal-body">
                <div class="email-header-info">
                  <div class="email-from" id="emailFrom"></div>
                  <div class="email-to" id="emailTo"></div>
                  <div class="email-date" id="emailDate"></div>
                </div>
                
                <div class="email-body-content" id="emailBodyContent"></div>
                
                <div class="email-attachments" id="emailAttachments"></div>
                
                <div class="reply-section">
                  <div class="reply-suggestions" id="replySuggestions"></div>
                  
                  <button class="reply-btn" onclick="showReplyForm()">
                    ${getSVGIcon('reply')} ${t('reply')}
                  </button>
                  
                  <div id="replyForm" class="reply-form">
                    <textarea id="replyEditor" class="reply-editor" placeholder="Type your reply..."></textarea>
                    <div class="reply-actions">
                      <button class="reply-btn" onclick="sendReply()">${t('send')}</button>
                      <button class="cancel-btn" onclick="hideReplyForm()">${t('cancel')}</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      } else if (currentView === 'settings') {
        app.innerHTML = `
          <div class="gmail-container">
            <div class="gmail-header">
              <div class="header-left">
                <button class="menu-btn" onclick="currentView='inbox'; render();">
                  ${getSVGIcon('menu')}
                </button>
                <div class="gmail-logo">
                  ${getSVGIcon('settings')}
                  ${t('settings')}
                </div>
              </div>
              <div class="header-right">
                <div class="profile-avatar" onclick="logout()">
                  ${currentUser.profilePic ? `<img src="${currentUser.profilePic}" alt="${currentUser.name}">` : currentUser.name.charAt(0).toUpperCase()}
                </div>
              </div>
            </div>
            
            <div class="gmail-body" style="padding: 40px;">
              <div style="max-width: 600px; margin: 0 auto;">
                <h2 style="margin-bottom: 30px; color: #202124;">${t('settings')}</h2>
                
                <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 30px;">
                  <h3 style="margin-bottom: 20px; color: #202124;">${t('language')}</h3>
                  <div style="display: flex; gap: 10px;">
                    <button type="button" class="btn ${currentLanguage === 'en' ? '' : 'btn-secondary'}" onclick="switchLanguage('en')">${t('english')}</button>
                    <button type="button" class="btn ${currentLanguage === 'hi' ? '' : 'btn-secondary'}" onclick="switchLanguage('hi')">${t('hindi')}</button>
                  </div>
                </div>
                
                <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <h3 style="margin-bottom: 20px; color: #202124;">${t('changePassword')}</h3>
                  <div id="settingsError" class="error-message"></div>
                  <div id="settingsSuccess" class="success-message"></div>
                  
                  <form id="changePasswordForm" onsubmit="handleChangePassword(event)">
                    <div class="form-group">
                      <label>${t('currentPassword')}</label>
                      <input type="password" id="currentPassword" placeholder="${t('currentPassword')}" required>
                    </div>
                    <div class="form-group">
                      <label>${t('newPassword')}</label>
                      <input type="password" id="newPasswordSettings" placeholder="${t('newPassword')}" minlength="6" required>
                    </div>
                    <div class="form-group">
                      <label>${t('confirmPassword')}</label>
                      <input type="password" id="confirmPasswordSettings" placeholder="${t('confirmPassword')}" minlength="6" required>
                    </div>
                    <button type="submit" class="btn">${t('updatePassword')}</button>
                  </form>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                  <button class="btn btn-secondary" onclick="currentView='inbox'; render();">${currentLanguage === 'en' ? 'Back to Inbox' : 'Inbox Par Wapas Jayen'}</button>
                </div>
              </div>
            </div>
          </div>
        `;
      }
    }

    render();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99897af4801259d8',t:'MTc2MjE0NzgzMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
