<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Homy - Your Home Shopping Destination</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Amazon-like styling */
        .star-rating {
            color: #ffa41c;
        }
        .product-card {
            transition: all 0.2s ease;
            border: 1px solid #e7e7e7;
        }
        .product-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-color: #c7c7c7;
        }
        .amazon-orange {
            background-color: #ff9900;
        }
        .amazon-orange:hover {
            background-color: #e88900;
        }
        .amazon-blue {
            background-color: #232f3e;
        }
        .amazon-blue:hover {
            background-color: #1a252f;
        }
        .amazon-light-blue {
            background-color: #37475a;
        }
        .amazon-light-blue:hover {
            background-color: #2a3441;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ff9900;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .product-card {
                margin-bottom: 1rem;
            }
            
            .text-responsive {
                font-size: 0.875rem;
            }
            
            .btn-responsive {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            
            .modal-responsive {
                margin: 1rem;
                max-height: 90vh;
                overflow-y: auto;
            }
        }
        
        /* Prevent zoom on input focus */
        input, select, textarea {
            font-size: 16px !important;
        }
        
        @media (max-width: 768px) {
            input, select, textarea {
                font-size: 16px !important;
                transform: scale(1);
            }
        }
        .sidebar {
            background: #f8f9fa;
            border-right: 1px solid #e7e7e7;
        }
        .nav-item {
            border-bottom: 1px solid #e7e7e7;
        }
        .nav-item:hover {
            background-color: #f0f2f2;
        }
        .badge-new {
            background: #ff4444;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
        }
        .order-status {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
        }
        .refund-badge {
            background: #ff6b6b;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation Header -->
    <header class="amazon-blue text-white sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 py-2">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold cursor-pointer flex items-center hover:text-gray-200" onclick="showHomePage()">
                        <img src="https://pulse.oriontec.xyz/IMG_0901.png" alt="Homy Logo" class="w-20 h-20 mr-3">
                        <span>Homy</span>
                    </h1>
                    <div class="hidden md:flex items-center flex-1 max-w-xl ml-8">
                        <div class="flex w-full">
                            <input type="text" id="searchInput" placeholder="Search products..." class="flex-1 px-4 py-2 text-gray-800 focus:outline-none rounded-l">
                            <button onclick="searchProducts()" class="amazon-orange px-4 py-2 rounded-r hover:bg-yellow-500">
                                <i class="fas fa-search text-gray-800"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Mobile Search Icon -->
                    <button onclick="toggleMobileSearch()" class="md:hidden text-white hover:text-gray-200">
                        <i class="fas fa-search text-xl"></i>
                    </button>
                    
                    <div id="userSection" class="hidden flex items-center space-x-4">
                        <!-- Orders -->
                        <button onclick="showOrders()" class="hidden md:flex flex-col items-center text-white hover:text-gray-200">
                            <span class="text-xs">Returns</span>
                            <span class="text-sm font-semibold">& Orders</span>
                        </button>
                        
                        <!-- Cart -->
                        <button onclick="showCart()" class="relative flex items-center text-white hover:text-gray-200">
                            <div class="relative">
                                <i class="fas fa-shopping-cart text-2xl"></i>
                                <span id="cartCount" class="absolute -top-2 -right-2 bg-orange-500 text-xs rounded-full px-1 min-w-[16px] h-4 flex items-center justify-center">0</span>
                            </div>
                            <span class="ml-1 hidden md:block text-sm font-semibold">Cart</span>
                        </button>
                        
                        <!-- Account Menu -->
                        <div class="relative">
                            <button onclick="showAccountMenu()" class="flex flex-col items-center text-white hover:text-gray-200">
                                <span class="text-xs">Hello, <span id="userName">User</span></span>
                                <span class="text-sm font-semibold flex items-center">Account & Lists <i class="fas fa-caret-down ml-1"></i></span>
                            </button>
                        </div>
                    </div>
                    
                    <div id="loginSection">
                        <button onclick="loginWithGoogle()" class="amazon-orange px-4 py-2 rounded hover:bg-yellow-500 text-gray-800 font-semibold">
                            <i class="fab fa-google mr-2"></i>Sign In
                        </button>
                    </div>
                </div>
            </div>
        </div>
        

    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <!-- Home Page -->
        <div id="homePage" class="fade-in">
            <!-- Announcements Banner -->
            <div id="announcementBanner" class="mb-4 hidden">
                <!-- Active announcements will be displayed here -->
            </div>
            
            <!-- Hero Banner -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-8 rounded-lg mb-6">
                <div class="max-w-4xl">
                    <h1 class="text-4xl font-bold mb-4">Welcome to Homy</h1>
                    <p class="text-xl mb-6">Discover amazing products at unbeatable prices</p>
                    <button onclick="filterByCategory('electronics')" class="amazon-orange text-gray-800 px-6 py-3 rounded-lg font-semibold hover:bg-yellow-500">
                        Shop Electronics
                    </button>
                </div>
            </div>
            
            <!-- Quick Categories -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
                <div class="category-card bg-white p-4 rounded-lg shadow hover:shadow-md cursor-pointer text-center border" onclick="filterByCategory('electronics')">
                    <div class="w-16 h-16 mx-auto mb-3 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-laptop text-2xl text-blue-600"></i>
                    </div>
                    <p class="font-semibold text-sm">Electronics</p>
                </div>
                <div class="category-card bg-white p-4 rounded-lg shadow hover:shadow-md cursor-pointer text-center border" onclick="filterByCategory('fashion')">
                    <div class="w-16 h-16 mx-auto mb-3 bg-green-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-tshirt text-2xl text-green-600"></i>
                    </div>
                    <p class="font-semibold text-sm">Fashion</p>
                </div>
                <div class="category-card bg-white p-4 rounded-lg shadow hover:shadow-md cursor-pointer text-center border" onclick="filterByCategory('books')">
                    <div class="w-16 h-16 mx-auto mb-3 bg-purple-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-book text-2xl text-purple-600"></i>
                    </div>
                    <p class="font-semibold text-sm">Books</p>
                </div>
                <div class="category-card bg-white p-4 rounded-lg shadow hover:shadow-md cursor-pointer text-center border" onclick="filterByCategory('grocery')">
                    <div class="w-16 h-16 mx-auto mb-3 bg-orange-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-shopping-basket text-2xl text-orange-600"></i>
                    </div>
                    <p class="font-semibold text-sm">Grocery</p>
                </div>
                <div class="category-card bg-white p-4 rounded-lg shadow hover:shadow-md cursor-pointer text-center border" onclick="filterByCategory('jewelry')">
                    <div class="w-16 h-16 mx-auto mb-3 bg-red-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-gem text-2xl text-red-600"></i>
                    </div>
                    <p class="font-semibold text-sm">Jewelry</p>
                </div>
                <div class="category-card bg-white p-4 rounded-lg shadow hover:shadow-md cursor-pointer text-center border" onclick="filterByCategory('toys')">
                    <div class="w-16 h-16 mx-auto mb-3 bg-pink-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-gamepad text-2xl text-pink-600"></i>
                    </div>
                    <p class="font-semibold text-sm">Toys</p>
                </div>
            </div>



            <!-- All Products -->
            <div class="bg-white rounded-lg shadow-sm border p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 border-b pb-4">All Products</h2>
                <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                    <!-- Products will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Product Detail Page -->
        <div id="productDetailPage" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <img id="productImage" src="" alt="" class="w-full h-96 object-cover rounded-lg mb-4">
                        <div id="productGallery" class="flex space-x-2 overflow-x-auto">
                            <!-- Additional images will be loaded here -->
                        </div>
                    </div>
                    <div>
                        <h1 id="productTitle" class="text-3xl font-bold mb-4"></h1>
                        <div id="productRating" class="flex items-center mb-4">
                            <!-- Rating stars will be loaded here -->
                        </div>
                        <div class="mb-4">
                            <span id="productPrice" class="text-3xl font-bold text-green-600"></span>
                            <span id="productMRP" class="text-xl text-gray-500 line-through ml-2"></span>
                        </div>
                        <p id="productDescription" class="text-gray-700 mb-6"></p>
                        
                        <!-- Variants Section -->
                        <div id="variantsSection" class="mb-6">
                            <div id="colorVariants" class="mb-4 hidden">
                                <h3 class="font-semibold mb-2">Color:</h3>
                                <div id="colorOptions" class="flex space-x-2">
                                    <!-- Color options will be loaded here -->
                                </div>
                            </div>
                            <div id="sizeVariants" class="mb-4 hidden">
                                <h3 class="font-semibold mb-2">Size:</h3>
                                <div id="sizeOptions" class="flex space-x-2">
                                    <!-- Size options will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Pincode Verification -->
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                            <h3 class="font-semibold mb-3 flex items-center">
                                <i class="fas fa-map-marker-alt mr-2 text-blue-600"></i>
                                Check Delivery & Services
                            </h3>
                            <div class="flex space-x-2">
                                <input type="text" id="pincodeInput" placeholder="Enter pincode" class="flex-1 border rounded-lg px-3 py-2" maxlength="6" pattern="[0-9]{6}">
                                <button onclick="verifyPincode()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                    Check
                                </button>
                            </div>
                            <div id="pincodeResult" class="mt-3 hidden">
                                <!-- Pincode verification result will appear here -->
                            </div>
                        </div>

                        <div class="flex space-x-4 mb-6">
                            <button onclick="addToCart()" class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 flex-1">
                                <i class="fas fa-shopping-cart mr-2"></i>Add to Cart
                            </button>
                            <button onclick="buyNow()" class="bg-gray-800 text-white px-6 py-3 rounded-lg hover:bg-gray-900 flex-1">
                                Buy Now
                            </button>
                        </div>
                        
                        <!-- Additional Actions -->
                        <div class="flex space-x-2 mb-6">
                            <button onclick="toggleWishlist(currentProduct.id)" class="flex-1 border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 flex items-center justify-center">
                                <i class="fas fa-heart mr-2"></i>Add to Wishlist
                            </button>
                            <button onclick="addToComparison(currentProduct.id)" class="flex-1 border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 flex items-center justify-center">
                                <i class="fas fa-balance-scale mr-2"></i>Compare
                            </button>
                            <button onclick="shareProduct(currentProduct.id)" class="border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50">
                                <i class="fas fa-share-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reviews Section -->
                <div class="mt-8 border-t pt-8">
                    <h2 class="text-2xl font-bold mb-6">Customer Reviews</h2>
                    <div class="mb-6">
                        <button onclick="showReviewForm()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            Write a Review
                        </button>
                    </div>
                    <div id="reviewsContainer">
                        <!-- Reviews will be loaded here -->
                    </div>
                </div>

                <!-- Related Products -->
                <div class="mt-8 border-t pt-8">
                    <h2 class="text-2xl font-bold mb-6">Related Products</h2>
                    <div id="relatedProducts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Related products will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Cart Page -->
        <div id="cartPage" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-6">Shopping Cart</h2>
                <div id="cartItems">
                    <!-- Cart items will be loaded here -->
                </div>
                <div class="border-t pt-4 mt-6">
                    <div class="flex justify-between items-center text-xl font-bold">
                        <span>Total: </span>
                        <span id="cartTotal">₹0</span>
                    </div>
                    <button onclick="proceedToCheckout()" class="w-full bg-red-500 text-white py-3 rounded-lg mt-4 hover:bg-red-600">
                        Proceed to Checkout
                    </button>
                </div>
            </div>
        </div>

        <!-- Checkout Page -->
        <div id="checkoutPage" class="hidden fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-6">Shipping Information</h2>
                    <form id="checkoutForm">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Full Name</label>
                            <input type="text" id="fullName" class="w-full border rounded-lg px-3 py-2" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Email</label>
                            <input type="email" id="email" class="w-full border rounded-lg px-3 py-2" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Phone Number</label>
                            <input type="tel" id="phone" class="w-full border rounded-lg px-3 py-2" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Address</label>
                            <textarea id="address" class="w-full border rounded-lg px-3 py-2" rows="3" required></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">City</label>
                                <input type="text" id="city" class="w-full border rounded-lg px-3 py-2" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">PIN Code</label>
                                <div class="flex">
                                    <input type="text" id="pincode" class="flex-1 border rounded-l-lg px-3 py-2" maxlength="6" pattern="[0-9]{6}" required>
                                    <button type="button" onclick="autoFillAddress()" class="bg-blue-500 text-white px-3 py-2 rounded-r-lg hover:bg-blue-600">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Enter pincode to auto-fill city and state</p>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">State</label>
                            <input type="text" id="state" class="w-full border rounded-lg px-3 py-2" required>
                        </div>
                    </form>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-6">Order Summary</h2>
                    <div id="checkoutItems">
                        <!-- Checkout items will be loaded here -->
                    </div>
                    <div class="border-t pt-4 mt-6">
                        <div class="flex justify-between mb-2">
                            <span>Subtotal:</span>
                            <span id="subtotal">₹0</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span>Shipping:</span>
                            <span>₹50</span>
                        </div>
                        <div class="flex justify-between text-xl font-bold">
                            <span>Total:</span>
                            <span id="finalTotal">₹0</span>
                        </div>
                        <button onclick="proceedToPayment()" class="w-full bg-red-600 text-white py-3 rounded-lg mt-4 hover:bg-red-700">
                            Proceed to Payment
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Page -->
        <div id="paymentPage" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6 max-w-md mx-auto">
                <h2 class="text-2xl font-bold mb-6">Payment</h2>
                <div class="mb-6">
                    <h3 class="font-semibold mb-4">Select Payment Method</h3>
                    <div class="space-y-3">
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="payment" value="upi" class="mr-3" checked>
                            <i class="fas fa-mobile-alt mr-2 text-green-600"></i>UPI Payment
                        </label>
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="payment" value="cod" class="mr-3">
                            <i class="fas fa-money-bill-wave mr-2 text-blue-600"></i>Cash on Delivery
                        </label>
                    </div>
                </div>

                <!-- UPI Apps Selection -->
                <div id="upiAppsSection" class="mb-6">
                    <h4 class="font-semibold mb-3">Choose UPI App</h4>
                    <div class="grid grid-cols-2 gap-3" id="upiOptions">
                        <button onclick="selectUPIApp('phonepe')" class="flex items-center justify-center p-3 border rounded-lg hover:bg-purple-50 hover:border-purple-500">
                            <div class="text-center">
                                <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold text-sm mb-1">Pe</div>
                                <div class="text-xs">PhonePe</div>
                            </div>
                        </button>
                        <button onclick="selectUPIApp('paytm')" class="flex items-center justify-center p-3 border rounded-lg hover:bg-blue-50 hover:border-blue-500">
                            <div class="text-center">
                                <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-sm mb-1">Py</div>
                                <div class="text-xs">Paytm</div>
                            </div>
                        </button>
                        <button onclick="selectUPIApp('googlepay')" class="flex items-center justify-center p-3 border rounded-lg hover:bg-green-50 hover:border-green-500">
                            <div class="text-center">
                                <div class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-sm mb-1">G</div>
                                <div class="text-xs">Google Pay</div>
                            </div>
                        </button>
                        <button onclick="selectUPIApp('bhim')" class="flex items-center justify-center p-3 border rounded-lg hover:bg-orange-50 hover:border-orange-500">
                            <div class="text-center">
                                <div class="w-8 h-8 bg-orange-600 rounded-full flex items-center justify-center text-white font-bold text-sm mb-1">B</div>
                                <div class="text-xs">BHIM</div>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- COD Advance Info -->
                <div id="codAdvanceInfo" class="mb-6 hidden">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h4 class="font-semibold text-yellow-800 mb-2">Advance Payment Required</h4>
                        <p class="text-sm text-yellow-700 mb-2">For Cash on Delivery, you need to pay ₹<span id="codAdvance">0</span> as advance via UPI.</p>
                        <p class="text-xs text-yellow-600">Remaining amount will be collected at delivery.</p>
                    </div>
                </div>

                <div class="mb-6">
                    <div class="flex justify-between text-xl font-bold">
                        <span>Amount to Pay:</span>
                        <span id="paymentAmount">₹0</span>
                    </div>
                </div>
                <button onclick="processPayment()" class="w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700">
                    <span id="paymentButtonText">Pay Now</span>
                </button>
            </div>
        </div>

        <!-- Orders Page -->
        <div id="ordersPage" class="hidden fade-in">
            <div class="max-w-6xl mx-auto">
                <!-- Orders Header -->
                <div class="bg-white rounded-lg shadow-sm border p-6 mb-6">
                    <div class="flex justify-between items-center">
                        <h1 class="text-2xl font-bold">Your Orders</h1>
                        <div class="flex space-x-4">
                            <input type="text" id="orderSearch" placeholder="Search your orders" class="border rounded-lg px-4 py-2 w-64">
                            <select id="orderFilter" class="border rounded-lg px-4 py-2">
                                <option value="all">All Orders</option>
                                <option value="pending">Pending</option>
                                <option value="accepted">Confirmed</option>
                                <option value="shipped">Shipped</option>
                                <option value="delivered">Delivered</option>
                                <option value="cancelled">Cancelled</option>
                                <option value="refund-requested">Refund Requested</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Orders List -->
                <div id="ordersContainer" class="space-y-4">
                    <!-- Orders will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Business Panel -->
        <div id="businessPanel" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-6">Business Dashboard</h2>
                
                <!-- Dashboard Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600" id="sellerTotalProducts">0</div>
                        <div class="text-sm text-blue-800">Total Products</div>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600" id="sellerTotalOrders">0</div>
                        <div class="text-sm text-green-800">Total Orders</div>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-yellow-600" id="sellerPendingOrders">0</div>
                        <div class="text-sm text-yellow-800">Pending Orders</div>
                    </div>
                    <div class="bg-purple-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-purple-600" id="sellerTotalEarnings">₹0</div>
                        <div class="text-sm text-purple-800">Total Earnings</div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-4 mb-6">
                    <button onclick="showAddProductForm()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                        <i class="fas fa-plus mr-2"></i>Add New Product
                    </button>
                    <button onclick="showSellerOrders()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        <i class="fas fa-shopping-bag mr-2"></i>Manage Orders
                    </button>
                    <button onclick="showSellerProducts()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        <i class="fas fa-box mr-2"></i>My Products
                    </button>
                </div>

                <!-- Quick View -->
                <div id="businessQuickView">
                    <h3 class="text-lg font-semibold mb-4">Recent Orders</h3>
                    <div id="recentSellerOrders" class="space-y-3">
                        <!-- Recent orders will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Seller Orders Management -->
        <div id="sellerOrdersPage" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Order Management</h2>
                    <button onclick="showBusinessPanel()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                    </button>
                </div>
                
                <!-- Order Filters -->
                <div class="flex flex-wrap gap-2 mb-6">
                    <button onclick="filterSellerOrders('all')" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300" id="filterAll">All Orders</button>
                    <button onclick="filterSellerOrders('pending')" class="px-4 py-2 bg-yellow-200 rounded hover:bg-yellow-300" id="filterPending">Pending</button>
                    <button onclick="filterSellerOrders('accepted')" class="px-4 py-2 bg-green-200 rounded hover:bg-green-300" id="filterAccepted">Accepted</button>
                    <button onclick="filterSellerOrders('shipped')" class="px-4 py-2 bg-blue-200 rounded hover:bg-blue-300" id="filterShipped">Shipped</button>
                    <button onclick="filterSellerOrders('delivered')" class="px-4 py-2 bg-purple-200 rounded hover:bg-purple-300" id="filterDelivered">Delivered</button>
                    <button onclick="filterSellerOrders('rejected')" class="px-4 py-2 bg-red-200 rounded hover:bg-red-300" id="filterRejected">Rejected</button>
                </div>

                <div id="sellerOrdersList" class="space-y-4">
                    <!-- Seller orders will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Seller Products Management -->
        <div id="sellerProductsPage" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">My Products</h2>
                    <div class="space-x-2">
                        <button onclick="showAddProductForm()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                            <i class="fas fa-plus mr-2"></i>Add Product
                        </button>
                        <button onclick="showBusinessPanel()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </button>
                    </div>
                </div>
                
                <div id="businessProducts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Business products will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settingsPage" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-6">Settings</h2>
                <div class="space-y-6">
                    <div class="border-b pb-6">
                        <h3 class="text-lg font-semibold mb-4">Account Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Name</label>
                                <input type="text" id="userDisplayName" class="w-full border rounded-lg px-3 py-2" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Email</label>
                                <input type="email" id="userEmail" class="w-full border rounded-lg px-3 py-2" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <div id="sellerSection" class="border-b pb-6">
                        <h3 class="text-lg font-semibold mb-4">Seller Account</h3>
                        <div id="notSellerSection">
                            <p class="text-gray-600 mb-4">Want to sell products on TrendCart? Create your seller account now!</p>
                            <button onclick="showSellerRegistration()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700">
                                Create Seller Account
                            </button>
                        </div>
                        <div id="sellerStatusSection" class="hidden">
                            <div class="flex items-center space-x-4">
                                <div class="flex-1">
                                    <p class="font-semibold">Seller Status: <span id="sellerStatus" class="text-green-600">Active</span></p>
                                    <p class="text-sm text-gray-600">Business Name: <span id="sellerBusinessName"></span></p>
                                </div>
                                <button onclick="showBusinessPanel()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                                    Manage Products
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seller Registration Form -->
        <div id="sellerRegistrationPage" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6 max-w-2xl mx-auto">
                <h2 class="text-2xl font-bold mb-6">Create Seller Account</h2>
                <form id="sellerRegistrationForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Business Name *</label>
                        <input type="text" id="businessName" class="w-full border rounded-lg px-3 py-2" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">PAN Number *</label>
                        <input type="text" id="panNumber" class="w-full border rounded-lg px-3 py-2" pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" placeholder="ABCDE1234F" required>
                        <p class="text-xs text-gray-500 mt-1">Enter valid PAN number (e.g., ABCDE1234F)</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">UPI ID *</label>
                        <input type="text" id="upiId" class="w-full border rounded-lg px-3 py-2" placeholder="yourname@paytm" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Business Category *</label>
                        <select id="businessCategory" class="w-full border rounded-lg px-3 py-2" required>
                            <option value="">Select Category</option>
                            <option value="fashion">Fashion</option>
                            <option value="grocery">Grocery</option>
                            <option value="electronics">Electronics</option>
                            <option value="jewelry">Jewelry</option>
                            <option value="toys">Toys</option>
                            <option value="books">Books</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Business Address *</label>
                        <textarea id="businessAddress" class="w-full border rounded-lg px-3 py-2" rows="3" required></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">City *</label>
                            <input type="text" id="businessCity" class="w-full border rounded-lg px-3 py-2" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">PIN Code *</label>
                            <input type="text" id="businessPincode" class="w-full border rounded-lg px-3 py-2" pattern="[0-9]{6}" required>
                        </div>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="termsAccepted" class="mr-2" required>
                        <label for="termsAccepted" class="text-sm">I agree to the Terms and Conditions for sellers</label>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700">
                            Submit for Review
                        </button>
                        <button type="button" onclick="showSettings()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">
                    <i class="fas fa-crown mr-2 text-red-600"></i>Admin Dashboard
                </h2>
                
                <!-- Admin Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-blue-100 p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800">Total Users</h3>
                        <p id="totalUsers" class="text-2xl font-bold text-blue-600">0</p>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h3 class="font-semibold text-green-800">Total Products</h3>
                        <p id="totalProducts" class="text-2xl font-bold text-green-600">0</p>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded-lg">
                        <h3 class="font-semibold text-yellow-800">Total Orders</h3>
                        <p id="totalOrders" class="text-2xl font-bold text-yellow-600">0</p>
                    </div>
                    <div class="bg-purple-100 p-4 rounded-lg">
                        <h3 class="font-semibold text-purple-800">Total Sellers</h3>
                        <p id="totalSellers" class="text-2xl font-bold text-purple-600">0</p>
                    </div>
                </div>

                <!-- Admin Actions -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <button onclick="showCategoryManager()" class="bg-red-600 text-white p-4 rounded-lg hover:bg-red-700">
                        <i class="fas fa-tags text-2xl mb-2"></i>
                        <div class="font-semibold">Manage Categories</div>
                        <div class="text-sm opacity-90">Update category images & names</div>
                    </button>
                    
                    <button onclick="showAnnouncementManager()" class="bg-gray-700 text-white p-4 rounded-lg hover:bg-gray-800">
                        <i class="fas fa-bullhorn text-2xl mb-2"></i>
                        <div class="font-semibold">Announcements</div>
                        <div class="text-sm opacity-90">Create sales & promotional banners</div>
                    </button>
                    
                    <button onclick="showSellerManager()" class="bg-red-500 text-white p-4 rounded-lg hover:bg-red-600">
                        <i class="fas fa-store text-2xl mb-2"></i>
                        <div class="font-semibold">Manage Sellers</div>
                        <div class="text-sm opacity-90">Approve/reject seller applications</div>
                    </button>
                    
                    <button onclick="showProductManager()" class="bg-gray-600 text-white p-4 rounded-lg hover:bg-gray-700">
                        <i class="fas fa-box text-2xl mb-2"></i>
                        <div class="font-semibold">Product Management</div>
                        <div class="text-sm opacity-90">Review & moderate products</div>
                    </button>
                    
                    <button onclick="showOrderManager()" class="bg-red-700 text-white p-4 rounded-lg hover:bg-red-800">
                        <i class="fas fa-shopping-cart text-2xl mb-2"></i>
                        <div class="font-semibold">Order Management</div>
                        <div class="text-sm opacity-90">Monitor all platform orders</div>
                    </button>
                    
                    <button onclick="showAnalytics()" class="bg-gray-800 text-white p-4 rounded-lg hover:bg-gray-900">
                        <i class="fas fa-chart-bar text-2xl mb-2"></i>
                        <div class="font-semibold">Analytics</div>
                        <div class="text-sm opacity-90">Platform performance metrics</div>
                    </button>
                </div>

                <!-- Recent Activity -->
                <div class="border-t pt-6">
                    <h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
                    <div id="recentActivity" class="space-y-3">
                        <!-- Recent activity will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Category Manager -->
        <div id="categoryManager" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Category Management</h2>
                    <button onclick="showAdminPanel()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Admin
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="categoryGrid">
                    <!-- Categories will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Announcement Manager -->
        <div id="announcementManager" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Announcement Management</h2>
                    <div class="space-x-2">
                        <button onclick="showCreateAnnouncement()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                            <i class="fas fa-plus mr-2"></i>Create Announcement
                        </button>
                        <button onclick="showAdminPanel()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Admin
                        </button>
                    </div>
                </div>
                
                <div id="announcementsList" class="space-y-4">
                    <!-- Announcements will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Create Announcement Form -->
        <div id="createAnnouncementForm" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6 max-w-2xl mx-auto">
                <h2 class="text-2xl font-bold mb-6">Create New Announcement</h2>
                <form id="announcementForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Announcement Type</label>
                        <select id="announcementType" class="w-full border rounded-lg px-3 py-2" required>
                            <option value="">Select Type</option>
                            <option value="sale">Sale/Discount</option>
                            <option value="new-arrival">New Arrival</option>
                            <option value="festival">Festival Offer</option>
                            <option value="general">General Announcement</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Title</label>
                        <input type="text" id="announcementTitle" class="w-full border rounded-lg px-3 py-2" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Description</label>
                        <textarea id="announcementDescription" class="w-full border rounded-lg px-3 py-2" rows="3" required></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Start Date</label>
                            <input type="datetime-local" id="announcementStart" class="w-full border rounded-lg px-3 py-2" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">End Date</label>
                            <input type="datetime-local" id="announcementEnd" class="w-full border rounded-lg px-3 py-2" required>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Banner Color</label>
                        <select id="announcementColor" class="w-full border rounded-lg px-3 py-2">
                            <option value="bg-red-500">Red (Sale/Urgent)</option>
                            <option value="bg-green-500">Green (New/Fresh)</option>
                            <option value="bg-blue-500">Blue (Information)</option>
                            <option value="bg-purple-500">Purple (Premium)</option>
                            <option value="bg-orange-500">Orange (Festival)</option>
                            <option value="bg-yellow-500">Yellow (Warning/Alert)</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="announcementActive" class="mr-2" checked>
                        <label for="announcementActive" class="text-sm">Active (show on homepage)</label>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700">
                            Create Announcement
                        </button>
                        <button type="button" onclick="showAnnouncementManager()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Product Form -->
        <div id="addProductForm" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-6">Add New Product</h2>
                <form id="productForm" class="space-y-6">
                    <!-- Basic Info -->
                    <div class="border-b pb-6">
                        <h3 class="text-lg font-semibold mb-4">🏷️ Basic Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Product Name *</label>
                                <input type="text" id="productName" class="w-full border rounded-lg px-3 py-2" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Brand Name</label>
                                <input type="text" id="brandName" class="w-full border rounded-lg px-3 py-2">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Category *</label>
                                <select id="category" class="w-full border rounded-lg px-3 py-2" required onchange="toggleVariants()">
                                    <option value="">Select Category</option>
                                    <option value="fashion">Fashion</option>
                                    <option value="grocery">Grocery</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="jewelry">Jewelry</option>
                                    <option value="toys">Toys</option>
                                    <option value="books">Books</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Sub-Category</label>
                                <input type="text" id="subCategory" class="w-full border rounded-lg px-3 py-2">
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium mb-2">Short Description</label>
                            <input type="text" id="shortDescription" class="w-full border rounded-lg px-3 py-2" maxlength="100">
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium mb-2">Detailed Description</label>
                            <textarea id="detailedDescription" class="w-full border rounded-lg px-3 py-2" rows="4"></textarea>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium mb-2">Product Images *</label>
                            <input type="file" id="productImages" class="w-full border rounded-lg px-3 py-2" multiple accept="image/*" required>
                            <p class="text-xs text-gray-500 mt-1">Upload multiple images. First image will be the cover image.</p>
                            <div id="imagePreview" class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 hidden">
                                <!-- Image previews will appear here -->
                            </div>
                        </div>
                    </div>

                    <!-- Inventory & SKU -->
                    <div class="border-b pb-6">
                        <h3 class="text-lg font-semibold mb-4">📦 Inventory & SKU</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">SKU Code</label>
                                <div class="flex">
                                    <input type="text" id="skuCode" class="flex-1 border rounded-l-lg px-3 py-2">
                                    <button type="button" onclick="generateSKU()" class="bg-gray-500 text-white px-3 py-2 rounded-r-lg hover:bg-gray-600">Auto</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Stock Quantity *</label>
                                <input type="number" id="stockQuantity" class="w-full border rounded-lg px-3 py-2" required min="0">
                            </div>
                        </div>
                    </div>

                    <!-- Variants -->
                    <div id="variantsContainer" class="border-b pb-6 hidden">
                        <h3 class="text-lg font-semibold mb-4">🎨 Product Variants</h3>
                        
                        <!-- Color Variants -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">Color Variants</label>
                            <div id="colorVariantsList" class="space-y-4">
                                <!-- Color variants will be added here -->
                            </div>
                            <button type="button" onclick="addColorVariant()" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                                <i class="fas fa-plus mr-2"></i>Add Color Variant
                            </button>
                        </div>

                        <!-- Size Variants -->
                        <div>
                            <label class="block text-sm font-medium mb-2">Available Sizes</label>
                            <input type="text" id="sizes" class="w-full border rounded-lg px-3 py-2" placeholder="S, M, L, XL (comma separated)">
                        </div>
                    </div>

                    <!-- Pricing -->
                    <div class="border-b pb-6">
                        <h3 class="text-lg font-semibold mb-4">💰 Pricing</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">MRP (₹) *</label>
                                <input type="number" id="mrp" class="w-full border rounded-lg px-3 py-2" required min="0" step="0.01">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Selling Price (₹) *</label>
                                <input type="number" id="sellingPrice" class="w-full border rounded-lg px-3 py-2" required min="0" step="0.01">
                            </div>
                        </div>
                    </div>

                    <!-- Shipping -->
                    <div class="border-b pb-6">
                        <h3 class="text-lg font-semibold mb-4">🚚 Shipping & Delivery</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Weight (kg)</label>
                                <input type="number" id="weight" class="w-full border rounded-lg px-3 py-2" min="0" step="0.01">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Shipping Charges (₹)</label>
                                <input type="number" id="shippingCharges" class="w-full border rounded-lg px-3 py-2" min="0" step="0.01" value="50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Delivery Days</label>
                                <input type="number" id="deliveryDays" class="w-full border rounded-lg px-3 py-2" min="1" value="3">
                            </div>
                        </div>
                    </div>

                    <!-- Marketing -->
                    <div class="border-b pb-6">
                        <h3 class="text-lg font-semibold mb-4">📊 Marketing & Visibility</h3>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Tags/Keywords</label>
                            <input type="text" id="tags" class="w-full border rounded-lg px-3 py-2" placeholder="smartphone, android, mobile (comma separated)">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Product Highlights</label>
                            <textarea id="highlights" class="w-full border rounded-lg px-3 py-2" rows="3" placeholder="• Feature 1&#10;• Feature 2&#10;• Feature 3"></textarea>
                        </div>
                    </div>

                    <!-- Advanced Controls -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4">🔒 Advanced Controls</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Product Status</label>
                                <select id="productStatus" class="w-full border rounded-lg px-3 py-2">
                                    <option value="active">Active</option>
                                    <option value="draft">Draft</option>
                                    <option value="out-of-stock">Out of Stock</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Return Policy</label>
                                <select id="returnPolicy" class="w-full border rounded-lg px-3 py-2">
                                    <option value="yes">Returnable</option>
                                    <option value="no">Non-Returnable</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium mb-2">Warranty/Guarantee</label>
                            <input type="text" id="warranty" class="w-full border rounded-lg px-3 py-2" placeholder="1 Year Manufacturer Warranty">
                        </div>
                    </div>

                    <div class="flex space-x-4 pt-6">
                        <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-save mr-2"></i>Save Product
                        </button>
                        <button type="button" onclick="cancelAddProduct()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-40 md:hidden shadow-lg">
        <div class="flex justify-around items-center py-2">
            <button onclick="showHomePage()" class="flex flex-col items-center p-2 text-gray-600 hover:text-red-600 active:scale-95 transition-all" id="navHome">
                <i class="fas fa-home text-xl"></i>
                <span class="text-xs mt-1">Home</span>
            </button>
            <button onclick="showProfile()" class="flex flex-col items-center p-2 text-gray-600 hover:text-red-600 active:scale-95 transition-all" id="navProfile">
                <i class="fas fa-user text-xl"></i>
                <span class="text-xs mt-1">Profile</span>
            </button>
            <button onclick="showCart()" class="flex flex-col items-center p-2 text-gray-600 hover:text-red-600 relative active:scale-95 transition-all" id="navCart">
                <i class="fas fa-shopping-cart text-xl"></i>
                <span class="text-xs mt-1">Cart</span>
                <span id="bottomCartCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1 min-w-[16px] h-4 flex items-center justify-center hidden">0</span>
            </button>
            <button onclick="showMobileMenu()" class="flex flex-col items-center p-2 text-gray-600 hover:text-red-600 active:scale-95 transition-all" id="navMenu">
                <i class="fas fa-bars text-xl"></i>
                <span class="text-xs mt-1">Menu</span>
            </button>
        </div>
    </nav>

    <!-- Mobile Search Overlay -->
    <div id="mobileSearchOverlay" class="fixed inset-0 bg-white z-50 hidden">
        <div class="flex items-center p-4 border-b">
            <button onclick="closeMobileSearch()" class="mr-4 text-gray-600 hover:text-gray-800">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <div class="flex-1 flex items-center bg-gray-100 rounded-lg overflow-hidden border border-gray-300">
                <input type="text" id="mobileSearchInput" placeholder="Search products..." class="px-4 py-3 text-gray-800 w-full focus:outline-none bg-transparent" autofocus>
                <button onclick="searchProductsMobile()" class="bg-red-500 px-4 py-3 hover:bg-red-600 text-white">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
        <div class="p-4">
            <div class="text-sm text-gray-500 mb-4">Popular searches</div>
            <div class="flex flex-wrap gap-2">
                <button onclick="quickSearch('electronics')" class="px-3 py-1 bg-gray-100 rounded-full text-sm hover:bg-gray-200">Electronics</button>
                <button onclick="quickSearch('fashion')" class="px-3 py-1 bg-gray-100 rounded-full text-sm hover:bg-gray-200">Fashion</button>
                <button onclick="quickSearch('books')" class="px-3 py-1 bg-gray-100 rounded-full text-sm hover:bg-gray-200">Books</button>
                <button onclick="quickSearch('grocery')" class="px-3 py-1 bg-gray-100 rounded-full text-sm hover:bg-gray-200">Grocery</button>
            </div>
        </div>
    </div>

    <!-- Account Menu Dropdown -->
    <div id="accountMenuDropdown" class="fixed top-20 right-4 bg-white border rounded-lg shadow-lg z-50 w-64 hidden">
        <div class="p-4 border-b">
            <div class="flex items-center">
                <div class="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold">
                    <span id="accountInitials">U</span>
                </div>
                <div class="ml-3">
                    <div class="font-semibold" id="accountUserName">User Name</div>
                    <div class="text-sm text-gray-600" id="accountUserEmail">user@email.com</div>
                </div>
            </div>
        </div>
        <div class="py-2">
            <button onclick="showProfile(); closeAccountMenu();" class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center">
                <i class="fas fa-user mr-3 text-gray-600"></i>Your Account
            </button>
            <button onclick="showOrders(); closeAccountMenu();" class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center">
                <i class="fas fa-shopping-bag mr-3 text-gray-600"></i>Your Orders
            </button>
            <div id="accountSellerButton" class="hidden">
                <button onclick="showBusinessPanel(); closeAccountMenu();" class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center">
                    <i class="fas fa-store mr-3 text-orange-600"></i>Seller Central
                </button>
            </div>
            <div id="accountAdminButton" class="hidden">
                <button onclick="showAdminPanel(); closeAccountMenu();" class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center">
                    <i class="fas fa-crown mr-3 text-purple-600"></i>Admin Panel
                </button>
            </div>
            <hr class="my-2">
            <button onclick="showMobileSettings(); closeAccountMenu();" class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center">
                <i class="fas fa-cog mr-3 text-gray-600"></i>Settings
            </button>
            <button onclick="logout(); closeAccountMenu();" class="w-full text-left px-4 py-2 hover:bg-red-50 flex items-center text-red-600">
                <i class="fas fa-sign-out-alt mr-3"></i>Sign Out
            </button>
        </div>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobileMenuOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="fixed left-0 top-0 h-full w-80 bg-white shadow-lg transform -translate-x-full transition-transform duration-300 sidebar" id="mobileMenuPanel">
            <div class="p-4 border-b amazon-blue text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-sm">
                            <span id="sidebarUserInitials">U</span>
                        </div>
                        <span class="ml-3 font-semibold">Hello, <span id="sidebarUserName">User</span></span>
                    </div>
                    <button onclick="closeMobileMenu()" class="text-white hover:text-gray-200">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto h-full pb-20">
                <div id="sidebarLoginSection" class="p-4">
                    <button onclick="loginWithGoogle(); closeMobileMenu();" class="w-full amazon-orange text-gray-800 py-3 px-4 rounded-lg font-semibold">
                        <i class="fab fa-google mr-2"></i>Sign In
                    </button>
                </div>
                
                <div id="sidebarLoggedInSection" class="hidden">
                    <!-- Digital Content & Devices -->
                    <div class="border-b">
                        <div class="px-4 py-3 font-semibold text-gray-800 bg-gray-100">Digital Content & Devices</div>
                        <button onclick="showOrders(); closeMobileMenu();" class="nav-item w-full text-left px-6 py-3 hover:bg-gray-100 flex items-center">
                            <i class="fas fa-shopping-bag mr-3 text-gray-600"></i>Your Orders
                        </button>
                        <button onclick="showProfile(); closeMobileMenu();" class="nav-item w-full text-left px-6 py-3 hover:bg-gray-100 flex items-center">
                            <i class="fas fa-user mr-3 text-gray-600"></i>Your Account
                        </button>
                    </div>
                    
                    <!-- Shop by Category -->
                    <div class="border-b">
                        <div class="px-4 py-3 font-semibold text-gray-800 bg-gray-100">Shop by Category</div>
                        <button onclick="filterByCategory('electronics'); closeMobileMenu();" class="nav-item w-full text-left px-6 py-3 hover:bg-gray-100">Electronics</button>
                        <button onclick="filterByCategory('fashion'); closeMobileMenu();" class="nav-item w-full text-left px-6 py-3 hover:bg-gray-100">Fashion</button>
                        <button onclick="filterByCategory('books'); closeMobileMenu();" class="nav-item w-full text-left px-6 py-3 hover:bg-gray-100">Books</button>
                        <button onclick="filterByCategory('grocery'); closeMobileMenu();" class="nav-item w-full text-left px-6 py-3 hover:bg-gray-100">Grocery</button>
                    </div>
                    
                    <!-- Programs & Features -->
                    <div class="border-b">
                        <div class="px-4 py-3 font-semibold text-gray-800 bg-gray-100">Programs & Features</div>
                        <div id="sidebarSellerButton" class="hidden">
                            <button onclick="showBusinessPanel(); closeMobileMenu();" class="nav-item w-full text-left px-6 py-3 hover:bg-gray-100 flex items-center">
                                <i class="fas fa-store mr-3 text-orange-600"></i>Seller Central
                                <span class="badge-new ml-auto">SELLER</span>
                            </button>
                        </div>
                        <div id="sidebarAdminButton" class="hidden">
                            <button onclick="showAdminPanel(); closeMobileMenu();" class="nav-item w-full text-left px-6 py-3 hover:bg-gray-100 flex items-center">
                                <i class="fas fa-crown mr-3 text-purple-600"></i>Admin Panel
                                <span class="badge-new ml-auto">ADMIN</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Settings & Account -->
                    <div>
                        <div class="px-4 py-3 font-semibold text-gray-800 bg-gray-100">Settings & Account</div>
                        <button onclick="showMobileSettings(); closeMobileMenu();" class="nav-item w-full text-left px-6 py-3 hover:bg-gray-100 flex items-center">
                            <i class="fas fa-cog mr-3 text-gray-600"></i>Settings
                        </button>
                        <button onclick="logout(); closeMobileMenu();" class="nav-item w-full text-left px-6 py-3 hover:bg-red-50 flex items-center text-red-600">
                            <i class="fas fa-sign-out-alt mr-3"></i>Sign Out
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div id="profilePage" class="hidden fade-in">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-20">
            <div id="profileLoginPrompt" class="text-center py-12">
                <i class="fas fa-user-circle text-6xl text-gray-400 mb-4"></i>
                <h2 class="text-xl font-semibold mb-4">Please Login to View Profile</h2>
                <button onclick="loginWithGoogle()" class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600">
                    <i class="fab fa-google mr-2"></i>Login with Google
                </button>
            </div>
            
            <div id="profileContent" class="hidden">
                <!-- Profile Header -->
                <div class="text-center mb-8">
                    <div class="w-24 h-24 bg-red-500 rounded-full mx-auto flex items-center justify-center text-white text-3xl font-bold mb-4">
                        <span id="profileInitials">U</span>
                    </div>
                    <h2 class="text-2xl font-bold" id="profileName">User Name</h2>
                    <p class="text-gray-600" id="profileEmail">user@email.com</p>
                </div>

                <!-- Profile Stats -->
                <div class="grid grid-cols-3 gap-4 mb-8">
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600" id="totalOrders">0</div>
                        <div class="text-sm text-gray-600">Orders</div>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="text-2xl font-bold text-green-600" id="totalSpent">₹0</div>
                        <div class="text-sm text-gray-600">Spent</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="text-2xl font-bold text-purple-600" id="totalReviews">0</div>
                        <div class="text-sm text-gray-600">Reviews</div>
                    </div>
                </div>

                <!-- Profile Actions -->
                <div class="space-y-4">
                    <button onclick="showEditProfile()" class="w-full bg-red-500 text-white py-3 px-4 rounded-lg hover:bg-red-600 flex items-center justify-center">
                        <i class="fas fa-edit mr-2"></i>Edit Profile
                    </button>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="showOrders()" class="bg-gray-100 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-200 flex items-center justify-center">
                            <i class="fas fa-shopping-bag mr-2"></i>My Orders
                        </button>
                        <button onclick="showMobileSettings()" class="bg-gray-100 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-200 flex items-center justify-center">
                            <i class="fas fa-cog mr-2"></i>Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">Edit Profile</h3>
                    <button onclick="closeEditProfile()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="editProfileForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Display Name</label>
                        <input type="text" id="editDisplayName" class="w-full border rounded-lg px-3 py-2" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Phone Number</label>
                        <input type="tel" id="editPhone" class="w-full border rounded-lg px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Date of Birth</label>
                        <input type="date" id="editDOB" class="w-full border rounded-lg px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Gender</label>
                        <select id="editGender" class="w-full border rounded-lg px-3 py-2">
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Address</label>
                        <textarea id="editAddress" class="w-full border rounded-lg px-3 py-2" rows="3"></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">City</label>
                            <input type="text" id="editCity" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">PIN Code</label>
                            <input type="text" id="editPincode" class="w-full border rounded-lg px-3 py-2">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">State</label>
                        <input type="text" id="editState" class="w-full border rounded-lg px-3 py-2">
                    </div>
                    
                    <div class="flex space-x-4 pt-4">
                        <button type="submit" class="flex-1 bg-red-500 text-white py-3 rounded-lg hover:bg-red-600">
                            Save Changes
                        </button>
                        <button type="button" onclick="closeEditProfile()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Mobile Settings Page -->
    <div id="mobileSettingsPage" class="hidden fade-in">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-20">
            <div class="flex items-center mb-6">
                <button onclick="showProfile()" class="mr-4 text-gray-600 hover:text-gray-800">
                    <i class="fas fa-arrow-left text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold">Settings</h2>
            </div>
            
            <div class="space-y-6">
                <!-- Account Section -->
                <div class="border-b pb-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-user mr-2 text-blue-600"></i>Account Information
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Name</span>
                            <span class="font-medium" id="settingsDisplayName">-</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Email</span>
                            <span class="font-medium" id="settingsEmail">-</span>
                        </div>
                        <button onclick="showEditProfile()" class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">
                            <i class="fas fa-edit mr-2"></i>Edit Profile
                        </button>
                    </div>
                </div>
                
                <!-- Seller Account Section -->
                <div class="border-b pb-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-store mr-2 text-red-600"></i>Seller Account
                    </h3>
                    
                    <div id="mobileNotSellerSection">
                        <div class="bg-red-50 p-4 rounded-lg mb-4">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-store text-red-600 mr-2"></i>
                                <span class="font-semibold text-red-800">Start Selling on Homy</span>
                            </div>
                            <p class="text-red-700 text-sm mb-3">Join thousands of sellers and start earning money by selling your products!</p>
                            <ul class="text-red-600 text-sm space-y-1 mb-4">
                                <li>• Easy product listing</li>
                                <li>• Direct payments to your UPI</li>
                                <li>• Manage orders easily</li>
                                <li>• No monthly fees</li>
                            </ul>
                        </div>
                        <button onclick="showMobileSellerRegistration()" class="w-full bg-red-600 text-white py-3 px-4 rounded-lg hover:bg-red-700 font-semibold">
                            <i class="fas fa-plus mr-2"></i>Create Seller Account
                        </button>
                    </div>
                    
                    <div id="mobileSellerStatusSection" class="hidden">
                        <div class="bg-green-50 p-4 rounded-lg mb-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-semibold text-green-800">Seller Status</span>
                                <span id="mobileSellerStatus" class="px-2 py-1 bg-green-200 text-green-800 rounded text-sm">Active</span>
                            </div>
                            <p class="text-green-700 text-sm">Business: <span id="mobileSellerBusinessName" class="font-medium">-</span></p>
                        </div>
                        <button onclick="showBusinessPanel()" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-store mr-2"></i>Manage Products
                        </button>
                    </div>
                </div>
                
                <!-- App Settings -->
                <div class="border-b pb-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-cog mr-2 text-gray-600"></i>App Settings
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span>Notifications</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                            </label>
                        </div>
                        <div class="flex justify-between items-center">
                            <span>Dark Mode</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Support -->
                <div>
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-question-circle mr-2 text-purple-600"></i>Support & Help
                    </h3>
                    <div class="space-y-3">
                        <button class="w-full text-left py-3 px-4 hover:bg-gray-100 rounded-lg flex items-center justify-between">
                            <span>Help Center</span>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </button>
                        <button class="w-full text-left py-3 px-4 hover:bg-gray-100 rounded-lg flex items-center justify-between">
                            <span>Contact Support</span>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </button>
                        <button class="w-full text-left py-3 px-4 hover:bg-gray-100 rounded-lg flex items-center justify-between">
                            <span>Terms & Conditions</span>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </button>
                        <button class="w-full text-left py-3 px-4 hover:bg-gray-100 rounded-lg flex items-center justify-between">
                            <span>Privacy Policy</span>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Seller Registration -->
    <div id="mobileSellerRegistrationPage" class="hidden fade-in">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-20">
            <div class="flex items-center mb-6">
                <button onclick="showMobileSettings()" class="mr-4 text-gray-600 hover:text-gray-800">
                    <i class="fas fa-arrow-left text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold">Create Seller Account</h2>
            </div>
            
            <div class="mb-6 bg-blue-50 p-4 rounded-lg">
                <h3 class="font-semibold text-blue-800 mb-2">Why Sell on Homy?</h3>
                <ul class="text-blue-700 text-sm space-y-1">
                    <li>• Reach millions of customers</li>
                    <li>• Easy product management</li>
                    <li>• Quick payments via UPI</li>
                    <li>• 24/7 seller support</li>
                </ul>
            </div>
            
            <form id="mobileSellerRegistrationForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Business Name *</label>
                    <input type="text" id="mobileBusinessName" class="w-full border rounded-lg px-3 py-2" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">PAN Number *</label>
                    <input type="text" id="mobilePanNumber" class="w-full border rounded-lg px-3 py-2" pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" placeholder="ABCDE1234F" required>
                    <p class="text-xs text-gray-500 mt-1">Enter valid PAN number</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">UPI ID *</label>
                    <input type="text" id="mobileUpiId" class="w-full border rounded-lg px-3 py-2" placeholder="yourname@paytm" required>
                    <p class="text-xs text-gray-500 mt-1">Payments will be sent to this UPI ID</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">Business Category *</label>
                    <select id="mobileBusinessCategory" class="w-full border rounded-lg px-3 py-2" required>
                        <option value="">Select Category</option>
                        <option value="fashion">Fashion</option>
                        <option value="grocery">Grocery</option>
                        <option value="electronics">Electronics</option>
                        <option value="jewelry">Jewelry</option>
                        <option value="toys">Toys</option>
                        <option value="books">Books</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">Business Address *</label>
                    <textarea id="mobileBusinessAddress" class="w-full border rounded-lg px-3 py-2" rows="3" required></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">City *</label>
                        <input type="text" id="mobileBusinessCity" class="w-full border rounded-lg px-3 py-2" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">PIN Code *</label>
                        <input type="text" id="mobileBusinessPincode" class="w-full border rounded-lg px-3 py-2" pattern="[0-9]{6}" required>
                    </div>
                </div>
                
                <div class="flex items-start">
                    <input type="checkbox" id="mobileTermsAccepted" class="mr-2 mt-1" required>
                    <label for="mobileTermsAccepted" class="text-sm">I agree to the Terms and Conditions for sellers and confirm that all information provided is accurate</label>
                </div>
                
                <button type="submit" class="w-full bg-red-600 text-white py-3 px-4 rounded-lg hover:bg-red-700 font-semibold">
                    <i class="fas fa-check mr-2"></i>Submit Application
                </button>
            </form>
        </div>
    </div>

    <!-- Review Form Modal -->
    <div id="reviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <h3 class="text-xl font-bold mb-4">Write a Review</h3>
                <form id="reviewForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Rating</label>
                        <div class="flex space-x-1">
                            <i class="fas fa-star text-2xl cursor-pointer text-gray-300" onclick="setRating(1)"></i>
                            <i class="fas fa-star text-2xl cursor-pointer text-gray-300" onclick="setRating(2)"></i>
                            <i class="fas fa-star text-2xl cursor-pointer text-gray-300" onclick="setRating(3)"></i>
                            <i class="fas fa-star text-2xl cursor-pointer text-gray-300" onclick="setRating(4)"></i>
                            <i class="fas fa-star text-2xl cursor-pointer text-gray-300" onclick="setRating(5)"></i>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Review Title</label>
                        <input type="text" id="reviewTitle" class="w-full border rounded-lg px-3 py-2" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Review</label>
                        <textarea id="reviewText" class="w-full border rounded-lg px-3 py-2" rows="4" required></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Upload Images (Optional)</label>
                        <input type="file" id="reviewImages" class="w-full border rounded-lg px-3 py-2" multiple accept="image/*">
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Submit Review</button>
                        <button type="button" onclick="closeReviewModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Refund Request Modal -->
    <div id="refundModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <h3 class="text-xl font-bold mb-4">Request Refund</h3>
                <form id="refundForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Reason for Refund *</label>
                        <select id="refundReason" class="w-full border rounded-lg px-3 py-2" required>
                            <option value="">Select a reason</option>
                            <option value="defective">Product is defective</option>
                            <option value="not-as-described">Not as described</option>
                            <option value="wrong-item">Wrong item received</option>
                            <option value="damaged">Damaged during shipping</option>
                            <option value="changed-mind">Changed my mind</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Detailed Description *</label>
                        <textarea id="refundDescription" class="w-full border rounded-lg px-3 py-2" rows="4" placeholder="Please provide details about the issue..." required></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Upload Images (Optional)</label>
                        <input type="file" id="refundImages" class="w-full border rounded-lg px-3 py-2" multiple accept="image/*">
                        <p class="text-xs text-gray-500 mt-1">Upload photos showing the issue (if applicable)</p>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Preferred Resolution</label>
                        <select id="refundResolution" class="w-full border rounded-lg px-3 py-2">
                            <option value="full-refund">Full refund</option>
                            <option value="replacement">Replacement</option>
                            <option value="partial-refund">Partial refund</option>
                        </select>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Submit Request</button>
                        <button type="button" onclick="closeRefundModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Order Cancellation Modal -->
    <div id="cancelOrderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <h3 class="text-xl font-bold mb-4">Cancel Order</h3>
                <div class="mb-4">
                    <p class="text-gray-600 mb-4">Are you sure you want to cancel this order?</p>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Reason for Cancellation *</label>
                        <select id="cancelReason" class="w-full border rounded-lg px-3 py-2" required>
                            <option value="">Select a reason</option>
                            <option value="changed-mind">Changed my mind</option>
                            <option value="found-better-price">Found better price elsewhere</option>
                            <option value="ordered-by-mistake">Ordered by mistake</option>
                            <option value="delivery-too-long">Delivery taking too long</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Additional Comments</label>
                        <textarea id="cancelComments" class="w-full border rounded-lg px-3 py-2" rows="3" placeholder="Optional additional details..."></textarea>
                    </div>
                </div>
                <div class="flex space-x-4">
                    <button onclick="confirmCancelOrder()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Cancel Order</button>
                    <button onclick="closeCancelOrderModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Keep Order</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDjfNlHwhT4xYb7vVym_SAqMlSuY_TMz0o",
            authDomain: "orioplay.firebaseapp.com",
            databaseURL: "https://orioplay-default-rtdb.firebaseio.com",
            projectId: "orioplay",
            storageBucket: "orioplay.firebasestorage.app",
            messagingSenderId: "300811706751",
            appId: "1:300811706751:web:bdce98b1ba7e11d34d7a4a"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        // Global Variables
        let currentUser = null;
        let cart = [];
        let currentProduct = null;
        let selectedRating = 0;
        let selectedUPIApp = '';
        let appliedCoupon = null;
        let currentDiscount = 0;
        let isAdmin = false;
        let isSeller = false;
        let currentOrderForAction = null;
        let accountMenuOpen = false;
        const ADMIN_EMAIL = 'customerserviceffrj4@gmail.com';
        const POSTAL_API_KEY = '579b464db66ec23bdd00000171b94d2674ed4b95753b7ef53b10fb49';
        let verifiedPincode = null;

        // Authentication
        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    currentUser = result.user;
                    updateUI();
                    loadUserData();
                })
                .catch((error) => {
                    console.error('Login error:', error);
                    showError('Login failed. Please try again.');
                });
        }

        function logout() {
            auth.signOut().then(() => {
                currentUser = null;
                cart = [];
                updateUI();
                showHomePage();
            });
        }

        function updateUI() {
            const loginSection = document.getElementById('loginSection');
            const userSection = document.getElementById('userSection');
            const userName = document.getElementById('userName');
            const sellerNavButton = document.getElementById('sellerNavButton');
            
            // Sidebar elements
            const sidebarLoginSection = document.getElementById('sidebarLoginSection');
            const sidebarLoggedInSection = document.getElementById('sidebarLoggedInSection');
            const sidebarUserName = document.getElementById('sidebarUserName');
            const sidebarUserInitials = document.getElementById('sidebarUserInitials');
            const sidebarSellerButton = document.getElementById('sidebarSellerButton');
            const sidebarAdminButton = document.getElementById('sidebarAdminButton');
            
            // Account menu elements
            const accountUserName = document.getElementById('accountUserName');
            const accountUserEmail = document.getElementById('accountUserEmail');
            const accountInitials = document.getElementById('accountInitials');
            const accountSellerButton = document.getElementById('accountSellerButton');
            const accountAdminButton = document.getElementById('accountAdminButton');

            if (currentUser) {
                loginSection.classList.add('hidden');
                userSection.classList.remove('hidden');
                userName.textContent = currentUser.displayName || 'User';
                updateCartCount();
                
                // Update sidebar
                sidebarLoginSection.classList.add('hidden');
                sidebarLoggedInSection.classList.remove('hidden');
                sidebarUserName.textContent = currentUser.displayName || 'User';
                sidebarUserInitials.textContent = (currentUser.displayName || 'U').charAt(0).toUpperCase();
                
                // Update account menu
                accountUserName.textContent = currentUser.displayName || 'User';
                accountUserEmail.textContent = currentUser.email || '';
                accountInitials.textContent = (currentUser.displayName || 'U').charAt(0).toUpperCase();
                
                // Check admin access
                isAdmin = currentUser.email === ADMIN_EMAIL;
                if (isAdmin) {
                    sidebarAdminButton.classList.remove('hidden');
                    accountAdminButton.classList.remove('hidden');
                } else {
                    sidebarAdminButton.classList.add('hidden');
                    accountAdminButton.classList.add('hidden');
                }
                
                // Check seller status
                checkSellerStatus();
            } else {
                loginSection.classList.remove('hidden');
                userSection.classList.add('hidden');
                sellerNavButton.classList.add('hidden');
                
                // Update sidebar
                sidebarLoginSection.classList.remove('hidden');
                sidebarLoggedInSection.classList.add('hidden');
                sidebarSellerButton.classList.add('hidden');
                sidebarAdminButton.classList.add('hidden');
                
                // Update account menu
                accountSellerButton.classList.add('hidden');
                accountAdminButton.classList.add('hidden');
                
                isAdmin = false;
                isSeller = false;
            }
        }

        function checkSellerStatus() {
            if (currentUser) {
                database.ref(`sellers/${currentUser.uid}`).once('value')
                    .then((snapshot) => {
                        const sellerData = snapshot.val();
                        isSeller = sellerData && sellerData.status === 'approved';
                        
                        const sellerNavButton = document.getElementById('sellerNavButton');
                        const sidebarSellerButton = document.getElementById('sidebarSellerButton');
                        const accountSellerButton = document.getElementById('accountSellerButton');
                        
                        if (isSeller) {
                            sellerNavButton.classList.remove('hidden');
                            sidebarSellerButton.classList.remove('hidden');
                            accountSellerButton.classList.remove('hidden');
                        } else {
                            sellerNavButton.classList.add('hidden');
                            sidebarSellerButton.classList.add('hidden');
                            accountSellerButton.classList.add('hidden');
                        }
                    });
            }
        }

        // Page Navigation
        function showHomePage() {
            hideAllPages();
            document.getElementById('homePage').classList.remove('hidden');
            updateBottomNavigation('home');
            loadProducts();
            loadActiveAnnouncements();
            updateURL('');
        }

        // URL Management Functions
        function updateURL(path) {
            const baseUrl = window.location.origin + window.location.pathname;
            const newUrl = path ? `${baseUrl}#${path}` : baseUrl;
            window.history.pushState({path}, '', newUrl);
        }

        function handleURLRouting() {
            const hash = window.location.hash.substring(1); // Remove #
            
            if (!hash) {
                showHomePage();
                return;
            }

            const parts = hash.split('/');
            const route = parts[0];
            const id = parts[1];

            switch (route) {
                case 'product':
                    if (id) {
                        showProductDetail(id);
                    } else {
                        showHomePage();
                    }
                    break;
                case 'category':
                    if (id) {
                        filterByCategory(id);
                    } else {
                        showHomePage();
                    }
                    break;
                case 'cart':
                    showCart();
                    break;
                case 'orders':
                    showOrders();
                    break;
                case 'profile':
                    showProfile();
                    break;
                case 'seller':
                    showBusinessPanel();
                    break;
                case 'admin':
                    showAdminPanel();
                    break;
                default:
                    showHomePage();
            }
        }

        // Handle browser back/forward buttons
        window.addEventListener('popstate', function(event) {
            handleURLRouting();
        });

        function playOrderNotificationSound() {
            // Create audio context for notification sound
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (error) {
                console.log('Audio notification not supported');
            }
        }

        function loadAdminStats() {
            // Load total users
            database.ref('users').once('value').then((snapshot) => {
                const users = snapshot.val() || {};
                document.getElementById('totalUsers').textContent = Object.keys(users).length;
            });

            // Load total products
            database.ref('products').once('value').then((snapshot) => {
                const products = snapshot.val() || {};
                document.getElementById('totalProducts').textContent = Object.keys(products).length;
            });

            // Load total orders
            database.ref('orders').once('value').then((snapshot) => {
                const orders = snapshot.val() || {};
                document.getElementById('totalOrders').textContent = Object.keys(orders).length;
            });

            // Load total sellers
            database.ref('sellers').once('value').then((snapshot) => {
                const sellers = snapshot.val() || {};
                const approvedSellers = Object.values(sellers).filter(seller => seller.status === 'approved');
                document.getElementById('totalSellers').textContent = approvedSellers.length;
            });
        }

        function loadRecentActivity() {
            const recentActivity = document.getElementById('recentActivity');
            
            // Load recent orders
            database.ref('orders').orderByChild('timestamp').limitToLast(5).once('value')
                .then((snapshot) => {
                    const orders = snapshot.val() || {};
                    const activities = [];
                    
                    Object.values(orders).forEach(order => {
                        activities.push({
                            type: 'order',
                            message: `New order #${order.orderId} - ₹${order.total}`,
                            timestamp: order.timestamp
                        });
                    });
                    
                    // Sort by timestamp and display
                    activities.sort((a, b) => b.timestamp - a.timestamp);
                    
                    recentActivity.innerHTML = activities.slice(0, 5).map(activity => `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                            <div class="flex items-center">
                                <i class="fas fa-shopping-cart text-blue-500 mr-3"></i>
                                <span>${activity.message}</span>
                            </div>
                            <span class="text-sm text-gray-500">${new Date(activity.timestamp).toLocaleTimeString()}</span>
                        </div>
                    `).join('');
                });
        }

        function loadCategoryManager() {
            const categories = [
                { id: 'electronics', name: 'Electronics', icon: 'fas fa-laptop' },
                { id: 'fashion', name: 'Fashion', icon: 'fas fa-tshirt' },
                { id: 'books', name: 'Books', icon: 'fas fa-book' },
                { id: 'grocery', name: 'Grocery', icon: 'fas fa-shopping-basket' },
                { id: 'jewelry', name: 'Jewelry', icon: 'fas fa-gem' },
                { id: 'toys', name: 'Toys', icon: 'fas fa-gamepad' }
            ];

            const categoryGrid = document.getElementById('categoryGrid');
            categoryGrid.innerHTML = categories.map(category => `
                <div class="bg-white border rounded-lg p-6 text-center">
                    <i class="${category.icon} text-4xl text-blue-600 mb-4"></i>
                    <h3 class="text-lg font-semibold mb-2">${category.name}</h3>
                    <div class="space-y-2">
                        <button onclick="editCategory('${category.id}')" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                            Edit Category
                        </button>
                        <button onclick="updateCategoryImage('${category.id}')" class="w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                            Update Image
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadAnnouncements() {
            database.ref('announcements').once('value')
                .then((snapshot) => {
                    const announcements = snapshot.val() || {};
                    displayAnnouncements(Object.entries(announcements).map(([id, announcement]) => ({id, ...announcement})));
                });
        }

        function displayAnnouncements(announcements) {
            const announcementsList = document.getElementById('announcementsList');
            
            if (announcements.length === 0) {
                announcementsList.innerHTML = '<div class="text-center text-gray-500 py-8">No announcements created yet</div>';
                return;
            }

            announcementsList.innerHTML = announcements.map(announcement => `
                <div class="border rounded-lg p-4 ${announcement.isActive ? 'border-green-500' : 'border-gray-300'}">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="text-lg font-semibold">${announcement.title}</h3>
                            <p class="text-gray-600">${announcement.description}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="toggleAnnouncement('${announcement.id}', ${!announcement.isActive})" class="px-3 py-1 text-sm rounded ${announcement.isActive ? 'bg-red-500 text-white' : 'bg-green-500 text-white'}">
                                ${announcement.isActive ? 'Deactivate' : 'Activate'}
                            </button>
                            <button onclick="deleteAnnouncement('${announcement.id}')" class="px-3 py-1 text-sm bg-gray-500 text-white rounded">
                                Delete
                            </button>
                        </div>
                    </div>
                    <div class="text-sm text-gray-500">
                        <span class="mr-4">Type: ${announcement.type}</span>
                        <span class="mr-4">Active: ${announcement.isActive ? 'Yes' : 'No'}</span>
                        <span>Valid: ${new Date(announcement.startDate).toLocaleDateString()} - ${new Date(announcement.endDate).toLocaleDateString()}</span>
                    </div>
                </div>
            `).join('');
        }

        function loadActiveAnnouncements() {
            database.ref('announcements').orderByChild('isActive').equalTo(true).once('value')
                .then((snapshot) => {
                    const announcements = snapshot.val() || {};
                    const activeAnnouncements = Object.values(announcements).filter(announcement => {
                        const now = Date.now();
                        const startDate = new Date(announcement.startDate).getTime();
                        const endDate = new Date(announcement.endDate).getTime();
                        return now >= startDate && now <= endDate;
                    });

                    displayAnnouncementBanner(activeAnnouncements);
                });
        }

        function displayAnnouncementBanner(announcements) {
            const banner = document.getElementById('announcementBanner');
            
            if (announcements.length === 0) {
                banner.classList.add('hidden');
                return;
            }

            banner.classList.remove('hidden');
            banner.innerHTML = announcements.map(announcement => `
                <div class="${announcement.color || 'bg-blue-500'} text-white p-4 rounded-lg mb-4 relative">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-bold">${announcement.title}</h3>
                            <p class="text-sm opacity-90">${announcement.description}</p>
                        </div>
                        <button onclick="closeBanner(this)" class="text-white hover:text-gray-200">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function showProductDetail(productId) {
            hideAllPages();
            document.getElementById('productDetailPage').classList.remove('hidden');
            loadProductDetail(productId);
            updateURL(`product/${productId}`);
        }

        function showCart() {
            if (!currentUser) {
                alert('Please login to view cart');
                return;
            }
            hideAllPages();
            document.getElementById('cartPage').classList.remove('hidden');
            updateBottomNavigation('cart');
            loadCart();
            updateURL('cart');
        }

        function showOrders() {
            if (!currentUser) {
                alert('Please login to view orders');
                return;
            }
            hideAllPages();
            document.getElementById('ordersPage').classList.remove('hidden');
            loadOrders();
            updateURL('orders');
        }

        function changeMainImage(imageSrc) {
            document.getElementById('productImage').src = imageSrc;
        }

        async function showBusinessPanel() {
            if (!currentUser) {
                alert('Please login to access business panel');
                return;
            }
            
            // Check if user is approved seller
            const sellerSnapshot = await database.ref(`sellers/${currentUser.uid}`).once('value');
            const sellerData = sellerSnapshot.val();
            
            if (!sellerData || sellerData.status !== 'approved') {
                alert('You need to be an approved seller to access business panel. Please apply for seller account first.');
                showSettings();
                return;
            }
            
            hideAllPages();
            document.getElementById('businessPanel').classList.remove('hidden');
            loadBusinessProducts();
        }

        function showAddProductForm() {
            hideAllPages();
            document.getElementById('addProductForm').classList.remove('hidden');
        }

        function showSettings() {
            if (!currentUser) {
                alert('Please login to access settings');
                return;
            }
            hideAllPages();
            document.getElementById('settingsPage').classList.remove('hidden');
            loadUserSettings();
        }

        function showSellerRegistration() {
            hideAllPages();
            document.getElementById('sellerRegistrationPage').classList.remove('hidden');
        }

        function showProfile() {
            if (!currentUser) {
                alert('Please login to view profile');
                return;
            }
            hideAllPages();
            document.getElementById('profilePage').classList.remove('hidden');
            loadUserProfile();
        }

        function showCouponManagement() {
            if (!currentUser) {
                alert('Please login to manage coupons');
                return;
            }
            hideAllPages();
            document.getElementById('couponManagementPage').classList.remove('hidden');
            loadSellerCoupons();
        }

        function showCreateCouponForm() {
            hideAllPages();
            document.getElementById('createCouponForm').classList.remove('hidden');
            loadSellerProducts();
        }

        function hideAllPages() {
            const pages = ['homePage', 'productDetailPage', 'cartPage', 'checkoutPage', 'paymentPage', 'ordersPage', 'businessPanel', 'addProductForm', 'settingsPage', 'sellerRegistrationPage', 'profilePage', 'couponManagementPage', 'createCouponForm', 'adminPanel', 'categoryManager', 'announcementManager', 'createAnnouncementForm', 'mobileSettingsPage', 'mobileSellerRegistrationPage', 'sellerOrdersPage', 'sellerProductsPage'];
            pages.forEach(page => {
                const element = document.getElementById(page);
                if (element) {
                    element.classList.add('hidden');
                }
            });
        }

        // Mobile Navigation Functions
        // Account Menu Functions
        function showAccountMenu() {
            const dropdown = document.getElementById('accountMenuDropdown');
            accountMenuOpen = !accountMenuOpen;
            
            if (accountMenuOpen) {
                dropdown.classList.remove('hidden');
            } else {
                dropdown.classList.add('hidden');
            }
        }

        function closeAccountMenu() {
            const dropdown = document.getElementById('accountMenuDropdown');
            dropdown.classList.add('hidden');
            accountMenuOpen = false;
        }

        // Close account menu when clicking outside
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('accountMenuDropdown');
            const accountButton = e.target.closest('[onclick="showAccountMenu()"]');
            
            if (!dropdown.contains(e.target) && !accountButton && accountMenuOpen) {
                closeAccountMenu();
            }
        });

        function showMobileMenu() {
            const overlay = document.getElementById('mobileMenuOverlay');
            const panel = document.getElementById('mobileMenuPanel');
            
            overlay.classList.remove('hidden');
            setTimeout(() => {
                panel.classList.remove('-translate-x-full');
            }, 10);
        }

        function closeMobileMenu() {
            const overlay = document.getElementById('mobileMenuOverlay');
            const panel = document.getElementById('mobileMenuPanel');
            
            panel.classList.add('-translate-x-full');
            setTimeout(() => {
                overlay.classList.add('hidden');
            }, 300);
        }

        function updateMobileMenuUI() {
            const mobileLoginSection = document.getElementById('mobileLoginSection');
            const mobileLoggedInSection = document.getElementById('mobileLoggedInSection');
            const mobileUserSection = document.getElementById('mobileUserSection');
            const mobileUserName = document.getElementById('mobileUserName');
            const mobileUserEmail = document.getElementById('mobileUserEmail');
            const mobileUserInitials = document.getElementById('mobileUserInitials');
            const mobileSellerButton = document.getElementById('mobileSellerButton');
            const mobileAdminButton = document.getElementById('mobileAdminButton');

            if (currentUser) {
                mobileLoginSection.classList.add('hidden');
                mobileLoggedInSection.classList.remove('hidden');
                mobileUserSection.classList.remove('hidden');
                
                mobileUserName.textContent = currentUser.displayName || 'User';
                mobileUserEmail.textContent = currentUser.email || '';
                mobileUserInitials.textContent = (currentUser.displayName || 'U').charAt(0).toUpperCase();
                
                // Show seller button if user is seller
                if (isSeller) {
                    mobileSellerButton.classList.remove('hidden');
                } else {
                    mobileSellerButton.classList.add('hidden');
                }
                
                // Show admin button if user is admin
                if (isAdmin) {
                    mobileAdminButton.classList.remove('hidden');
                } else {
                    mobileAdminButton.classList.add('hidden');
                }
            } else {
                mobileLoginSection.classList.remove('hidden');
                mobileLoggedInSection.classList.add('hidden');
                mobileUserSection.classList.add('hidden');
                mobileSellerButton.classList.add('hidden');
                mobileAdminButton.classList.add('hidden');
            }
        }

        function showProfile() {
            hideAllPages();
            document.getElementById('profilePage').classList.remove('hidden');
            updateBottomNavigation('profile');
            updateURL('profile');
            
            if (currentUser) {
                document.getElementById('profileLoginPrompt').classList.add('hidden');
                document.getElementById('profileContent').classList.remove('hidden');
                loadUserProfile();
            } else {
                document.getElementById('profileLoginPrompt').classList.remove('hidden');
                document.getElementById('profileContent').classList.add('hidden');
            }
        }

        function showMobileSettings() {
            if (!currentUser) {
                alert('Please login to access settings');
                return;
            }
            hideAllPages();
            document.getElementById('mobileSettingsPage').classList.remove('hidden');
            loadMobileSettings();
        }

        function showMobileSellerRegistration() {
            if (!currentUser) {
                alert('Please login to create seller account');
                return;
            }
            hideAllPages();
            document.getElementById('mobileSellerRegistrationPage').classList.remove('hidden');
        }

        function loadMobileSettings() {
            const settingsDisplayName = document.getElementById('settingsDisplayName');
            const settingsEmail = document.getElementById('settingsEmail');
            
            if (settingsDisplayName) {
                settingsDisplayName.textContent = currentUser.displayName || '-';
            }
            if (settingsEmail) {
                settingsEmail.textContent = currentUser.email || '-';
            }
            
            // Check seller status for mobile
            database.ref(`sellers/${currentUser.uid}`).once('value')
                .then((snapshot) => {
                    const sellerData = snapshot.val();
                    const mobileNotSellerSection = document.getElementById('mobileNotSellerSection');
                    const mobileSellerStatusSection = document.getElementById('mobileSellerStatusSection');
                    const mobileSellerStatus = document.getElementById('mobileSellerStatus');
                    const mobileSellerBusinessName = document.getElementById('mobileSellerBusinessName');
                    
                    if (sellerData) {
                        if (mobileNotSellerSection) mobileNotSellerSection.classList.add('hidden');
                        if (mobileSellerStatusSection) mobileSellerStatusSection.classList.remove('hidden');
                        if (mobileSellerStatus) mobileSellerStatus.textContent = sellerData.status;
                        if (mobileSellerBusinessName) mobileSellerBusinessName.textContent = sellerData.businessName;
                    } else {
                        if (mobileNotSellerSection) mobileNotSellerSection.classList.remove('hidden');
                        if (mobileSellerStatusSection) mobileSellerStatusSection.classList.add('hidden');
                    }
                })
                .catch((error) => {
                    console.error('Error loading mobile seller data:', error);
                });
        }

        function showEditProfile() {
            if (!currentUser) {
                alert('Please login to edit profile');
                return;
            }
            document.getElementById('editProfileModal').classList.remove('hidden');
            loadEditProfileData();
        }

        function closeEditProfile() {
            document.getElementById('editProfileModal').classList.add('hidden');
        }

        function loadEditProfileData() {
            database.ref(`users/${currentUser.uid}`).once('value')
                .then((snapshot) => {
                    const userData = snapshot.val() || {};
                    document.getElementById('editDisplayName').value = userData.displayName || currentUser.displayName || '';
                    document.getElementById('editPhone').value = userData.phone || '';
                    document.getElementById('editDOB').value = userData.dob || '';
                    document.getElementById('editGender').value = userData.gender || '';
                    document.getElementById('editAddress').value = userData.address || '';
                    document.getElementById('editCity').value = userData.city || '';
                    document.getElementById('editPincode').value = userData.pincode || '';
                    document.getElementById('editState').value = userData.state || '';
                });
        }

        function updateBottomNavigation(activeTab) {
            // Reset all nav buttons
            const navButtons = ['navHome', 'navProfile', 'navCart', 'navMenu'];
            navButtons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.classList.remove('text-red-600');
                    button.classList.add('text-gray-600');
                }
            });
            
            // Highlight active tab
            const activeButton = document.getElementById(`nav${activeTab.charAt(0).toUpperCase() + activeTab.slice(1)}`);
            if (activeButton) {
                activeButton.classList.remove('text-gray-600');
                activeButton.classList.add('text-red-600');
            }
        }

        function showAdminPanel() {
            if (!isAdmin) {
                showError('Access denied. Admin privileges required.');
                return;
            }
            hideAllPages();
            document.getElementById('adminPanel').classList.remove('hidden');
            updateURL('admin');
            loadAdminStats();
            loadRecentActivity();
        }

        function showCategoryManager() {
            if (!isAdmin) {
                alert('Access denied. Admin privileges required.');
                return;
            }
            hideAllPages();
            document.getElementById('categoryManager').classList.remove('hidden');
            loadCategoryManager();
        }

        function showAnnouncementManager() {
            if (!isAdmin) {
                alert('Access denied. Admin privileges required.');
                return;
            }
            hideAllPages();
            document.getElementById('announcementManager').classList.remove('hidden');
            loadAnnouncements();
        }

        function showCreateAnnouncement() {
            if (!isAdmin) {
                alert('Access denied. Admin privileges required.');
                return;
            }
            hideAllPages();
            document.getElementById('createAnnouncementForm').classList.remove('hidden');
        }

        // Product Functions
        function loadProducts() {
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = '<div class="col-span-full text-center"><div class="loading mx-auto"></div></div>';

            database.ref('products').once('value')
                .then((snapshot) => {
                    const products = snapshot.val() || {};
                    const productsWithStats = Object.entries(products).map(([id, product]) => ({
                        id, 
                        ...product,
                        popularityScore: calculatePopularityScore(product),
                        totalOrders: product.totalOrders || 0,
                        totalViews: product.totalViews || 0
                    }));
                    displayProducts(productsWithStats);
                })
                .catch((error) => {
                    console.error('Error loading products:', error);
                    productsGrid.innerHTML = '<div class="col-span-full text-center text-red-500">Failed to load products</div>';
                });
        }



        function calculatePopularityScore(product) {
            const views = product.totalViews || 0;
            const orders = product.totalOrders || 0;
            const cartAdds = product.totalCartAdds || 0;
            const rating = product.averageRating || 0;
            const reviews = product.reviewCount || 0;
            
            // Weighted popularity score
            return (views * 0.1) + (cartAdds * 2) + (orders * 5) + (rating * 10) + (reviews * 3);
        }

        function trackProductView(productId) {
            database.ref(`products/${productId}/totalViews`).transaction((currentViews) => {
                return (currentViews || 0) + 1;
            });
        }

        function trackProductAction(productId, action) {
            const actionField = action === 'add_to_cart' ? 'totalCartAdds' : 'totalOrders';
            database.ref(`products/${productId}/${actionField}`).transaction((currentCount) => {
                return (currentCount || 0) + 1;
            });
        }

        function displayProducts(products) {
            const productsGrid = document.getElementById('productsGrid');
            
            if (products.length === 0) {
                productsGrid.innerHTML = '<div class="col-span-full text-center text-gray-500 py-12">No products available yet. Be the first seller to add products!</div>';
                return;
            }

            productsGrid.innerHTML = products.map(product => {
                const discount = product.mrp && product.mrp > product.sellingPrice ? 
                    Math.round(((product.mrp - product.sellingPrice) / product.mrp) * 100) : 0;
                
                return `
                    <div class="product-card bg-white rounded-lg overflow-hidden cursor-pointer relative" onclick="trackProductView('${product.id}'); showProductDetail('${product.id}')">
                        ${discount > 0 ? `<div class="absolute top-2 left-2 bg-red-600 text-white text-xs px-2 py-1 rounded z-10">${discount}% off</div>` : ''}
                        ${product.popularityScore > 50 ? `<div class="absolute top-2 right-2 bg-orange-500 text-white text-xs px-2 py-1 rounded z-10 flex items-center"><i class="fas fa-fire mr-1"></i>Hot</div>` : ''}
                        
                        <div class="h-48 bg-gray-100 flex items-center justify-center overflow-hidden relative">
                            ${product.images && product.images.length > 0 ? 
                                `<img src="${product.images[0]}" alt="${product.name}" class="w-full h-full object-contain p-2">` :
                                `<div class="text-gray-400 text-center">
                                    <i class="fas fa-image text-4xl mb-2"></i>
                                    <p class="text-sm">No Image</p>
                                </div>`
                            }
                        </div>
                        
                        <div class="p-3">
                            <h3 class="font-medium text-sm mb-1 line-clamp-2 h-10 overflow-hidden">${product.name}</h3>
                            
                            <div class="flex items-center mb-2">
                                <div class="star-rating text-sm">
                                    ${generateStarRating(product.averageRating || 0)}
                                </div>
                                <span class="text-xs text-gray-500 ml-1">(${product.reviewCount || 0})</span>
                                ${product.totalOrders > 0 ? `<span class="text-xs text-green-600 ml-2">${product.totalOrders} sold</span>` : ''}
                            </div>
                            
                            <div class="mb-2">
                                <span class="text-lg font-bold">₹${product.sellingPrice}</span>
                                ${product.mrp > product.sellingPrice ? 
                                    `<div class="text-xs text-gray-500">
                                        M.R.P: <span class="line-through">₹${product.mrp}</span>
                                    </div>` : ''
                                }
                            </div>
                            
                            <div class="text-xs text-gray-600 mb-3">
                                ${product.deliveryDays ? `Get it by ${new Date(Date.now() + product.deliveryDays * 24 * 60 * 60 * 1000).toLocaleDateString()}` : 'Fast delivery'}
                            </div>
                            
                            <div class="flex space-x-2">
                                <button onclick="event.stopPropagation(); trackProductAction('${product.id}', 'add_to_cart'); quickAddToCart('${product.id}')" 
                                        class="flex-1 amazon-orange text-gray-800 py-2 rounded text-sm font-semibold hover:bg-yellow-500 transition-colors">
                                    Add to Cart
                                </button>
                                <button onclick="event.stopPropagation(); toggleWishlist('${product.id}')" 
                                        class="px-3 py-2 border border-gray-300 rounded text-gray-600 hover:text-red-500 hover:border-red-300 transition-colors"
                                        title="Add to Wishlist">
                                    <i class="fas fa-heart"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadProductDetail(productId) {
            database.ref(`products/${productId}`).once('value')
                .then((snapshot) => {
                    const product = snapshot.val();
                    if (product) {
                        currentProduct = {id: productId, ...product};
                        displayProductDetail(currentProduct);
                        loadProductReviews(productId);
                        loadRelatedProducts(product.category);
                    }
                })
                .catch((error) => {
                    console.error('Error loading product:', error);
                });
        }

        function displayProductDetail(product) {
            document.getElementById('productTitle').textContent = product.name;
            document.getElementById('productPrice').textContent = `₹${product.sellingPrice}`;
            document.getElementById('productMRP').textContent = `₹${product.mrp}`;
            document.getElementById('productDescription').textContent = product.detailedDescription || product.shortDescription;

            // Display main product image
            const productImage = document.getElementById('productImage');
            if (product.images && product.images.length > 0) {
                productImage.src = product.images[0];
                productImage.alt = product.name;
                
                // Display image gallery
                const gallery = document.getElementById('productGallery');
                gallery.innerHTML = product.images.map((img, index) => `
                    <img src="${img}" alt="${product.name}" class="w-16 h-16 object-cover rounded cursor-pointer border-2 border-transparent hover:border-blue-500" onclick="changeMainImage('${img}')">
                `).join('');
            } else {
                productImage.src = '';
                productImage.alt = 'No image available';
                document.getElementById('productGallery').innerHTML = '';
            }

            // Display rating
            const ratingContainer = document.getElementById('productRating');
            const rating = product.averageRating || 0;
            ratingContainer.innerHTML = `
                <div class="star-rating text-xl">
                    ${generateStarRating(rating)}
                </div>
                <span class="ml-2 text-gray-600">${rating.toFixed(1)} out of 5 (${product.reviewCount || 0} reviews)</span>
            `;

            // Display variants if available
            const variantsSection = document.getElementById('variantsSection');
            const colorVariants = document.getElementById('colorVariants');
            const sizeVariants = document.getElementById('sizeVariants');

            if (product.colors && product.colors.length > 0) {
                colorVariants.classList.remove('hidden');
                document.getElementById('colorOptions').innerHTML = product.colors.split(',').map(color => 
                    `<button class="w-8 h-8 rounded-full border-2 border-gray-300" style="background-color: ${color.trim().toLowerCase()}" onclick="selectColor('${color.trim()}')"></button>`
                ).join('');
            } else {
                colorVariants.classList.add('hidden');
            }

            if (product.sizes && product.sizes.length > 0) {
                sizeVariants.classList.remove('hidden');
                document.getElementById('sizeOptions').innerHTML = product.sizes.split(',').map(size => 
                    `<button class="border border-gray-300 px-3 py-1 rounded hover:bg-gray-100" onclick="selectSize('${size.trim()}')">${size.trim()}</button>`
                ).join('');
            } else {
                sizeVariants.classList.add('hidden');
            }
        }

        function loadProductReviews(productId) {
            database.ref(`reviews/${productId}`).once('value')
                .then((snapshot) => {
                    const reviews = snapshot.val() || {};
                    displayReviews(Object.entries(reviews).map(([id, review]) => ({id, ...review})));
                });
        }

        function displayReviews(reviews) {
            const reviewsContainer = document.getElementById('reviewsContainer');
            
            if (reviews.length === 0) {
                reviewsContainer.innerHTML = '<p class="text-gray-500">No reviews yet. Be the first to review!</p>';
                return;
            }

            reviewsContainer.innerHTML = reviews.map(review => `
                <div class="border-b pb-4 mb-4">
                    <div class="flex items-center mb-2">
                        <div class="star-rating text-sm">
                            ${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}
                        </div>
                        <span class="ml-2 font-semibold">${review.title}</span>
                    </div>
                    <p class="text-gray-700 mb-2">${review.text}</p>
                    <div class="flex items-center text-sm text-gray-500">
                        <span>By ${review.userName}</span>
                        <span class="ml-4">${new Date(review.timestamp).toLocaleDateString()}</span>
                    </div>
                    ${review.images ? `
                        <div class="flex space-x-2 mt-2">
                            ${review.images.map(img => `<img src="${img}" alt="Review image" class="w-16 h-16 object-cover rounded">`).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function loadRelatedProducts(category) {
            database.ref('products').orderByChild('category').equalTo(category).limitToFirst(4).once('value')
                .then((snapshot) => {
                    const products = snapshot.val() || {};
                    const relatedProducts = Object.entries(products)
                        .map(([id, product]) => ({id, ...product}))
                        .filter(product => product.id !== currentProduct.id);
                    
                    document.getElementById('relatedProducts').innerHTML = relatedProducts.map(product => `
                        <div class="product-card bg-white rounded-lg shadow-lg overflow-hidden cursor-pointer" onclick="showProductDetail('${product.id}')">
                            <div class="h-32 bg-gray-200 flex items-center justify-center">
                                <i class="fas fa-image text-2xl text-gray-400"></i>
                            </div>
                            <div class="p-3">
                                <h4 class="font-semibold text-sm mb-1 truncate">${product.name}</h4>
                                <div class="text-lg font-bold text-green-600">₹${product.sellingPrice}</div>
                            </div>
                        </div>
                    `).join('');
                });
        }

        // Cart Functions
        function addToCart() {
            if (!currentUser) {
                alert('Please login to add items to cart');
                return;
            }

            const cartItem = {
                productId: currentProduct.id,
                name: currentProduct.name,
                price: currentProduct.sellingPrice,
                mrp: currentProduct.mrp,
                quantity: 1,
                image: currentProduct.images && currentProduct.images.length > 0 ? currentProduct.images[0] : '',
                brand: currentProduct.brandName || '',
                category: currentProduct.category || '',
                sellerId: currentProduct.sellerId || '',
                sellerName: currentProduct.sellerName || '',
                stockQuantity: currentProduct.stockQuantity || 0
            };

            const existingItem = cart.find(item => item.productId === currentProduct.id);
            if (existingItem) {
                if (existingItem.quantity < currentProduct.stockQuantity) {
                    existingItem.quantity += 1;
                    showSuccess('Product quantity updated in cart!');
                } else {
                    showWarning('Cannot add more items. Stock limit reached!');
                    return;
                }
            } else {
                cart.push(cartItem);
                showSuccess('Product added to cart!');
            }

            saveCartToFirebase();
            updateCartCount();
        }

        function quickAddToCart(productId) {
            if (!currentUser) {
                showError('Please login to add items to cart');
                return;
            }

            database.ref(`products/${productId}`).once('value')
                .then((snapshot) => {
                    const product = snapshot.val();
                    if (product) {
                        const cartItem = {
                            productId: productId,
                            name: product.name,
                            price: product.sellingPrice,
                            mrp: product.mrp,
                            quantity: 1,
                            image: product.images && product.images.length > 0 ? product.images[0] : '',
                            brand: product.brandName || '',
                            category: product.category || '',
                            sellerId: product.sellerId || '',
                            sellerName: product.sellerName || '',
                            stockQuantity: product.stockQuantity || 0
                        };

                        const existingItem = cart.find(item => item.productId === productId);
                        if (existingItem) {
                            if (existingItem.quantity < product.stockQuantity) {
                                existingItem.quantity += 1;
                                showSuccess('Product quantity updated in cart!');
                            } else {
                                showWarning('Cannot add more items. Stock limit reached!');
                                return;
                            }
                        } else {
                            cart.push(cartItem);
                            showSuccess('Product added to cart!');
                        }

                        saveCartToFirebase();
                        updateCartCount();
                    }
                });
        }

        function loadCart() {
            const cartItems = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-shopping-cart text-6xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">Your cart is empty</h3>
                        <p class="text-gray-500 mb-6">Add some products to get started!</p>
                        <button onclick="showHomePage()" class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600">
                            <i class="fas fa-shopping-bag mr-2"></i>Continue Shopping
                        </button>
                    </div>
                `;
                document.getElementById('cartTotal').textContent = '₹0';
                return;
            }

            let total = 0;
            cartItems.innerHTML = cart.map((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                const discount = item.mrp && item.mrp > item.price ? Math.round(((item.mrp - item.price) / item.mrp) * 100) : 0;
                
                return `
                    <div class="bg-white border rounded-lg p-4 mb-4 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-start space-x-4">
                            <!-- Product Image -->
                            <div class="w-20 h-20 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0">
                                ${item.image ? 
                                    `<img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover">` :
                                    `<div class="w-full h-full flex items-center justify-center">
                                        <i class="fas fa-image text-2xl text-gray-400"></i>
                                    </div>`
                                }
                            </div>
                            
                            <!-- Product Details -->
                            <div class="flex-1 min-w-0">
                                <h3 class="font-semibold text-lg text-gray-800 mb-1 truncate">${item.name}</h3>
                                ${item.brand ? `<p class="text-sm text-gray-500 mb-2">Brand: ${item.brand}</p>` : ''}
                                
                                <!-- Price Section -->
                                <div class="flex items-center space-x-2 mb-3">
                                    <span class="text-xl font-bold text-green-600">₹${item.price}</span>
                                    ${item.mrp && item.mrp > item.price ? 
                                        `<span class="text-sm text-gray-500 line-through">₹${item.mrp}</span>
                                         <span class="text-sm text-green-600 font-medium">${discount}% off</span>` : ''
                                    }
                                </div>
                                
                                <!-- Quantity and Actions -->
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-sm text-gray-600">Qty:</span>
                                        <div class="flex items-center border rounded-lg">
                                            <button onclick="updateQuantity(${index}, -1)" 
                                                    class="px-3 py-1 hover:bg-gray-100 text-gray-600 ${item.quantity <= 1 ? 'opacity-50 cursor-not-allowed' : ''}">
                                                <i class="fas fa-minus text-xs"></i>
                                            </button>
                                            <span class="px-4 py-1 border-x font-medium">${item.quantity}</span>
                                            <button onclick="updateQuantity(${index}, 1)" 
                                                    class="px-3 py-1 hover:bg-gray-100 text-gray-600">
                                                <i class="fas fa-plus text-xs"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Item Total and Remove -->
                                    <div class="flex items-center space-x-4">
                                        <div class="text-right">
                                            <div class="font-bold text-lg">₹${itemTotal}</div>
                                            ${item.quantity > 1 ? `<div class="text-xs text-gray-500">₹${item.price} each</div>` : ''}
                                        </div>
                                        <button onclick="removeFromCart(${index})" 
                                                class="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg transition-colors"
                                                title="Remove from cart">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Delivery Info -->
                                <div class="mt-3 pt-3 border-t border-gray-100">
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-truck mr-2 text-green-600"></i>
                                        <span>Free delivery by ${new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toLocaleDateString()}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('cartTotal').textContent = `₹${total}`;
            
            // Add cart summary
            const cartSummary = `
                <div class="bg-gray-50 rounded-lg p-4 mt-4">
                    <h4 class="font-semibold mb-3">Cart Summary</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>Items (${cart.reduce((sum, item) => sum + item.quantity, 0)})</span>
                            <span>₹${total}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Delivery Charges</span>
                            <span class="text-green-600">FREE</span>
                        </div>
                        <hr class="my-2">
                        <div class="flex justify-between font-semibold text-lg">
                            <span>Total Amount</span>
                            <span class="text-green-600">₹${total}</span>
                        </div>
                    </div>
                </div>
            `;
            
            cartItems.innerHTML += cartSummary;
        }

        function updateQuantity(index, change) {
            const item = cart[index];
            const newQuantity = item.quantity + change;
            
            if (newQuantity <= 0) {
                if (confirm(`Remove "${item.name}" from cart?`)) {
                    cart.splice(index, 1);
                } else {
                    return; // Don't update if user cancels removal
                }
            } else if (newQuantity > item.stockQuantity) {
                alert(`Only ${item.stockQuantity} items available in stock!`);
                return;
            } else {
                cart[index].quantity = newQuantity;
            }
            
            saveCartToFirebase();
            updateCartCount();
            loadCart();
        }

        function removeFromCart(index) {
            const item = cart[index];
            if (confirm(`Remove "${item.name}" from your cart?`)) {
                cart.splice(index, 1);
                saveCartToFirebase();
                updateCartCount();
                loadCart();
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                successMsg.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-check-circle mr-2"></i>
                        <span>Item removed from cart</span>
                    </div>
                `;
                document.body.appendChild(successMsg);
                
                setTimeout(() => {
                    if (successMsg.parentElement) {
                        successMsg.remove();
                    }
                }, 3000);
            }
        }

        function updateCartCount() {
            const cartCount = document.getElementById('cartCount');
            const bottomCartCount = document.getElementById('bottomCartCount');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            cartCount.textContent = totalItems;
            bottomCartCount.textContent = totalItems;
            
            if (totalItems > 0) {
                bottomCartCount.classList.remove('hidden');
            } else {
                bottomCartCount.classList.add('hidden');
            }
        }

        function saveCartToFirebase() {
            if (currentUser) {
                database.ref(`carts/${currentUser.uid}`).set(cart);
            }
        }

        function loadUserData() {
            if (currentUser) {
                database.ref(`carts/${currentUser.uid}`).once('value')
                    .then((snapshot) => {
                        cart = snapshot.val() || [];
                        updateCartCount();
                    });
            }
        }

        // Checkout Functions
        function proceedToCheckout() {
            if (cart.length === 0) {
                alert('Your cart is empty');
                return;
            }
            hideAllPages();
            document.getElementById('checkoutPage').classList.remove('hidden');
            loadCheckoutItems();
        }

        function loadCheckoutItems() {
            const checkoutItems = document.getElementById('checkoutItems');
            let subtotal = 0;

            checkoutItems.innerHTML = cart.map(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                return `
                    <div class="flex justify-between items-center mb-2">
                        <span>${item.name} x ${item.quantity}</span>
                        <span>₹${itemTotal}</span>
                    </div>
                `;
            }).join('');

            document.getElementById('subtotal').textContent = `₹${subtotal}`;
            document.getElementById('finalTotal').textContent = `₹${subtotal + 50}`;
        }

        function proceedToPayment() {
            const form = document.getElementById('checkoutForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            hideAllPages();
            document.getElementById('paymentPage').classList.remove('hidden');
            
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('paymentAmount').textContent = `₹${subtotal + 50}`;
        }

        function processPayment() {
            const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
            
            if (paymentMethod === 'upi' && !selectedUPIApp) {
                alert('Please select a UPI app');
                return;
            }

            // Show loading and simulate UPI redirect
            if (paymentMethod === 'upi') {
                simulateUPIPayment();
            } else {
                processCODPayment();
            }
        }

        function simulateUPIPayment() {
            // Get seller UPI ID from the first product's seller
            const firstItem = cart[0];
            database.ref(`products/${firstItem.productId}`).once('value')
                .then((snapshot) => {
                    const product = snapshot.val();
                    if (product && product.sellerId) {
                        return database.ref(`sellers/${product.sellerId}`).once('value');
                    }
                })
                .then((sellerSnapshot) => {
                    const sellerData = sellerSnapshot.val();
                    const sellerUPI = sellerData ? sellerData.upiId : '7347417931@axl';
                    const paymentAmount = document.getElementById('paymentAmount').textContent.replace('₹', '');
                    
                    // Show payment redirect dialog
                    showPaymentDialog(selectedUPIApp, paymentAmount, sellerUPI, () => {
                        // Show processing
                        showPaymentProcessing();
                        
                        // Auto complete after 3 seconds
                        setTimeout(() => {
                            hidePaymentProcessing();
                            completeOrder('upi', sellerData);
                        }, 3000);
                    });
                });
        }

        function processCODPayment() {
            const advanceAmount = Math.round(parseFloat(document.getElementById('paymentAmount').textContent.replace('₹', '')));
            
            // Get seller UPI for advance payment
            const firstItem = cart[0];
            database.ref(`products/${firstItem.productId}`).once('value')
                .then((snapshot) => {
                    const product = snapshot.val();
                    if (product && product.sellerId) {
                        return database.ref(`sellers/${product.sellerId}`).once('value');
                    }
                })
                .then((sellerSnapshot) => {
                    const sellerData = sellerSnapshot.val();
                    const sellerUPI = sellerData ? sellerData.upiId : '7347417931@axl';
                    
                    // Show COD advance payment dialog
                    showPaymentDialog('UPI', advanceAmount, sellerUPI, () => {
                        // Show processing
                        showPaymentProcessing();
                        
                        // Auto complete after 3 seconds
                        setTimeout(() => {
                            hidePaymentProcessing();
                            completeOrder('cod', sellerData);
                        }, 3000);
                    }, true);
                });
        }

        function showPaymentDialog(appName, amount, receiver, onConfirm, isCOD = false) {
            const modal = document.createElement('div');
            modal.id = 'paymentDialog';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm w-full">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-mobile-alt text-2xl text-blue-600"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">
                            ${isCOD ? 'COD Advance Payment' : 'Payment Required'}
                        </h3>
                        <p class="text-gray-600 text-sm mb-4">
                            ${isCOD ? 'Pay advance amount for Cash on Delivery' : `Pay using ${appName.toUpperCase()}`}
                        </p>
                        
                        <div class="bg-gray-50 rounded-lg p-4 mb-4">
                            <div class="text-sm text-gray-600 mb-1">Amount:</div>
                            <div class="text-2xl font-bold text-green-600">₹${amount}</div>
                            <div class="text-sm text-gray-600 mt-2">Pay to:</div>
                            <div class="font-mono text-sm">${receiver}</div>
                        </div>
                        
                        <p class="text-xs text-gray-500 mb-6">
                            Click "Pay Now" to open ${appName.toUpperCase()} app and complete payment
                        </p>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="closePaymentDialog()" class="flex-1 bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600">
                            Cancel
                        </button>
                        <button onclick="redirectToPaymentApp('${appName}', '${amount}', '${receiver}')" class="flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700">
                            Pay Now
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Store callback for later use
            window.paymentConfirmCallback = onConfirm;
        }

        function redirectToPaymentApp(appName, amount, receiver) {
            let paymentUrl = '';
            
            // Create UPI payment URLs for different apps
            switch(appName.toLowerCase()) {
                case 'phonepe':
                    paymentUrl = `phonepe://pay?pa=${receiver}&pn=Homy&am=${amount}&cu=INR&tn=Order Payment`;
                    break;
                case 'paytm':
                    paymentUrl = `paytmmp://pay?pa=${receiver}&pn=Homy&am=${amount}&cu=INR&tn=Order Payment`;
                    break;
                case 'googlepay':
                    paymentUrl = `tez://upi/pay?pa=${receiver}&pn=Homy&am=${amount}&cu=INR&tn=Order Payment`;
                    break;
                case 'bhim':
                    paymentUrl = `bhim://pay?pa=${receiver}&pn=Homy&am=${amount}&cu=INR&tn=Order Payment`;
                    break;
                default:
                    // Generic UPI URL
                    paymentUrl = `upi://pay?pa=${receiver}&pn=Homy&am=${amount}&cu=INR&tn=Order Payment`;
            }
            
            // Try to open the payment app
            const link = document.createElement('a');
            link.href = paymentUrl;
            link.click();
            
            // Show payment confirmation dialog after a short delay
            setTimeout(() => {
                showPaymentConfirmationDialog();
            }, 2000);
        }

        function showPaymentConfirmationDialog() {
            closePaymentDialog();
            
            const modal = document.createElement('div');
            modal.id = 'paymentConfirmDialog';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm w-full">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-question-circle text-2xl text-orange-600"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">Payment Confirmation</h3>
                        <p class="text-gray-600 text-sm mb-4">
                            Did you complete the payment successfully?
                        </p>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="paymentFailed()" class="flex-1 bg-red-500 text-white py-3 px-4 rounded-lg hover:bg-red-600">
                            Payment Failed
                        </button>
                        <button onclick="paymentSuccess()" class="flex-1 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700">
                            Payment Done
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function paymentSuccess() {
            const confirmDialog = document.getElementById('paymentConfirmDialog');
            if (confirmDialog) {
                confirmDialog.remove();
            }
            
            if (window.paymentConfirmCallback) {
                window.paymentConfirmCallback();
            }
        }

        function paymentFailed() {
            const confirmDialog = document.getElementById('paymentConfirmDialog');
            if (confirmDialog) {
                confirmDialog.remove();
            }
            
            showError('Payment failed. Please try again or choose a different payment method.');
        }

        function confirmPayment() {
            closePaymentDialog();
            if (window.paymentConfirmCallback) {
                window.paymentConfirmCallback();
            }
        }

        function closePaymentDialog() {
            const dialog = document.getElementById('paymentDialog');
            if (dialog) {
                dialog.remove();
            }
            window.paymentConfirmCallback = null;
        }

        function showPaymentProcessing() {
            const modal = document.createElement('div');
            modal.id = 'paymentProcessing';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 text-center max-w-sm w-full">
                    <div class="loading mx-auto mb-4"></div>
                    <h3 class="text-lg font-semibold mb-2">Processing Payment</h3>
                    <p class="text-gray-600">Please wait while we process your payment...</p>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function hidePaymentProcessing() {
            const processing = document.getElementById('paymentProcessing');
            if (processing) {
                processing.remove();
            }
        }

        function showOrderSuccessDialog(orderId, paymentMethod, total) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm w-full text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-2xl text-green-600"></i>
                    </div>
                    <h3 class="text-xl font-bold text-green-600 mb-2">Order Successful!</h3>
                    <p class="text-gray-600 mb-4">Your order has been placed successfully</p>
                    
                    <div class="bg-gray-50 rounded-lg p-4 mb-4 text-left">
                        <div class="flex justify-between mb-2">
                            <span class="text-sm text-gray-600">Order ID:</span>
                            <span class="font-mono text-sm">${orderId}</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="text-sm text-gray-600">Payment:</span>
                            <span class="text-sm">${paymentMethod}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Total:</span>
                            <span class="font-bold text-green-600">₹${total}</span>
                        </div>
                    </div>
                    
                    <p class="text-xs text-gray-500 mb-6">
                        Your order is pending seller approval. You will be notified once confirmed.
                    </p>
                    
                    <button onclick="this.closest('.fixed').remove()" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700">
                        Continue Shopping
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Auto close after 5 seconds
            setTimeout(() => {
                if (modal.parentElement) {
                    modal.remove();
                }
            }, 5000);
        }

        function completeOrder(paymentMethod, sellerData) {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const finalTotal = subtotal - currentDiscount + 50;
            
            // Create order
            const order = {
                userId: currentUser.uid,
                userName: currentUser.displayName,
                userEmail: currentUser.email,
                items: cart,
                shippingInfo: {
                    fullName: document.getElementById('fullName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    address: document.getElementById('address').value,
                    city: document.getElementById('city').value,
                    pincode: document.getElementById('pincode').value,
                    state: document.getElementById('state').value
                },
                paymentMethod: paymentMethod,
                upiApp: selectedUPIApp,
                subtotal: subtotal,
                discount: currentDiscount,
                shippingCharges: 50,
                total: finalTotal,
                appliedCoupon: appliedCoupon,
                sellerInfo: sellerData,
                sellerId: cart[0].sellerId,
                status: 'pending',
                timestamp: Date.now(),
                orderId: 'ORD' + Date.now()
            };

            // Save order and track product orders
            database.ref('orders').push(order)
                .then((orderRef) => {
                    // Update product order counts
                    cart.forEach(item => {
                        trackProductAction(item.productId, 'order');
                    });
                    
                    // Create seller notification
                    if (sellerData && sellerData.userId) {
                        const notification = {
                            sellerId: sellerData.userId,
                            orderId: order.orderId,
                            message: `New order received! Order #${order.orderId} - ₹${finalTotal}`,
                            type: 'new_order',
                            timestamp: Date.now(),
                            read: false
                        };
                        
                        database.ref('sellerNotifications').push(notification);
                        
                        // Play notification sound for seller (if they're online)
                        database.ref(`sellerOnline/${sellerData.userId}`).once('value')
                            .then((snapshot) => {
                                if (snapshot.val() === true) {
                                    // Trigger notification sound
                                    database.ref(`sellerNotifications/${sellerData.userId}/playSound`).set(true);
                                }
                            });
                    }
                    
                    // Update coupon usage if applied
                    if (appliedCoupon) {
                        database.ref('coupons').orderByChild('code').equalTo(appliedCoupon.code).once('value')
                            .then((snapshot) => {
                                const coupons = snapshot.val();
                                if (coupons) {
                                    const couponId = Object.keys(coupons)[0];
                                    const currentUsage = coupons[couponId].usedCount || 0;
                                    database.ref(`coupons/${couponId}/usedCount`).set(currentUsage + 1);
                                }
                            });
                    }
                    
                    // Clear cart and reset
                    cart = [];
                    appliedCoupon = null;
                    currentDiscount = 0;
                    selectedUPIApp = '';
                    saveCartToFirebase();
                    updateCartCount();
                    
                    // Show success message
                    showOrderSuccessDialog(order.orderId, paymentMethod.toUpperCase(), finalTotal);
                    showHomePage();
                })
                .catch((error) => {
                    console.error('Error placing order:', error);
                    alert('Failed to place order. Please try again.');
                });
        }

        // Pincode Verification Functions
        async function verifyPincode() {
            const pincode = document.getElementById('pincodeInput').value.trim();
            const resultDiv = document.getElementById('pincodeResult');
            
            if (!pincode || pincode.length !== 6) {
                showPincodeResult('Please enter a valid 6-digit pincode', 'error');
                return;
            }
            
            try {
                resultDiv.innerHTML = '<div class="flex items-center text-blue-600"><div class="loading mr-2"></div>Checking delivery availability...</div>';
                resultDiv.classList.remove('hidden');
                
                const response = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
                const data = await response.json();
                
                if (data[0].Status === 'Success') {
                    const postOffice = data[0].PostOffice[0];
                    verifiedPincode = {
                        pincode: pincode,
                        city: postOffice.District,
                        state: postOffice.State,
                        area: postOffice.Name
                    };
                    
                    showPincodeResult(`
                        <div class="text-green-600">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-check-circle mr-2"></i>
                                <span class="font-semibold">Delivery Available!</span>
                            </div>
                            <div class="text-sm space-y-1">
                                <div><strong>Area:</strong> ${postOffice.Name}</div>
                                <div><strong>District:</strong> ${postOffice.District}</div>
                                <div><strong>State:</strong> ${postOffice.State}</div>
                                <div class="flex items-center mt-2">
                                    <i class="fas fa-truck mr-2 text-blue-600"></i>
                                    <span>Expected delivery: ${getDeliveryDate()} days</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-money-bill-wave mr-2 text-green-600"></i>
                                    <span>Cash on Delivery available</span>
                                </div>
                            </div>
                        </div>
                    `, 'success');
                } else {
                    showPincodeResult('Invalid pincode. Please check and try again.', 'error');
                }
            } catch (error) {
                console.error('Error verifying pincode:', error);
                showPincodeResult('Unable to verify pincode. Please try again later.', 'error');
            }
        }

        function showPincodeResult(message, type) {
            const resultDiv = document.getElementById('pincodeResult');
            const bgColor = type === 'success' ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
            
            resultDiv.innerHTML = `<div class="p-3 rounded-lg border ${bgColor}">${message}</div>`;
            resultDiv.classList.remove('hidden');
        }

        function getDeliveryDate() {
            const deliveryDays = currentProduct?.deliveryDays || 3;
            return `3-${deliveryDays}`;
        }

        // Auto-fill address from pincode
        async function autoFillAddress() {
            const pincode = document.getElementById('pincode').value.trim();
            
            if (!pincode || pincode.length !== 6) {
                alert('Please enter a valid 6-digit pincode');
                return;
            }
            
            try {
                const response = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
                const data = await response.json();
                
                if (data[0].Status === 'Success') {
                    const postOffice = data[0].PostOffice[0];
                    document.getElementById('city').value = postOffice.District;
                    document.getElementById('state').value = postOffice.State;
                    
                    showSuccess(`Address auto-filled for ${postOffice.Name}, ${postOffice.District}`);
                } else {
                    showError('Invalid pincode. Please check and try again.');
                }
            } catch (error) {
                console.error('Error fetching address:', error);
                showError('Unable to fetch address. Please enter manually.');
            }
        }

        // Seller Order Management Functions
        function showSellerOrders() {
            hideAllPages();
            document.getElementById('sellerOrdersPage').classList.remove('hidden');
            loadSellerOrders();
        }

        function showSellerProducts() {
            hideAllPages();
            document.getElementById('sellerProductsPage').classList.remove('hidden');
            loadBusinessProducts();
        }

        function loadSellerOrders() {
            database.ref('orders').orderByChild('sellerId').equalTo(currentUser.uid).once('value')
                .then((snapshot) => {
                    const orders = snapshot.val() || {};
                    const ordersArray = Object.entries(orders).map(([id, order]) => ({id, ...order}));
                    displaySellerOrders(ordersArray);
                    updateSellerStats(ordersArray);
                });
        }

        function displaySellerOrders(orders) {
            const ordersList = document.getElementById('sellerOrdersList');
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<div class="text-center text-gray-500 py-8">No orders received yet</div>';
                return;
            }

            ordersList.innerHTML = orders.map(order => `
                <div class="border rounded-lg p-6 bg-white shadow-sm">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-lg font-bold">Order #${order.orderId}</h3>
                            <p class="text-gray-600">Customer: ${order.userName}</p>
                            <p class="text-gray-600">Phone: ${order.shippingInfo.phone}</p>
                            <p class="text-sm text-gray-500">${new Date(order.timestamp).toLocaleString()}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-green-600">₹${order.total}</div>
                            <span class="px-3 py-1 rounded-full text-sm ${getOrderStatusColor(order.status)}">${order.status.toUpperCase()}</span>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <div class="mb-4">
                        <h4 class="font-semibold mb-2">Items:</h4>
                        <div class="space-y-2">
                            ${order.items.map(item => `
                                <div class="flex justify-between items-center bg-gray-50 p-2 rounded">
                                    <span>${item.name} x ${item.quantity}</span>
                                    <span>₹${item.price * item.quantity}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Shipping Address -->
                    <div class="mb-4">
                        <h4 class="font-semibold mb-2">Shipping Address:</h4>
                        <div class="bg-gray-50 p-3 rounded text-sm">
                            <p><strong>${order.shippingInfo.fullName}</strong></p>
                            <p>${order.shippingInfo.address}</p>
                            <p>${order.shippingInfo.city}, ${order.shippingInfo.pincode}</p>
                            <p>Phone: ${order.shippingInfo.phone}</p>
                            <p>Email: ${order.shippingInfo.email}</p>
                        </div>
                    </div>

                    <!-- Order Actions -->
                    <div class="flex flex-wrap gap-2">
                        ${order.status === 'pending' ? `
                            <button onclick="updateOrderStatus('${order.id}', 'accepted')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                                <i class="fas fa-check mr-2"></i>Accept Order
                            </button>
                            <button onclick="rejectOrder('${order.id}')" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                                <i class="fas fa-times mr-2"></i>Reject Order
                            </button>
                        ` : ''}
                        
                        ${order.status === 'accepted' ? `
                            <button onclick="updateOrderStatus('${order.id}', 'shipped')" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                                <i class="fas fa-shipping-fast mr-2"></i>Mark as Shipped
                            </button>
                        ` : ''}
                        
                        ${order.status === 'shipped' ? `
                            <button onclick="updateOrderStatus('${order.id}', 'out-for-delivery')" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600">
                                <i class="fas fa-truck mr-2"></i>Out for Delivery
                            </button>
                        ` : ''}
                        
                        ${order.status === 'out-for-delivery' ? `
                            <button onclick="updateOrderStatus('${order.id}', 'delivered')" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                                <i class="fas fa-check-circle mr-2"></i>Mark as Delivered
                            </button>
                        ` : ''}
                        
                        <button onclick="contactCustomer('${order.shippingInfo.phone}')" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                            <i class="fas fa-phone mr-2"></i>Contact Customer
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateOrderStatus(orderId, newStatus) {
            database.ref(`orders/${orderId}/status`).set(newStatus)
                .then(() => {
                    showSuccess(`Order status updated to ${newStatus}!`);
                    loadSellerOrders();
                    
                    // Send notification to customer
                    database.ref(`orders/${orderId}`).once('value').then((snapshot) => {
                        const order = snapshot.val();
                        if (order) {
                            const customerNotification = {
                                userId: order.userId,
                                orderId: order.orderId,
                                message: `Your order #${order.orderId} is now ${newStatus}`,
                                type: 'order_update',
                                timestamp: Date.now(),
                                read: false
                            };
                            database.ref('customerNotifications').push(customerNotification);
                        }
                    });
                })
                .catch((error) => {
                    console.error('Error updating order status:', error);
                    showError('Failed to update order status');
                });
        }

        function rejectOrder(orderId) {
            const reason = prompt('Please provide a reason for rejection:');
            if (reason) {
                database.ref(`orders/${orderId}`).update({
                    status: 'rejected',
                    rejectionReason: reason,
                    rejectedAt: Date.now()
                })
                .then(() => {
                    showSuccess('Order rejected successfully!');
                    loadSellerOrders();
                    
                    // Send notification to customer
                    database.ref(`orders/${orderId}`).once('value').then((snapshot) => {
                        const order = snapshot.val();
                        if (order) {
                            const customerNotification = {
                                userId: order.userId,
                                orderId: order.orderId,
                                message: `Your order #${order.orderId} has been rejected. Reason: ${reason}`,
                                type: 'order_rejected',
                                timestamp: Date.now(),
                                read: false
                            };
                            database.ref('customerNotifications').push(customerNotification);
                        }
                    });
                })
                .catch((error) => {
                    console.error('Error rejecting order:', error);
                    showError('Failed to reject order');
                });
            }
        }

        function contactCustomer(phone) {
            window.open(`tel:${phone}`, '_self');
        }

        function getOrderStatusColor(status) {
            const colors = {
                'pending': 'bg-yellow-100 text-yellow-800',
                'accepted': 'bg-green-100 text-green-800',
                'shipped': 'bg-blue-100 text-blue-800',
                'out-for-delivery': 'bg-orange-100 text-orange-800',
                'delivered': 'bg-purple-100 text-purple-800',
                'rejected': 'bg-red-100 text-red-800'
            };
            return colors[status] || 'bg-gray-100 text-gray-800';
        }

        function filterSellerOrders(status) {
            // Reset all filter buttons
            document.querySelectorAll('[id^="filter"]').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'hover:bg-gray-300');
            });
            
            // Highlight active filter
            const activeBtn = document.getElementById(`filter${status.charAt(0).toUpperCase() + status.slice(1)}`);
            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                activeBtn.classList.add('bg-blue-500', 'text-white');
            }
            
            // Load filtered orders
            database.ref('orders').orderByChild('sellerId').equalTo(currentUser.uid).once('value')
                .then((snapshot) => {
                    const orders = snapshot.val() || {};
                    let ordersArray = Object.entries(orders).map(([id, order]) => ({id, ...order}));
                    
                    if (status !== 'all') {
                        ordersArray = ordersArray.filter(order => order.status === status);
                    }
                    
                    displaySellerOrders(ordersArray);
                });
        }

        function updateSellerStats(orders) {
            const totalOrders = orders.length;
            const pendingOrders = orders.filter(order => order.status === 'pending').length;
            const totalEarnings = orders
                .filter(order => order.status === 'delivered')
                .reduce((sum, order) => sum + order.total, 0);
            
            document.getElementById('sellerTotalOrders').textContent = totalOrders;
            document.getElementById('sellerPendingOrders').textContent = pendingOrders;
            document.getElementById('sellerTotalEarnings').textContent = `₹${totalEarnings}`;
            
            // Load recent orders for dashboard
            const recentOrders = orders.slice(0, 3);
            const recentOrdersContainer = document.getElementById('recentSellerOrders');
            
            if (recentOrders.length === 0) {
                recentOrdersContainer.innerHTML = '<p class="text-gray-500">No recent orders</p>';
            } else {
                recentOrdersContainer.innerHTML = recentOrders.map(order => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <div>
                            <div class="font-semibold">Order #${order.orderId}</div>
                            <div class="text-sm text-gray-600">${order.userName}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold">₹${order.total}</div>
                            <span class="text-xs px-2 py-1 rounded ${getOrderStatusColor(order.status)}">${order.status}</span>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Orders Functions
        function loadOrders() {
            database.ref('orders').orderByChild('userId').equalTo(currentUser.uid).once('value')
                .then((snapshot) => {
                    const orders = snapshot.val() || {};
                    displayOrders(Object.entries(orders).map(([id, order]) => ({id, ...order})));
                });
        }

        function displayOrders(orders) {
            const ordersContainer = document.getElementById('ordersContainer');
            
            if (orders.length === 0) {
                ordersContainer.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm border p-12 text-center">
                        <i class="fas fa-shopping-bag text-6xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">No orders yet</h3>
                        <p class="text-gray-500 mb-6">Looks like you haven't placed any orders yet.</p>
                        <button onclick="showHomePage()" class="amazon-orange text-gray-800 px-6 py-3 rounded-lg font-semibold hover:bg-yellow-500">
                            Start Shopping
                        </button>
                    </div>
                `;
                return;
            }

            ordersContainer.innerHTML = orders.map(order => {
                const canCancel = ['pending', 'accepted'].includes(order.status);
                const canRequestRefund = ['delivered'].includes(order.status) && !order.refundRequested;
                const isRefundRequested = order.refundRequested;
                
                return `
                    <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
                        <!-- Order Header -->
                        <div class="bg-gray-50 px-6 py-4 border-b">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="flex items-center space-x-4 mb-2">
                                        <span class="text-sm text-gray-600">ORDER PLACED</span>
                                        <span class="text-sm text-gray-600">TOTAL</span>
                                        <span class="text-sm text-gray-600">SHIP TO</span>
                                    </div>
                                    <div class="flex items-center space-x-4">
                                        <span class="text-sm">${new Date(order.timestamp).toLocaleDateString()}</span>
                                        <span class="text-sm font-semibold">₹${order.total}</span>
                                        <span class="text-sm">${order.shippingInfo.fullName}</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-600 mb-1">ORDER # ${order.orderId}</div>
                                    <div class="flex items-center space-x-2">
                                        <span class="order-status px-3 py-1 rounded-full text-xs ${getOrderStatusColor(order.status)}">${order.status.toUpperCase()}</span>
                                        ${isRefundRequested ? '<span class="refund-badge">REFUND REQUESTED</span>' : ''}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Order Items -->
                        <div class="p-6">
                            ${order.items.map(item => `
                                <div class="flex items-start space-x-4 mb-6 pb-6 border-b last:border-b-0 last:mb-0 last:pb-0">
                                    <div class="w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                        ${item.image ? 
                                            `<img src="${item.image}" alt="${item.name}" class="w-full h-full object-contain rounded-lg">` :
                                            `<i class="fas fa-image text-2xl text-gray-400"></i>`
                                        }
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-semibold mb-1">${item.name}</h4>
                                        <p class="text-sm text-gray-600 mb-2">Quantity: ${item.quantity}</p>
                                        <p class="text-lg font-bold text-green-600">₹${item.price * item.quantity}</p>
                                        
                                        <!-- Item Actions -->
                                        <div class="flex flex-wrap gap-2 mt-3">
                                            ${order.status === 'delivered' ? `
                                                <button onclick="showReviewForm('${item.productId}')" class="text-sm border border-gray-300 px-3 py-1 rounded hover:bg-gray-50">
                                                    Write a review
                                                </button>
                                                <button onclick="buyAgain('${item.productId}')" class="text-sm border border-gray-300 px-3 py-1 rounded hover:bg-gray-50">
                                                    Buy it again
                                                </button>
                                            ` : ''}
                                            
                                            ${order.status === 'shipped' || order.status === 'out-for-delivery' ? `
                                                <button onclick="trackOrder('${order.orderId}')" class="text-sm amazon-orange border border-orange-400 px-3 py-1 rounded hover:bg-orange-50">
                                                    Track package
                                                </button>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                            
                            <!-- Order Actions -->
                            <div class="flex flex-wrap gap-3 mt-6 pt-4 border-t">
                                ${canCancel ? `
                                    <button onclick="showCancelOrderModal('${order.id}')" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                                        Cancel Order
                                    </button>
                                ` : ''}
                                
                                ${canRequestRefund ? `
                                    <button onclick="showRefundModal('${order.id}')" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700">
                                        Request Refund
                                    </button>
                                ` : ''}
                                
                                <button onclick="contactSeller('${order.sellerId}')" class="border border-gray-300 px-4 py-2 rounded hover:bg-gray-50">
                                    Contact Seller
                                </button>
                                
                                <button onclick="viewOrderDetails('${order.id}')" class="border border-gray-300 px-4 py-2 rounded hover:bg-gray-50">
                                    Order Details
                                </button>
                                
                                ${order.status === 'delivered' ? `
                                    <button onclick="downloadInvoice('${order.id}')" class="border border-gray-300 px-4 py-2 rounded hover:bg-gray-50">
                                        Download Invoice
                                    </button>
                                ` : ''}
                            </div>
                            
                            <!-- Refund Status -->
                            ${order.refundRequested ? `
                                <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <div class="flex items-center">
                                        <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                                        <span class="font-semibold text-yellow-800">Refund Request Submitted</span>
                                    </div>
                                    <p class="text-sm text-yellow-700 mt-1">
                                        Your refund request is being processed. You will be notified once it's approved.
                                    </p>
                                    <p class="text-xs text-yellow-600 mt-2">
                                        Reason: ${order.refundReason || 'Not specified'}
                                    </p>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getStatusColor(status) {
            const colors = {
                'accepted': 'bg-blue-100 text-blue-800',
                'shipped': 'bg-yellow-100 text-yellow-800',
                'out-for-delivery': 'bg-orange-100 text-orange-800',
                'delivered': 'bg-green-100 text-green-800',
                'rejected': 'bg-red-100 text-red-800'
            };
            return colors[status] || 'bg-gray-100 text-gray-800';
        }

        // Business Functions
        function loadBusinessProducts() {
            database.ref('products').orderByChild('sellerId').equalTo(currentUser.uid).once('value')
                .then((snapshot) => {
                    const products = snapshot.val() || {};
                    displayBusinessProducts(Object.entries(products).map(([id, product]) => ({id, ...product})));
                });
        }

        function displayBusinessProducts(products) {
            const businessProducts = document.getElementById('businessProducts');
            
            if (products.length === 0) {
                businessProducts.innerHTML = '<div class="col-span-full text-center text-gray-500">No products added yet</div>';
                return;
            }

            businessProducts.innerHTML = products.map(product => `
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <div class="h-32 bg-gray-200 rounded mb-4 flex items-center justify-center">
                        <i class="fas fa-image text-2xl text-gray-400"></i>
                    </div>
                    <h3 class="font-semibold mb-2">${product.name}</h3>
                    <p class="text-green-600 font-bold mb-2">₹${product.sellingPrice}</p>
                    <p class="text-sm text-gray-600 mb-4">Stock: ${product.stockQuantity}</p>
                    <div class="flex space-x-2">
                        <button onclick="editProduct('${product.id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">Edit</button>
                        <button onclick="deleteProduct('${product.id}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function generateStarRating(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            return '★'.repeat(fullStars) + 
                   (hasHalfStar ? '☆' : '') + 
                   '☆'.repeat(emptyStars);
        }

        function calculateAverageRating(reviews) {
            if (!reviews || reviews.length === 0) return 0;
            const sum = reviews.reduce((acc, review) => acc + review.rating, 0);
            return (sum / reviews.length).toFixed(1);
        }

        function toggleVariants() {
            const category = document.getElementById('category').value;
            const variantsContainer = document.getElementById('variantsContainer');
            
            // Show variants for fashion category
            if (category === 'fashion') {
                variantsContainer.classList.remove('hidden');
            } else {
                variantsContainer.classList.add('hidden');
            }
        }

        function generateSKU() {
            const sku = 'SKU' + Date.now();
            document.getElementById('skuCode').value = sku;
        }

        function cancelAddProduct() {
            document.getElementById('productForm').reset();
            showBusinessPanel();
        }

        // Review Functions
        function showReviewForm() {
            if (!currentUser) {
                alert('Please login to write a review');
                return;
            }
            document.getElementById('reviewModal').classList.remove('hidden');
        }

        function closeReviewModal() {
            document.getElementById('reviewModal').classList.add('hidden');
            document.getElementById('reviewForm').reset();
            selectedRating = 0;
            updateStarDisplay();
        }

        function setRating(rating) {
            selectedRating = rating;
            updateStarDisplay();
        }

        function updateStarDisplay() {
            const stars = document.querySelectorAll('#reviewModal .fas.fa-star');
            stars.forEach((star, index) => {
                if (index < selectedRating) {
                    star.classList.remove('text-gray-300');
                    star.classList.add('text-yellow-400');
                } else {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-300');
                }
            });
        }

        // Search and Filter Functions
        function searchProducts() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (!query) {
                loadProducts();
                return;
            }

            database.ref('products').once('value')
                .then((snapshot) => {
                    const products = snapshot.val() || {};
                    const filteredProducts = Object.entries(products)
                        .map(([id, product]) => ({id, ...product}))
                        .filter(product => 
                            product.name.toLowerCase().includes(query) ||
                            (product.tags && product.tags.toLowerCase().includes(query)) ||
                            (product.category && product.category.toLowerCase().includes(query))
                        );
                    displayProducts(filteredProducts);
                });
        }

        function toggleMobileSearch() {
            const overlay = document.getElementById('mobileSearchOverlay');
            overlay.classList.remove('hidden');
            
            // Focus on search input after a short delay
            setTimeout(() => {
                document.getElementById('mobileSearchInput').focus();
            }, 100);
        }

        function closeMobileSearch() {
            const overlay = document.getElementById('mobileSearchOverlay');
            overlay.classList.add('hidden');
            
            // Clear search input
            document.getElementById('mobileSearchInput').value = '';
        }

        function searchProductsMobile() {
            const query = document.getElementById('mobileSearchInput').value.toLowerCase();
            if (!query) {
                loadProducts();
                closeMobileSearch();
                return;
            }

            database.ref('products').once('value')
                .then((snapshot) => {
                    const products = snapshot.val() || {};
                    const filteredProducts = Object.entries(products)
                        .map(([id, product]) => ({id, ...product}))
                        .filter(product => 
                            product.name.toLowerCase().includes(query) ||
                            (product.tags && product.tags.toLowerCase().includes(query)) ||
                            (product.category && product.category.toLowerCase().includes(query))
                        );
                    displayProducts(filteredProducts);
                    closeMobileSearch();
                    showHomePage();
                });
        }

        function quickSearch(category) {
            document.getElementById('mobileSearchInput').value = category;
            searchProductsMobile();
        }

        function filterByCategory(category) {
            // Show home page first
            hideAllPages();
            document.getElementById('homePage').classList.remove('hidden');
            updateURL(`category/${category}`);
            
            // Load filtered products
            database.ref('products').orderByChild('category').equalTo(category).once('value')
                .then((snapshot) => {
                    const products = snapshot.val() || {};
                    displayProducts(Object.entries(products).map(([id, product]) => ({id, ...product})));
                })
                .catch((error) => {
                    console.error('Error loading category products:', error);
                    // Show all products if category filter fails
                    loadProducts();
                });
        }

        function buyNow() {
            if (!currentUser) {
                alert('Please login to buy products');
                return;
            }
            
            // Add to cart and proceed to checkout
            addToCart();
            setTimeout(() => {
                proceedToCheckout();
            }, 500);
        }

        function loadUserSettings() {
            console.log('Loading user settings for:', currentUser);
            
            const userDisplayNameEl = document.getElementById('userDisplayName');
            const userEmailEl = document.getElementById('userEmail');
            
            if (userDisplayNameEl) {
                userDisplayNameEl.value = currentUser.displayName || '';
            }
            if (userEmailEl) {
                userEmailEl.value = currentUser.email || '';
            }
            
            // Check seller status
            database.ref(`sellers/${currentUser.uid}`).once('value')
                .then((snapshot) => {
                    const sellerData = snapshot.val();
                    const notSellerSection = document.getElementById('notSellerSection');
                    const sellerStatusSection = document.getElementById('sellerStatusSection');
                    const sellerStatus = document.getElementById('sellerStatus');
                    const sellerBusinessName = document.getElementById('sellerBusinessName');
                    
                    if (sellerData) {
                        if (notSellerSection) notSellerSection.classList.add('hidden');
                        if (sellerStatusSection) sellerStatusSection.classList.remove('hidden');
                        if (sellerStatus) sellerStatus.textContent = sellerData.status;
                        if (sellerBusinessName) sellerBusinessName.textContent = sellerData.businessName;
                    } else {
                        if (notSellerSection) notSellerSection.classList.remove('hidden');
                        if (sellerStatusSection) sellerStatusSection.classList.add('hidden');
                    }
                })
                .catch((error) => {
                    console.error('Error loading seller data:', error);
                });
        }

        function convertToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        async function handleImageUpload() {
            const files = document.getElementById('productImages').files;
            const imagePreview = document.getElementById('imagePreview');
            const images = [];
            
            if (files.length > 0) {
                imagePreview.classList.remove('hidden');
                imagePreview.innerHTML = '';
                
                for (let file of files) {
                    try {
                        const base64 = await convertToBase64(file);
                        images.push(base64);
                        
                        // Show preview
                        const previewDiv = document.createElement('div');
                        previewDiv.className = 'relative';
                        previewDiv.innerHTML = `
                            <img src="${base64}" alt="Preview" class="w-full h-24 object-cover rounded">
                            <button type="button" onclick="removeImage(${images.length - 1})" class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 text-xs">×</button>
                        `;
                        imagePreview.appendChild(previewDiv);
                    } catch (error) {
                        console.error('Error converting image:', error);
                    }
                }
            }
            
            return images;
        }

        function removeImage(index) {
            // This would need to be implemented to remove specific images
            console.log('Remove image at index:', index);
        }

        // Event Listeners
        document.getElementById('productImages').addEventListener('change', handleImageUpload);

        // Mobile seller registration form
        document.getElementById('mobileSellerRegistrationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const sellerData = {
                userId: currentUser.uid,
                userName: currentUser.displayName,
                userEmail: currentUser.email,
                businessName: document.getElementById('mobileBusinessName').value,
                panNumber: document.getElementById('mobilePanNumber').value,
                upiId: document.getElementById('mobileUpiId').value,
                businessCategory: document.getElementById('mobileBusinessCategory').value,
                businessAddress: document.getElementById('mobileBusinessAddress').value,
                businessCity: document.getElementById('mobileBusinessCity').value,
                businessPincode: document.getElementById('mobileBusinessPincode').value,
                status: 'pending',
                appliedAt: Date.now()
            };

            // Set status to approved immediately
            sellerData.status = 'approved';
            
            database.ref(`sellers/${currentUser.uid}`).set(sellerData)
                .then(() => {
                    showSuccess('🎉 Congratulations! Your seller account has been approved instantly!\n\nYou can now start selling products on Homy.');
                    checkSellerStatus(); // Refresh seller status immediately
                    
                    showMobileSettings();
                })
                .catch((error) => {
                    console.error('Error submitting seller application:', error);
                    alert('Failed to submit application. Please try again.');
                });
        });

        // Edit profile form
        document.getElementById('editProfileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const profileData = {
                displayName: document.getElementById('editDisplayName').value,
                phone: document.getElementById('editPhone').value,
                dob: document.getElementById('editDOB').value,
                gender: document.getElementById('editGender').value,
                address: document.getElementById('editAddress').value,
                city: document.getElementById('editCity').value,
                pincode: document.getElementById('editPincode').value,
                state: document.getElementById('editState').value,
                updatedAt: Date.now()
            };

            database.ref(`users/${currentUser.uid}`).update(profileData)
                .then(() => {
                    alert('Profile updated successfully!');
                    closeEditProfile();
                    if (document.getElementById('profilePage').classList.contains('hidden') === false) {
                        loadUserProfile();
                    }
                    if (document.getElementById('mobileSettingsPage').classList.contains('hidden') === false) {
                        loadMobileSettings();
                    }
                })
                .catch((error) => {
                    console.error('Error updating profile:', error);
                    alert('Failed to update profile. Please try again.');
                });
        });

        document.getElementById('sellerRegistrationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const sellerData = {
                userId: currentUser.uid,
                userName: currentUser.displayName,
                userEmail: currentUser.email,
                businessName: document.getElementById('businessName').value,
                panNumber: document.getElementById('panNumber').value,
                upiId: document.getElementById('upiId').value,
                businessCategory: document.getElementById('businessCategory').value,
                businessAddress: document.getElementById('businessAddress').value,
                businessCity: document.getElementById('businessCity').value,
                businessPincode: document.getElementById('businessPincode').value,
                status: 'pending',
                appliedAt: Date.now()
            };

            // Set status to approved immediately
            sellerData.status = 'approved';
            
            database.ref(`sellers/${currentUser.uid}`).set(sellerData)
                .then(() => {
                    showSuccess('🎉 Congratulations! Your seller account has been approved instantly!\n\nYou can now start selling products on Homy.');
                    checkSellerStatus(); // Refresh seller status immediately
                    
                    showSettings();
                })
                .catch((error) => {
                    console.error('Error submitting seller application:', error);
                    alert('Failed to submit application. Please try again.');
                });
        });

        document.getElementById('productForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Check if user is approved seller
            const sellerSnapshot = await database.ref(`sellers/${currentUser.uid}`).once('value');
            const sellerData = sellerSnapshot.val();
            
            if (!sellerData || sellerData.status !== 'approved') {
                alert('You need to be an approved seller to add products. Please apply for seller account first.');
                return;
            }
            
            // Get uploaded images
            const images = await handleImageUpload();
            
            if (images.length === 0) {
                alert('Please upload at least one product image.');
                return;
            }
            
            const product = {
                name: document.getElementById('productName').value,
                brandName: document.getElementById('brandName').value,
                category: document.getElementById('category').value,
                subCategory: document.getElementById('subCategory').value,
                shortDescription: document.getElementById('shortDescription').value,
                detailedDescription: document.getElementById('detailedDescription').value,
                images: images,
                skuCode: document.getElementById('skuCode').value,
                stockQuantity: parseInt(document.getElementById('stockQuantity').value),
                colors: document.getElementById('colors').value,
                sizes: document.getElementById('sizes').value,
                mrp: parseFloat(document.getElementById('mrp').value),
                sellingPrice: parseFloat(document.getElementById('sellingPrice').value),
                weight: parseFloat(document.getElementById('weight').value) || 0,
                shippingCharges: parseFloat(document.getElementById('shippingCharges').value) || 50,
                deliveryDays: parseInt(document.getElementById('deliveryDays').value) || 3,
                tags: document.getElementById('tags').value,
                highlights: document.getElementById('highlights').value,
                productStatus: document.getElementById('productStatus').value,
                returnPolicy: document.getElementById('returnPolicy').value,
                warranty: document.getElementById('warranty').value,
                sellerId: currentUser.uid,
                sellerName: currentUser.displayName,
                businessName: sellerData.businessName,
                timestamp: Date.now(),
                averageRating: 0,
                reviewCount: 0
            };

            database.ref('products').push(product)
                .then(() => {
                    alert('Product added successfully!');
                    document.getElementById('productForm').reset();
                    document.getElementById('imagePreview').classList.add('hidden');
                    showBusinessPanel();
                })
                .catch((error) => {
                    console.error('Error adding product:', error);
                    alert('Failed to add product. Please try again.');
                });
        });

        document.getElementById('reviewForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (selectedRating === 0) {
                alert('Please select a rating');
                return;
            }

            const review = {
                productId: currentProduct.id,
                userId: currentUser.uid,
                userName: currentUser.displayName,
                rating: selectedRating,
                title: document.getElementById('reviewTitle').value,
                text: document.getElementById('reviewText').value,
                timestamp: Date.now()
            };

            // Handle image uploads for review
            const reviewImageFiles = document.getElementById('reviewImages').files;
            if (reviewImageFiles.length > 0) {
                const reviewImages = [];
                for (let file of reviewImageFiles) {
                    try {
                        const base64 = await convertToBase64(file);
                        reviewImages.push(base64);
                    } catch (error) {
                        console.error('Error converting review image:', error);
                    }
                }
                review.images = reviewImages;
            }

            database.ref(`reviews/${currentProduct.id}`).push(review)
                .then(() => {
                    // Update product's average rating
                    return database.ref(`reviews/${currentProduct.id}`).once('value');
                })
                .then((snapshot) => {
                    const reviews = snapshot.val() || {};
                    const reviewsArray = Object.values(reviews);
                    const averageRating = calculateAverageRating(reviewsArray);
                    const reviewCount = reviewsArray.length;
                    
                    // Update product with new rating
                    return database.ref(`products/${currentProduct.id}`).update({
                        averageRating: parseFloat(averageRating),
                        reviewCount: reviewCount
                    });
                })
                .then(() => {
                    alert('Review submitted successfully!');
                    closeReviewModal();
                    loadProductReviews(currentProduct.id);
                    // Refresh product detail to show updated rating
                    loadProductDetail(currentProduct.id);
                })
                .catch((error) => {
                    console.error('Error submitting review:', error);
                    alert('Failed to submit review. Please try again.');
                });
        });

        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchProducts();
            }
        });

        // Add event listener for mobile search input after DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchProductsMobile();
                    }
                });
            }
        });

        // Utility Functions
        function getCategoryImage(category) {
            const categoryImages = {
                'electronics': `<svg class="w-16 h-16 text-blue-600" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 3H4C2.9 3 2 3.9 2 5V15C2 16.1 2.9 17 4 17H9L8 19V20H16V19L15 17H20C21.1 17 22 16.1 22 15V5C22 3.9 21.1 3 20 3ZM20 15H4V5H20V15Z"/>
                </svg>`,
                'fashion': `<svg class="w-16 h-16 text-green-600" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 4L14.5 2.5C14.1 2.1 13.6 1.9 13 1.9H11C10.4 1.9 9.9 2.1 9.5 2.5L8 4H6C4.9 4 4 4.9 4 6V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V6C20 4.9 19.1 4 18 4H16Z"/>
                </svg>`,
                'books': `<svg class="w-16 h-16 text-purple-600" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V4C20 2.9 19.1 2 18 2Z"/>
                </svg>`,
                'grocery': `<svg class="w-16 h-16 text-orange-600" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M7 18C5.9 18 5 18.9 5 20S5.9 22 7 22 9 21.1 9 20 8.1 18 7 18ZM1 2V4H3L6.6 11.59L5.25 14.04C5.09 14.32 5 14.65 5 15C5 16.1 5.9 17 7 17H19V15H7.42C7.28 15 7.17 14.89 7.17 14.75L7.2 14.63L8.1 13H15.55C16.3 13 16.96 12.59 17.3 11.97L20.88 5H5.21L4.27 3H1Z"/>
                </svg>`,
                'jewelry': `<svg class="w-16 h-16 text-red-600" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M5 16L3 5H1L3.5 17H5.5L12 7L18.5 17H20.5L23 5H21L19 16L12 9L5 16Z"/>
                </svg>`,
                'toys': `<svg class="w-16 h-16 text-pink-600" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2Z"/>
                </svg>`
            };
            return categoryImages[category] || `<svg class="w-16 h-16 text-gray-400" viewBox="0 0 24 24" fill="currentColor">
                <path d="M21 19V5C21 3.9 20.1 3 19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19Z"/>
            </svg>`;
        }

        function selectUPIApp(app) {
            selectedUPIApp = app;
            // Highlight selected app
            document.querySelectorAll('#upiOptions button').forEach(btn => {
                btn.classList.remove('bg-blue-100', 'border-blue-500');
            });
            event.target.closest('button').classList.add('bg-blue-100', 'border-blue-500');
        }

        // Color Variant Management
        let colorVariants = [];

        function addColorVariant() {
            const variantId = Date.now();
            const variantHtml = `
                <div class="border rounded-lg p-4" id="colorVariant_${variantId}">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-semibold">Color Variant ${colorVariants.length + 1}</h4>
                        <button type="button" onclick="removeColorVariant('${variantId}')" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Color Name *</label>
                            <input type="text" class="w-full border rounded-lg px-3 py-2" placeholder="e.g., Red, Blue" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Color Code</label>
                            <input type="color" class="w-full border rounded-lg px-3 py-2 h-10">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Price for this color (₹)</label>
                            <input type="number" class="w-full border rounded-lg px-3 py-2" placeholder="Leave empty to use base price" min="0" step="0.01">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Stock Quantity</label>
                            <input type="number" class="w-full border rounded-lg px-3 py-2" placeholder="Stock for this color" min="0" required>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Images for this color *</label>
                        <input type="file" class="w-full border rounded-lg px-3 py-2" multiple accept="image/*" required>
                        <div class="mt-2 grid grid-cols-4 gap-2 hidden" id="colorPreview_${variantId}">
                            <!-- Color-specific image previews will appear here -->
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('colorVariantsList').insertAdjacentHTML('beforeend', variantHtml);
            colorVariants.push(variantId);
        }

        function removeColorVariant(variantId) {
            document.getElementById(`colorVariant_${variantId}`).remove();
            colorVariants = colorVariants.filter(id => id !== variantId);
        }

        // Fix Buy Now button
        function buyNow() {
            if (!currentUser) {
                alert('Please login to buy products');
                return;
            }
            
            if (!currentProduct) {
                alert('Product not found');
                return;
            }
            
            // Clear existing cart and add current product
            cart = [];
            
            const cartItem = {
                productId: currentProduct.id,
                name: currentProduct.name,
                price: currentProduct.sellingPrice,
                mrp: currentProduct.mrp,
                quantity: 1,
                image: currentProduct.images && currentProduct.images.length > 0 ? currentProduct.images[0] : '',
                brand: currentProduct.brandName || '',
                category: currentProduct.category || '',
                sellerId: currentProduct.sellerId || '',
                sellerName: currentProduct.sellerName || '',
                stockQuantity: currentProduct.stockQuantity || 0
            };
            
            cart.push(cartItem);
            saveCartToFirebase();
            updateCartCount();
            
            // Proceed directly to checkout
            proceedToCheckout();
        }



        // Load seller stats when business panel loads
        function loadBusinessPanel() {
            if (!currentUser) {
                alert('Please login to access business panel');
                return;
            }
            
            database.ref(`sellers/${currentUser.uid}`).once('value')
                .then((snapshot) => {
                    const sellerData = snapshot.val();
                    
                    if (!sellerData || sellerData.status !== 'approved') {
                        alert('You need to be an approved seller to access business panel. Please apply for seller account first.');
                        showSettings();
                        return;
                    }
                    
                    hideAllPages();
                    document.getElementById('businessPanel').classList.remove('hidden');
                    
                    // Load seller statistics
                    loadSellerDashboardStats();
                });
        }

        function loadSellerDashboardStats() {
            // Load products count
            database.ref('products').orderByChild('sellerId').equalTo(currentUser.uid).once('value')
                .then((snapshot) => {
                    const products = snapshot.val() || {};
                    document.getElementById('sellerTotalProducts').textContent = Object.keys(products).length;
                });
            
            // Load orders and calculate stats
            database.ref('orders').orderByChild('sellerId').equalTo(currentUser.uid).once('value')
                .then((snapshot) => {
                    const orders = snapshot.val() || {};
                    const ordersArray = Object.values(orders);
                    
                    const totalOrders = ordersArray.length;
                    const pendingOrders = ordersArray.filter(order => order.status === 'pending').length;
                    const totalEarnings = ordersArray
                        .filter(order => order.status === 'delivered')
                        .reduce((sum, order) => sum + order.total, 0);
                    
                    document.getElementById('sellerTotalOrders').textContent = totalOrders;
                    document.getElementById('sellerPendingOrders').textContent = pendingOrders;
                    document.getElementById('sellerTotalEarnings').textContent = `₹${totalEarnings}`;
                    
                    // Load recent orders
                    const recentOrders = ordersArray.slice(0, 3);
                    const recentOrdersContainer = document.getElementById('recentSellerOrders');
                    
                    if (recentOrders.length === 0) {
                        recentOrdersContainer.innerHTML = '<p class="text-gray-500">No recent orders</p>';
                    } else {
                        recentOrdersContainer.innerHTML = recentOrders.map(order => `
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded cursor-pointer hover:bg-gray-100" onclick="showSellerOrders()">
                                <div>
                                    <div class="font-semibold">Order #${order.orderId}</div>
                                    <div class="text-sm text-gray-600">${order.userName}</div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold">₹${order.total}</div>
                                    <span class="text-xs px-2 py-1 rounded ${getOrderStatusColor(order.status)}">${order.status}</span>
                                </div>
                            </div>
                        `).join('');
                    }
                });
        }

        function applyCoupon() {
            const couponCode = document.getElementById('couponCode').value.trim();
            if (!couponCode) {
                showCouponMessage('Please enter a coupon code', 'error');
                return;
            }

            database.ref('coupons').orderByChild('code').equalTo(couponCode).once('value')
                .then((snapshot) => {
                    const coupons = snapshot.val();
                    if (!coupons) {
                        showCouponMessage('Invalid coupon code', 'error');
                        return;
                    }

                    const couponId = Object.keys(coupons)[0];
                    const coupon = coupons[couponId];
                    
                    // Validate coupon
                    const now = Date.now();
                    if (now < new Date(coupon.validFrom).getTime() || now > new Date(coupon.validUntil).getTime()) {
                        showCouponMessage('Coupon has expired', 'error');
                        return;
                    }

                    const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    if (coupon.minOrderAmount && subtotal < coupon.minOrderAmount) {
                        showCouponMessage(`Minimum order amount is ₹${coupon.minOrderAmount}`, 'error');
                        return;
                    }

                    // Calculate discount
                    let discount = 0;
                    if (coupon.type === 'percentage') {
                        discount = (subtotal * coupon.discountValue) / 100;
                        if (coupon.maxDiscount && discount > coupon.maxDiscount) {
                            discount = coupon.maxDiscount;
                        }
                    } else if (coupon.type === 'fixed') {
                        discount = coupon.discountValue;
                    }

                    appliedCoupon = coupon;
                    currentDiscount = discount;
                    
                    showCouponMessage(`Coupon applied! You saved ₹${discount}`, 'success');
                    updateCheckoutTotals();
                })
                .catch((error) => {
                    console.error('Error applying coupon:', error);
                    showCouponMessage('Error applying coupon', 'error');
                });
        }

        function showCouponMessage(message, type) {
            const messageDiv = document.getElementById('couponMessage');
            messageDiv.textContent = message;
            messageDiv.className = `text-sm mt-2 ${type === 'success' ? 'text-green-600' : 'text-red-600'}`;
            messageDiv.classList.remove('hidden');
        }

        function updateCheckoutTotals() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('subtotal').textContent = `₹${subtotal}`;
            
            if (currentDiscount > 0) {
                document.getElementById('discountRow').classList.remove('hidden');
                document.getElementById('discountAmount').textContent = `-₹${currentDiscount}`;
            } else {
                document.getElementById('discountRow').classList.add('hidden');
            }
            
            const finalTotal = subtotal - currentDiscount + 50;
            document.getElementById('finalTotal').textContent = `₹${finalTotal}`;
            document.getElementById('paymentAmount').textContent = `₹${finalTotal}`;
        }

        function loadUserProfile() {
            document.getElementById('profileName').textContent = currentUser.displayName || 'User';
            document.getElementById('profileEmail').textContent = currentUser.email || '';
            document.getElementById('profileInitials').textContent = (currentUser.displayName || 'U').charAt(0).toUpperCase();
            
            // Load user profile data from Firebase
            database.ref(`users/${currentUser.uid}`).once('value')
                .then((snapshot) => {
                    const userData = snapshot.val() || {};
                    document.getElementById('editDisplayName').value = userData.displayName || currentUser.displayName || '';
                    document.getElementById('editPhone').value = userData.phone || '';
                    document.getElementById('editDOB').value = userData.dob || '';
                    document.getElementById('editGender').value = userData.gender || '';
                    document.getElementById('editAddress').value = userData.address || '';
                    document.getElementById('editCity').value = userData.city || '';
                    document.getElementById('editPincode').value = userData.pincode || '';
                    document.getElementById('editState').value = userData.state || '';
                });

            // Load user statistics
            loadUserStatistics();
        }

        function loadUserStatistics() {
            // Load orders count and total spent
            database.ref('orders').orderByChild('userId').equalTo(currentUser.uid).once('value')
                .then((snapshot) => {
                    const orders = snapshot.val() || {};
                    const ordersArray = Object.values(orders);
                    document.getElementById('totalOrders').textContent = ordersArray.length;
                    
                    const totalSpent = ordersArray.reduce((sum, order) => sum + (order.total || 0), 0);
                    document.getElementById('totalSpent').textContent = `₹${totalSpent}`;
                });

            // Load reviews count
            database.ref('reviews').once('value')
                .then((snapshot) => {
                    const allReviews = snapshot.val() || {};
                    let userReviewsCount = 0;
                    Object.values(allReviews).forEach(productReviews => {
                        Object.values(productReviews).forEach(review => {
                            if (review.userId === currentUser.uid) {
                                userReviewsCount++;
                            }
                        });
                    });
                    document.getElementById('totalReviews').textContent = userReviewsCount;
                });
        }

        function saveProfile() {
            const profileData = {
                displayName: document.getElementById('editDisplayName').value,
                phone: document.getElementById('editPhone').value,
                dob: document.getElementById('editDOB').value,
                gender: document.getElementById('editGender').value,
                address: document.getElementById('editAddress').value,
                city: document.getElementById('editCity').value,
                pincode: document.getElementById('editPincode').value,
                state: document.getElementById('editState').value,
                updatedAt: Date.now()
            };

            database.ref(`users/${currentUser.uid}`).update(profileData)
                .then(() => {
                    alert('Profile updated successfully!');
                    loadUserProfile();
                })
                .catch((error) => {
                    console.error('Error updating profile:', error);
                    alert('Failed to update profile. Please try again.');
                });
        }

        function loadSellerCoupons() {
            database.ref('coupons').orderByChild('sellerId').equalTo(currentUser.uid).once('value')
                .then((snapshot) => {
                    const coupons = snapshot.val() || {};
                    displaySellerCoupons(Object.entries(coupons).map(([id, coupon]) => ({id, ...coupon})));
                });
        }

        function displaySellerCoupons(coupons) {
            const couponsGrid = document.getElementById('couponsGrid');
            
            if (coupons.length === 0) {
                couponsGrid.innerHTML = '<div class="col-span-full text-center text-gray-500">No coupons created yet</div>';
                return;
            }

            couponsGrid.innerHTML = coupons.map(coupon => `
                <div class="bg-white border-2 border-dashed border-gray-300 rounded-lg p-4">
                    <div class="text-center mb-4">
                        <div class="text-2xl font-bold text-blue-600">${coupon.code}</div>
                        <div class="text-sm text-gray-600">${coupon.type === 'percentage' ? coupon.discountValue + '% OFF' : '₹' + coupon.discountValue + ' OFF'}</div>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div><strong>Valid:</strong> ${new Date(coupon.validFrom).toLocaleDateString()} - ${new Date(coupon.validUntil).toLocaleDateString()}</div>
                        <div><strong>Used:</strong> ${coupon.usedCount || 0}/${coupon.usageLimit}</div>
                        <div><strong>Status:</strong> <span class="${coupon.isActive ? 'text-green-600' : 'text-red-600'}">${coupon.isActive ? 'Active' : 'Inactive'}</span></div>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button onclick="toggleCouponStatus('${coupon.id}', ${!coupon.isActive})" class="flex-1 px-3 py-1 text-sm rounded ${coupon.isActive ? 'bg-red-500 text-white' : 'bg-green-500 text-white'}">
                            ${coupon.isActive ? 'Deactivate' : 'Activate'}
                        </button>
                        <button onclick="deleteCoupon('${coupon.id}')" class="px-3 py-1 text-sm bg-gray-500 text-white rounded">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function loadSellerProducts() {
            database.ref('products').orderByChild('sellerId').equalTo(currentUser.uid).once('value')
                .then((snapshot) => {
                    const products = snapshot.val() || {};
                    const productSelect = document.getElementById('couponProduct');
                    productSelect.innerHTML = '<option value="">Select Product</option>' +
                        Object.entries(products).map(([id, product]) => 
                            `<option value="${id}">${product.name}</option>`
                        ).join('');
                });
        }

        function generateCouponCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            document.getElementById('generatedCouponCode').value = code;
        }

        function toggleCouponFields() {
            const type = document.getElementById('couponType').value;
            const productSection = document.getElementById('productSpecificSection');
            const discountHint = document.getElementById('discountHint');
            
            if (type === 'product') {
                productSection.classList.remove('hidden');
            } else {
                productSection.classList.add('hidden');
            }
            
            if (type === 'percentage') {
                discountHint.textContent = 'Enter percentage (1-100)';
            } else {
                discountHint.textContent = 'Enter fixed amount in ₹';
            }
        }

        // Seller notification listener
        function setupSellerNotifications() {
            if (currentUser && isSeller) {
                // Set seller as online
                database.ref(`sellerOnline/${currentUser.uid}`).set(true);
                
                // Listen for new notifications
                database.ref(`sellerNotifications/${currentUser.uid}/playSound`).on('value', (snapshot) => {
                    if (snapshot.val() === true) {
                        playOrderNotificationSound();
                        // Reset the trigger
                        database.ref(`sellerNotifications/${currentUser.uid}/playSound`).set(false);
                        
                        // Show notification
                        showOrderNotification();
                    }
                });
                
                // Set offline when page unloads
                window.addEventListener('beforeunload', () => {
                    database.ref(`sellerOnline/${currentUser.uid}`).set(false);
                });
            }
        }

        function showOrderNotification() {
            // Create notification popup
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg z-50 animate-bounce';
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-bell text-xl mr-3"></i>
                    <div>
                        <div class="font-bold">New Order Received!</div>
                        <div class="text-sm">Check your seller panel for details</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Admin utility functions
        function toggleAnnouncement(announcementId, newStatus) {
            database.ref(`announcements/${announcementId}/isActive`).set(newStatus)
                .then(() => {
                    loadAnnouncements();
                    alert(`Announcement ${newStatus ? 'activated' : 'deactivated'} successfully!`);
                });
        }

        function deleteAnnouncement(announcementId) {
            if (confirm('Are you sure you want to delete this announcement?')) {
                database.ref(`announcements/${announcementId}`).remove()
                    .then(() => {
                        loadAnnouncements();
                        alert('Announcement deleted successfully!');
                    });
            }
        }

        function closeBanner(element) {
            element.closest('.bg-blue-500, .bg-red-500, .bg-green-500, .bg-purple-500, .bg-orange-500, .bg-yellow-500').remove();
        }

        function editCategory(categoryId) {
            const newName = prompt('Enter new category name:');
            if (newName) {
                // In a real app, you would save this to Firebase
                alert(`Category ${categoryId} updated to: ${newName}`);
            }
        }

        function updateCategoryImage(categoryId) {
            showInfo(`Category image update for ${categoryId} will be available in the next update.`);
        }

        // Refund and Cancellation Functions
        function showRefundModal(orderId) {
            currentOrderForAction = orderId;
            document.getElementById('refundModal').classList.remove('hidden');
        }

        function closeRefundModal() {
            document.getElementById('refundModal').classList.add('hidden');
            currentOrderForAction = null;
            document.getElementById('refundForm').reset();
        }

        function showCancelOrderModal(orderId) {
            currentOrderForAction = orderId;
            document.getElementById('cancelOrderModal').classList.remove('hidden');
        }

        function closeCancelOrderModal() {
            document.getElementById('cancelOrderModal').classList.add('hidden');
            currentOrderForAction = null;
        }

        function confirmCancelOrder() {
            const reason = document.getElementById('cancelReason').value;
            const comments = document.getElementById('cancelComments').value;
            
            if (!reason) {
                alert('Please select a reason for cancellation');
                return;
            }
            
            database.ref(`orders/${currentOrderForAction}`).update({
                status: 'cancelled',
                cancelReason: reason,
                cancelComments: comments,
                cancelledAt: Date.now(),
                cancelledBy: 'customer'
            })
            .then(() => {
                showSuccess('Order cancelled successfully! Refund will be processed within 3-5 business days.');
                closeCancelOrderModal();
                loadOrders();
            })
            .catch((error) => {
                console.error('Error cancelling order:', error);
                showError('Failed to cancel order. Please try again.');
            });
        }

        // Additional order functions
        function buyAgain(productId) {
            showProductDetail(productId);
        }

        function trackOrder(orderId) {
            alert(`Tracking information for order ${orderId} will be available soon!`);
        }

        function contactSeller(sellerId) {
            database.ref(`sellers/${sellerId}`).once('value')
                .then((snapshot) => {
                    const seller = snapshot.val();
                    if (seller && seller.phone) {
                        window.open(`tel:${seller.phone}`, '_self');
                    } else {
                        alert('Seller contact information not available');
                    }
                });
        }

        function viewOrderDetails(orderId) {
            database.ref(`orders/${orderId}`).once('value')
                .then((snapshot) => {
                    const order = snapshot.val();
                    if (order) {
                        alert(`Order Details:\n\nOrder ID: ${order.orderId}\nStatus: ${order.status}\nTotal: ₹${order.total}\nPayment: ${order.paymentMethod}\nDate: ${new Date(order.timestamp).toLocaleString()}`);
                    }
                });
        }

        function downloadInvoice(orderId) {
            database.ref(`orders/${orderId}`).once('value')
                .then((snapshot) => {
                    const order = snapshot.val();
                    if (order && order.status === 'delivered') {
                        generateInvoice(order);
                    } else {
                        showError('Invoice is only available for delivered orders');
                    }
                })
                .catch((error) => {
                    console.error('Error loading order:', error);
                    showError('Failed to load order details');
                });
        }

        async function generateInvoice(order) {
            try {
                showInvoiceLoading();
                
                const invoiceData = {
                    from: "Homy - Your Home Shopping Destination\nCustomer Service\nIndia\nEmail: customerserviceffrj4@gmail.com",
                    to: `${order.shippingInfo.fullName}\n${order.shippingInfo.address}\n${order.shippingInfo.city}, ${order.shippingInfo.state} - ${order.shippingInfo.pincode}\nPhone: ${order.shippingInfo.phone}\nEmail: ${order.shippingInfo.email}`,
                    logo: "https://pulse.oriontec.xyz/IMG_0901.png",
                    number: order.orderId,
                    date: new Date(order.timestamp).toLocaleDateString('en-IN'),
                    due_date: new Date(order.timestamp + (7 * 24 * 60 * 60 * 1000)).toLocaleDateString('en-IN'),
                    currency: "INR",
                    items: order.items.map(item => ({
                        name: item.name,
                        quantity: item.quantity,
                        unit_cost: item.price,
                        description: item.brand ? `Brand: ${item.brand}` : ''
                    })),
                    fields: {
                        tax: "%"
                    },
                    tax: 0,
                    shipping: order.shippingCharges || 50,
                    amount_paid: order.total,
                    notes: `Payment Method: ${order.paymentMethod.toUpperCase()}\nOrder Status: ${order.status.toUpperCase()}\nDelivered on: ${new Date().toLocaleDateString('en-IN')}\n\nThank you for shopping with Homy!`,
                    terms: "1. All sales are final for delivered orders\n2. For any queries, contact customer service\n3. Return policy applies as per product terms"
                };

                // Use the correct API endpoint with proper headers
                const response = await fetch('https://invoice-generator.com', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/pdf'
                    },
                    body: JSON.stringify(invoiceData)
                });

                if (response.ok) {
                    const blob = await response.blob();
                    
                    // Check if we actually got a PDF
                    if (blob.type === 'application/pdf' || blob.size > 1000) {
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `Invoice_${order.orderId}.pdf`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        
                        hideInvoiceLoading();
                        showSuccess('Invoice downloaded successfully!');
                    } else {
                        throw new Error('Invalid PDF response');
                    }
                } else {
                    // If API fails, generate a simple HTML invoice
                    generateHTMLInvoice(order);
                }
            } catch (error) {
                console.error('Error generating invoice:', error);
                // Fallback to HTML invoice
                generateHTMLInvoice(order);
            }
        }

        function generateHTMLInvoice(order) {
            try {
                const invoiceHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Invoice - ${order.orderId}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; color: #333; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #ff9900; padding-bottom: 20px; }
                        .logo { width: 80px; height: 80px; margin: 0 auto 10px; }
                        .company-name { font-size: 24px; font-weight: bold; color: #232f3e; }
                        .invoice-details { display: flex; justify-content: space-between; margin: 30px 0; }
                        .invoice-info, .customer-info { width: 48%; }
                        .invoice-info h3, .customer-info h3 { color: #232f3e; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
                        .items-table { width: 100%; border-collapse: collapse; margin: 30px 0; }
                        .items-table th, .items-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                        .items-table th { background-color: #f8f9fa; font-weight: bold; }
                        .total-section { text-align: right; margin: 30px 0; }
                        .total-row { margin: 5px 0; }
                        .grand-total { font-size: 18px; font-weight: bold; color: #ff9900; }
                        .footer { margin-top: 50px; text-align: center; font-size: 12px; color: #666; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <img src="https://pulse.oriontec.xyz/IMG_0901.png" alt="Homy Logo" class="logo">
                        <div class="company-name">Homy</div>
                        <div>Your Home Shopping Destination</div>
                        <div>Email: customerserviceffrj4@gmail.com</div>
                    </div>

                    <div class="invoice-details">
                        <div class="invoice-info">
                            <h3>Invoice Details</h3>
                            <p><strong>Invoice Number:</strong> ${order.orderId}</p>
                            <p><strong>Invoice Date:</strong> ${new Date(order.timestamp).toLocaleDateString('en-IN')}</p>
                            <p><strong>Payment Method:</strong> ${order.paymentMethod.toUpperCase()}</p>
                            <p><strong>Order Status:</strong> ${order.status.toUpperCase()}</p>
                        </div>
                        
                        <div class="customer-info">
                            <h3>Bill To</h3>
                            <p><strong>${order.shippingInfo.fullName}</strong></p>
                            <p>${order.shippingInfo.address}</p>
                            <p>${order.shippingInfo.city}, ${order.shippingInfo.state} - ${order.shippingInfo.pincode}</p>
                            <p>Phone: ${order.shippingInfo.phone}</p>
                            <p>Email: ${order.shippingInfo.email}</p>
                        </div>
                    </div>

                    <table class="items-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Brand</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${order.items.map(item => `
                                <tr>
                                    <td>${item.name}</td>
                                    <td>${item.brand || 'N/A'}</td>
                                    <td>${item.quantity}</td>
                                    <td>₹${item.price}</td>
                                    <td>₹${item.price * item.quantity}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>

                    <div class="total-section">
                        <div class="total-row">Subtotal: ₹${order.subtotal || order.total - 50}</div>
                        <div class="total-row">Shipping: ₹${order.shippingCharges || 50}</div>
                        <div class="total-row">Tax: ₹0</div>
                        <div class="total-row grand-total">Grand Total: ₹${order.total}</div>
                    </div>

                    <div class="footer">
                        <p><strong>Thank you for shopping with Homy!</strong></p>
                        <p>For any queries, please contact our customer service.</p>
                        <p>Terms: All sales are final for delivered orders. Return policy applies as per product terms.</p>
                    </div>
                </body>
                </html>
                `;

                // Create and download HTML file
                const blob = new Blob([invoiceHTML], { type: 'text/html' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Invoice_${order.orderId}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                hideInvoiceLoading();
                showSuccess('Invoice downloaded successfully! Open the HTML file in your browser and print as PDF if needed.');
                
            } catch (error) {
                console.error('Error generating HTML invoice:', error);
                hideInvoiceLoading();
                showError('Failed to generate invoice. Please contact customer service.');
            }
        }

        function showInvoiceLoading() {
            const modal = document.createElement('div');
            modal.id = 'invoiceLoading';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 text-center max-w-sm w-full mx-4">
                    <div class="loading mx-auto mb-4"></div>
                    <h3 class="text-lg font-semibold mb-2">Generating Invoice</h3>
                    <p class="text-gray-600">Please wait while we prepare your invoice...</p>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function hideInvoiceLoading() {
            const loading = document.getElementById('invoiceLoading');
            if (loading) {
                loading.remove();
            }
        }

        // Wishlist Functions
        let wishlist = [];

        function toggleWishlist(productId) {
            if (!currentUser) {
                showError('Please login to add items to wishlist');
                return;
            }

            const isInWishlist = wishlist.includes(productId);
            
            if (isInWishlist) {
                wishlist = wishlist.filter(id => id !== productId);
                showSuccess('Removed from wishlist');
            } else {
                wishlist.push(productId);
                showSuccess('Added to wishlist');
            }
            
            // Save to Firebase
            database.ref(`wishlists/${currentUser.uid}`).set(wishlist);
            updateWishlistUI();
        }

        function loadWishlist() {
            if (currentUser) {
                database.ref(`wishlists/${currentUser.uid}`).once('value')
                    .then((snapshot) => {
                        wishlist = snapshot.val() || [];
                        updateWishlistUI();
                    });
            }
        }

        function updateWishlistUI() {
            // Update wishlist heart icons
            document.querySelectorAll('[onclick*="toggleWishlist"]').forEach(btn => {
                const productId = btn.getAttribute('onclick').match(/'([^']+)'/)[1];
                const heart = btn.querySelector('i');
                if (wishlist.includes(productId)) {
                    heart.classList.remove('far');
                    heart.classList.add('fas', 'text-red-500');
                } else {
                    heart.classList.remove('fas', 'text-red-500');
                    heart.classList.add('far');
                }
            });
        }

        // Recently Viewed Products
        let recentlyViewed = [];

        function addToRecentlyViewed(productId) {
            if (!currentUser) return;
            
            // Remove if already exists
            recentlyViewed = recentlyViewed.filter(id => id !== productId);
            
            // Add to beginning
            recentlyViewed.unshift(productId);
            
            // Keep only last 10 items
            recentlyViewed = recentlyViewed.slice(0, 10);
            
            // Save to Firebase
            database.ref(`recentlyViewed/${currentUser.uid}`).set(recentlyViewed);
        }

        function loadRecentlyViewed() {
            if (currentUser) {
                database.ref(`recentlyViewed/${currentUser.uid}`).once('value')
                    .then((snapshot) => {
                        recentlyViewed = snapshot.val() || [];
                    });
            }
        }

        // Enhanced Product View Tracking
        function trackProductView(productId) {
            database.ref(`products/${productId}/totalViews`).transaction((currentViews) => {
                return (currentViews || 0) + 1;
            });
            
            // Add to recently viewed
            addToRecentlyViewed(productId);
        }

        // Product Comparison Functions
        let comparisonList = [];

        function addToComparison(productId) {
            if (!currentUser) {
                showError('Please login to compare products');
                return;
            }

            if (comparisonList.includes(productId)) {
                showWarning('Product already in comparison list');
                return;
            }

            if (comparisonList.length >= 4) {
                showWarning('You can compare maximum 4 products at a time');
                return;
            }

            comparisonList.push(productId);
            showSuccess(`Added to comparison (${comparisonList.length}/4)`);
            
            // Save to Firebase
            database.ref(`comparisons/${currentUser.uid}`).set(comparisonList);
            updateComparisonUI();
        }

        function removeFromComparison(productId) {
            comparisonList = comparisonList.filter(id => id !== productId);
            database.ref(`comparisons/${currentUser.uid}`).set(comparisonList);
            updateComparisonUI();
        }

        function updateComparisonUI() {
            // Update comparison button states and show comparison bar if items exist
            if (comparisonList.length > 0) {
                showComparisonBar();
            } else {
                hideComparisonBar();
            }
        }

        function showComparisonBar() {
            let comparisonBar = document.getElementById('comparisonBar');
            if (!comparisonBar) {
                comparisonBar = document.createElement('div');
                comparisonBar.id = 'comparisonBar';
                comparisonBar.className = 'fixed bottom-20 md:bottom-4 left-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-40';
                comparisonBar.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas fa-balance-scale mr-2"></i>
                            <span id="comparisonCount">${comparisonList.length} products selected for comparison</span>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="viewComparison()" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-100">
                                Compare Now
                            </button>
                            <button onclick="clearComparison()" class="text-white hover:text-gray-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(comparisonBar);
            } else {
                document.getElementById('comparisonCount').textContent = `${comparisonList.length} products selected for comparison`;
            }
        }

        function hideComparisonBar() {
            const comparisonBar = document.getElementById('comparisonBar');
            if (comparisonBar) {
                comparisonBar.remove();
            }
        }

        function clearComparison() {
            comparisonList = [];
            database.ref(`comparisons/${currentUser.uid}`).remove();
            hideComparisonBar();
            showSuccess('Comparison list cleared');
        }

        function viewComparison() {
            if (comparisonList.length < 2) {
                showWarning('Please select at least 2 products to compare');
                return;
            }
            
            // Load comparison products and show comparison modal
            Promise.all(comparisonList.map(id => 
                database.ref(`products/${id}`).once('value').then(snapshot => ({id, ...snapshot.val()}))
            )).then(products => {
                showComparisonModal(products);
            });
        }

        function showComparisonModal(products) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 overflow-y-auto';
            modal.innerHTML = `
                <div class="min-h-screen px-4 py-8">
                    <div class="bg-white rounded-lg max-w-6xl mx-auto">
                        <div class="p-6 border-b flex justify-between items-center">
                            <h2 class="text-2xl font-bold">Product Comparison</h2>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <div class="p-6 overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr>
                                        <th class="text-left p-4 border-b">Feature</th>
                                        ${products.map(product => `
                                            <th class="text-center p-4 border-b min-w-48">
                                                <div class="space-y-2">
                                                    <img src="${product.images?.[0] || ''}" alt="${product.name}" class="w-20 h-20 object-contain mx-auto">
                                                    <div class="font-semibold text-sm">${product.name}</div>
                                                    <div class="text-lg font-bold text-green-600">₹${product.sellingPrice}</div>
                                                </div>
                                            </th>
                                        `).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="p-4 border-b font-semibold">Price</td>
                                        ${products.map(product => `
                                            <td class="p-4 border-b text-center">
                                                <div class="text-lg font-bold">₹${product.sellingPrice}</div>
                                                ${product.mrp > product.sellingPrice ? `<div class="text-sm text-gray-500 line-through">₹${product.mrp}</div>` : ''}
                                            </td>
                                        `).join('')}
                                    </tr>
                                    <tr>
                                        <td class="p-4 border-b font-semibold">Rating</td>
                                        ${products.map(product => `
                                            <td class="p-4 border-b text-center">
                                                <div class="star-rating">${generateStarRating(product.averageRating || 0)}</div>
                                                <div class="text-sm text-gray-500">(${product.reviewCount || 0} reviews)</div>
                                            </td>
                                        `).join('')}
                                    </tr>
                                    <tr>
                                        <td class="p-4 border-b font-semibold">Brand</td>
                                        ${products.map(product => `<td class="p-4 border-b text-center">${product.brandName || 'N/A'}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td class="p-4 border-b font-semibold">Delivery</td>
                                        ${products.map(product => `<td class="p-4 border-b text-center">${product.deliveryDays || 3} days</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td class="p-4 border-b font-semibold">Actions</td>
                                        ${products.map(product => `
                                            <td class="p-4 border-b text-center space-y-2">
                                                <button onclick="quickAddToCart('${product.id}')" class="w-full bg-orange-500 text-white py-2 px-4 rounded hover:bg-orange-600">
                                                    Add to Cart
                                                </button>
                                                <button onclick="removeFromComparison('${product.id}'); this.closest('.fixed').remove();" class="w-full border border-gray-300 py-2 px-4 rounded hover:bg-gray-50">
                                                    Remove
                                                </button>
                                            </td>
                                        `).join('')}
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Product Sharing Function
        function shareProduct(productId) {
            const productUrl = `${window.location.origin}${window.location.pathname}#product/${productId}`;
            
            if (navigator.share) {
                navigator.share({
                    title: currentProduct.name,
                    text: `Check out this amazing product: ${currentProduct.name}`,
                    url: productUrl
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                navigator.clipboard.writeText(productUrl).then(() => {
                    showSuccess('Product link copied to clipboard!');
                }).catch(() => {
                    // Show share modal with social media options
                    showShareModal(productId);
                });
            }
        }

        function showShareModal(productId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Share Product</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="space-y-3">
                        <button onclick="shareToWhatsApp('${productId}')" class="w-full flex items-center justify-center space-x-2 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600">
                            <i class="fab fa-whatsapp"></i>
                            <span>Share on WhatsApp</span>
                        </button>
                        <button onclick="shareToFacebook('${productId}')" class="w-full flex items-center justify-center space-x-2 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700">
                            <i class="fab fa-facebook"></i>
                            <span>Share on Facebook</span>
                        </button>
                        <button onclick="copyProductLink('${productId}')" class="w-full flex items-center justify-center space-x-2 border border-gray-300 py-3 rounded-lg hover:bg-gray-50">
                            <i class="fas fa-copy"></i>
                            <span>Copy Link</span>
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function shareToWhatsApp(productId) {
            const productUrl = `${window.location.origin}${window.location.pathname}#product/${productId}`;
            const text = `Check out this amazing product: ${currentProduct.name} - Only ₹${currentProduct.sellingPrice}`;
            const url = `https://wa.me/?text=${encodeURIComponent(text + ' ' + productUrl)}`;
            window.open(url, '_blank');
        }

        function shareToFacebook(productId) {
            const productUrl = `${window.location.origin}${window.location.pathname}#product/${productId}`;
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(productUrl)}`;
            window.open(url, '_blank');
        }

        function copyProductLink(productId) {
            const productUrl = `${window.location.origin}${window.location.pathname}#product/${productId}`;
            navigator.clipboard.writeText(productUrl).then(() => {
                showSuccess('Product link copied to clipboard!');
                document.querySelector('.fixed').remove();
            });
        }

        // Initialize app
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                updateUI();
                loadUserData();
                loadWishlist();
                loadRecentlyViewed();
                
                // Setup seller notifications after checking seller status
                setTimeout(() => {
                    if (isSeller) {
                        setupSellerNotifications();
                    }
                }, 1000);
            } else {
                currentUser = null;
                wishlist = [];
                recentlyViewed = [];
                updateUI();
                
                // Clean up seller online status
                if (currentUser) {
                    database.ref(`sellerOnline/${currentUser.uid}`).set(false);
                }
            }
        });

        // Payment method change handler
        document.addEventListener('change', function(e) {
            if (e.target.name === 'payment') {
                const codAdvanceInfo = document.getElementById('codAdvanceInfo');
                const paymentAmount = document.getElementById('paymentAmount');
                const finalTotal = parseFloat(document.getElementById('finalTotal').textContent.replace('₹', ''));
                
                if (e.target.value === 'cod') {
                    const advance = Math.round(finalTotal * 0.05);
                    document.getElementById('codAdvance').textContent = advance;
                    codAdvanceInfo.classList.remove('hidden');
                    paymentAmount.textContent = `₹${advance}`;
                } else {
                    codAdvanceInfo.classList.add('hidden');
                    paymentAmount.textContent = `₹${finalTotal}`;
                }
            }
        });

        // Coupon form submission
        document.getElementById('couponForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const couponData = {
                code: document.getElementById('generatedCouponCode').value,
                type: document.getElementById('couponType').value,
                discountValue: parseFloat(document.getElementById('discountValue').value),
                productId: document.getElementById('couponProduct').value || null,
                minOrderAmount: parseFloat(document.getElementById('minOrderAmount').value) || 0,
                maxDiscount: parseFloat(document.getElementById('maxDiscount').value) || null,
                validFrom: document.getElementById('validFrom').value,
                validUntil: document.getElementById('validUntil').value,
                usageLimit: parseInt(document.getElementById('usageLimit').value),
                perUserLimit: parseInt(document.getElementById('perUserLimit').value),
                description: document.getElementById('couponDescription').value,
                sellerId: currentUser.uid,
                sellerName: currentUser.displayName,
                isActive: true,
                usedCount: 0,
                createdAt: Date.now()
            };

            database.ref('coupons').push(couponData)
                .then(() => {
                    alert('Coupon created successfully!');
                    document.getElementById('couponForm').reset();
                    showCouponManagement();
                })
                .catch((error) => {
                    console.error('Error creating coupon:', error);
                    alert('Failed to create coupon. Please try again.');
                });
        });

        // Announcement form submission
        document.getElementById('announcementForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!isAdmin) {
                alert('Access denied. Admin privileges required.');
                return;
            }
            
            const announcementData = {
                type: document.getElementById('announcementType').value,
                title: document.getElementById('announcementTitle').value,
                description: document.getElementById('announcementDescription').value,
                startDate: document.getElementById('announcementStart').value,
                endDate: document.getElementById('announcementEnd').value,
                color: document.getElementById('announcementColor').value,
                isActive: document.getElementById('announcementActive').checked,
                createdBy: currentUser.uid,
                createdAt: Date.now()
            };

            database.ref('announcements').push(announcementData)
                .then(() => {
                    alert('Announcement created successfully!');
                    document.getElementById('announcementForm').reset();
                    showAnnouncementManager();
                })
                .catch((error) => {
                    console.error('Error creating announcement:', error);
                    alert('Failed to create announcement. Please try again.');
                });
        });

        // Close mobile menu when clicking overlay
        document.getElementById('mobileMenuOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMobileMenu();
            }
        });

        // Close edit profile modal when clicking overlay
        document.getElementById('editProfileModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditProfile();
            }
        });

        // Refund form submission
        document.getElementById('refundForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const refundData = {
                orderId: currentOrderForAction,
                userId: currentUser.uid,
                reason: document.getElementById('refundReason').value,
                description: document.getElementById('refundDescription').value,
                resolution: document.getElementById('refundResolution').value,
                requestedAt: Date.now(),
                status: 'pending'
            };

            // Handle image uploads for refund
            const refundImageFiles = document.getElementById('refundImages').files;
            if (refundImageFiles.length > 0) {
                const refundImages = [];
                for (let file of refundImageFiles) {
                    try {
                        const base64 = await convertToBase64(file);
                        refundImages.push(base64);
                    } catch (error) {
                        console.error('Error converting refund image:', error);
                    }
                }
                refundData.images = refundImages;
            }

            // Save refund request
            database.ref('refundRequests').push(refundData)
                .then(() => {
                    // Update order to mark refund as requested
                    return database.ref(`orders/${currentOrderForAction}`).update({
                        refundRequested: true,
                        refundReason: refundData.reason,
                        refundRequestedAt: Date.now()
                    });
                })
                .then(() => {
                    showSuccess('Refund request submitted successfully! We will review your request and get back to you within 24-48 hours.');
                    closeRefundModal();
                    loadOrders();
                })
                .catch((error) => {
                    console.error('Error submitting refund request:', error);
                    showError('Failed to submit refund request. Please try again.');
                });
        });

        // Utility functions for notifications
        function showSuccess(message) {
            showNotification(message, 'success');
        }

        function showError(message) {
            showNotification(message, 'error');
        }

        function showWarning(message) {
            showNotification(message, 'warning');
        }

        function showInfo(message) {
            showNotification(message, 'info');
        }

        function showNotification(message, type) {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-sm`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Update showBusinessPanel function name
        async function showBusinessPanel() {
            await loadBusinessPanel();
        }

        // Load initial data and handle URL routing
        document.addEventListener('DOMContentLoaded', function() {
            handleURLRouting();
        });
        
        // Fallback if DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', handleURLRouting);
        } else {
            handleURLRouting();
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97bd2c3b246559cf',t:'MTc1NzMyMTE1OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
