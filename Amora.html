<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amora - Find Your Perfect Match</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e, #ffa726, #ff7043);
        }
        
        .card-swipe {
            transition: transform 0.3s ease, opacity 0.3s ease;
            touch-action: pan-y;
        }
        
        .card-swipe.swipe-left {
            transform: translateX(-100%) rotate(-30deg);
            opacity: 0;
        }
        
        .card-swipe.swipe-right {
            transform: translateX(100%) rotate(30deg);
            opacity: 0;
        }
        
        .match-animation {
            animation: matchPulse 0.6s ease-in-out;
        }
        
        @keyframes matchPulse {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .online-indicator {
            width: 12px;
            height: 12px;
            background: #4ade80;
            border-radius: 50%;
            border: 2px solid white;
            position: absolute;
            bottom: 2px;
            right: 2px;
        }
        
        .message-bubble {
            max-width: 70%;
            word-wrap: break-word;
        }
        
        .dark-mode {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: white;
        }
        
        .premium-badge {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #1a1a2e;
            font-weight: bold;
        }
        
        .streak-fire {
            animation: fireFlicker 1s ease-in-out infinite alternate;
        }
        
        @keyframes fireFlicker {
            0% { transform: scale(1) rotate(-2deg); }
            100% { transform: scale(1.1) rotate(2deg); }
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .mobile-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: blur(10px);
                z-index: 50;
                padding: 8px;
            }
            
            .mobile-nav-grid {
                display: grid;
                grid-template-columns: repeat(5, 1fr);
                gap: 4px;
            }
            
            .mobile-nav-btn {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 8px 4px;
                border-radius: 12px;
                color: white;
                font-size: 10px;
                transition: all 0.2s;
                min-height: 60px;
            }
            
            .mobile-nav-btn.active {
                background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            }
            
            .mobile-nav-btn:not(.active) {
                background: rgba(255, 255, 255, 0.1);
            }
            
            .mobile-nav-icon {
                font-size: 20px;
                margin-bottom: 4px;
            }
            
            .mobile-card-stack {
                height: 70vh;
                max-height: 600px;
            }
            
            .mobile-action-buttons {
                position: fixed;
                bottom: 90px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                gap: 12px;
                z-index: 40;
            }
            
            .mobile-action-btn {
                width: 50px;
                height: 50px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: white;
                border: none;
                cursor: pointer;
                transition: all 0.2s;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            }
            
            .mobile-action-btn:active {
                transform: scale(0.95);
            }
            
            .mobile-padding {
                padding-bottom: 100px;
            }
            
            .mobile-full-height {
                height: calc(100vh - 140px);
                overflow-y: auto;
            }
            
            .mobile-chat-height {
                height: calc(100vh - 200px);
            }
            
            .mobile-grid-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .mobile-text-sm {
                font-size: 14px;
            }
            
            .mobile-p-4 {
                padding: 16px;
            }
            
            .mobile-gap-4 {
                gap: 16px;
            }
        }
        
        /* Touch-friendly interactions */
        .touch-target {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Prevent zoom on input focus */
        input, select, textarea {
            font-size: 16px;
        }
        
        /* Smooth scrolling */
        * {
            -webkit-overflow-scrolling: touch;
        }
    </style>
</head>
<body class="min-h-full gradient-bg">
    <!-- Navigation -->
    <nav class="bg-white/10 backdrop-blur-md border-b border-white/20 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-white">üíï Amora</h1>
                    <div id="streakCounter" class="hidden bg-white/20 px-3 py-1 rounded-full text-white text-sm">
                        üî• <span id="streakCount">0</span> Day Streak
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="darkModeToggle" class="p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors">
                        üåô
                    </button>
                    <div id="userPoints" class="hidden bg-white/20 px-3 py-1 rounded-full text-white text-sm">
                        ‚≠ê <span id="pointsCount">0</span> Points
                    </div>
                    <button id="profileBtn" class="hidden bg-white/20 px-4 py-2 rounded-full text-white hover:bg-white/30 transition-colors">
                        Profile
                    </button>
                    <button id="logoutBtn" class="hidden bg-red-500/80 px-4 py-2 rounded-full text-white hover:bg-red-600/80 transition-colors">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 py-6">
        <!-- Login Screen -->
        <div id="loginScreen" class="flex items-center justify-center min-h-[80vh]">
            <div class="bg-white/10 backdrop-blur-md rounded-3xl p-8 max-w-md w-full border border-white/20">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold text-white mb-2">Welcome to Amora</h2>
                    <p class="text-white/80">Find your perfect match today!</p>
                </div>
                <button id="googleLoginBtn" class="w-full bg-white text-gray-800 py-3 px-6 rounded-full font-semibold hover:bg-gray-100 transition-colors flex items-center justify-center space-x-2">
                    <span>üîê</span>
                    <span>Continue with Google</span>
                </button>
                <div class="mt-6 text-center">
                    <p class="text-white/60 text-sm">By continuing, you agree to our Terms & Privacy Policy</p>
                </div>
            </div>
        </div>

        <!-- Profile Setup Screen -->
        <div id="profileSetupScreen" class="hidden">
            <div class="bg-white/10 backdrop-blur-md rounded-3xl p-4 lg:p-8 max-w-2xl mx-auto border border-white/20">
                <div class="text-center mb-6 lg:mb-8">
                    <h2 class="text-2xl lg:text-3xl font-bold text-white mb-4">Complete Your Profile</h2>
                    <p class="text-white/80 mb-4 text-sm lg:text-base">‡§∏‡§≠‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡§®‡§æ ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à ‡§Æ‡•à‡§ö‡§ø‡§Ç‡§ó ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è (All information is required to start matching)</p>
                    <div class="bg-white/20 rounded-full h-2 mb-2">
                        <div id="profileProgress" class="bg-gradient-to-r from-pink-500 to-red-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p class="text-white/60 text-sm">Profile Completion: <span id="progressText">0%</span></p>
                </div>
                <form id="profileForm" class="space-y-6">
                    <!-- Photo Upload -->
                    <div>
                        <label class="block text-white font-semibold mb-2">Profile Photos (Upload 1-6) *</label>
                        <p class="text-white/70 text-sm mb-4">‡§™‡§π‡§≤‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§´‡•ã‡§ü‡•ã ‡§π‡•ã‡§ó‡•Ä‡•§ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 1 ‡§´‡•ã‡§ü‡•ã ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à‡•§ (First photo will be your main photo. At least 1 photo required.)</p>
                        <div class="grid grid-cols-3 gap-4">
                            <div id="photoUpload1" class="aspect-square bg-white/20 rounded-xl border-2 border-dashed border-white/40 flex items-center justify-center cursor-pointer hover:bg-white/30 transition-colors">
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-white text-xl">+</span>
                                    </div>
                                    <span class="text-white text-sm">Main Photo *</span>
                                </div>
                                <input type="file" class="hidden" accept="image/*" onchange="handlePhotoUpload(this, 1)">
                            </div>
                            <div id="photoUpload2" class="aspect-square bg-white/20 rounded-xl border-2 border-dashed border-white/40 flex items-center justify-center cursor-pointer hover:bg-white/30 transition-colors">
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-white text-xl">+</span>
                                    </div>
                                    <span class="text-white text-sm">Photo 2</span>
                                </div>
                                <input type="file" class="hidden" accept="image/*" onchange="handlePhotoUpload(this, 2)">
                            </div>
                            <div id="photoUpload3" class="aspect-square bg-white/20 rounded-xl border-2 border-dashed border-white/40 flex items-center justify-center cursor-pointer hover:bg-white/30 transition-colors">
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-white text-xl">+</span>
                                    </div>
                                    <span class="text-white text-sm">Photo 3</span>
                                </div>
                                <input type="file" class="hidden" accept="image/*" onchange="handlePhotoUpload(this, 3)">
                            </div>
                            <div id="photoUpload4" class="aspect-square bg-white/20 rounded-xl border-2 border-dashed border-white/40 flex items-center justify-center cursor-pointer hover:bg-white/30 transition-colors">
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-white text-xl">+</span>
                                    </div>
                                    <span class="text-white text-sm">Photo 4</span>
                                </div>
                                <input type="file" class="hidden" accept="image/*" onchange="handlePhotoUpload(this, 4)">
                            </div>
                            <div id="photoUpload5" class="aspect-square bg-white/20 rounded-xl border-2 border-dashed border-white/40 flex items-center justify-center cursor-pointer hover:bg-white/30 transition-colors">
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-white text-xl">+</span>
                                    </div>
                                    <span class="text-white text-sm">Photo 5</span>
                                </div>
                                <input type="file" class="hidden" accept="image/*" onchange="handlePhotoUpload(this, 5)">
                            </div>
                            <div id="photoUpload6" class="aspect-square bg-white/20 rounded-xl border-2 border-dashed border-white/40 flex items-center justify-center cursor-pointer hover:bg-white/30 transition-colors">
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-white text-xl">+</span>
                                    </div>
                                    <span class="text-white text-sm">Photo 6</span>
                                </div>
                                <input type="file" class="hidden" accept="image/*" onchange="handlePhotoUpload(this, 6)">
                            </div>
                        </div>
                    </div>

                    <!-- Basic Info -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-white font-semibold mb-2">Name *</label>
                            <input type="text" id="userName" required class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60" placeholder="Your name">
                        </div>
                        <div>
                            <label class="block text-white font-semibold mb-2">Age *</label>
                            <input type="number" id="userAge" required min="18" max="100" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60" placeholder="25">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-white font-semibold mb-2">Gender *</label>
                            <select id="userGender" required class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white">
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-white font-semibold mb-2">Interested In *</label>
                            <select id="interestedIn" required class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white">
                                <option value="">Select Preference</option>
                                <option value="male">Men</option>
                                <option value="female">Women</option>
                                <option value="everyone">Everyone</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-white font-semibold mb-2">City/Location *</label>
                        <input type="text" id="userLocation" required class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60" placeholder="Mumbai, India">
                    </div>

                    <div>
                        <label class="block text-white font-semibold mb-2">About Me *</label>
                        <textarea id="userBio" required class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 h-24" placeholder="Adventurous soul who loves road trips üöó"></textarea>
                    </div>

                    <!-- Optional Details -->
                    <div class="border-t border-white/20 pt-6">
                        <h3 class="text-xl font-semibold text-white mb-4">Optional Details</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-white font-semibold mb-2">Occupation</label>
                                <input type="text" id="userOccupation" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60" placeholder="Software Engineer">
                            </div>
                            <div>
                                <label class="block text-white font-semibold mb-2">Height</label>
                                <input type="text" id="userHeight" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60" placeholder="5'8&quot;">
                            </div>
                        </div>
                    </div>

                    <!-- Interests -->
                    <div>
                        <label class="block text-white font-semibold mb-2">Interests (Select multiple)</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                            <label class="flex items-center space-x-2 text-white">
                                <input type="checkbox" value="music" class="rounded">
                                <span>üéµ Music</span>
                            </label>
                            <label class="flex items-center space-x-2 text-white">
                                <input type="checkbox" value="travel" class="rounded">
                                <span>‚úàÔ∏è Travel</span>
                            </label>
                            <label class="flex items-center space-x-2 text-white">
                                <input type="checkbox" value="fitness" class="rounded">
                                <span>üí™ Fitness</span>
                            </label>
                            <label class="flex items-center space-x-2 text-white">
                                <input type="checkbox" value="movies" class="rounded">
                                <span>üé¨ Movies</span>
                            </label>
                            <label class="flex items-center space-x-2 text-white">
                                <input type="checkbox" value="food" class="rounded">
                                <span>üçï Food</span>
                            </label>
                            <label class="flex items-center space-x-2 text-white">
                                <input type="checkbox" value="books" class="rounded">
                                <span>üìö Books</span>
                            </label>
                            <label class="flex items-center space-x-2 text-white">
                                <input type="checkbox" value="sports" class="rounded">
                                <span>‚öΩ Sports</span>
                            </label>
                            <label class="flex items-center space-x-2 text-white">
                                <input type="checkbox" value="art" class="rounded">
                                <span>üé® Art</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-pink-500 to-red-500 text-white py-3 px-6 rounded-full font-semibold hover:from-pink-600 hover:to-red-600 transition-colors">
                        Complete Profile & Start Matching! üíï
                    </button>
                </form>
            </div>
        </div>

        <!-- Main App Screen -->
        <div id="mainAppScreen" class="hidden">
            <!-- Desktop Navigation -->
            <div class="hidden lg:grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Left Sidebar - Navigation -->
                <div class="lg:col-span-1">
                    <div class="bg-white/10 backdrop-blur-md rounded-3xl p-6 border border-white/20 sticky top-24">
                        <div class="space-y-4">
                            <button id="discoverTab" class="w-full bg-gradient-to-r from-pink-500 to-red-500 text-white py-3 px-4 rounded-xl font-semibold transition-colors">
                                Discover
                            </button>
                            <button id="matchesTab" class="w-full bg-white/20 text-white py-3 px-4 rounded-xl font-semibold hover:bg-white/30 transition-colors">
                                Matches (<span id="matchCount">0</span>)
                            </button>
                            <button id="chatTab" class="w-full bg-white/20 text-white py-3 px-4 rounded-xl font-semibold hover:bg-white/30 transition-colors">
                                Messages
                            </button>
                            <button id="likesTab" class="w-full bg-white/20 text-white py-3 px-4 rounded-xl font-semibold hover:bg-white/30 transition-colors">
                                Likes You
                            </button>
                            <button id="premiumTab" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white py-3 px-4 rounded-xl font-semibold hover:from-yellow-500 hover:to-orange-600 transition-colors opacity-50 cursor-not-allowed">
                                Premium (Coming Soon)
                            </button>
                            <button id="boostTab" class="w-full bg-purple-500/80 text-white py-3 px-4 rounded-xl font-semibold hover:bg-purple-600/80 transition-colors">
                                Boost Profile
                            </button>
                            <button id="rewindTab" class="w-full bg-orange-500/80 text-white py-3 px-4 rounded-xl font-semibold hover:bg-orange-600/80 transition-colors">
                                Rewind Last Swipe
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="lg:col-span-2">
            </div>
            
            <!-- Mobile Layout -->
            <div class="lg:hidden mobile-padding">
                <!-- Mobile Content Area -->
                    <!-- Discover Section -->
                    <div id="discoverSection" class="bg-white/10 backdrop-blur-md rounded-3xl mobile-p-4 lg:p-6 border border-white/20 mobile-full-height">
                        <div class="text-center mb-4 lg:mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl lg:text-2xl font-bold text-white">Discover People</h2>
                                <button id="filtersBtn" class="bg-white/20 text-white px-3 py-2 lg:px-4 lg:py-2 rounded-full hover:bg-white/30 transition-colors touch-target mobile-text-sm">
                                    ‚öôÔ∏è Filters
                                </button>
                            </div>
                            <p class="text-white/80 mobile-text-sm lg:text-base">Swipe right to like, left to pass</p>
                        </div>
                        
                        <div id="cardStack" class="relative mobile-card-stack lg:h-96 mx-auto max-w-sm">
                            <!-- Cards will be dynamically generated here -->
                        </div>
                        
                        <!-- Desktop Action Buttons -->
                        <div class="hidden lg:flex justify-center space-x-3 mt-6">
                            <button id="rewindCardBtn" class="bg-orange-500/80 hover:bg-orange-600/80 text-white p-4 rounded-full transition-colors font-semibold" title="Rewind">
                                ‚Ü∂
                            </button>
                            <button id="passBtn" class="bg-red-500/80 hover:bg-red-600/80 text-white p-4 rounded-full transition-colors font-semibold" title="Pass">
                                ‚úï
                            </button>
                            <button id="superLikeBtn" class="bg-blue-500/80 hover:bg-blue-600/80 text-white p-4 rounded-full transition-colors font-semibold" title="Super Like">
                                ‚≠ê
                            </button>
                            <button id="likeBtn" class="bg-green-500/80 hover:bg-green-600/80 text-white p-4 rounded-full transition-colors font-semibold" title="Like">
                                ‚ô•
                            </button>
                            <button id="boostCardBtn" class="bg-purple-500/80 hover:bg-purple-600/80 text-white p-4 rounded-full transition-colors font-semibold" title="Boost">
                                ‚ö°
                            </button>
                        </div>
                        
                        <!-- Mobile Action Buttons (Fixed Position) -->
                        <div class="mobile-action-buttons lg:hidden">
                            <button id="mobilePassBtn" class="mobile-action-btn bg-red-500/80" title="Pass">‚úï</button>
                            <button id="mobileSuperLikeBtn" class="mobile-action-btn bg-blue-500/80" title="Super Like">‚≠ê</button>
                            <button id="mobileLikeBtn" class="mobile-action-btn bg-green-500/80" title="Like">‚ô•</button>
                        </div>
                        
                        <div class="text-center mt-4 lg:mt-4">
                            <button id="viewProfileBtn" class="text-white/80 hover:text-white text-sm underline touch-target">
                                View Full Profile
                            </button>
                        </div>
                    </div>

                    <!-- Matches Section -->
                    <div id="matchesSection" class="hidden bg-white/10 backdrop-blur-md rounded-3xl mobile-p-4 lg:p-6 border border-white/20 mobile-full-height">
                        <h2 class="text-xl lg:text-2xl font-bold text-white mb-4 lg:mb-6">Your Matches</h2>
                        <div id="matchesList" class="grid mobile-grid-2 md:grid-cols-3 mobile-gap-4 lg:gap-4">
                            <!-- Matches will be displayed here -->
                        </div>
                    </div>

                    <!-- Chat Section -->
                    <div id="chatSection" class="hidden bg-white/10 backdrop-blur-md rounded-3xl mobile-p-4 lg:p-6 border border-white/20 mobile-full-height">
                        <div id="chatList" class="space-y-4">
                            <h2 class="text-xl lg:text-2xl font-bold text-white mb-4 lg:mb-6">Messages</h2>
                            <!-- Chat conversations will be listed here -->
                        </div>
                        
                        <!-- Individual Chat Window -->
                        <div id="chatWindow" class="hidden">
                            <div class="flex items-center justify-between mb-4 pb-4 border-b border-white/20">
                                <div class="flex items-center space-x-3">
                                    <button id="backToChatList" class="text-white hover:text-white/80 touch-target">
                                        ‚Üê Back
                                    </button>
                                    <div class="relative">
                                        <img id="chatPartnerPhoto" class="w-10 h-10 rounded-full object-cover" src="" alt="">
                                        <div class="online-indicator"></div>
                                    </div>
                                    <div>
                                        <h3 id="chatPartnerName" class="text-white font-semibold mobile-text-sm lg:text-base"></h3>
                                        <p class="text-white/60 text-xs lg:text-sm">Active now</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="chatMessages" class="mobile-chat-height lg:h-64 overflow-y-auto mb-4 space-y-2">
                                <!-- Messages will appear here -->
                            </div>
                            
                            <div class="flex space-x-2">
                                <input type="text" id="messageInput" class="flex-1 bg-white/20 border border-white/30 rounded-full px-4 py-3 lg:py-2 text-white placeholder-white/60 touch-target" placeholder="Type a message...">
                                <button id="sendMessageBtn" class="bg-gradient-to-r from-pink-500 to-red-500 text-white px-4 lg:px-6 py-3 lg:py-2 rounded-full hover:from-pink-600 hover:to-red-600 transition-colors touch-target mobile-text-sm lg:text-base">
                                    Send
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Likes Section -->
                    <div id="likesSection" class="hidden bg-white/10 backdrop-blur-md rounded-3xl mobile-p-4 lg:p-6 border border-white/20 mobile-full-height">
                        <h2 class="text-xl lg:text-2xl font-bold text-white mb-4 lg:mb-6">People Who Liked You</h2>
                        <div id="likesList" class="grid mobile-grid-2 md:grid-cols-3 mobile-gap-4 lg:gap-4">
                            <!-- Likes will be displayed here -->
                        </div>
                    </div>

                    <!-- Profile View Section -->
                    <div id="profileViewSection" class="hidden bg-white/10 backdrop-blur-md rounded-3xl p-6 border border-white/20">
                        <div id="profileViewContent">
                            <!-- Profile details will be shown here -->
                        </div>
                    </div>

                    <!-- Boost Section -->
                    <div id="boostSection" class="hidden bg-white/10 backdrop-blur-md rounded-3xl p-6 border border-white/20">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-white mb-2">üöÄ Boost Your Profile</h2>
                            <p class="text-white/80">Get 10x more profile views for 30 minutes!</p>
                        </div>
                        
                        <div class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-2xl p-8 mb-6 border border-purple-400/30">
                            <div class="text-center">
                                <div class="text-6xl mb-4">‚ö°</div>
                                <h3 class="text-2xl font-bold text-white mb-2">Profile Boost</h3>
                                <p class="text-white/80 mb-4">Be one of the top profiles in your area for 30 minutes</p>
                                <div class="text-3xl font-bold text-white mb-6">‚Çπ199</div>
                                <button id="buyBoostBtn" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-3 rounded-full font-semibold hover:from-purple-600 hover:to-pink-600 transition-colors">
                                    Boost Now
                                </button>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <p class="text-white/60 text-sm">Boost increases your visibility and helps you get more matches!</p>
                        </div>
                    </div>

                    <!-- Premium Section -->
                    <div id="premiumSection" class="hidden bg-white/10 backdrop-blur-md rounded-3xl p-6 border border-white/20">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-white mb-2">Go Premium ‚≠ê</h2>
                            <p class="text-white/80">Unlock exclusive features and find love faster!</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Plus Plan -->
                            <div class="bg-gradient-to-b from-blue-500/20 to-blue-600/20 rounded-2xl p-6 border border-blue-400/30">
                                <h3 class="text-xl font-bold text-white mb-2">Plus</h3>
                                <p class="text-2xl font-bold text-white mb-4">‚Çπ499/month</p>
                                <ul class="space-y-2 text-white/80 text-sm mb-6">
                                    <li>‚úì Unlimited likes</li>
                                    <li>‚úì See who liked you</li>
                                    <li>‚úì Rewind last swipe</li>
                                    <li>‚úì 5 Super Likes per day</li>
                                </ul>
                                <button class="w-full bg-blue-500 text-white py-2 rounded-xl hover:bg-blue-600 transition-colors">
                                    Choose Plus
                                </button>
                            </div>
                            
                            <!-- Gold Plan -->
                            <div class="bg-gradient-to-b from-yellow-500/20 to-orange-600/20 rounded-2xl p-6 border border-yellow-400/30 transform scale-105">
                                <div class="premium-badge text-center py-1 px-3 rounded-full text-xs mb-3">MOST POPULAR</div>
                                <h3 class="text-xl font-bold text-white mb-2">Gold</h3>
                                <p class="text-2xl font-bold text-white mb-4">‚Çπ999/month</p>
                                <ul class="space-y-2 text-white/80 text-sm mb-6">
                                    <li>‚úì Everything in Plus</li>
                                    <li>‚úì Profile boost (2x/month)</li>
                                    <li>‚úì Travel mode</li>
                                    <li>‚úì Hide ads</li>
                                    <li>‚úì Priority support</li>
                                </ul>
                                <button class="w-full bg-gradient-to-r from-yellow-500 to-orange-500 text-white py-2 rounded-xl hover:from-yellow-600 hover:to-orange-600 transition-colors">
                                    Choose Gold
                                </button>
                            </div>
                            
                            <!-- Diamond Plan -->
                            <div class="bg-gradient-to-b from-purple-500/20 to-pink-600/20 rounded-2xl p-6 border border-purple-400/30">
                                <h3 class="text-xl font-bold text-white mb-2">Diamond</h3>
                                <p class="text-2xl font-bold text-white mb-4">‚Çπ1499/month</p>
                                <ul class="space-y-2 text-white/80 text-sm mb-6">
                                    <li>‚úì Everything in Gold</li>
                                    <li>‚úì Message before matching</li>
                                    <li>‚úì Priority likes</li>
                                    <li>‚úì Weekly profile boost</li>
                                    <li>‚úì VIP support</li>
                                </ul>
                                <button class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-2 rounded-xl hover:from-purple-600 hover:to-pink-600 transition-colors">
                                    Choose Diamond
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Edit Section -->
                    <div id="profileEditSection" class="hidden bg-white/10 backdrop-blur-md rounded-3xl mobile-p-4 lg:p-6 border border-white/20 mobile-full-height">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl lg:text-2xl font-bold text-white">Edit Profile</h2>
                            <button onclick="showDiscoverSection()" class="text-white/80 hover:text-white touch-target">‚Üê Back</button>
                        </div>
                        
                        <form id="profileEditForm" class="space-y-6">
                            <!-- Photo Upload -->
                            <div>
                                <label class="block text-white font-semibold mb-2">Profile Photos</label>
                                <p class="text-white/70 text-sm mb-4">‡§™‡§π‡§≤‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§´‡•ã‡§ü‡•ã ‡§π‡•ã‡§ó‡•Ä‡•§ (First photo will be your main photo.)</p>
                                <div class="grid grid-cols-3 gap-4">
                                    <div id="editPhotoUpload1" class="aspect-square bg-white/20 rounded-xl border-2 border-dashed border-white/40 flex items-center justify-center cursor-pointer hover:bg-white/30 transition-colors">
                                        <div class="text-center">
                                            <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                                <span class="text-white text-xl">+</span>
                                            </div>
                                            <span class="text-white text-sm">Main Photo</span>
                                        </div>
                                        <input type="file" class="hidden" accept="image/*" onchange="handleEditPhotoUpload(this, 1)">
                                    </div>
                                    <div id="editPhotoUpload2" class="aspect-square bg-white/20 rounded-xl border-2 border-dashed border-white/40 flex items-center justify-center cursor-pointer hover:bg-white/30 transition-colors">
                                        <div class="text-center">
                                            <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                                <span class="text-white text-xl">+</span>
                                            </div>
                                            <span class="text-white text-sm">Photo 2</span>
                                        </div>
                                        <input type="file" class="hidden" accept="image/*" onchange="handleEditPhotoUpload(this, 2)">
                                    </div>
                                    <div id="editPhotoUpload3" class="aspect-square bg-white/20 rounded-xl border-2 border-dashed border-white/40 flex items-center justify-center cursor-pointer hover:bg-white/30 transition-colors">
                                        <div class="text-center">
                                            <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                                <span class="text-white text-xl">+</span>
                                            </div>
                                            <span class="text-white text-sm">Photo 3</span>
                                        </div>
                                        <input type="file" class="hidden" accept="image/*" onchange="handleEditPhotoUpload(this, 3)">
                                    </div>
                                    <div id="editPhotoUpload4" class="aspect-square bg-white/20 rounded-xl border-2 border-dashed border-white/40 flex items-center justify-center cursor-pointer hover:bg-white/30 transition-colors">
                                        <div class="text-center">
                                            <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                                <span class="text-white text-xl">+</span>
                                            </div>
                                            <span class="text-white text-sm">Photo 4</span>
                                        </div>
                                        <input type="file" class="hidden" accept="image/*" onchange="handleEditPhotoUpload(this, 4)">
                                    </div>
                                    <div id="editPhotoUpload5" class="aspect-square bg-white/20 rounded-xl border-2 border-dashed border-white/40 flex items-center justify-center cursor-pointer hover:bg-white/30 transition-colors">
                                        <div class="text-center">
                                            <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                                <span class="text-white text-xl">+</span>
                                            </div>
                                            <span class="text-white text-sm">Photo 5</span>
                                        </div>
                                        <input type="file" class="hidden" accept="image/*" onchange="handleEditPhotoUpload(this, 5)">
                                    </div>
                                    <div id="editPhotoUpload6" class="aspect-square bg-white/20 rounded-xl border-2 border-dashed border-white/40 flex items-center justify-center cursor-pointer hover:bg-white/30 transition-colors">
                                        <div class="text-center">
                                            <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                                <span class="text-white text-xl">+</span>
                                            </div>
                                            <span class="text-white text-sm">Photo 6</span>
                                        </div>
                                        <input type="file" class="hidden" accept="image/*" onchange="handleEditPhotoUpload(this, 6)">
                                    </div>
                                </div>
                            </div>

                            <!-- Basic Info -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-white font-semibold mb-2">Name *</label>
                                    <input type="text" id="editUserName" required class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 touch-target" placeholder="Your name">
                                </div>
                                <div>
                                    <label class="block text-white font-semibold mb-2">Age *</label>
                                    <input type="number" id="editUserAge" required min="18" max="100" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 touch-target" placeholder="25">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-white font-semibold mb-2">Gender *</label>
                                    <select id="editUserGender" required class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white touch-target">
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-white font-semibold mb-2">Interested In *</label>
                                    <select id="editInterestedIn" required class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white touch-target">
                                        <option value="">Select Preference</option>
                                        <option value="male">Men</option>
                                        <option value="female">Women</option>
                                        <option value="everyone">Everyone</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-white font-semibold mb-2">City/Location *</label>
                                <input type="text" id="editUserLocation" required class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 touch-target" placeholder="Mumbai, India">
                            </div>

                            <div>
                                <label class="block text-white font-semibold mb-2">About Me *</label>
                                <textarea id="editUserBio" required class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 h-24 touch-target" placeholder="Adventurous soul who loves road trips üöó"></textarea>
                            </div>

                            <!-- Optional Details -->
                            <div class="border-t border-white/20 pt-6">
                                <h3 class="text-xl font-semibold text-white mb-4">Optional Details</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-white font-semibold mb-2">Occupation</label>
                                        <input type="text" id="editUserOccupation" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 touch-target" placeholder="Software Engineer">
                                    </div>
                                    <div>
                                        <label class="block text-white font-semibold mb-2">Height</label>
                                        <input type="text" id="editUserHeight" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 touch-target" placeholder="5'8&quot;">
                                    </div>
                                </div>
                            </div>

                            <!-- Social Media Links -->
                            <div class="border-t border-white/20 pt-6">
                                <h3 class="text-xl font-semibold text-white mb-4">üîó Social Media Links</h3>
                                <p class="text-white/70 text-sm mb-4">‡§Ö‡§™‡§®‡•á ‡§∏‡•ã‡§∂‡§≤ ‡§Æ‡•Ä‡§°‡§ø‡§Ø‡§æ ‡§≤‡§ø‡§Ç‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç (Add your social media links)</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-white font-semibold mb-2">üì∑ Instagram</label>
                                        <input type="url" id="editInstagram" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 touch-target" placeholder="https://instagram.com/username">
                                    </div>
                                    <div>
                                        <label class="block text-white font-semibold mb-2">üìò Facebook</label>
                                        <input type="url" id="editFacebook" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 touch-target" placeholder="https://facebook.com/username">
                                    </div>
                                    <div>
                                        <label class="block text-white font-semibold mb-2">üê¶ Twitter</label>
                                        <input type="url" id="editTwitter" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 touch-target" placeholder="https://twitter.com/username">
                                    </div>
                                    <div>
                                        <label class="block text-white font-semibold mb-2">üíº LinkedIn</label>
                                        <input type="url" id="editLinkedin" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 touch-target" placeholder="https://linkedin.com/in/username">
                                    </div>
                                    <div>
                                        <label class="block text-white font-semibold mb-2">üì∫ YouTube</label>
                                        <input type="url" id="editYoutube" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 touch-target" placeholder="https://youtube.com/channel/username">
                                    </div>
                                    <div>
                                        <label class="block text-white font-semibold mb-2">üëª Snapchat</label>
                                        <input type="text" id="editSnapchat" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/60 touch-target" placeholder="snapchat_username">
                                    </div>
                                </div>
                            </div>

                            <!-- Interests -->
                            <div>
                                <label class="block text-white font-semibold mb-2">Interests (Select multiple)</label>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                    <label class="flex items-center space-x-2 text-white">
                                        <input type="checkbox" value="music" class="rounded touch-target">
                                        <span>üéµ Music</span>
                                    </label>
                                    <label class="flex items-center space-x-2 text-white">
                                        <input type="checkbox" value="travel" class="rounded touch-target">
                                        <span>‚úàÔ∏è Travel</span>
                                    </label>
                                    <label class="flex items-center space-x-2 text-white">
                                        <input type="checkbox" value="fitness" class="rounded touch-target">
                                        <span>üí™ Fitness</span>
                                    </label>
                                    <label class="flex items-center space-x-2 text-white">
                                        <input type="checkbox" value="movies" class="rounded touch-target">
                                        <span>üé¨ Movies</span>
                                    </label>
                                    <label class="flex items-center space-x-2 text-white">
                                        <input type="checkbox" value="food" class="rounded touch-target">
                                        <span>üçï Food</span>
                                    </label>
                                    <label class="flex items-center space-x-2 text-white">
                                        <input type="checkbox" value="books" class="rounded touch-target">
                                        <span>üìö Books</span>
                                    </label>
                                    <label class="flex items-center space-x-2 text-white">
                                        <input type="checkbox" value="sports" class="rounded touch-target">
                                        <span>‚öΩ Sports</span>
                                    </label>
                                    <label class="flex items-center space-x-2 text-white">
                                        <input type="checkbox" value="art" class="rounded touch-target">
                                        <span>üé® Art</span>
                                    </label>
                                    <label class="flex items-center space-x-2 text-white">
                                        <input type="checkbox" value="gaming" class="rounded touch-target">
                                        <span>üéÆ Gaming</span>
                                    </label>
                                    <label class="flex items-center space-x-2 text-white">
                                        <input type="checkbox" value="photography" class="rounded touch-target">
                                        <span>üì∏ Photography</span>
                                    </label>
                                    <label class="flex items-center space-x-2 text-white">
                                        <input type="checkbox" value="cooking" class="rounded touch-target">
                                        <span>üë®‚Äçüç≥ Cooking</span>
                                    </label>
                                    <label class="flex items-center space-x-2 text-white">
                                        <input type="checkbox" value="dancing" class="rounded touch-target">
                                        <span>üíÉ Dancing</span>
                                    </label>
                                </div>
                            </div>

                            <div class="flex space-x-4">
                                <button type="button" onclick="showDiscoverSection()" class="flex-1 bg-white/20 text-white py-3 px-6 rounded-full font-semibold hover:bg-white/30 transition-colors touch-target">
                                    Cancel
                                </button>
                                <button type="submit" class="flex-1 bg-gradient-to-r from-pink-500 to-red-500 text-white py-3 px-6 rounded-full font-semibold hover:from-pink-600 hover:to-red-600 transition-colors touch-target">
                                    Save Changes üíï
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Bottom Navigation -->
            <div class="mobile-nav lg:hidden">
                <div class="mobile-nav-grid">
                    <button id="mobileDiscoverTab" class="mobile-nav-btn active">
                        <div class="mobile-nav-icon">üíï</div>
                        <span>Discover</span>
                    </button>
                    <button id="mobileMatchesTab" class="mobile-nav-btn">
                        <div class="mobile-nav-icon">üíñ</div>
                        <span>Matches</span>
                    </button>
                    <button id="mobileChatTab" class="mobile-nav-btn">
                        <div class="mobile-nav-icon">üí¨</div>
                        <span>Messages</span>
                    </button>
                    <button id="mobileLikesTab" class="mobile-nav-btn">
                        <div class="mobile-nav-icon">üëÄ</div>
                        <span>Likes</span>
                    </button>
                    <button id="mobileBoostTab" class="mobile-nav-btn">
                        <div class="mobile-nav-icon">‚ö°</div>
                        <span>Boost</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters Modal -->
    <div id="filtersModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="bg-white/10 backdrop-blur-md rounded-3xl p-8 max-w-md w-full mx-4 border border-white/20">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">Discovery Settings</h2>
                <button id="closeFiltersBtn" class="text-white/80 hover:text-white text-2xl">√ó</button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-white font-semibold mb-2">Age Range</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="minAgeSlider" min="18" max="100" value="18" class="flex-1">
                        <span id="minAgeValue" class="text-white">18</span>
                        <span class="text-white">-</span>
                        <input type="range" id="maxAgeSlider" min="18" max="100" value="35" class="flex-1">
                        <span id="maxAgeValue" class="text-white">35</span>
                    </div>
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-2">Maximum Distance</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="distanceSlider" min="1" max="100" value="25" class="flex-1">
                        <span id="distanceValue" class="text-white">25 km</span>
                    </div>
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-2">Show Me</label>
                    <select id="showMeFilter" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white">
                        <option value="everyone">Everyone</option>
                        <option value="male">Men</option>
                        <option value="female">Women</option>
                    </select>
                </div>
                
                <div>
                    <label class="flex items-center space-x-2 text-white">
                        <input type="checkbox" id="onlineOnlyFilter" class="rounded">
                        <span>Show only people who are online</span>
                    </label>
                </div>
                
                <div>
                    <label class="flex items-center space-x-2 text-white">
                        <input type="checkbox" id="verifiedOnlyFilter" class="rounded">
                        <span>Show only verified profiles</span>
                    </label>
                </div>
            </div>
            
            <div class="flex space-x-4 mt-8">
                <button id="resetFiltersBtn" class="flex-1 bg-white/20 text-white py-3 rounded-full hover:bg-white/30 transition-colors">
                    Reset
                </button>
                <button id="applyFiltersBtn" class="flex-1 bg-gradient-to-r from-pink-500 to-red-500 text-white py-3 rounded-full hover:from-pink-600 hover:to-red-600 transition-colors">
                    Apply
                </button>
            </div>
        </div>
    </div>

    <!-- Match Popup -->
    <div id="matchPopup" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="bg-gradient-to-b from-pink-500 to-red-500 rounded-3xl p-8 max-w-md w-full mx-4 text-center match-animation">
            <h2 class="text-4xl font-bold text-white mb-4">It's a Match!</h2>
            <div class="flex justify-center space-x-4 mb-6">
                <img id="matchUser1Photo" class="w-24 h-24 rounded-full object-cover border-4 border-white" src="" alt="">
                <img id="matchUser2Photo" class="w-24 h-24 rounded-full object-cover border-4 border-white" src="" alt="">
            </div>
            <p class="text-white/90 mb-6">You and <span id="matchUserName"></span> liked each other!</p>
            <div class="space-y-3">
                <button id="sendMessageFromMatch" class="w-full bg-white text-pink-500 py-3 rounded-full font-semibold hover:bg-gray-100 transition-colors">
                    Send Message
                </button>
                <button id="keepSwipingBtn" class="w-full bg-white/20 text-white py-3 rounded-full font-semibold hover:bg-white/30 transition-colors">
                    Keep Swiping
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC30TcmMVhP_8HdFYS1WufRiZwSDYNMTF0",
            authDomain: "pulse2-92372.firebaseapp.com",
            databaseURL: "https://pulse2-92372-default-rtdb.firebaseio.com",
            projectId: "pulse2-92372",
            storageBucket: "pulse2-92372.firebasestorage.app",
            messagingSenderId: "276235725177",
            appId: "1:276235725177:web:0f4e0789fae80a435927a8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        // Global variables
        let currentUser = null;
        let currentUserProfile = null;
        let potentialMatches = [];
        let currentCardIndex = 0;
        let userPoints = 0;
        let streakCount = 0;
        let isDarkMode = false;
        let lastSwipedUser = null;
        let discoveryFilters = {
            minAge: 18,
            maxAge: 35,
            maxDistance: 25,
            showMe: 'everyone',
            onlineOnly: false,
            verifiedOnly: false
        };
        let isProfileBoosted = false;
        let boostEndTime = null;

        // Users will be loaded from Firebase database
        let allUsers = [];

        // Authentication
        document.getElementById('googleLoginBtn').addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    currentUser = result.user;
                    checkUserProfile();
                })
                .catch((error) => {
                    console.error('Login error:', error);
                    alert('Login failed. Please try again.');
                });
        });

        // Check if user has completed profile
        function checkUserProfile() {
            if (currentUser) {
                database.ref(`users/${currentUser.uid}`).once('value')
                    .then((snapshot) => {
                        if (snapshot.exists()) {
                            const profile = snapshot.val();
                            // Check if profile is complete (all required fields)
                            if (isProfileComplete(profile)) {
                                currentUserProfile = profile;
                                // Set user as online
                                database.ref(`users/${currentUser.uid}/online`).set(true);
                                database.ref(`users/${currentUser.uid}/lastSeen`).set(Date.now());
                                showMainApp();
                            } else {
                                showProfileSetup();
                            }
                        } else {
                            showProfileSetup();
                        }
                    });
            }
        }

        // Check if profile has all required information
        function isProfileComplete(profile) {
            const requiredFields = ['name', 'age', 'gender', 'interestedIn', 'location', 'bio', 'photos'];
            
            for (let field of requiredFields) {
                if (!profile[field]) return false;
                if (field === 'photos' && (!Array.isArray(profile[field]) || profile[field].length === 0)) return false;
                if (field === 'name' && profile[field].trim().length < 2) return false;
                if (field === 'bio' && profile[field].trim().length < 10) return false;
                if (field === 'age' && (profile[field] < 18 || profile[field] > 100)) return false;
            }
            
            return true;
        }

        // Photo upload handler
        function handlePhotoUpload(input, index) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoDiv = document.getElementById(`photoUpload${index}`);
                    photoDiv.innerHTML = `
                        <div class="relative w-full h-full">
                            <img src="${e.target.result}" class="w-full h-full object-cover rounded-xl">
                            <button type="button" onclick="removePhoto(${index})" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-red-600">√ó</button>
                        </div>
                    `;
                    photoDiv.dataset.photo = e.target.result;
                    updateProfileProgress();
                };
                reader.readAsDataURL(file);
            }
        }

        // Remove photo
        function removePhoto(index) {
            const photoDiv = document.getElementById(`photoUpload${index}`);
            photoDiv.innerHTML = `
                <div class="text-center">
                    <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                        <span class="text-white text-xl">+</span>
                    </div>
                    <span class="text-white text-sm">${index === 1 ? 'Main Photo *' : `Photo ${index}`}</span>
                </div>
                <input type="file" class="hidden" accept="image/*" onchange="handlePhotoUpload(this, ${index})">
            `;
            delete photoDiv.dataset.photo;
            
            // Re-add click listener
            photoDiv.addEventListener('click', () => {
                photoDiv.querySelector('input[type="file"]').click();
            });
            
            updateProfileProgress();
        }

        // Update profile completion progress
        function updateProfileProgress() {
            const fields = {
                photos: 0,
                name: document.getElementById('userName')?.value?.trim() || '',
                age: document.getElementById('userAge')?.value || '',
                gender: document.getElementById('userGender')?.value || '',
                interestedIn: document.getElementById('interestedIn')?.value || '',
                location: document.getElementById('userLocation')?.value?.trim() || '',
                bio: document.getElementById('userBio')?.value?.trim() || '',
                interests: document.querySelectorAll('input[type="checkbox"]:checked').length
            };

            // Count photos
            for (let i = 1; i <= 6; i++) {
                const photoDiv = document.getElementById(`photoUpload${i}`);
                if (photoDiv?.dataset.photo) {
                    fields.photos++;
                }
            }

            let completedFields = 0;
            const totalFields = 8; // 7 required fields + interests

            if (fields.photos > 0) completedFields++;
            if (fields.name.length >= 2) completedFields++;
            if (fields.age >= 18 && fields.age <= 100) completedFields++;
            if (fields.gender) completedFields++;
            if (fields.interestedIn) completedFields++;
            if (fields.location.length >= 3) completedFields++;
            if (fields.bio.length >= 10) completedFields++;
            if (fields.interests > 0) completedFields++;

            const progress = Math.round((completedFields / totalFields) * 100);
            
            const progressBar = document.getElementById('profileProgress');
            const progressText = document.getElementById('progressText');
            
            if (progressBar) progressBar.style.width = progress + '%';
            if (progressText) progressText.textContent = progress + '%';
        }

        // Make photo upload divs clickable
        function initializePhotoUploads() {
            for (let i = 1; i <= 6; i++) {
                const div = document.getElementById(`photoUpload${i}`);
                if (div) {
                    div.addEventListener('click', () => {
                        div.querySelector('input[type="file"]').click();
                    });
                }
            }
        }

        // Initialize photo uploads when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            initializePhotoUploads();
            
            // Add event listeners for real-time progress tracking
            const formFields = ['userName', 'userAge', 'userGender', 'interestedIn', 'userLocation', 'userBio'];
            formFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', updateProfileProgress);
                    field.addEventListener('change', updateProfileProgress);
                }
            });
            
            // Add listeners for checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateProfileProgress);
            });
            
            // Initial progress update
            updateProfileProgress();
        });

        // Profile form submission
        document.getElementById('profileForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Validate photos
            const photos = [];
            for (let i = 1; i <= 6; i++) {
                const photoDiv = document.getElementById(`photoUpload${i}`);
                if (photoDiv && photoDiv.dataset.photo) {
                    photos.push(photoDiv.dataset.photo);
                }
            }

            if (photos.length === 0) {
                alert('‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à! (At least one photo is required!)');
                return;
            }

            // Validate required fields
            const name = document.getElementById('userName').value.trim();
            const age = parseInt(document.getElementById('userAge').value);
            const gender = document.getElementById('userGender').value;
            const interestedIn = document.getElementById('interestedIn').value;
            const location = document.getElementById('userLocation').value.trim();
            const bio = document.getElementById('userBio').value.trim();

            if (name.length < 2) {
                alert('‡§®‡§æ‡§Æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 2 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è! (Name must be at least 2 characters!)');
                return;
            }

            if (age < 18 || age > 100) {
                alert('‡§â‡§Æ‡•ç‡§∞ 18 ‡§∏‡•á 100 ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è! (Age must be between 18-100!)');
                return;
            }

            if (!gender) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§≤‡§ø‡§Ç‡§ó ‡§ö‡•Å‡§®‡•á‡§Ç! (Please select your gender!)');
                return;
            }

            if (!interestedIn) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡§§‡§æ‡§è‡§Ç ‡§Ü‡§™ ‡§ï‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§∞‡•Å‡§ö‡§ø ‡§∞‡§ñ‡§§‡•á ‡§π‡•à‡§Ç! (Please select your preference!)');
                return;
            }

            if (location.length < 3) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§∂‡§π‡§∞/‡§∏‡•ç‡§•‡§æ‡§® ‡§¨‡§§‡§æ‡§è‡§Ç! (Please enter your city/location!)');
                return;
            }

            if (bio.length < 10) {
                alert('‡§Ö‡§™‡§®‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 10 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§≤‡§ø‡§ñ‡•á‡§Ç! (Write at least 10 characters about yourself!)');
                return;
            }

            const interests = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                interests.push(checkbox.value);
            });

            if (interests.length === 0) {
                alert('‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§∞‡•Å‡§ö‡§ø ‡§ö‡•Å‡§®‡§®‡§æ ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à! (Please select at least one interest!)');
                return;
            }

            const profileData = {
                name: name,
                age: age,
                gender: gender,
                interestedIn: interestedIn,
                location: location,
                bio: bio,
                occupation: document.getElementById('userOccupation').value.trim(),
                height: document.getElementById('userHeight').value.trim(),
                interests: interests,
                photos: photos,
                createdAt: Date.now(),
                online: true,
                verified: false,
                premium: false,
                points: 100, // Starting points
                streak: 0,
                profileComplete: true,
                lastSeen: Date.now()
            };

            // Show loading
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = '‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à... (Saving Profile...)';
            submitBtn.disabled = true;

            database.ref(`users/${currentUser.uid}`).set(profileData)
                .then(() => {
                    currentUserProfile = profileData;
                    alert('‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§® ‡§ó‡§à! ‡§Ö‡§¨ ‡§Ü‡§™ ‡§Æ‡•à‡§ö‡§ø‡§Ç‡§ó ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ (Profile created successfully! You can now start matching.)');
                    showMainApp();
                })
                .catch((error) => {
                    console.error('Profile save error:', error);
                    alert('‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•Å‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç‡•§ (Failed to save profile. Please try again.)');
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                });
        });

        // Show different screens
        function showProfileSetup() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('profileSetupScreen').classList.remove('hidden');
            document.getElementById('mainAppScreen').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('profileSetupScreen').classList.add('hidden');
            document.getElementById('mainAppScreen').classList.remove('hidden');
            
            // Show user info in nav
            document.getElementById('profileBtn').classList.remove('hidden');
            document.getElementById('logoutBtn').classList.remove('hidden');
            document.getElementById('userPoints').classList.remove('hidden');
            document.getElementById('streakCounter').classList.remove('hidden');
            
            // Update points and streak
            userPoints = currentUserProfile.points || 0;
            streakCount = currentUserProfile.streak || 0;
            document.getElementById('pointsCount').textContent = userPoints;
            document.getElementById('streakCount').textContent = streakCount;
            
            loadPotentialMatches();
            showDiscoverSection();
        }

        // Load potential matches
        function loadPotentialMatches() {
            // Load users from Firebase
            database.ref('users').once('value')
                .then((snapshot) => {
                    allUsers = [];
                    snapshot.forEach((childSnapshot) => {
                        const userData = childSnapshot.val();
                        userData.id = childSnapshot.key;
                        allUsers.push(userData);
                    });
                    
                    // Filter potential matches with discovery filters
                    potentialMatches = allUsers.filter(user => {
                        if (user.id === currentUser?.uid) return false;
                        
                        // Gender preference
                        if (discoveryFilters.showMe !== 'everyone' && user.gender !== discoveryFilters.showMe) return false;
                        if (currentUserProfile.interestedIn !== 'everyone' && user.gender !== currentUserProfile.interestedIn) return false;
                        
                        // Age filter
                        if (user.age < discoveryFilters.minAge || user.age > discoveryFilters.maxAge) return false;
                        
                        // Online filter
                        if (discoveryFilters.onlineOnly && !user.online) return false;
                        
                        // Verified filter
                        if (discoveryFilters.verifiedOnly && !user.verified) return false;
                        
                        return true;
                    });
                    
                    // Add random distance for demo
                    potentialMatches.forEach(user => {
                        user.distance = Math.floor(Math.random() * discoveryFilters.maxDistance) + 1;
                        user.verified = Math.random() > 0.7; // 30% verified
                        user.premium = Math.random() > 0.8; // 20% premium
                    });
                    
                    currentCardIndex = 0;
                    displayCurrentCard();
                })
                .catch((error) => {
                    console.error('Error loading users:', error);
                    potentialMatches = [];
                    currentCardIndex = 0;
                    displayCurrentCard();
                });
        }

        // Display current card
        function displayCurrentCard() {
            const cardStack = document.getElementById('cardStack');
            cardStack.innerHTML = '';
            
            if (currentCardIndex >= potentialMatches.length) {
                cardStack.innerHTML = `
                    <div class="absolute inset-0 bg-white/10 rounded-2xl flex items-center justify-center">
                        <div class="text-center text-white">
                            <h3 class="text-2xl font-bold mb-2">No more profiles!</h3>
                            <p class="text-white/80">Check back later for new matches</p>
                        </div>
                    </div>
                `;
                return;
            }

            const user = potentialMatches[currentCardIndex];
            const card = document.createElement('div');
            card.className = 'absolute inset-0 bg-white rounded-2xl shadow-2xl card-swipe cursor-pointer';
            card.innerHTML = `
                <div class="relative h-full">
                    <img src="${user.photos[0]}" alt="${user.name}" class="w-full h-3/4 object-cover rounded-t-2xl">
                    ${user.online ? '<div class="online-indicator"></div>' : ''}
                    ${user.verified ? '<div class="absolute top-2 right-2 bg-blue-500 text-white px-2 py-1 rounded-full text-xs">‚úì Verified</div>' : ''}
                    ${user.premium ? '<div class="absolute top-2 left-2 bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-2 py-1 rounded-full text-xs">‚≠ê Premium</div>' : ''}
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-4 rounded-b-2xl">
                        <h3 class="text-xl font-bold text-white">${user.name}, ${user.age}</h3>
                        <p class="text-white/80 text-sm mb-2">üìç ${user.location} ${user.distance ? `‚Ä¢ ${user.distance}km away` : ''}</p>
                        <p class="text-white/90 text-sm mb-2">${user.bio}</p>
                        ${user.occupation ? `<p class="text-white/70 text-xs mb-2">üíº ${user.occupation}</p>` : ''}
                        ${user.socialMedia && Object.keys(user.socialMedia).length > 0 ? `
                            <div class="flex flex-wrap gap-1 mb-2">
                                ${user.socialMedia.instagram ? `<a href="${user.socialMedia.instagram}" target="_blank" rel="noopener noreferrer" class="bg-pink-500/30 text-white px-2 py-1 rounded-full text-xs hover:bg-pink-500/50 transition-colors">üì∑ IG</a>` : ''}
                                ${user.socialMedia.facebook ? `<a href="${user.socialMedia.facebook}" target="_blank" rel="noopener noreferrer" class="bg-blue-500/30 text-white px-2 py-1 rounded-full text-xs hover:bg-blue-500/50 transition-colors">üìò FB</a>` : ''}
                                ${user.socialMedia.twitter ? `<a href="${user.socialMedia.twitter}" target="_blank" rel="noopener noreferrer" class="bg-sky-500/30 text-white px-2 py-1 rounded-full text-xs hover:bg-sky-500/50 transition-colors">üê¶ TW</a>` : ''}
                                ${user.socialMedia.linkedin ? `<a href="${user.socialMedia.linkedin}" target="_blank" rel="noopener noreferrer" class="bg-blue-600/30 text-white px-2 py-1 rounded-full text-xs hover:bg-blue-600/50 transition-colors">üíº LI</a>` : ''}
                                ${user.socialMedia.youtube ? `<a href="${user.socialMedia.youtube}" target="_blank" rel="noopener noreferrer" class="bg-red-500/30 text-white px-2 py-1 rounded-full text-xs hover:bg-red-500/50 transition-colors">üì∫ YT</a>` : ''}
                                ${user.socialMedia.snapchat ? `<span class="bg-yellow-400/30 text-white px-2 py-1 rounded-full text-xs">üëª ${user.socialMedia.snapchat}</span>` : ''}
                            </div>
                        ` : ''}
                        <div class="flex flex-wrap gap-1">
                            ${user.interests.slice(0, 3).map(interest => `<span class="bg-white/20 text-white px-2 py-1 rounded-full text-xs">${interest}</span>`).join('')}
                            ${user.interests.length > 3 ? `<span class="bg-white/20 text-white px-2 py-1 rounded-full text-xs">+${user.interests.length - 3} more</span>` : ''}
                        </div>
                    </div>
                    <div class="absolute top-1/2 left-4 transform -translate-y-1/2 opacity-0 transition-opacity" id="passIndicator">
                        <div class="bg-red-500 text-white px-4 py-2 rounded-full font-bold text-lg transform -rotate-12">PASS</div>
                    </div>
                    <div class="absolute top-1/2 right-4 transform -translate-y-1/2 opacity-0 transition-opacity" id="likeIndicator">
                        <div class="bg-green-500 text-white px-4 py-2 rounded-full font-bold text-lg transform rotate-12">LIKE</div>
                    </div>
                    <div class="absolute top-1/4 left-1/2 transform -translate-x-1/2 -translate-y-1/2 opacity-0 transition-opacity" id="superLikeIndicator">
                        <div class="bg-blue-500 text-white px-4 py-2 rounded-full font-bold text-lg">SUPER LIKE</div>
                    </div>
                </div>
            `;
            
            cardStack.appendChild(card);
            
            // Add swipe functionality (Mouse and Touch)
            let startX = 0;
            let currentX = 0;
            let isDragging = false;
            
            // Mouse events
            card.addEventListener('mousedown', (e) => {
                isDragging = true;
                startX = e.clientX;
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                currentX = e.clientX - startX;
                updateCardPosition(card, currentX);
            });
            
            document.addEventListener('mouseup', () => {
                if (!isDragging) return;
                isDragging = false;
                handleSwipeEnd(card, currentX, user);
            });

            // Touch events for mobile
            card.addEventListener('touchstart', (e) => {
                isDragging = true;
                startX = e.touches[0].clientX;
                e.preventDefault();
            });
            
            card.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                currentX = e.touches[0].clientX - startX;
                updateCardPosition(card, currentX);
                e.preventDefault();
            });
            
            card.addEventListener('touchend', () => {
                if (!isDragging) return;
                isDragging = false;
                handleSwipeEnd(card, currentX, user);
            });
        }

        // Helper functions for swipe functionality
        function updateCardPosition(card, currentX) {
            card.style.transform = `translateX(${currentX}px) rotate(${currentX * 0.1}deg)`;
            
            // Show indicators based on swipe direction
            const passIndicator = card.querySelector('#passIndicator');
            const likeIndicator = card.querySelector('#likeIndicator');
            
            if (currentX < -50) {
                passIndicator.style.opacity = Math.min(Math.abs(currentX) / 100, 1);
                likeIndicator.style.opacity = 0;
            } else if (currentX > 50) {
                likeIndicator.style.opacity = Math.min(currentX / 100, 1);
                passIndicator.style.opacity = 0;
            } else {
                passIndicator.style.opacity = 0;
                likeIndicator.style.opacity = 0;
            }
        }

        function handleSwipeEnd(card, currentX, user) {
            if (Math.abs(currentX) > 100) {
                if (currentX > 0) {
                    likeUser(user);
                } else {
                    passUser(user);
                }
            } else {
                card.style.transform = '';
                // Reset indicators
                const passIndicator = card.querySelector('#passIndicator');
                const likeIndicator = card.querySelector('#likeIndicator');
                passIndicator.style.opacity = 0;
                likeIndicator.style.opacity = 0;
            }
        }

        // Swipe actions
        function likeUser(user) {
            const card = document.querySelector('.card-swipe');
            card.classList.add('swipe-right');
            lastSwipedUser = { user, action: 'like', index: currentCardIndex };
            
            setTimeout(() => {
                // Check for match (simulate)
                if (Math.random() > 0.7) { // 30% chance of match
                    showMatchPopup(user);
                    addPoints(50);
                }
                nextCard();
            }, 300);
        }

        function passUser(user) {
            const card = document.querySelector('.card-swipe');
            card.classList.add('swipe-left');
            lastSwipedUser = { user, action: 'pass', index: currentCardIndex };
            
            setTimeout(() => {
                nextCard();
            }, 300);
        }

        function superLikeUser(user) {
            const card = document.querySelector('.card-swipe');
            const superLikeIndicator = card.querySelector('#superLikeIndicator');
            superLikeIndicator.style.opacity = 1;
            
            setTimeout(() => {
                card.classList.add('swipe-right');
                lastSwipedUser = { user, action: 'superlike', index: currentCardIndex };
                
                setTimeout(() => {
                    if (Math.random() > 0.3) { // 70% chance of match for super like
                        showMatchPopup(user);
                        addPoints(100);
                    }
                    nextCard();
                }, 300);
            }, 200);
        }

        function rewindLastSwipe() {
            if (!lastSwipedUser) {
                alert('No recent swipe to undo!');
                return;
            }
            
            if (userPoints < 50) {
                alert('You need 50 points to rewind. Keep swiping to earn more points!');
                return;
            }
            
            // Deduct points
            addPoints(-50);
            
            // Go back to previous card
            currentCardIndex = lastSwipedUser.index;
            potentialMatches.splice(currentCardIndex, 0, lastSwipedUser.user);
            displayCurrentCard();
            
            lastSwipedUser = null;
            alert('Rewound your last swipe!');
        }

        function viewFullProfile(user) {
            showSection('profileViewSection');
            
            const profileContent = document.getElementById('profileViewContent');
            profileContent.innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-white">${user.name}'s Profile</h2>
                        <button onclick="showDiscoverSection()" class="text-white/80 hover:text-white">‚Üê Back</button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        ${user.photos.map(photo => `
                            <img src="${photo}" alt="${user.name}" class="w-full aspect-square object-cover rounded-2xl">
                        `).join('')}
                    </div>
                    
                    <div class="bg-white/10 rounded-2xl p-6 mb-6">
                        <h3 class="text-xl font-bold text-white mb-4">${user.name}, ${user.age}</h3>
                        <div class="space-y-3 text-white/80">
                            <p><strong>üìç Location:</strong> ${user.location}</p>
                            ${user.occupation ? `<p><strong>üíº Occupation:</strong> ${user.occupation}</p>` : ''}
                            ${user.height ? `<p><strong>üìè Height:</strong> ${user.height}</p>` : ''}
                            <p><strong>üìù About:</strong> ${user.bio}</p>
                        </div>
                    </div>
                    
                    <div class="bg-white/10 rounded-2xl p-6 mb-6">
                        <h4 class="text-lg font-semibold text-white mb-3">Interests</h4>
                        <div class="flex flex-wrap gap-2">
                            ${user.interests.map(interest => `
                                <span class="bg-pink-500/30 text-white px-3 py-1 rounded-full text-sm">${interest}</span>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="passUser(potentialMatches[currentCardIndex]); showDiscoverSection();" class="flex-1 bg-red-500/80 hover:bg-red-600/80 text-white py-3 rounded-full transition-colors font-semibold">
                            Pass
                        </button>
                        <button onclick="superLikeUser(potentialMatches[currentCardIndex]); showDiscoverSection();" class="flex-1 bg-blue-500/80 hover:bg-blue-600/80 text-white py-3 rounded-full transition-colors font-semibold">
                            Super Like
                        </button>
                        <button onclick="likeUser(potentialMatches[currentCardIndex]); showDiscoverSection();" class="flex-1 bg-green-500/80 hover:bg-green-600/80 text-white py-3 rounded-full transition-colors font-semibold">
                            Like
                        </button>
                    </div>
                </div>
            `;
        }

        function nextCard() {
            currentCardIndex++;
            displayCurrentCard();
        }

        // Button actions - Desktop
        document.getElementById('passBtn').addEventListener('click', () => {
            if (currentCardIndex < potentialMatches.length) {
                passUser(potentialMatches[currentCardIndex]);
            }
        });

        document.getElementById('likeBtn').addEventListener('click', () => {
            if (currentCardIndex < potentialMatches.length) {
                likeUser(potentialMatches[currentCardIndex]);
            }
        });

        document.getElementById('superLikeBtn').addEventListener('click', () => {
            if (currentCardIndex < potentialMatches.length) {
                superLikeUser(potentialMatches[currentCardIndex]);
            }
        });

        document.getElementById('rewindCardBtn').addEventListener('click', () => {
            rewindLastSwipe();
        });

        document.getElementById('boostCardBtn').addEventListener('click', () => {
            showBoostSection();
        });

        // Button actions - Mobile
        document.getElementById('mobilePassBtn').addEventListener('click', () => {
            if (currentCardIndex < potentialMatches.length) {
                passUser(potentialMatches[currentCardIndex]);
            }
        });

        document.getElementById('mobileLikeBtn').addEventListener('click', () => {
            if (currentCardIndex < potentialMatches.length) {
                likeUser(potentialMatches[currentCardIndex]);
            }
        });

        document.getElementById('mobileSuperLikeBtn').addEventListener('click', () => {
            if (currentCardIndex < potentialMatches.length) {
                superLikeUser(potentialMatches[currentCardIndex]);
            }
        });

        document.getElementById('viewProfileBtn').addEventListener('click', () => {
            if (currentCardIndex < potentialMatches.length) {
                viewFullProfile(potentialMatches[currentCardIndex]);
            }
        });

        // Match popup
        function showMatchPopup(user) {
            document.getElementById('matchPopup').classList.remove('hidden');
            document.getElementById('matchUser1Photo').src = currentUserProfile.photos[0];
            document.getElementById('matchUser2Photo').src = user.photos[0];
            document.getElementById('matchUserName').textContent = user.name;
        }

        document.getElementById('keepSwipingBtn').addEventListener('click', () => {
            document.getElementById('matchPopup').classList.add('hidden');
        });

        document.getElementById('sendMessageFromMatch').addEventListener('click', () => {
            document.getElementById('matchPopup').classList.add('hidden');
            showChatSection();
        });

        // Points system
        function addPoints(points) {
            userPoints += points;
            document.getElementById('pointsCount').textContent = userPoints;
            
            // Update in database
            if (currentUser) {
                database.ref(`users/${currentUser.uid}/points`).set(userPoints);
            }
        }

        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('[id$="Section"]').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update tab styles
            document.querySelectorAll('[id$="Tab"]').forEach(tab => {
                tab.className = 'w-full bg-white/20 text-white py-3 px-4 rounded-xl font-semibold hover:bg-white/30 transition-colors';
            });
            
            const activeTab = sectionId.replace('Section', 'Tab');
            if (document.getElementById(activeTab)) {
                document.getElementById(activeTab).className = 'w-full bg-gradient-to-r from-pink-500 to-red-500 text-white py-3 px-4 rounded-xl font-semibold transition-colors';
            }
        }

        function showDiscoverSection() {
            showSection('discoverSection');
        }

        function showMatchesSection() {
            showSection('matchesSection');
            loadMatches();
        }

        function showChatSection() {
            showSection('chatSection');
            loadChats();
        }

        function showLikesSection() {
            showSection('likesSection');
            loadLikes();
        }

        function showBoostSection() {
            showSection('boostSection');
        }

        function showPremiumSection() {
            showSection('premiumSection');
        }

        // Tab event listeners - Desktop
        document.getElementById('discoverTab').addEventListener('click', showDiscoverSection);
        document.getElementById('matchesTab').addEventListener('click', showMatchesSection);
        document.getElementById('chatTab').addEventListener('click', showChatSection);
        document.getElementById('likesTab').addEventListener('click', showLikesSection);
        document.getElementById('premiumTab').addEventListener('click', (e) => {
            e.preventDefault();
            alert('Premium features coming soon! Stay tuned for updates.');
        });
        document.getElementById('boostTab').addEventListener('click', showBoostSection);
        document.getElementById('rewindTab').addEventListener('click', () => {
            rewindLastSwipe();
        });

        // Tab event listeners - Mobile
        document.getElementById('mobileDiscoverTab').addEventListener('click', () => {
            showDiscoverSection();
            updateMobileNavigation('mobileDiscoverTab');
        });
        document.getElementById('mobileMatchesTab').addEventListener('click', () => {
            showMatchesSection();
            updateMobileNavigation('mobileMatchesTab');
        });
        document.getElementById('mobileChatTab').addEventListener('click', () => {
            showChatSection();
            updateMobileNavigation('mobileChatTab');
        });
        document.getElementById('mobileLikesTab').addEventListener('click', () => {
            showLikesSection();
            updateMobileNavigation('mobileLikesTab');
        });
        document.getElementById('mobileBoostTab').addEventListener('click', () => {
            showBoostSection();
            updateMobileNavigation('mobileBoostTab');
        });

        // Update mobile navigation active state
        function updateMobileNavigation(activeTabId) {
            document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(activeTabId).classList.add('active');
        }

        // Filters functionality
        document.getElementById('filtersBtn').addEventListener('click', () => {
            document.getElementById('filtersModal').classList.remove('hidden');
        });

        document.getElementById('closeFiltersBtn').addEventListener('click', () => {
            document.getElementById('filtersModal').classList.add('hidden');
        });

        // Filter sliders
        document.getElementById('minAgeSlider').addEventListener('input', (e) => {
            document.getElementById('minAgeValue').textContent = e.target.value;
        });

        document.getElementById('maxAgeSlider').addEventListener('input', (e) => {
            document.getElementById('maxAgeValue').textContent = e.target.value;
        });

        document.getElementById('distanceSlider').addEventListener('input', (e) => {
            document.getElementById('distanceValue').textContent = e.target.value + ' km';
        });

        document.getElementById('resetFiltersBtn').addEventListener('click', () => {
            document.getElementById('minAgeSlider').value = 18;
            document.getElementById('maxAgeSlider').value = 35;
            document.getElementById('distanceSlider').value = 25;
            document.getElementById('showMeFilter').value = 'everyone';
            document.getElementById('onlineOnlyFilter').checked = false;
            document.getElementById('verifiedOnlyFilter').checked = false;
            
            document.getElementById('minAgeValue').textContent = '18';
            document.getElementById('maxAgeValue').textContent = '35';
            document.getElementById('distanceValue').textContent = '25 km';
        });

        document.getElementById('applyFiltersBtn').addEventListener('click', () => {
            discoveryFilters = {
                minAge: parseInt(document.getElementById('minAgeSlider').value),
                maxAge: parseInt(document.getElementById('maxAgeSlider').value),
                maxDistance: parseInt(document.getElementById('distanceSlider').value),
                showMe: document.getElementById('showMeFilter').value,
                onlineOnly: document.getElementById('onlineOnlyFilter').checked,
                verifiedOnly: document.getElementById('verifiedOnlyFilter').checked
            };
            
            document.getElementById('filtersModal').classList.add('hidden');
            loadPotentialMatches(); // Reload with new filters
            alert('Filters applied! Finding new matches...');
        });

        // Boost functionality
        document.getElementById('buyBoostBtn').addEventListener('click', () => {
            if (userPoints < 500) {
                alert('You need 500 points to boost your profile! Keep swiping to earn more points.');
                return;
            }
            
            addPoints(-500);
            isProfileBoosted = true;
            boostEndTime = Date.now() + (30 * 60 * 1000); // 30 minutes
            
            alert('Profile boosted for 30 minutes! You\'ll get 10x more visibility.');
            showDiscoverSection();
            
            // Auto-disable boost after 30 minutes
            setTimeout(() => {
                isProfileBoosted = false;
                boostEndTime = null;
                alert('Your boost has ended. You can boost again anytime!');
            }, 30 * 60 * 1000);
        });

        // Load matches
        function loadMatches() {
            const matchesList = document.getElementById('matchesList');
            
            // Load matches from Firebase
            database.ref(`matches/${currentUser.uid}`).once('value')
                .then((snapshot) => {
                    const matches = [];
                    snapshot.forEach((childSnapshot) => {
                        const matchData = childSnapshot.val();
                        matches.push(matchData);
                    });
                    
                    if (matches.length === 0) {
                        matchesList.innerHTML = `
                            <div class="col-span-full text-center py-12">
                                <h3 class="text-white text-xl font-semibold mb-2">No matches yet</h3>
                                <p class="text-white/60">Start swiping to find your perfect match!</p>
                            </div>
                        `;
                    } else {
                        matchesList.innerHTML = matches.map(match => `
                            <div class="bg-white/10 rounded-2xl p-4 text-center cursor-pointer hover:bg-white/20 transition-colors" onclick="openChat('${match.id}')">
                                <div class="relative mb-3">
                                    <img src="${match.photos[0]}" alt="${match.name}" class="w-full aspect-square object-cover rounded-xl">
                                    ${match.online ? '<div class="online-indicator"></div>' : ''}
                                </div>
                                <h3 class="text-white font-semibold">${match.name}</h3>
                                <p class="text-white/60 text-sm">${match.age} ‚Ä¢ ${match.location}</p>
                            </div>
                        `).join('');
                    }
                    
                    document.getElementById('matchCount').textContent = matches.length;
                })
                .catch((error) => {
                    console.error('Error loading matches:', error);
                    matchesList.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <h3 class="text-white text-xl font-semibold mb-2">No matches yet</h3>
                            <p class="text-white/60">Start swiping to find your perfect match!</p>
                        </div>
                    `;
                    document.getElementById('matchCount').textContent = '0';
                });
        }

        // Load chats
        function loadChats() {
            const chatList = document.getElementById('chatList');
            
            // Load chats from Firebase
            database.ref(`chats/${currentUser.uid}`).once('value')
                .then((snapshot) => {
                    const chats = [];
                    snapshot.forEach((childSnapshot) => {
                        const chatData = childSnapshot.val();
                        chats.push(chatData);
                    });
                    
                    if (chats.length === 0) {
                        chatList.innerHTML = `
                            <h2 class="text-2xl font-bold text-white mb-6">Messages</h2>
                            <div class="text-center py-12">
                                <h3 class="text-white text-xl font-semibold mb-2">No conversations yet</h3>
                                <p class="text-white/60">Start matching to begin conversations!</p>
                            </div>
                        `;
                    } else {
                        chatList.innerHTML = `
                            <h2 class="text-2xl font-bold text-white mb-6">Messages</h2>
                            ${chats.map(chat => `
                                <div class="bg-white/10 rounded-2xl p-4 cursor-pointer hover:bg-white/20 transition-colors" onclick="openChat('${chat.id}')">
                                    <div class="flex items-center space-x-3">
                                        <div class="relative">
                                            <img src="${chat.photos[0]}" alt="${chat.name}" class="w-12 h-12 rounded-full object-cover">
                                            ${chat.online ? '<div class="online-indicator"></div>' : ''}
                                        </div>
                                        <div class="flex-1">
                                            <h3 class="text-white font-semibold">${chat.name}</h3>
                                            <p class="text-white/60 text-sm">${chat.lastMessage || 'Say hello!'}</p>
                                        </div>
                                        <div class="text-white/60 text-xs">${chat.lastMessageTime || 'now'}</div>
                                    </div>
                                </div>
                            `).join('')}
                        `;
                    }
                })
                .catch((error) => {
                    console.error('Error loading chats:', error);
                    chatList.innerHTML = `
                        <h2 class="text-2xl font-bold text-white mb-6">Messages</h2>
                        <div class="text-center py-12">
                            <h3 class="text-white text-xl font-semibold mb-2">No conversations yet</h3>
                            <p class="text-white/60">Start matching to begin conversations!</p>
                        </div>
                    `;
                });
        }

        // Load likes
        function loadLikes() {
            const likesList = document.getElementById('likesList');
            
            // Show premium required message
            likesList.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-8 mb-6">
                        <h3 class="text-white text-2xl font-bold mb-2">Premium Feature</h3>
                        <p class="text-white/90 mb-4">See who likes you with Premium subscription</p>
                        <div class="text-white/80 text-sm">Coming Soon!</div>
                    </div>
                    <p class="text-white/60">This feature will be available with our premium plans</p>
                </div>
            `;
        }

        // Chat functionality
        function openChat(userId) {
            // Find user in allUsers array
            const user = allUsers.find(u => u.id === userId);
            if (!user) {
                console.error('User not found:', userId);
                return;
            }
            
            document.getElementById('chatList').classList.add('hidden');
            document.getElementById('chatWindow').classList.remove('hidden');
            
            document.getElementById('chatPartnerPhoto').src = user.photos[0];
            document.getElementById('chatPartnerName').textContent = user.name;
            
            // Load messages from Firebase
            const chatMessages = document.getElementById('chatMessages');
            const chatId = [currentUser.uid, userId].sort().join('_');
            
            database.ref(`messages/${chatId}`).once('value')
                .then((snapshot) => {
                    chatMessages.innerHTML = '';
                    
                    if (!snapshot.exists()) {
                        chatMessages.innerHTML = `
                            <div class="text-center py-8">
                                <p class="text-white/60">Start your conversation!</p>
                            </div>
                        `;
                    } else {
                        snapshot.forEach((childSnapshot) => {
                            const message = childSnapshot.val();
                            const isCurrentUser = message.senderId === currentUser.uid;
                            
                            const messageDiv = document.createElement('div');
                            messageDiv.className = `flex ${isCurrentUser ? 'justify-end' : 'justify-start'} mb-2`;
                            messageDiv.innerHTML = `
                                <div class="message-bubble ${isCurrentUser ? 'bg-gradient-to-r from-pink-500 to-red-500' : 'bg-white/20'} text-white px-4 py-2 rounded-2xl ${isCurrentUser ? 'rounded-br-md' : 'rounded-bl-md'}">
                                    ${message.text}
                                </div>
                            `;
                            chatMessages.appendChild(messageDiv);
                        });
                    }
                    
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                })
                .catch((error) => {
                    console.error('Error loading messages:', error);
                    chatMessages.innerHTML = `
                        <div class="text-center py-8">
                            <p class="text-white/60">Start your conversation!</p>
                        </div>
                    `;
                });
        }

        document.getElementById('backToChatList').addEventListener('click', () => {
            document.getElementById('chatWindow').classList.add('hidden');
            document.getElementById('chatList').classList.remove('hidden');
        });

        // Send message
        document.getElementById('sendMessageBtn').addEventListener('click', sendMessage);
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message) return;
            
            const chatPartnerName = document.getElementById('chatPartnerName').textContent;
            const chatPartner = allUsers.find(u => u.name === chatPartnerName);
            
            if (!chatPartner) {
                console.error('Chat partner not found');
                return;
            }
            
            const chatId = [currentUser.uid, chatPartner.id].sort().join('_');
            const messageData = {
                text: message,
                senderId: currentUser.uid,
                timestamp: Date.now()
            };
            
            // Save message to Firebase
            database.ref(`messages/${chatId}`).push(messageData)
                .then(() => {
                    // Add message to UI
                    const chatMessages = document.getElementById('chatMessages');
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'flex justify-end mb-2';
                    messageDiv.innerHTML = `
                        <div class="message-bubble bg-gradient-to-r from-pink-500 to-red-500 text-white px-4 py-2 rounded-2xl rounded-br-md">
                            ${message}
                        </div>
                    `;
                    
                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    messageInput.value = '';
                })
                .catch((error) => {
                    console.error('Error sending message:', error);
                    alert('Failed to send message. Please try again.');
                });
        }

        // Dark mode toggle
        document.getElementById('darkModeToggle').addEventListener('click', () => {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            document.getElementById('darkModeToggle').textContent = isDarkMode ? '‚òÄÔ∏è' : 'üåô';
        });

        // Profile button click
        document.getElementById('profileBtn').addEventListener('click', () => {
            showProfileEditSection();
        });

        // Show profile edit section
        function showProfileEditSection() {
            showSection('profileEditSection');
            loadCurrentProfileData();
        }

        // Load current profile data into edit form
        function loadCurrentProfileData() {
            if (!currentUserProfile) return;
            
            // Basic info
            document.getElementById('editUserName').value = currentUserProfile.name || '';
            document.getElementById('editUserAge').value = currentUserProfile.age || '';
            document.getElementById('editUserGender').value = currentUserProfile.gender || '';
            document.getElementById('editInterestedIn').value = currentUserProfile.interestedIn || '';
            document.getElementById('editUserLocation').value = currentUserProfile.location || '';
            document.getElementById('editUserBio').value = currentUserProfile.bio || '';
            document.getElementById('editUserOccupation').value = currentUserProfile.occupation || '';
            document.getElementById('editUserHeight').value = currentUserProfile.height || '';
            
            // Social media links
            document.getElementById('editInstagram').value = currentUserProfile.socialMedia?.instagram || '';
            document.getElementById('editFacebook').value = currentUserProfile.socialMedia?.facebook || '';
            document.getElementById('editTwitter').value = currentUserProfile.socialMedia?.twitter || '';
            document.getElementById('editLinkedin').value = currentUserProfile.socialMedia?.linkedin || '';
            document.getElementById('editYoutube').value = currentUserProfile.socialMedia?.youtube || '';
            document.getElementById('editSnapchat').value = currentUserProfile.socialMedia?.snapchat || '';
            
            // Load photos
            if (currentUserProfile.photos) {
                currentUserProfile.photos.forEach((photo, index) => {
                    const photoDiv = document.getElementById(`editPhotoUpload${index + 1}`);
                    if (photoDiv) {
                        photoDiv.innerHTML = `
                            <div class="relative w-full h-full">
                                <img src="${photo}" class="w-full h-full object-cover rounded-xl">
                                <button type="button" onclick="removeEditPhoto(${index + 1})" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-red-600">√ó</button>
                            </div>
                        `;
                        photoDiv.dataset.photo = photo;
                    }
                });
            }
            
            // Load interests
            if (currentUserProfile.interests) {
                document.querySelectorAll('#profileEditSection input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = currentUserProfile.interests.includes(checkbox.value);
                });
            }
        }

        // Logout with confirmation
        document.getElementById('logoutBtn').addEventListener('click', () => {
            const confirmLogout = confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç? (Are you sure you want to logout?)');
            if (confirmLogout) {
                // Set user offline before logout
                if (currentUser) {
                    database.ref(`users/${currentUser.uid}/online`).set(false);
                    database.ref(`users/${currentUser.uid}/lastSeen`).set(Date.now());
                }
                
                auth.signOut().then(() => {
                    currentUser = null;
                    currentUserProfile = null;
                    document.getElementById('loginScreen').classList.remove('hidden');
                    document.getElementById('mainAppScreen').classList.add('hidden');
                    document.getElementById('profileSetupScreen').classList.add('hidden');
                    document.getElementById('profileBtn').classList.add('hidden');
                    document.getElementById('logoutBtn').classList.add('hidden');
                    document.getElementById('userPoints').classList.add('hidden');
                    document.getElementById('streakCounter').classList.add('hidden');
                    alert('‡§Ü‡§™ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§π‡•ã ‡§ó‡§è ‡§π‡•à‡§Ç‡•§ (You have been logged out successfully.)');
                });
            }
        });

        // Keep user online and handle page visibility
        function updateUserOnlineStatus() {
            if (currentUser && currentUserProfile) {
                database.ref(`users/${currentUser.uid}/online`).set(true);
                database.ref(`users/${currentUser.uid}/lastSeen`).set(Date.now());
            }
        }

        // Update online status every 30 seconds
        setInterval(updateUserOnlineStatus, 30000);

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (currentUser && currentUserProfile) {
                if (document.hidden) {
                    // User switched tabs or minimized
                    database.ref(`users/${currentUser.uid}/online`).set(false);
                    database.ref(`users/${currentUser.uid}/lastSeen`).set(Date.now());
                } else {
                    // User came back
                    database.ref(`users/${currentUser.uid}/online`).set(true);
                    database.ref(`users/${currentUser.uid}/lastSeen`).set(Date.now());
                }
            }
        });

        // Handle page unload (browser close/refresh)
        window.addEventListener('beforeunload', () => {
            if (currentUser && currentUserProfile) {
                database.ref(`users/${currentUser.uid}/online`).set(false);
                database.ref(`users/${currentUser.uid}/lastSeen`).set(Date.now());
            }
        });

        // Auth state observer with persistent login
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                // Enable persistence
                auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
                    .then(() => {
                        checkUserProfile();
                    })
                    .catch((error) => {
                        console.error('Persistence error:', error);
                        checkUserProfile();
                    });
            } else {
                currentUser = null;
                currentUserProfile = null;
                // Show login screen only if not already shown
                if (!document.getElementById('loginScreen').classList.contains('hidden')) {
                    return;
                }
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainAppScreen').classList.add('hidden');
                document.getElementById('profileSetupScreen').classList.add('hidden');
            }
        });

        // Edit photo upload handler
        function handleEditPhotoUpload(input, index) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoDiv = document.getElementById(`editPhotoUpload${index}`);
                    photoDiv.innerHTML = `
                        <div class="relative w-full h-full">
                            <img src="${e.target.result}" class="w-full h-full object-cover rounded-xl">
                            <button type="button" onclick="removeEditPhoto(${index})" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-red-600">√ó</button>
                        </div>
                    `;
                    photoDiv.dataset.photo = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        // Remove edit photo
        function removeEditPhoto(index) {
            const photoDiv = document.getElementById(`editPhotoUpload${index}`);
            photoDiv.innerHTML = `
                <div class="text-center">
                    <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                        <span class="text-white text-xl">+</span>
                    </div>
                    <span class="text-white text-sm">${index === 1 ? 'Main Photo' : `Photo ${index}`}</span>
                </div>
                <input type="file" class="hidden" accept="image/*" onchange="handleEditPhotoUpload(this, ${index})">
            `;
            delete photoDiv.dataset.photo;
            
            // Re-add click listener
            photoDiv.addEventListener('click', () => {
                photoDiv.querySelector('input[type="file"]').click();
            });
        }

        // Initialize edit photo uploads
        function initializeEditPhotoUploads() {
            for (let i = 1; i <= 6; i++) {
                const div = document.getElementById(`editPhotoUpload${i}`);
                if (div) {
                    div.addEventListener('click', () => {
                        div.querySelector('input[type="file"]').click();
                    });
                }
            }
        }

        // Profile edit form submission
        document.addEventListener('DOMContentLoaded', () => {
            const profileEditForm = document.getElementById('profileEditForm');
            if (profileEditForm) {
                profileEditForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    // Collect photos
                    const photos = [];
                    for (let i = 1; i <= 6; i++) {
                        const photoDiv = document.getElementById(`editPhotoUpload${i}`);
                        if (photoDiv && photoDiv.dataset.photo) {
                            photos.push(photoDiv.dataset.photo);
                        }
                    }

                    if (photos.length === 0) {
                        alert('‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§´‡•ã‡§ü‡•ã ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à! (At least one photo is required!)');
                        return;
                    }

                    // Validate required fields
                    const name = document.getElementById('editUserName').value.trim();
                    const age = parseInt(document.getElementById('editUserAge').value);
                    const gender = document.getElementById('editUserGender').value;
                    const interestedIn = document.getElementById('editInterestedIn').value;
                    const location = document.getElementById('editUserLocation').value.trim();
                    const bio = document.getElementById('editUserBio').value.trim();

                    if (name.length < 2) {
                        alert('‡§®‡§æ‡§Æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 2 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è! (Name must be at least 2 characters!)');
                        return;
                    }

                    if (age < 18 || age > 100) {
                        alert('‡§â‡§Æ‡•ç‡§∞ 18 ‡§∏‡•á 100 ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è! (Age must be between 18-100!)');
                        return;
                    }

                    if (!gender || !interestedIn) {
                        alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç! (Please fill all required fields!)');
                        return;
                    }

                    if (location.length < 3) {
                        alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§∂‡§π‡§∞/‡§∏‡•ç‡§•‡§æ‡§® ‡§¨‡§§‡§æ‡§è‡§Ç! (Please enter your city/location!)');
                        return;
                    }

                    if (bio.length < 10) {
                        alert('‡§Ö‡§™‡§®‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 10 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§≤‡§ø‡§ñ‡•á‡§Ç! (Write at least 10 characters about yourself!)');
                        return;
                    }

                    // Collect interests
                    const interests = [];
                    document.querySelectorAll('#profileEditSection input[type="checkbox"]:checked').forEach(checkbox => {
                        interests.push(checkbox.value);
                    });

                    // Collect social media links
                    const socialMedia = {
                        instagram: document.getElementById('editInstagram').value.trim(),
                        facebook: document.getElementById('editFacebook').value.trim(),
                        twitter: document.getElementById('editTwitter').value.trim(),
                        linkedin: document.getElementById('editLinkedin').value.trim(),
                        youtube: document.getElementById('editYoutube').value.trim(),
                        snapchat: document.getElementById('editSnapchat').value.trim()
                    };

                    // Remove empty social media links
                    Object.keys(socialMedia).forEach(key => {
                        if (!socialMedia[key]) {
                            delete socialMedia[key];
                        }
                    });

                    const updatedProfileData = {
                        ...currentUserProfile,
                        name: name,
                        age: age,
                        gender: gender,
                        interestedIn: interestedIn,
                        location: location,
                        bio: bio,
                        occupation: document.getElementById('editUserOccupation').value.trim(),
                        height: document.getElementById('editUserHeight').value.trim(),
                        interests: interests,
                        photos: photos,
                        socialMedia: socialMedia,
                        lastUpdated: Date.now()
                    };

                    // Show loading
                    const submitBtn = e.target.querySelector('button[type="submit"]');
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = '‡§∏‡•á‡§µ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à... (Saving...)';
                    submitBtn.disabled = true;

                    // Update profile in Firebase
                    database.ref(`users/${currentUser.uid}`).update(updatedProfileData)
                        .then(() => {
                            currentUserProfile = updatedProfileData;
                            alert('‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§à! (Profile updated successfully!)');
                            showDiscoverSection();
                            loadPotentialMatches(); // Reload matches with updated profile
                        })
                        .catch((error) => {
                            console.error('Profile update error:', error);
                            alert('‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•Å‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç‡•§ (Failed to update profile. Please try again.)');
                        })
                        .finally(() => {
                            submitBtn.textContent = originalText;
                            submitBtn.disabled = false;
                        });
                });
            }
            
            // Initialize edit photo uploads
            initializeEditPhotoUploads();
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user is already logged in
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    checkUserProfile();
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98d7f8d5d7a38adf',t:'MTc2MDI4NjUyNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
