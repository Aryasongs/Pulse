<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
  <title>Pixplay - Discover Amazing Images</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f7f7f7;
            color: #333;
        }

        .header {
            background: white;
            padding: 12px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            margin: 0 20px;
        }

        .search-box {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input {
            width: 100%;
            padding: 12px 50px 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 24px;
            font-size: 16px;
            outline: none;
            transition: all 0.2s;
            background: #f8f9fa;
        }

        .search-input:focus {
            border-color: #e60023;
            background: white;
            box-shadow: 0 0 0 3px rgba(230, 0, 35, 0.1);
        }

        .search-btn {
            position: absolute;
            right: 8px;
            background: #e60023;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s;
        }

        .search-btn:hover {
            background: #d50020;
            transform: scale(1.05);
        }

        .logo {
            font-size: 32px;
            font-weight: bold;
            color: #e60023;
            text-decoration: none;
        }

        .nav-center {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .nav-btn.home {
            background: #111;
            color: white;
        }

        .nav-btn.create {
            background: #e60023;
            color: white;
        }

        .nav-btn.about {
            background: #6c5ce7;
            color: white;
        }

        .nav-btn:hover {
            transform: scale(1.05);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: white;
            min-width: 200px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-radius: 8px;
            z-index: 1000;
            overflow: hidden;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown-item {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background-color: #f5f5f5;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
        }

        .login-btn {
            background: #e60023;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .login-btn:hover {
            background: #d50020;
        }

        .hero {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .hero h1 {
            font-size: 48px;
            margin: 0 0 16px 0;
            font-weight: 700;
        }

        .hero p {
            font-size: 20px;
            margin: 0;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .masonry-grid {
            columns: 5;
            column-gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 1200px) {
            .masonry-grid { columns: 4; }
        }

        @media (max-width: 900px) {
            .masonry-grid { columns: 3; }
        }

        @media (max-width: 600px) {
            .masonry-grid { columns: 2; }
        }

        .pix-card {
            break-inside: avoid;
            margin-bottom: 20px;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .pix-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .pix-image {
            width: 100%;
            height: auto;
            display: block;
            transition: filter 0.3s;
        }

        .pix-image.blurred {
            filter: blur(20px);
        }

        .pix-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .pix-overlay.active {
            display: flex;
        }

        .view-btn {
            background: #e60023;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pix-actions {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .pix-card:hover .pix-actions {
            opacity: 1;
        }

        .action-btn {
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .action-btn:hover {
            background: rgba(0,0,0,0.9);
        }

        .pix-info {
            padding: 16px;
        }

        .pix-title {
            font-weight: 600;
            font-size: 16px;
            margin: 0 0 8px 0;
            color: #333;
        }

        .pix-description {
            font-size: 14px;
            color: #666;
            margin: 0;
            line-height: 1.4;
        }

        .pix-user {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
        }

        .pix-user-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .pix-user-name {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #e60023;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: block;
            padding: 40px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-label:hover {
            border-color: #e60023;
            background: #fef7f7;
        }

        .file-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 12px;
        }

        .publish-btn {
            background: #e60023;
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 24px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s;
        }

        .publish-btn:hover {
            background: #d50020;
        }

        .publish-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e60023;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state h3 {
            font-size: 24px;
            margin: 0 0 12px 0;
        }

        .empty-state p {
            font-size: 16px;
            margin: 0;
        }

        .page-content {
            display: none;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .page-content.active {
            display: block;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin: 0 0 24px 0;
            color: #333;
        }

        .settings-section {
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid #eee;
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 16px 0;
            color: #333;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info h4 {
            margin: 0 0 4px 0;
            font-weight: 600;
            color: #333;
        }

        .setting-info p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #e60023;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(26px);
        }

        .founder-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            text-align: center;
        }

        .founder-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .founder-name {
            font-size: 18px;
            font-weight: 600;
            margin: 0 0 4px 0;
            color: #333;
        }

        .founder-role {
            color: #666;
            font-size: 14px;
            margin: 0;
        }

        .back-btn {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .report-modal .modal-content {
            max-width: 400px;
        }

        .report-reasons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }

        .report-reason {
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .report-reason:hover {
            border-color: #e60023;
            background: #fef7f7;
        }

        .report-reason.selected {
            border-color: #e60023;
            background: #fef7f7;
        }

        .creation-type-selector {
            text-align: center;
            padding: 20px 0;
        }

        .creation-type-selector h3 {
            margin: 0 0 24px 0;
            color: #333;
            font-size: 20px;
        }

        .creation-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .creation-option {
            background: white;
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .creation-option:hover {
            border-color: #e60023;
            background: #fef7f7;
            transform: translateY(-2px);
        }

        .option-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .option-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
            color: #333;
        }

        .option-desc {
            font-size: 14px;
            color: #666;
        }

        .creation-section {
            margin-bottom: 20px;
        }

        .preview-btn {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.2s;
        }

        .preview-btn:hover {
            background: #5a4fcf;
        }

        .preview-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .link-preview, .product-preview {
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
            display: flex;
            gap: 12px;
            background: #f8f9fa;
        }

        .link-preview-image, .product-preview-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .link-preview-content, .product-preview-content {
            flex: 1;
        }

        .link-preview-title, .product-preview-title {
            font-weight: 600;
            font-size: 16px;
            margin: 0 0 8px 0;
            color: #333;
            line-height: 1.3;
        }

        .link-preview-desc, .product-preview-desc {
            font-size: 14px;
            color: #666;
            margin: 0 0 8px 0;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .link-preview-domain, .product-store {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            font-weight: 500;
        }

        .product-price {
            font-size: 18px;
            font-weight: 700;
            color: #e60023;
            margin: 0 0 8px 0;
        }

        .loading-preview {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .loading-preview .spinner {
            width: 24px;
            height: 24px;
            margin: 0 auto 8px;
        }

        .pix-detail-container {
            max-width: 1000px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
            align-items: start;
        }

        @media (max-width: 768px) {
            .pix-detail-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .pix-detail-image {
            width: 100%;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }

        .pix-detail-info {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .pix-detail-title {
            font-size: 28px;
            font-weight: 700;
            margin: 0 0 16px 0;
            color: #333;
        }

        .pix-detail-description {
            font-size: 16px;
            line-height: 1.6;
            color: #666;
            margin: 0 0 20px 0;
        }

        .pix-detail-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .pix-detail-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
        }

        .pix-detail-user {
            flex: 1;
        }

        .pix-detail-username {
            font-weight: 600;
            font-size: 16px;
            color: #333;
            margin: 0 0 4px 0;
        }

        .pix-detail-date {
            font-size: 14px;
            color: #999;
            margin: 0;
        }

        .pix-detail-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .detail-action-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .detail-action-btn.like {
            background: #ff4757;
            color: white;
        }

        .detail-action-btn.save {
            background: #2ed573;
            color: white;
        }

        .detail-action-btn.share {
            background: #3742fa;
            color: white;
        }

        .detail-action-btn:hover {
            transform: translateY(-2px);
        }

        .pix-detail-stats {
            display: flex;
            justify-content: space-around;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 20px;
            font-weight: 700;
            color: #333;
            margin: 0;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin: 0;
            text-transform: uppercase;
        }

        .pix-detail-tags {
            margin-bottom: 20px;
        }

        .tag-item {
            display: inline-block;
            background: #e60023;
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            margin: 0 8px 8px 0;
            text-decoration: none;
            transition: all 0.2s;
        }

        .tag-item:hover {
            background: #d50020;
            transform: translateY(-1px);
        }

        .share-url-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            display: none;
        }

        .share-url-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        .copy-btn {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 8px;
            width: 100%;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 1000;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
        }

        .bottom-nav-item {
            background: none;
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 8px;
            min-width: 60px;
        }

        .bottom-nav-item:hover {
            background: #f5f5f5;
        }

        .bottom-nav-item.active {
            background: #fef7f7;
            color: #e60023;
        }

        .nav-icon {
            font-size: 20px;
        }

        .nav-label {
            font-size: 12px;
            font-weight: 500;
        }

        .container {
            padding-bottom: 80px;
        }

        @media (min-width: 768px) {
            .bottom-nav {
                display: none;
            }
            
            .container {
                padding-bottom: 20px;
            }
        }

        .user-profile-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .profile-header {
            background: white;
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            margin-bottom: 32px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 16px;
            border: 4px solid #e60023;
            cursor: pointer;
            position: relative;
        }

        .profile-avatar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: 500;
        }

        .profile-avatar:hover .profile-avatar-overlay {
            display: flex;
        }

        .profile-name {
            font-size: 32px;
            font-weight: 700;
            margin: 0 0 8px 0;
            color: #333;
        }

        .profile-bio {
            font-size: 16px;
            color: #666;
            margin: 8px 0 16px 0;
            line-height: 1.4;
        }

        .profile-edit-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .profile-edit-btn:hover {
            background: #5a4fcf;
        }

        .follow-btn {
            background: #e60023;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            margin: 16px 8px 0 8px;
            transition: all 0.2s;
        }

        .follow-btn:hover {
            background: #d50020;
        }

        .follow-btn.following {
            background: #2ed573;
        }

        .follow-btn.following:hover {
            background: #26d065;
        }

        .monetization-badge {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin: 16px 0;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-top: 24px;
        }

        .profile-stat {
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .profile-stat:hover {
            transform: translateY(-2px);
        }

        .profile-stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #e60023;
            margin: 0;
        }

        .profile-stat-label {
            font-size: 14px;
            color: #666;
            margin: 0;
        }

        .profile-tabs {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 24px;
            background: white;
            border-radius: 12px;
            padding: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .profile-tab {
            background: none;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            color: #666;
        }

        .profile-tab.active {
            background: #e60023;
            color: white;
        }

        .profile-content {
            display: none;
        }

        .profile-content.active {
            display: block;
        }

        .ad-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .ad-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .ad-content {
            position: relative;
            z-index: 1;
        }

        .ad-title {
            font-size: 18px;
            font-weight: 700;
            margin: 0 0 8px 0;
        }

        .ad-description {
            font-size: 14px;
            opacity: 0.9;
            margin: 0 0 12px 0;
        }

        .ad-cta {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ad-cta:hover {
            background: rgba(255,255,255,0.3);
        }

        .safety-message {
            text-align: center;
            padding: 20px;
            line-height: 1.6;
        }

        .safety-message h3 {
            color: #e60023;
            margin: 0 0 16px 0;
            font-size: 24px;
        }

        .safety-message p {
            color: #666;
            margin: 0 0 16px 0;
            font-size: 16px;
        }

        .safety-message .helpline {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin: 20px 0;
            border-left: 4px solid #e60023;
        }

        .safety-message .helpline h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 18px;
        }

        .safety-message .helpline p {
            margin: 0;
            font-weight: 600;
            color: #e60023;
            font-size: 18px;
        }

        .safety-actions {
            text-align: center;
            margin-top: 20px;
        }

        .warning-message {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
            text-align: center;
        }

        .warning-message h4 {
            color: #856404;
            margin: 0 0 8px 0;
        }

        .warning-message p {
            color: #856404;
            margin: 0;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <header class="header"><a href="#" class="logo" id="siteTitle">Pixplay</a>
   <div class="search-container">
    <div class="search-box"><input type="text" id="searchInput" class="search-input" placeholder="Search for ideas, images, or inspiration..."> <button class="search-btn" id="searchBtn">üîç</button>
    </div>
   </div>
   <nav class="nav-center"><a href="#" class="nav-btn home" id="homeBtn">Home</a> <button class="nav-btn create" id="createBtn" style="display: none;">Create</button> <button class="nav-btn about" id="aboutBtn">About</button>
   </nav>
   <div class="user-section">
    <div id="userInfo" style="display: none;">
     <div class="dropdown"><img id="userAvatar" class="user-avatar" alt="User">
      <div class="dropdown-content"><a href="#" class="dropdown-item" id="settingsBtn">‚öôÔ∏è Settings</a> <a href="#" class="dropdown-item" id="privacyBtn">üîí Privacy Policy</a> <a href="#" class="dropdown-item" id="copyrightBtn">¬©Ô∏è Copyright</a> <a href="#" class="dropdown-item" id="logoutBtn">üö™ Logout</a>
      </div>
     </div>
    </div><button id="loginBtn" class="login-btn">Login with Google</button>
   </div>
  </header>
  <main class="container"><!-- Home Page -->
   <div id="homePage" class="page-content active">
    <div id="loading" class="loading">
     <div class="spinner"></div>
     <p>Loading amazing Pixs...</p>
    </div>
    <div id="emptyState" class="empty-state" style="display: none;">
     <h3>No Pixs yet!</h3>
     <p>Be the first to share something amazing. Login and create your first Pix!</p>
    </div>
    <div id="pixGrid" class="masonry-grid"></div>
   </div><!-- About Page -->
   <div id="aboutPage" class="page-content"><button class="back-btn" id="backFromAbout">‚Üê Back to Home</button>
    <h1 class="page-title">About Pixplay</h1>
    <p style="font-size: 18px; line-height: 1.6; margin-bottom: 32px; color: #666;">Pixplay is a creative platform inspired by Pinterest, where users can discover and share amazing images. Our mission is to inspire creativity and help people find their next great idea through visual discovery.</p>
    <h2 class="section-title">Meet Our Founders</h2>
    <div class="founder-card">
     <div class="founder-avatar">
      GA
     </div>
     <h3 class="founder-name">Gursharn Arya</h3>
     <p class="founder-role">Founder &amp; CEO</p>
    </div>
    <div class="founder-card">
     <div class="founder-avatar">
      AS
     </div>
     <h3 class="founder-name">Anmol Sunda</h3>
     <p class="founder-role">Co-Founder &amp; CTO</p>
    </div>
    <div class="founder-card">
     <div class="founder-avatar">
      JG
     </div>
     <h3 class="founder-name">Jashan Ganagar</h3>
     <p class="founder-role">Co-Founder &amp; CPO</p>
    </div>
   </div><!-- Settings Page -->
   <div id="settingsPage" class="page-content"><button class="back-btn" id="backFromSettings">‚Üê Back to Home</button>
    <h1 class="page-title">Settings</h1>
    <div class="settings-section">
     <h2 class="section-title">Privacy &amp; Safety</h2>
     <div class="setting-item">
      <div class="setting-info">
       <h4>Blur Sensitive Content</h4>
       <p>Automatically blur images with potentially sensitive content</p>
      </div>
      <div class="toggle-switch active" id="blurToggle">
       <div class="toggle-slider"></div>
      </div>
     </div>
     <div class="setting-item">
      <div class="setting-info">
       <h4>Safe Search</h4>
       <p>Filter out inappropriate content from search results</p>
      </div>
      <div class="toggle-switch active" id="safeSearchToggle">
       <div class="toggle-slider"></div>
      </div>
     </div>
    </div>
    <div class="settings-section">
     <h2 class="section-title">Notifications</h2>
     <div class="setting-item">
      <div class="setting-info">
       <h4>Email Notifications</h4>
       <p>Receive updates about your Pixs and followers</p>
      </div>
      <div class="toggle-switch" id="emailToggle">
       <div class="toggle-slider"></div>
      </div>
     </div>
     <div class="setting-item">
      <div class="setting-info">
       <h4>Push Notifications</h4>
       <p>Get notified about new activity on your account</p>
      </div>
      <div class="toggle-switch" id="pushToggle">
       <div class="toggle-slider"></div>
      </div>
     </div>
    </div>
    <div class="settings-section">
     <h2 class="section-title">Account</h2>
     <div class="setting-item">
      <div class="setting-info">
       <h4>Profile Visibility</h4>
       <p>Make your profile visible to other users</p>
      </div>
      <div class="toggle-switch active" id="profileToggle">
       <div class="toggle-slider"></div>
      </div>
     </div>
    </div>
   </div><!-- Privacy Policy Page -->
   <div id="privacyPage" class="page-content"><button class="back-btn" id="backFromPrivacy">‚Üê Back to Home</button>
    <h1 class="page-title">Privacy Policy</h1>
    <div style="line-height: 1.6; color: #666;">
     <h3>Information We Collect</h3>
     <p>We collect information you provide directly to us, such as when you create an account, upload images, or contact us for support.</p>
     <h3>How We Use Your Information</h3>
     <p>We use the information we collect to provide, maintain, and improve our services, process transactions, and communicate with you.</p>
     <h3>Information Sharing</h3>
     <p>We do not sell, trade, or otherwise transfer your personal information to third parties without your consent, except as described in this policy.</p>
     <h3>Data Security</h3>
     <p>We implement appropriate security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction.</p>
     <h3>Your Rights</h3>
     <p>You have the right to access, update, or delete your personal information. You can also opt out of certain communications from us.</p>
     <h3>Contact Us</h3>
     <p>If you have any questions about this Privacy Policy, please contact us at privacy@pixplay.com</p>
    </div>
   </div><!-- Copyright Page -->
   <div id="copyrightPage" class="page-content"><button class="back-btn" id="backFromCopyright">‚Üê Back to Home</button>
    <h1 class="page-title">Copyright &amp; DMCA</h1>
    <div style="line-height: 1.6; color: #666;">
     <h3>Copyright Policy</h3>
     <p>Pixplay respects the intellectual property rights of others and expects users to do the same. We will respond to clear notices of alleged copyright infringement.</p>
     <h3>DMCA Takedown Process</h3>
     <p>If you believe your copyrighted work has been used without permission, please provide us with the following information:</p>
     <ul>
      <li>A description of the copyrighted work you claim has been infringed</li>
      <li>The URL or location of the allegedly infringing material</li>
      <li>Your contact information</li>
      <li>A statement of good faith belief that the use is not authorized</li>
      <li>A statement that the information is accurate and you are authorized to act</li>
     </ul>
     <h3>Counter-Notification</h3>
     <p>If you believe your content was removed in error, you may submit a counter-notification with the required information.</p>
     <h3>Repeat Infringers</h3>
     <p>We will terminate accounts of users who are repeat infringers of copyright.</p>
     <h3>Contact for Copyright Issues</h3>
     <p>Send DMCA notices to: copyright@pixplay.com</p>
    </div>
   </div><!-- Individual Pix Detail Page -->
   <div id="pixDetailPage" class="page-content"><button class="back-btn" id="backFromPixDetail">‚Üê Back to Home</button>
    <div id="pixDetailContent" class="pix-detail-container"><!-- Content will be dynamically loaded -->
    </div>
   </div><!-- User Profile Page -->
   <div id="userProfilePage" class="page-content"><button class="back-btn" id="backFromUserProfile">‚Üê Back to Home</button>
    <div id="userProfileContent" class="user-profile-container"><!-- Content will be dynamically loaded -->
    </div>
   </div>
  </main><!-- Bottom Navigation -->
  <div class="bottom-nav"><button class="bottom-nav-item active" id="bottomHomeBtn"> <span class="nav-icon">üè†</span> <span class="nav-label">Home</span> </button> <button class="bottom-nav-item" id="bottomExploreBtn"> <span class="nav-icon">üîç</span> <span class="nav-label">Explore</span> </button> <button class="bottom-nav-item" id="bottomCreateBtn" style="display: none;"> <span class="nav-icon">‚ûï</span> <span class="nav-label">Create</span> </button> <button class="bottom-nav-item" id="bottomProfileBtn" style="display: none;"> <span class="nav-icon">üë§</span> <span class="nav-label">Profile</span> </button> <button class="bottom-nav-item" id="bottomLoginBtn"> <span class="nav-icon">üîë</span> <span class="nav-label">Login</span> </button>
  </div><!-- Create Pix Modal -->
  <div id="createModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h2 class="modal-title">Create a Pix</h2><button class="close-btn" id="closeModal">√ó</button>
    </div>
    <div class="modal-body"><!-- Creation Type Selection -->
     <div id="creationTypeSelector" class="creation-type-selector">
      <h3>How would you like to create your Pix?</h3>
      <div class="creation-options"><button type="button" class="creation-option" id="uploadOption">
        <div class="option-icon">
         üì∏
        </div>
        <div class="option-title">
         Upload Image
        </div>
        <div class="option-desc">
         Upload from your device
        </div></button> <button type="button" class="creation-option" id="linkOption">
        <div class="option-icon">
         üîó
        </div>
        <div class="option-title">
         From Link
        </div>
        <div class="option-desc">
         Create from website URL
        </div></button> <button type="button" class="creation-option" id="productOption">
        <div class="option-icon">
         üõçÔ∏è
        </div>
        <div class="option-title">
         Product
        </div>
        <div class="option-desc">
         Share a product you love
        </div></button> <button type="button" class="creation-option" id="ideaOption">
        <div class="option-icon">
         üí°
        </div>
        <div class="option-title">
         Idea
        </div>
        <div class="option-desc">
         Share an inspiration
        </div></button>
      </div>
     </div>
     <form id="pixForm" style="display: none;"><!-- Upload Image Section -->
      <div id="uploadSection" class="creation-section" style="display: none;">
       <div class="form-group"><label class="form-label">Choose Image</label> <input type="file" id="imageInput" class="file-input" accept="image/*"> <label for="imageInput" class="file-label">
         <div>
          üì∏ Click to choose an image
         </div><small>JPG, PNG, GIF up to 10MB</small> </label> <img id="imagePreview" class="file-preview" style="display: none;">
       </div>
      </div><!-- Link Preview Section -->
      <div id="linkSection" class="creation-section" style="display: none;">
       <div class="form-group"><label for="websiteUrl" class="form-label">Website URL</label> <input type="url" id="websiteUrl" class="form-input" placeholder="https://example.com"> <button type="button" id="previewBtn" class="preview-btn">Get Preview</button>
       </div>
       <div id="linkPreview" class="link-preview" style="display: none;"><img id="linkImage" class="link-preview-image" alt="Link preview">
        <div class="link-preview-content">
         <h4 id="linkTitle" class="link-preview-title"></h4>
         <p id="linkDescription" class="link-preview-desc"></p><span id="linkDomain" class="link-preview-domain"></span>
        </div>
       </div>
      </div><!-- Product Section -->
      <div id="productSection" class="creation-section" style="display: none;">
       <div class="form-group"><label for="productUrl" class="form-label">Product URL</label> <input type="url" id="productUrl" class="form-input" placeholder="https://store.com/product"> <button type="button" id="productPreviewBtn" class="preview-btn">Get Product Info</button>
       </div>
       <div id="productPreview" class="product-preview" style="display: none;"><img id="productImage" class="product-preview-image" alt="Product">
        <div class="product-preview-content">
         <h4 id="productTitle" class="product-preview-title"></h4>
         <p id="productPrice" class="product-price"></p>
         <p id="productDescription" class="product-preview-desc"></p><span id="productStore" class="product-store"></span>
        </div>
       </div>
       <div class="form-group"><label for="productCategory" class="form-label">Category</label> <select id="productCategory" class="form-input"> <option value="">Select Category</option> <option value="fashion">Fashion &amp; Style</option> <option value="home">Home &amp; Garden</option> <option value="tech">Technology</option> <option value="beauty">Beauty &amp; Health</option> <option value="food">Food &amp; Drink</option> <option value="sports">Sports &amp; Fitness</option> <option value="books">Books &amp; Education</option> <option value="art">Art &amp; Crafts</option> <option value="travel">Travel</option> <option value="other">Other</option> </select>
       </div>
      </div><!-- Idea Section -->
      <div id="ideaSection" class="creation-section" style="display: none;">
       <div class="form-group"><label for="ideaImage" class="form-label">Inspiration Image</label> <input type="file" id="ideaImage" class="file-input" accept="image/*"> <label for="ideaImage" class="file-label">
         <div>
          üí° Upload inspiration image
         </div><small>JPG, PNG, GIF up to 10MB</small> </label> <img id="ideaPreview" class="file-preview" style="display: none;">
       </div>
       <div class="form-group"><label for="ideaCategory" class="form-label">Idea Category</label> <select id="ideaCategory" class="form-input"> <option value="">Select Category</option> <option value="diy">DIY &amp; Crafts</option> <option value="recipes">Recipes</option> <option value="decor">Home Decor</option> <option value="fashion">Fashion Ideas</option> <option value="garden">Gardening</option> <option value="art">Art &amp; Design</option> <option value="photography">Photography</option> <option value="travel">Travel Ideas</option> <option value="fitness">Fitness &amp; Health</option> <option value="business">Business Ideas</option> <option value="other">Other</option> </select>
       </div>
      </div><!-- Common Fields -->
      <div id="commonFields" style="display: none;">
       <div class="form-group"><label for="pixTitle" class="form-label">Title</label> <input type="text" id="pixTitle" class="form-input" placeholder="Tell everyone what your Pix is about" maxlength="100" required> <small>0/100</small>
       </div>
       <div class="form-group"><label for="pixDescription" class="form-label">Description</label> <textarea id="pixDescription" class="form-input form-textarea" placeholder="Add a description, mention, or hashtags to your Pix." rows="3"></textarea>
       </div>
       <div class="form-group"><label for="pixTags" class="form-label">Tags (Optional)</label> <input type="text" id="pixTags" class="form-input" placeholder="Add tags separated by commas (e.g., fashion, style, summer)"> <small>Help others discover your Pix</small>
       </div>
       <div class="form-group"><label for="pixBoard" class="form-label">Board (Optional)</label> <select id="pixBoard" class="form-input"> <option value="">Select a board</option> <option value="favorites">My Favorites</option> <option value="inspiration">Inspiration</option> <option value="wishlist">Wishlist</option> <option value="ideas">Ideas to Try</option> </select>
       </div><button type="button" id="backToOptions" class="back-btn">‚Üê Back to Options</button> <button type="submit" class="publish-btn" id="publishBtn">Publish Pix</button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Safety Message Modal -->
  <div id="safetyModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h2 class="modal-title" id="safetyTitle">We're Here for You</h2><button class="close-btn" id="closeSafetyModal">√ó</button>
    </div>
    <div class="modal-body">
     <div id="safetyMessage" class="safety-message"><!-- Content will be dynamically loaded -->
     </div>
     <div class="safety-actions"><button class="publish-btn" id="continueBrowsing">Continue Browsing</button>
     </div>
    </div>
   </div>
  </div><!-- Report Modal -->
  <div id="reportModal" class="modal report-modal">
   <div class="modal-content">
    <div class="modal-header">
     <h2 class="modal-title">Report Pix</h2><button class="close-btn" id="closeReportModal">√ó</button>
    </div>
    <div class="modal-body">
     <p>Why are you reporting this Pix?</p>
     <div class="report-reasons">
      <div class="report-reason" data-reason="inappropriate"><strong>Inappropriate Content</strong>
       <p>Contains nudity, violence, or other inappropriate material</p>
      </div>
      <div class="report-reason" data-reason="copyright"><strong>Copyright Infringement</strong>
       <p>Uses copyrighted material without permission</p>
      </div>
      <div class="report-reason" data-reason="spam"><strong>Spam or Misleading</strong>
       <p>Spam, fake content, or misleading information</p>
      </div>
      <div class="report-reason" data-reason="harassment"><strong>Harassment or Bullying</strong>
       <p>Targets individuals with harassment or bullying</p>
      </div>
      <div class="report-reason" data-reason="other"><strong>Other</strong>
       <p>Something else that violates our community guidelines</p>
      </div>
     </div><button class="publish-btn" id="submitReport" disabled>Submit Report</button>
    </div>
   </div>
  </div><!-- Profile Edit Modal -->
  <div id="profileEditModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h2 class="modal-title">Edit Profile</h2><button class="close-btn" id="closeProfileEditModal">√ó</button>
    </div>
    <div class="modal-body">
     <form id="profileEditForm">
      <div class="form-group"><label class="form-label">Profile Picture</label> <input type="file" id="profilePictureInput" class="file-input" accept="image/*"> <label for="profilePictureInput" class="file-label">
        <div>
         üì∏ Change Profile Picture
        </div><small>JPG, PNG up to 2MB</small> </label> <img id="profilePicturePreview" class="file-preview" style="display: none; width: 100px; height: 100px; border-radius: 50%; object-fit: cover;">
      </div>
      <div class="form-group"><label for="profileDisplayName" class="form-label">Display Name</label> <input type="text" id="profileDisplayName" class="form-input" placeholder="Your display name" maxlength="50" required>
      </div>
      <div class="form-group"><label for="profileBio" class="form-label">Bio</label> <textarea id="profileBio" class="form-input form-textarea" placeholder="Tell people about yourself..." rows="3" maxlength="200"></textarea> <small id="bioCounter">0/200</small>
      </div>
      <div class="form-group"><label for="profileWebsite" class="form-label">Website (Optional)</label> <input type="url" id="profileWebsite" class="form-input" placeholder="https://yourwebsite.com">
      </div>
      <div class="form-group"><label for="profileLocation" class="form-label">Location (Optional)</label> <input type="text" id="profileLocation" class="form-input" placeholder="Your location" maxlength="50">
      </div><button type="submit" class="publish-btn" id="saveProfileBtn">Save Changes</button>
     </form>
    </div>
   </div>
  </div>
  <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC30TcmMVhP_8HdFYS1WufRiZwSDYNMTF0",
            authDomain: "pulse2-92372.firebaseapp.com",
            databaseURL: "https://pulse2-92372-default-rtdb.firebaseio.com",
            projectId: "pulse2-92372",
            messagingSenderId: "276235725177",
            appId: "1:276235725177:web:0f4e0789fae80a435927a8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Global variables
        let currentUser = null;
        let allPixs = [];
        let userSettings = {
            blurSensitive: true,
            safeSearch: true,
            emailNotifications: false,
            pushNotifications: false,
            profileVisible: true
        };
        let currentReportPixId = null;
        let currentCreationType = null;
        let linkPreviewData = null;
        let currentRoute = 'home';
        let userProfiles = {};
        let followingUsers = {};
        let currentProfileTab = 'pixs';

        // Sensitive content keywords
        const sensitiveKeywords = ['sex', 'nude', 'porn', 'xxx', 'adult', 'nsfw', 'sexy', 'hot', 'bikini'];
        
        // Suicide/self-harm keywords
        const suicideKeywords = ['suicide', 'kill myself', 'end my life', 'want to die', 'self harm', 'cut myself', 'depression help', 'suicidal thoughts'];
        
        // Inappropriate search keywords
        const inappropriateKeywords = ['sex', 'porn', 'xxx', 'nude', 'naked', 'adult content', 'nsfw'];

        // Default config for Element SDK
        const defaultConfig = {
            site_title: "Pixplay",
            welcome_message: "Discover and share amazing images"
        };

        // DOM Elements
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userInfo = document.getElementById('userInfo');
        const userAvatar = document.getElementById('userAvatar');
        const createBtn = document.getElementById('createBtn');
        const createModal = document.getElementById('createModal');
        const closeModal = document.getElementById('closeModal');
        const pixForm = document.getElementById('pixForm');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const pixTitle = document.getElementById('pixTitle');
        const publishBtn = document.getElementById('publishBtn');
        const pixGrid = document.getElementById('pixGrid');
        const loading = document.getElementById('loading');
        const emptyState = document.getElementById('emptyState');

        // Search elements
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');

        // Safety modal elements
        const safetyModal = document.getElementById('safetyModal');
        const closeSafetyModal = document.getElementById('closeSafetyModal');
        const continueBrowsing = document.getElementById('continueBrowsing');
        const safetyTitle = document.getElementById('safetyTitle');
        const safetyMessage = document.getElementById('safetyMessage');

        // Bottom navigation elements
        const bottomHomeBtn = document.getElementById('bottomHomeBtn');
        const bottomExploreBtn = document.getElementById('bottomExploreBtn');
        const bottomCreateBtn = document.getElementById('bottomCreateBtn');
        const bottomProfileBtn = document.getElementById('bottomProfileBtn');
        const bottomLoginBtn = document.getElementById('bottomLoginBtn');

        // Creation flow elements
        const creationTypeSelector = document.getElementById('creationTypeSelector');
        const uploadOption = document.getElementById('uploadOption');
        const linkOption = document.getElementById('linkOption');
        const productOption = document.getElementById('productOption');
        const ideaOption = document.getElementById('ideaOption');
        const backToOptions = document.getElementById('backToOptions');
        const commonFields = document.getElementById('commonFields');

        // Section elements
        const uploadSection = document.getElementById('uploadSection');
        const linkSection = document.getElementById('linkSection');
        const productSection = document.getElementById('productSection');
        const ideaSection = document.getElementById('ideaSection');

        // Link preview elements
        const websiteUrl = document.getElementById('websiteUrl');
        const previewBtn = document.getElementById('previewBtn');
        const linkPreview = document.getElementById('linkPreview');
        const linkImage = document.getElementById('linkImage');
        const linkTitle = document.getElementById('linkTitle');
        const linkDescription = document.getElementById('linkDescription');
        const linkDomain = document.getElementById('linkDomain');

        // Product elements
        const productUrl = document.getElementById('productUrl');
        const productPreviewBtn = document.getElementById('productPreviewBtn');
        const productPreview = document.getElementById('productPreview');
        const productImage = document.getElementById('productImage');
        const productTitle = document.getElementById('productTitle');
        const productPrice = document.getElementById('productPrice');
        const productDescription = document.getElementById('productDescription');
        const productStore = document.getElementById('productStore');
        const productCategory = document.getElementById('productCategory');

        // Idea elements
        const ideaImage = document.getElementById('ideaImage');
        const ideaPreview = document.getElementById('ideaPreview');
        const ideaCategory = document.getElementById('ideaCategory');

        // Navigation elements
        const homeBtn = document.getElementById('homeBtn');
        const aboutBtn = document.getElementById('aboutBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const privacyBtn = document.getElementById('privacyBtn');
        const copyrightBtn = document.getElementById('copyrightBtn');

        // Page elements
        const homePage = document.getElementById('homePage');
        const aboutPage = document.getElementById('aboutPage');
        const settingsPage = document.getElementById('settingsPage');
        const privacyPage = document.getElementById('privacyPage');
        const copyrightPage = document.getElementById('copyrightPage');

        // Back buttons
        const backFromAbout = document.getElementById('backFromAbout');
        const backFromSettings = document.getElementById('backFromSettings');
        const backFromPrivacy = document.getElementById('backFromPrivacy');
        const backFromCopyright = document.getElementById('backFromCopyright');

        // Settings toggles
        const blurToggle = document.getElementById('blurToggle');
        const safeSearchToggle = document.getElementById('safeSearchToggle');
        const emailToggle = document.getElementById('emailToggle');
        const pushToggle = document.getElementById('pushToggle');
        const profileToggle = document.getElementById('profileToggle');

        // Report modal elements
        const reportModal = document.getElementById('reportModal');
        const closeReportModal = document.getElementById('closeReportModal');
        const submitReport = document.getElementById('submitReport');

        // Profile edit modal elements
        const profileEditModal = document.getElementById('profileEditModal');
        const closeProfileEditModal = document.getElementById('closeProfileEditModal');
        const profileEditForm = document.getElementById('profileEditForm');
        const profilePictureInput = document.getElementById('profilePictureInput');
        const profilePicturePreview = document.getElementById('profilePicturePreview');
        const profileDisplayName = document.getElementById('profileDisplayName');
        const profileBio = document.getElementById('profileBio');
        const profileWebsite = document.getElementById('profileWebsite');
        const profileLocation = document.getElementById('profileLocation');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        const bioCounter = document.getElementById('bioCounter');

        // Element SDK Implementation
        const element = {
            defaultConfig,
            render: async (config) => {
                document.getElementById('siteTitle').textContent = config.site_title || defaultConfig.site_title;
                document.getElementById('welcomeMessage').textContent = config.welcome_message || defaultConfig.welcome_message;
            },
            mapToCapabilities: (config) => ({
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            }),
            mapToEditPanelValues: (config) => new Map([
                ["site_title", config.site_title || defaultConfig.site_title],
                ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
            ])
        };

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init(element);
        }

        // URL Routing System
        function initializeRouting() {
            // Handle initial load
            handleRoute();
            
            // Handle browser back/forward
            window.addEventListener('popstate', handleRoute);
            
            // Handle hash changes
            window.addEventListener('hashchange', handleRoute);
        }

        function handleRoute() {
            const hash = window.location.hash;
            
            if (hash.startsWith('#pix/')) {
                // Individual pix view: #pix/pixId
                const pixId = hash.replace('#pix/', '');
                showPixDetail(pixId);
            } else if (hash.startsWith('#user/')) {
                // User profile: #user/userId
                const userId = hash.replace('#user/', '');
                showUserProfile(userId);
            } else if (hash === '#about') {
                showPage('aboutPage');
                currentRoute = 'about';
            } else if (hash === '#settings') {
                showPage('settingsPage');
                currentRoute = 'settings';
            } else if (hash === '#privacy') {
                showPage('privacyPage');
                currentRoute = 'privacy';
            } else if (hash === '#copyright') {
                showPage('copyrightPage');
                currentRoute = 'copyright';
            } else {
                // Default home page
                showPage('homePage');
                currentRoute = 'home';
                if (window.location.hash !== '') {
                    window.history.replaceState(null, null, window.location.pathname);
                }
            }
        }

        function navigateTo(route) {
            window.location.hash = route;
        }

        // Show individual Pix detail
        async function showPixDetail(pixId) {
            showPage('pixDetailPage');
            currentRoute = 'pixDetail';
            
            const pixDetailContent = document.getElementById('pixDetailContent');
            pixDetailContent.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading Pix...</p></div>';
            
            try {
                const snapshot = await database.ref('pixs').orderByChild('id').equalTo(pixId).once('value');
                let pix = null;
                
                snapshot.forEach((childSnapshot) => {
                    pix = childSnapshot.val();
                });
                
                if (!pix) {
                    pixDetailContent.innerHTML = '<div class="empty-state"><h3>Pix not found</h3><p>This Pix may have been removed or doesn\'t exist.</p></div>';
                    return;
                }
                
                const typeIcon = {
                    'upload': 'üì∏',
                    'link': 'üîó',
                    'product': 'üõçÔ∏è',
                    'idea': 'üí°'
                };
                
                const createdDate = pix.createdAt ? new Date(pix.createdAt).toLocaleDateString() : 'Unknown date';
                const shareUrl = `${window.location.origin}${window.location.pathname}#pix/${pixId}`;
                
                pixDetailContent.innerHTML = `
                    <div class="pix-detail-image-container">
                        <img src="${pix.imageUrl}" alt="${pix.title}" class="pix-detail-image">
                    </div>
                    
                    <div class="pix-detail-info">
                        <div class="pix-detail-meta">
                            <img src="${pix.userAvatar || 'https://via.placeholder.com/48'}" alt="${pix.userName}" class="pix-detail-avatar">
                            <div class="pix-detail-user">
                                <h4 class="pix-detail-username">${pix.userName}</h4>
                                <p class="pix-detail-date">${createdDate}</p>
                            </div>
                            <span style="font-size: 24px;">${typeIcon[pix.type] || 'üì∏'}</span>
                        </div>
                        
                        <h1 class="pix-detail-title">${pix.title}</h1>
                        
                        ${pix.description ? `<p class="pix-detail-description">${pix.description}</p>` : ''}
                        
                        <div class="pix-detail-actions">
                            <button class="detail-action-btn like" onclick="likePix('${pix.id}')">
                                ‚ù§Ô∏è Like
                            </button>
                            <button class="detail-action-btn save" onclick="savePix('${pix.id}')">
                                üìå Save
                            </button>
                            <button class="detail-action-btn share" onclick="toggleShareUrl()">
                                üîó Share
                            </button>
                        </div>
                        
                        <div class="share-url-container" id="shareUrlContainer">
                            <input type="text" class="share-url-input" value="${shareUrl}" readonly>
                            <button class="copy-btn" onclick="copyShareUrl()">Copy Link</button>
                        </div>
                        
                        <div class="pix-detail-stats">
                            <div class="stat-item">
                                <p class="stat-number">${pix.likes || 0}</p>
                                <p class="stat-label">Likes</p>
                            </div>
                            <div class="stat-item">
                                <p class="stat-number">${pix.saves || 0}</p>
                                <p class="stat-label">Saves</p>
                            </div>
                            <div class="stat-item">
                                <p class="stat-number">${pix.views || 0}</p>
                                <p class="stat-label">Views</p>
                            </div>
                        </div>
                        
                        ${pix.tags && pix.tags.length > 0 ? `
                            <div class="pix-detail-tags">
                                <h4 style="margin: 0 0 12px 0; color: #333;">Tags:</h4>
                                ${pix.tags.map(tag => `<span class="tag-item">#${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                        
                        ${pix.category ? `
                            <div style="margin-bottom: 20px;">
                                <h4 style="margin: 0 0 8px 0; color: #333;">Category:</h4>
                                <span style="background: #e60023; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500;">${pix.category}</span>
                            </div>
                        ` : ''}
                        
                        ${pix.board ? `
                            <div style="margin-bottom: 20px;">
                                <h4 style="margin: 0 0 8px 0; color: #333;">Board:</h4>
                                <span style="background: #6c5ce7; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500;">üìã ${pix.board}</span>
                            </div>
                        ` : ''}
                        
                        ${pix.sourceUrl ? `
                            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                                <a href="${pix.sourceUrl}" target="_blank" rel="noopener noreferrer" style="display: inline-flex; align-items: center; gap: 8px; background: #f8f9fa; padding: 12px 16px; border-radius: 8px; text-decoration: none; color: #333; font-weight: 500; transition: all 0.2s;">
                                    üîó Visit Source
                                </a>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                // Update view count
                const pixRef = database.ref('pixs').orderByChild('id').equalTo(pixId);
                const viewSnapshot = await pixRef.once('value');
                viewSnapshot.forEach((childSnapshot) => {
                    const currentViews = childSnapshot.val().views || 0;
                    childSnapshot.ref.update({ views: currentViews + 1 });
                });
                
            } catch (error) {
                console.error('Error loading pix detail:', error);
                pixDetailContent.innerHTML = '<div class="empty-state"><h3>Error loading Pix</h3><p>Please try again later.</p></div>';
            }
        }

        // Show user profile
        async function showUserProfile(userId) {
            showPage('userProfilePage');
            currentRoute = 'userProfile';
            
            const userProfileContent = document.getElementById('userProfileContent');
            userProfileContent.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading Profile...</p></div>';
            
            try {
                // Get user profile data
                const profileSnapshot = await database.ref('profiles').child(userId).once('value');
                const profileData = profileSnapshot.val() || {};
                
                // Get user's pixs
                const pixsSnapshot = await database.ref('pixs').orderByChild('userId').equalTo(userId).once('value');
                const userPixs = [];
                let userName = profileData.displayName || 'Unknown User';
                let userAvatar = profileData.profilePicture || 'https://via.placeholder.com/120';
                
                pixsSnapshot.forEach((childSnapshot) => {
                    const pix = childSnapshot.val();
                    userPixs.push(pix);
                    if (!profileData.displayName && (!userName || userName === 'Unknown User')) {
                        userName = pix.userName;
                        userAvatar = pix.userAvatar || userAvatar;
                    }
                });
                
                // Get followers/following counts
                const followersSnapshot = await database.ref('followers').child(userId).once('value');
                const followingSnapshot = await database.ref('following').child(userId).once('value');
                const followersCount = followersSnapshot.numChildren();
                const followingCount = followingSnapshot.numChildren();
                
                // Check if current user is following this user
                let isFollowing = false;
                if (currentUser && currentUser.uid !== userId) {
                    const followingCheck = await database.ref('following').child(currentUser.uid).child(userId).once('value');
                    isFollowing = followingCheck.exists();
                }
                
                const totalLikes = userPixs.reduce((sum, pix) => sum + (pix.likes || 0), 0);
                const totalSaves = userPixs.reduce((sum, pix) => sum + (pix.saves || 0), 0);
                
                // Check monetization eligibility
                const isMonetizationEligible = userPixs.length >= 10 && totalLikes >= 1000;
                
                const isOwnProfile = currentUser && currentUser.uid === userId;
                
                userProfileContent.innerHTML = `
                    <div class="profile-header">
                        ${isOwnProfile ? '<button class="profile-edit-btn" onclick="openProfileEditModal()">‚úèÔ∏è Edit Profile</button>' : ''}
                        
                        <div class="profile-avatar" ${isOwnProfile ? 'onclick="openProfileEditModal()"' : ''}>
                            <img src="${userAvatar}" alt="${userName}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                            ${isOwnProfile ? '<div class="profile-avatar-overlay">Change Photo</div>' : ''}
                        </div>
                        
                        <h1 class="profile-name">${userName}</h1>
                        
                        ${profileData.bio ? `<p class="profile-bio">${profileData.bio}</p>` : ''}
                        
                        ${profileData.location ? `<p style="color: #666; margin: 8px 0;"><span style="margin-right: 8px;">üìç</span>${profileData.location}</p>` : ''}
                        
                        ${profileData.website ? `<p style="margin: 8px 0;"><a href="${profileData.website}" target="_blank" rel="noopener noreferrer" style="color: #e60023; text-decoration: none; font-weight: 500;">üîó ${profileData.website}</a></p>` : ''}
                        
                        ${isMonetizationEligible ? `
                            <div class="monetization-badge">
                                <span>üí∞</span>
                                <span>Monetization Eligible</span>
                            </div>
                        ` : ''}
                        
                        ${!isOwnProfile && currentUser ? `
                            <button class="follow-btn ${isFollowing ? 'following' : ''}" onclick="toggleFollow('${userId}')">
                                ${isFollowing ? '‚úì Following' : '+ Follow'}
                            </button>
                        ` : ''}
                        
                        <div class="profile-stats">
                            <div class="profile-stat" onclick="switchProfileTab('pixs')">
                                <p class="profile-stat-number">${userPixs.length}</p>
                                <p class="profile-stat-label">Pixs</p>
                            </div>
                            <div class="profile-stat" onclick="switchProfileTab('followers')">
                                <p class="profile-stat-number">${followersCount}</p>
                                <p class="profile-stat-label">Followers</p>
                            </div>
                            <div class="profile-stat" onclick="switchProfileTab('following')">
                                <p class="profile-stat-number">${followingCount}</p>
                                <p class="profile-stat-label">Following</p>
                            </div>
                            <div class="profile-stat">
                                <p class="profile-stat-number">${totalLikes}</p>
                                <p class="profile-stat-label">Total Likes</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-tabs">
                        <button class="profile-tab active" onclick="switchProfileTab('pixs')">üì∏ Pixs</button>
                        <button class="profile-tab" onclick="switchProfileTab('followers')">üë• Followers</button>
                        <button class="profile-tab" onclick="switchProfileTab('following')">‚û°Ô∏è Following</button>
                        ${isOwnProfile ? '<button class="profile-tab" onclick="switchProfileTab(\'saved\')">üìå Saved</button>' : ''}
                    </div>
                    
                    <div id="profilePixsContent" class="profile-content active">
                        <div class="masonry-grid" id="userPixGrid"></div>
                    </div>
                    
                    <div id="profileFollowersContent" class="profile-content">
                        <div id="followersList"></div>
                    </div>
                    
                    <div id="profileFollowingContent" class="profile-content">
                        <div id="followingList"></div>
                    </div>
                    
                    ${isOwnProfile ? `
                        <div id="profileSavedContent" class="profile-content">
                            <div class="masonry-grid" id="savedPixGrid"></div>
                        </div>
                    ` : ''}
                `;
                
                // Add ads between content
                insertAds();
                
                // Render user's pixs
                if (userPixs.length > 0) {
                    renderPixs(userPixs.reverse(), 'userPixGrid'); // Show newest first
                } else {
                    document.getElementById('userPixGrid').innerHTML = '<div class="empty-state"><h3>No Pixs yet</h3><p>This user hasn\'t shared any Pixs.</p></div>';
                }
                
                // Load followers and following lists
                await loadFollowersList(userId);
                await loadFollowingList(userId);
                
                // Load saved pixs if own profile
                if (isOwnProfile) {
                    await loadSavedPixs();
                }
                
            } catch (error) {
                console.error('Error loading user profile:', error);
                userProfileContent.innerHTML = '<div class="empty-state"><h3>Error loading profile</h3><p>Please try again later.</p></div>';
            }
        }

        // Auth state observer
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            updateUI();
            if (user) {
                loadPixs();
            } else {
                loadPixs(); // Load public pixs even without login
            }
        });

        // Update UI based on auth state
        function updateUI() {
            if (currentUser) {
                loginBtn.style.display = 'none';
                userInfo.style.display = 'flex';
                createBtn.style.display = 'block';
                userAvatar.src = currentUser.photoURL || 'https://via.placeholder.com/32';
                
                // Bottom nav
                bottomLoginBtn.style.display = 'none';
                bottomCreateBtn.style.display = 'flex';
                bottomProfileBtn.style.display = 'flex';
            } else {
                loginBtn.style.display = 'block';
                userInfo.style.display = 'none';
                createBtn.style.display = 'none';
                
                // Bottom nav
                bottomLoginBtn.style.display = 'flex';
                bottomCreateBtn.style.display = 'none';
                bottomProfileBtn.style.display = 'none';
            }
        }

        // Search functionality
        function performSearch() {
            const query = searchInput.value.trim().toLowerCase();
            
            if (!query) {
                showToast('Please enter a search term');
                return;
            }

            // Check for suicide/self-harm keywords
            const containsSuicideKeywords = suicideKeywords.some(keyword => 
                query.includes(keyword.toLowerCase())
            );

            if (containsSuicideKeywords) {
                showSafetyMessage('suicide');
                return;
            }

            // Check for inappropriate content
            const containsInappropriate = inappropriateKeywords.some(keyword => 
                query.includes(keyword.toLowerCase())
            );

            if (containsInappropriate) {
                showSafetyMessage('inappropriate');
                return;
            }

            // Perform actual search
            searchPixs(query);
        }

        // Show safety message based on type
        function showSafetyMessage(type) {
            if (type === 'suicide') {
                safetyTitle.textContent = "We're Here for You üíô";
                safetyMessage.innerHTML = `
                    <h3>You Are Not Alone</h3>
                    <p>If you're going through a difficult time, please know that there are people who care and want to help.</p>
                    
                    <div class="helpline">
                        <h4>üáÆüá≥ India - National Suicide Prevention Helpline</h4>
                        <p>üìû 9152987821</p>
                    </div>
                    
                    <div class="helpline">
                        <h4>üåç International Crisis Text Line</h4>
                        <p>Text HOME to 741741</p>
                    </div>
                    
                    <p>Remember: This feeling is temporary. You matter, and your life has value. Please reach out for help.</p>
                    <p>üíô You are loved, you are important, and you deserve support.</p>
                `;
            } else if (type === 'inappropriate') {
                safetyTitle.textContent = "Content Warning ‚ö†Ô∏è";
                safetyMessage.innerHTML = `
                    <div class="warning-message">
                        <h4>‚ö†Ô∏è Inappropriate Content Detected</h4>
                        <p>Pixplay is a family-friendly platform for creative inspiration and ideas.</p>
                        <p>Please search for appropriate content like art, recipes, home decor, fashion, or other creative ideas.</p>
                    </div>
                    <p>Let's keep Pixplay a safe and inspiring place for everyone! üåü</p>
                `;
            }
            
            safetyModal.classList.add('active');
        }

        // Search Pixs function
        function searchPixs(query) {
            loading.style.display = 'block';
            pixGrid.innerHTML = '';
            
            const filteredPixs = allPixs.filter(pix => {
                const searchText = (pix.title + ' ' + pix.description + ' ' + (pix.tags ? pix.tags.join(' ') : '')).toLowerCase();
                return searchText.includes(query);
            });
            
            loading.style.display = 'none';
            
            if (filteredPixs.length === 0) {
                pixGrid.innerHTML = `
                    <div class="empty-state">
                        <h3>No results found for "${query}"</h3>
                        <p>Try searching for something else like "art", "food", "fashion", or "home decor"</p>
                    </div>
                `;
            } else {
                renderPixs(filteredPixs);
                showToast(`Found ${filteredPixs.length} results for "${query}"`);
            }
        }

        // Google Sign In
        loginBtn.addEventListener('click', async () => {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await auth.signInWithPopup(provider);
            } catch (error) {
                console.error('Login error:', error);
                showToast('Login failed. Please try again.');
            }
        });

        // Logout
        logoutBtn.addEventListener('click', async () => {
            try {
                await auth.signOut();
                showToast('Logged out successfully!');
            } catch (error) {
                console.error('Logout error:', error);
            }
        });

        // Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        homeBtn.addEventListener('click', (e) => {
            e.preventDefault();
            navigateTo('');
        });

        aboutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            navigateTo('about');
        });

        settingsBtn.addEventListener('click', (e) => {
            e.preventDefault();
            navigateTo('settings');
        });

        privacyBtn.addEventListener('click', (e) => {
            e.preventDefault();
            navigateTo('privacy');
        });

        copyrightBtn.addEventListener('click', (e) => {
            e.preventDefault();
            navigateTo('copyright');
        });

        // Back buttons
        backFromAbout.addEventListener('click', () => navigateTo(''));
        backFromSettings.addEventListener('click', () => navigateTo(''));
        backFromPrivacy.addEventListener('click', () => navigateTo(''));
        backFromCopyright.addEventListener('click', () => navigateTo(''));
        
        // Additional back buttons for new pages
        document.getElementById('backFromPixDetail').addEventListener('click', () => navigateTo(''));
        document.getElementById('backFromUserProfile').addEventListener('click', () => navigateTo(''));

        // Settings toggles
        function setupToggle(toggle, settingKey) {
            toggle.addEventListener('click', () => {
                userSettings[settingKey] = !userSettings[settingKey];
                toggle.classList.toggle('active', userSettings[settingKey]);
                saveUserSettings();
                
                if (settingKey === 'blurSensitive') {
                    renderPixs(allPixs); // Re-render to apply blur changes
                }
            });
        }

        setupToggle(blurToggle, 'blurSensitive');
        setupToggle(safeSearchToggle, 'safeSearch');
        setupToggle(emailToggle, 'emailNotifications');
        setupToggle(pushToggle, 'pushNotifications');
        setupToggle(profileToggle, 'profileVisible');

        // Save user settings to localStorage
        function saveUserSettings() {
            localStorage.setItem('pixplay_settings', JSON.stringify(userSettings));
        }

        // Load user settings from localStorage
        function loadUserSettings() {
            const saved = localStorage.getItem('pixplay_settings');
            if (saved) {
                userSettings = { ...userSettings, ...JSON.parse(saved) };
                updateSettingsUI();
            }
        }

        // Update settings UI
        function updateSettingsUI() {
            blurToggle.classList.toggle('active', userSettings.blurSensitive);
            safeSearchToggle.classList.toggle('active', userSettings.safeSearch);
            emailToggle.classList.toggle('active', userSettings.emailNotifications);
            pushToggle.classList.toggle('active', userSettings.pushNotifications);
            profileToggle.classList.toggle('active', userSettings.profileVisible);
        }

        // Modal controls
        createBtn.addEventListener('click', () => {
            createModal.classList.add('active');
            showCreationTypeSelector();
        });

        closeModal.addEventListener('click', () => {
            createModal.classList.remove('active');
            resetForm();
        });

        createModal.addEventListener('click', (e) => {
            if (e.target === createModal) {
                createModal.classList.remove('active');
                resetForm();
            }
        });

        // Creation type selection
        uploadOption.addEventListener('click', () => {
            selectCreationType('upload');
        });

        linkOption.addEventListener('click', () => {
            selectCreationType('link');
        });

        productOption.addEventListener('click', () => {
            selectCreationType('product');
        });

        ideaOption.addEventListener('click', () => {
            selectCreationType('idea');
        });

        backToOptions.addEventListener('click', () => {
            showCreationTypeSelector();
        });

        // Link preview functionality
        previewBtn.addEventListener('click', async () => {
            const url = websiteUrl.value.trim();
            if (!url) {
                showToast('Please enter a valid URL');
                return;
            }
            await fetchLinkPreview(url);
        });

        productPreviewBtn.addEventListener('click', async () => {
            const url = productUrl.value.trim();
            if (!url) {
                showToast('Please enter a valid product URL');
                return;
            }
            await fetchProductPreview(url);
        });

        // Report modal controls
        closeReportModal.addEventListener('click', () => {
            reportModal.classList.remove('active');
            resetReportModal();
        });

        reportModal.addEventListener('click', (e) => {
            if (e.target === reportModal) {
                reportModal.classList.remove('active');
                resetReportModal();
            }
        });

        // Report reason selection
        document.querySelectorAll('.report-reason').forEach(reason => {
            reason.addEventListener('click', () => {
                document.querySelectorAll('.report-reason').forEach(r => r.classList.remove('selected'));
                reason.classList.add('selected');
                submitReport.disabled = false;
            });
        });

        // Submit report
        submitReport.addEventListener('click', async () => {
            const selectedReason = document.querySelector('.report-reason.selected');
            if (!selectedReason || !currentReportPixId) return;

            try {
                const reportData = {
                    pixId: currentReportPixId,
                    reason: selectedReason.dataset.reason,
                    reportedBy: currentUser ? currentUser.uid : 'anonymous',
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                };

                await database.ref('reports').push(reportData);
                showToast('Report submitted successfully. Thank you for helping keep Pixplay safe!');
                reportModal.classList.remove('active');
                resetReportModal();

            } catch (error) {
                console.error('Error submitting report:', error);
                showToast('Failed to submit report. Please try again.');
            }
        });

        function resetReportModal() {
            document.querySelectorAll('.report-reason').forEach(r => r.classList.remove('selected'));
            submitReport.disabled = true;
            currentReportPixId = null;
        }

        // Check if content is sensitive
        function isSensitiveContent(title, description = '') {
            const text = (title + ' ' + description).toLowerCase();
            return sensitiveKeywords.some(keyword => text.includes(keyword));
        }

        // Base64 image conversion
        function convertToBase64(file, callback) {
            const reader = new FileReader();
            reader.onload = (e) => {
                callback(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        // Image preview handlers
        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                // Check file size (max 5MB for better performance)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('Image size should be less than 5MB');
                    return;
                }
                
                convertToBase64(file, (base64) => {
                    imagePreview.src = base64;
                    imagePreview.style.display = 'block';
                });
            }
        });

        ideaImage.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                // Check file size (max 5MB for better performance)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('Image size should be less than 5MB');
                    return;
                }
                
                convertToBase64(file, (base64) => {
                    ideaPreview.src = base64;
                    ideaPreview.style.display = 'block';
                });
            }
        });

        // Creation flow functions
        function showCreationTypeSelector() {
            creationTypeSelector.style.display = 'block';
            pixForm.style.display = 'none';
            currentCreationType = null;
            linkPreviewData = null;
        }

        function selectCreationType(type) {
            currentCreationType = type;
            creationTypeSelector.style.display = 'none';
            pixForm.style.display = 'block';
            
            // Hide all sections
            uploadSection.style.display = 'none';
            linkSection.style.display = 'none';
            productSection.style.display = 'none';
            ideaSection.style.display = 'none';
            
            // Show selected section
            switch(type) {
                case 'upload':
                    uploadSection.style.display = 'block';
                    imageInput.required = true;
                    break;
                case 'link':
                    linkSection.style.display = 'block';
                    websiteUrl.required = true;
                    break;
                case 'product':
                    productSection.style.display = 'block';
                    productUrl.required = true;
                    break;
                case 'idea':
                    ideaSection.style.display = 'block';
                    ideaImage.required = true;
                    break;
            }
            
            commonFields.style.display = 'block';
        }

        // Link Preview API Integration
        async function fetchLinkPreview(url) {
            previewBtn.disabled = true;
            previewBtn.textContent = 'Loading...';
            
            try {
                const apiKey = 'abc72997cd616bbddeea737e2e28acbc';
                const response = await fetch(`https://api.linkpreview.net/?key=${apiKey}&q=${encodeURIComponent(url)}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch preview');
                }
                
                const data = await response.json();
                linkPreviewData = data;
                
                // Display preview
                linkImage.src = data.image || 'https://via.placeholder.com/80x80?text=No+Image';
                linkTitle.textContent = data.title || 'No title available';
                linkDescription.textContent = data.description || 'No description available';
                linkDomain.textContent = new URL(url).hostname;
                
                linkPreview.style.display = 'flex';
                
                // Auto-fill title if empty
                if (!pixTitle.value && data.title) {
                    pixTitle.value = data.title;
                    pixTitle.dispatchEvent(new Event('input'));
                }
                
                // Auto-fill description if empty
                if (!document.getElementById('pixDescription').value && data.description) {
                    document.getElementById('pixDescription').value = data.description;
                }
                
                showToast('Link preview loaded successfully!');
                
            } catch (error) {
                console.error('Error fetching link preview:', error);
                showToast('Failed to load link preview. Please check the URL.');
            } finally {
                previewBtn.disabled = false;
                previewBtn.textContent = 'Get Preview';
            }
        }

        // Product Preview (using same API but with product-specific parsing)
        async function fetchProductPreview(url) {
            productPreviewBtn.disabled = true;
            productPreviewBtn.textContent = 'Loading...';
            
            try {
                const apiKey = 'abc72997cd616bbddeea737e2e28acbc';
                const response = await fetch(`https://api.linkpreview.net/?key=${apiKey}&q=${encodeURIComponent(url)}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch product preview');
                }
                
                const data = await response.json();
                linkPreviewData = data;
                
                // Extract product information
                const title = data.title || 'Product';
                const description = data.description || 'No description available';
                const image = data.image || 'https://via.placeholder.com/80x80?text=No+Image';
                const domain = new URL(url).hostname;
                
                // Try to extract price from title or description
                const priceMatch = (title + ' ' + description).match(/[\$¬£‚Ç¨¬•‚Çπ]\s*[\d,]+\.?\d*/);
                const price = priceMatch ? priceMatch[0] : 'Price not available';
                
                // Display product preview
                productImage.src = image;
                productTitle.textContent = title;
                productPrice.textContent = price;
                productDescription.textContent = description;
                productStore.textContent = domain;
                
                productPreview.style.display = 'flex';
                
                // Auto-fill fields
                if (!pixTitle.value) {
                    pixTitle.value = title;
                    pixTitle.dispatchEvent(new Event('input'));
                }
                
                if (!document.getElementById('pixDescription').value) {
                    document.getElementById('pixDescription').value = `${description}\n\nPrice: ${price}\nFrom: ${domain}`;
                }
                
                showToast('Product preview loaded successfully!');
                
            } catch (error) {
                console.error('Error fetching product preview:', error);
                showToast('Failed to load product preview. Please check the URL.');
            } finally {
                productPreviewBtn.disabled = false;
                productPreviewBtn.textContent = 'Get Product Info';
            }
        }

        // Title character counter
        pixTitle.addEventListener('input', (e) => {
            const count = e.target.value.length;
            const counter = e.target.parentNode.querySelector('small');
            counter.textContent = `${count}/100`;
        });

        // Form submission
        pixForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentUser) {
                showToast('Please login to create a Pix');
                return;
            }

            if (!currentCreationType) {
                showToast('Please select a creation type');
                return;
            }

            publishBtn.disabled = true;
            publishBtn.textContent = 'Publishing...';

            try {
                let imageUrl = '';
                let sourceUrl = '';
                
                // Handle different creation types
                switch(currentCreationType) {
                    case 'upload':
                        const file = imageInput.files[0];
                        if (!file) {
                            showToast('Please select an image');
                            publishBtn.disabled = false;
                            publishBtn.textContent = 'Publish Pix';
                            return;
                        }
                        // Convert to Base64
                        imageUrl = await new Promise((resolve) => {
                            convertToBase64(file, resolve);
                        });
                        break;
                        
                    case 'link':
                        if (!linkPreviewData) {
                            showToast('Please get link preview first');
                            publishBtn.disabled = false;
                            publishBtn.textContent = 'Publish Pix';
                            return;
                        }
                        imageUrl = linkPreviewData.image || 'https://via.placeholder.com/400x300?text=No+Image';
                        sourceUrl = websiteUrl.value;
                        break;
                        
                    case 'product':
                        if (!linkPreviewData) {
                            showToast('Please get product preview first');
                            publishBtn.disabled = false;
                            publishBtn.textContent = 'Publish Pix';
                            return;
                        }
                        imageUrl = linkPreviewData.image || 'https://via.placeholder.com/400x300?text=No+Image';
                        sourceUrl = productUrl.value;
                        break;
                        
                    case 'idea':
                        const ideaFile = ideaImage.files[0];
                        if (!ideaFile) {
                            showToast('Please select an inspiration image');
                            publishBtn.disabled = false;
                            publishBtn.textContent = 'Publish Pix';
                            return;
                        }
                        // Convert to Base64
                        imageUrl = await new Promise((resolve) => {
                            convertToBase64(ideaFile, resolve);
                        });
                        break;
                }

                // Collect form data
                const tags = document.getElementById('pixTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                const board = document.getElementById('pixBoard').value;
                const pixId = Date.now().toString();
                
                // Save pix data to Firebase Database
                const pixData = {
                    id: pixId,
                    title: pixTitle.value,
                    description: document.getElementById('pixDescription').value,
                    imageUrl: imageUrl,
                    sourceUrl: sourceUrl,
                    type: currentCreationType,
                    tags: tags,
                    board: board,
                    category: currentCreationType === 'product' ? productCategory.value : 
                             currentCreationType === 'idea' ? ideaCategory.value : '',
                    userId: currentUser.uid,
                    userName: currentUser.displayName,
                    userAvatar: currentUser.photoURL,
                    createdAt: firebase.database.ServerValue.TIMESTAMP,
                    likes: 0,
                    saves: 0,
                    likedBy: {},
                    savedBy: {}
                };

                await database.ref('pixs').push(pixData);
                
                showToast('Pix published successfully!');
                createModal.classList.remove('active');
                resetForm();
                loadPixs();

            } catch (error) {
                console.error('Error publishing pix:', error);
                showToast('Failed to publish Pix. Please try again.');
            } finally {
                publishBtn.disabled = false;
                publishBtn.textContent = 'Publish Pix';
            }
        });

        // Reset form
        function resetForm() {
            pixForm.reset();
            imagePreview.style.display = 'none';
            ideaPreview.style.display = 'none';
            linkPreview.style.display = 'none';
            productPreview.style.display = 'none';
            
            // Reset character counter
            const counter = document.querySelector('#pixTitle').parentNode.querySelector('small');
            if (counter) counter.textContent = '0/100';
            
            // Reset creation type
            currentCreationType = null;
            linkPreviewData = null;
            
            // Reset required attributes
            imageInput.required = false;
            websiteUrl.required = false;
            productUrl.required = false;
            ideaImage.required = false;
            
            // Show creation type selector
            showCreationTypeSelector();
        }

        // Load pixs from Firebase
        async function loadPixs() {
            loading.style.display = 'block';
            pixGrid.innerHTML = '';
            emptyState.style.display = 'none';

            try {
                const snapshot = await database.ref('pixs').orderByChild('createdAt').once('value');
                const pixs = [];
                
                snapshot.forEach((childSnapshot) => {
                    pixs.unshift(childSnapshot.val()); // Reverse order (newest first)
                });

                allPixs = pixs;
                renderPixs(pixs);

            } catch (error) {
                console.error('Error loading pixs:', error);
                showToast('Failed to load Pixs');
            } finally {
                loading.style.display = 'none';
            }
        }

        // Render pixs in masonry grid
        function renderPixs(pixs, containerId = 'pixGrid') {
            const container = document.getElementById(containerId);
            
            if (pixs.length === 0) {
                if (containerId === 'pixGrid') {
                    emptyState.style.display = 'block';
                }
                return;
            }

            container.innerHTML = '';
            
            pixs.forEach((pix, index) => {
                // Insert ad every 6 pixs on home page
                if (containerId === 'pixGrid' && index > 0 && index % 6 === 0) {
                    const adBanners = [
                        {
                            title: "üé® Creative Tools",
                            description: "Discover amazing design tools to create stunning visuals",
                            cta: "Explore Now"
                        },
                        {
                            title: "üì∏ Photography Course", 
                            description: "Learn professional photography techniques from experts",
                            cta: "Start Learning"
                        },
                        {
                            title: "üõçÔ∏è Fashion Deals",
                            description: "Get up to 50% off on trending fashion items",
                            cta: "Shop Now"
                        },
                        {
                            title: "üè† Home Decor Ideas",
                            description: "Transform your space with these amazing decor tips",
                            cta: "Get Inspired"
                        }
                    ];
                    
                    const randomAd = adBanners[Math.floor(Math.random() * adBanners.length)];
                    const adElement = document.createElement('div');
                    adElement.className = 'ad-banner';
                    adElement.style.cssText = 'break-inside: avoid; margin-bottom: 20px;';
                    adElement.innerHTML = `
                        <div class="ad-content">
                            <h3 class="ad-title">${randomAd.title}</h3>
                            <p class="ad-description">${randomAd.description}</p>
                            <button class="ad-cta" onclick="showToast('This is a demo ad! üì¢')">${randomAd.cta}</button>
                        </div>
                    `;
                    container.appendChild(adElement);
                }
            
            pixs.forEach((pix) => {
                const isSensitive = isSensitiveContent(pix.title, pix.description);
                const shouldBlur = userSettings.blurSensitive && isSensitive;
                
                const pixCard = document.createElement('div');
                pixCard.className = 'pix-card';
                pixCard.dataset.pixId = pix.id;
                
                // Type indicator
                const typeIcon = {
                    'upload': 'üì∏',
                    'link': 'üîó',
                    'product': 'üõçÔ∏è',
                    'idea': 'üí°'
                };
                
                pixCard.innerHTML = `
                    <img src="${pix.imageUrl}" alt="${pix.title}" class="pix-image ${shouldBlur ? 'blurred' : ''}" loading="lazy">
                    
                    ${shouldBlur ? `
                        <div class="pix-overlay active">
                            <h4>Sensitive Content</h4>
                            <p>This content may contain sensitive material</p>
                            <button class="view-btn" onclick="viewSensitiveContent('${pix.id}')">
                                üëÅÔ∏è View Content
                            </button>
                        </div>
                    ` : ''}
                    
                    <div class="pix-actions">
                        <button class="action-btn" onclick="likePix('${pix.id}')" title="Like">
                            ‚ù§Ô∏è
                        </button>
                        <button class="action-btn" onclick="savePix('${pix.id}')" title="Save">
                            üìå
                        </button>
                        <button class="action-btn" onclick="reportPix('${pix.id}')" title="Report">
                            üö©
                        </button>
                    </div>
                    
                    <div class="pix-info">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <span style="font-size: 16px;">${typeIcon[pix.type] || 'üì∏'}</span>
                            <h3 class="pix-title" style="margin: 0; flex: 1;">${pix.title}</h3>
                        </div>
                        
                        ${pix.description ? `<p class="pix-description">${pix.description}</p>` : ''}
                        
                        ${pix.category ? `<div style="margin: 8px 0;"><span style="background: #e60023; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">${pix.category}</span></div>` : ''}
                        
                        ${pix.tags && pix.tags.length > 0 ? `
                            <div style="margin: 8px 0;">
                                ${pix.tags.map(tag => `<span style="background: #f0f0f0; color: #666; padding: 2px 6px; border-radius: 8px; font-size: 11px; margin-right: 4px;">#${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                        
                        <div class="pix-user">
                            <img src="${pix.userAvatar || 'https://via.placeholder.com/24'}" alt="${pix.userName}" class="pix-user-avatar" onclick="navigateTo('user/${pix.userId}')" style="cursor: pointer;">
                            <span class="pix-user-name" onclick="navigateTo('user/${pix.userId}')" style="cursor: pointer;">${pix.userName}</span>
                            ${pix.board ? `<span style="margin-left: auto; font-size: 12px; color: #999;">üìã ${pix.board}</span>` : ''}
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px; font-size: 12px; color: #999;">
                            <span>‚ù§Ô∏è ${pix.likes || 0} likes</span>
                            <span>üìå ${pix.saves || 0} saves</span>
                        </div>
                    </div>
                `;

                // Click handler to view Pix detail
                pixCard.addEventListener('click', (e) => {
                    if (!e.target.closest('.pix-actions') && 
                        !e.target.closest('.view-btn') && 
                        !e.target.closest('.pix-user-avatar') && 
                        !e.target.closest('.pix-user-name') &&
                        !shouldBlur) {
                        navigateTo(`pix/${pix.id}`);
                    }
                });

                container.appendChild(pixCard);
            });
        }

        // Like pix function
        window.likePix = async function(pixId) {
            if (!currentUser) {
                showToast('Please login to like Pixs');
                return;
            }
            
            try {
                const pixRef = database.ref('pixs').orderByChild('id').equalTo(pixId);
                const snapshot = await pixRef.once('value');
                
                snapshot.forEach((childSnapshot) => {
                    const pix = childSnapshot.val();
                    const likedBy = pix.likedBy || {};
                    
                    if (likedBy[currentUser.uid]) {
                        // Unlike
                        delete likedBy[currentUser.uid];
                        const newLikes = Math.max(0, (pix.likes || 0) - 1);
                        childSnapshot.ref.update({ 
                            likes: newLikes,
                            likedBy: likedBy
                        });
                        showToast('Pix unliked');
                    } else {
                        // Like
                        likedBy[currentUser.uid] = true;
                        const newLikes = (pix.likes || 0) + 1;
                        childSnapshot.ref.update({ 
                            likes: newLikes,
                            likedBy: likedBy
                        });
                        showToast('Pix liked! ‚ù§Ô∏è');
                    }
                });
                
                // Refresh current view
                if (currentRoute === 'home') {
                    loadPixs();
                } else if (currentRoute === 'pixDetail') {
                    const hash = window.location.hash;
                    const pixId = hash.replace('#pix/', '');
                    showPixDetail(pixId);
                }
                
            } catch (error) {
                console.error('Error liking pix:', error);
                showToast('Failed to like Pix');
            }
        };

        // Save pix function
        window.savePix = async function(pixId) {
            if (!currentUser) {
                showToast('Please login to save Pixs');
                return;
            }
            
            try {
                const pixRef = database.ref('pixs').orderByChild('id').equalTo(pixId);
                const snapshot = await pixRef.once('value');
                
                snapshot.forEach((childSnapshot) => {
                    const pix = childSnapshot.val();
                    const savedBy = pix.savedBy || {};
                    
                    if (savedBy[currentUser.uid]) {
                        // Unsave
                        delete savedBy[currentUser.uid];
                        const newSaves = Math.max(0, (pix.saves || 0) - 1);
                        childSnapshot.ref.update({ 
                            saves: newSaves,
                            savedBy: savedBy
                        });
                        showToast('Pix removed from saves');
                    } else {
                        // Save
                        savedBy[currentUser.uid] = true;
                        const newSaves = (pix.saves || 0) + 1;
                        childSnapshot.ref.update({ 
                            saves: newSaves,
                            savedBy: savedBy
                        });
                        showToast('Pix saved! üìå');
                    }
                });
                
                // Refresh current view
                if (currentRoute === 'home') {
                    loadPixs();
                } else if (currentRoute === 'pixDetail') {
                    const hash = window.location.hash;
                    const pixId = hash.replace('#pix/', '');
                    showPixDetail(pixId);
                }
                
            } catch (error) {
                console.error('Error saving pix:', error);
                showToast('Failed to save Pix');
            }
        };

        // Toggle share URL visibility
        window.toggleShareUrl = function() {
            const shareContainer = document.getElementById('shareUrlContainer');
            if (shareContainer) {
                shareContainer.style.display = shareContainer.style.display === 'none' ? 'block' : 'none';
            }
        };

        // Copy share URL to clipboard
        window.copyShareUrl = async function() {
            const shareInput = document.querySelector('.share-url-input');
            if (shareInput) {
                try {
                    await navigator.clipboard.writeText(shareInput.value);
                    showToast('Link copied to clipboard! üîó');
                } catch (error) {
                    // Fallback for older browsers
                    shareInput.select();
                    document.execCommand('copy');
                    showToast('Link copied to clipboard! üîó');
                }
            }
        };

        // View sensitive content
        window.viewSensitiveContent = function(pixId) {
            const pixCard = document.querySelector(`[data-pix-id="${pixId}"]`);
            if (pixCard) {
                const image = pixCard.querySelector('.pix-image');
                const overlay = pixCard.querySelector('.pix-overlay');
                
                image.classList.remove('blurred');
                overlay.classList.remove('active');
            }
        };

        // Report pix
        window.reportPix = function(pixId) {
            currentReportPixId = pixId;
            reportModal.classList.add('active');
        };

        // Toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #333;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                font-weight: 500;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize app
        function initializeApp() {
            loadUserSettings();
            initializeRouting();
            loadPixs();
        }

        // Search event listeners
        searchBtn.addEventListener('click', performSearch);
        
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Safety modal event listeners
        closeSafetyModal.addEventListener('click', () => {
            safetyModal.classList.remove('active');
        });

        continueBrowsing.addEventListener('click', () => {
            safetyModal.classList.remove('active');
        });

        safetyModal.addEventListener('click', (e) => {
            if (e.target === safetyModal) {
                safetyModal.classList.remove('active');
            }
        });

        // Bottom navigation event listeners
        bottomHomeBtn.addEventListener('click', () => {
            navigateTo('');
            updateBottomNavActive('home');
        });

        bottomExploreBtn.addEventListener('click', () => {
            searchInput.focus();
            updateBottomNavActive('explore');
        });

        bottomCreateBtn.addEventListener('click', () => {
            createModal.classList.add('active');
            showCreationTypeSelector();
            updateBottomNavActive('create');
        });

        bottomProfileBtn.addEventListener('click', () => {
            if (currentUser) {
                navigateTo(`user/${currentUser.uid}`);
                updateBottomNavActive('profile');
            }
        });

        bottomLoginBtn.addEventListener('click', async () => {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await auth.signInWithPopup(provider);
                updateBottomNavActive('home');
            } catch (error) {
                console.error('Login error:', error);
                showToast('Login failed. Please try again.');
            }
        });

        // Update bottom navigation active state
        function updateBottomNavActive(activeTab) {
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            switch(activeTab) {
                case 'home':
                    bottomHomeBtn.classList.add('active');
                    break;
                case 'explore':
                    bottomExploreBtn.classList.add('active');
                    break;
                case 'create':
                    bottomCreateBtn.classList.add('active');
                    break;
                case 'profile':
                    bottomProfileBtn.classList.add('active');
                    break;
            }
        }

        // Profile management functions
        window.openProfileEditModal = function() {
            if (!currentUser) return;
            
            profileEditModal.classList.add('active');
            
            // Load current profile data
            database.ref('profiles').child(currentUser.uid).once('value').then((snapshot) => {
                const profileData = snapshot.val() || {};
                
                profileDisplayName.value = profileData.displayName || currentUser.displayName || '';
                profileBio.value = profileData.bio || '';
                profileWebsite.value = profileData.website || '';
                profileLocation.value = profileData.location || '';
                
                if (profileData.profilePicture) {
                    profilePicturePreview.src = profileData.profilePicture;
                    profilePicturePreview.style.display = 'block';
                }
                
                updateBioCounter();
            });
        };

        // Profile picture preview
        profilePictureInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) {
                    showToast('Profile picture should be less than 2MB');
                    return;
                }
                
                convertToBase64(file, (base64) => {
                    profilePicturePreview.src = base64;
                    profilePicturePreview.style.display = 'block';
                });
            }
        });

        // Bio character counter
        profileBio.addEventListener('input', updateBioCounter);
        
        function updateBioCounter() {
            const count = profileBio.value.length;
            bioCounter.textContent = `${count}/200`;
        }

        // Profile edit form submission
        profileEditForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentUser) return;
            
            saveProfileBtn.disabled = true;
            saveProfileBtn.textContent = 'Saving...';
            
            try {
                const profileData = {
                    displayName: profileDisplayName.value.trim(),
                    bio: profileBio.value.trim(),
                    website: profileWebsite.value.trim(),
                    location: profileLocation.value.trim(),
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                // Handle profile picture
                if (profilePictureInput.files[0]) {
                    const file = profilePictureInput.files[0];
                    const base64 = await new Promise((resolve) => {
                        convertToBase64(file, resolve);
                    });
                    profileData.profilePicture = base64;
                }
                
                await database.ref('profiles').child(currentUser.uid).update(profileData);
                
                showToast('Profile updated successfully! üéâ');
                profileEditModal.classList.remove('active');
                
                // Refresh current profile view if viewing own profile
                const hash = window.location.hash;
                if (hash === `#user/${currentUser.uid}`) {
                    showUserProfile(currentUser.uid);
                }
                
            } catch (error) {
                console.error('Error updating profile:', error);
                showToast('Failed to update profile. Please try again.');
            } finally {
                saveProfileBtn.disabled = false;
                saveProfileBtn.textContent = 'Save Changes';
            }
        });

        // Profile edit modal controls
        closeProfileEditModal.addEventListener('click', () => {
            profileEditModal.classList.remove('active');
        });

        profileEditModal.addEventListener('click', (e) => {
            if (e.target === profileEditModal) {
                profileEditModal.classList.remove('active');
            }
        });

        // Follow/Unfollow functionality
        window.toggleFollow = async function(userId) {
            if (!currentUser) {
                showToast('Please login to follow users');
                return;
            }
            
            try {
                const followingRef = database.ref('following').child(currentUser.uid).child(userId);
                const followerRef = database.ref('followers').child(userId).child(currentUser.uid);
                
                const snapshot = await followingRef.once('value');
                
                if (snapshot.exists()) {
                    // Unfollow
                    await followingRef.remove();
                    await followerRef.remove();
                    showToast('Unfollowed user');
                } else {
                    // Follow
                    const followData = {
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        userName: currentUser.displayName,
                        userAvatar: currentUser.photoURL
                    };
                    
                    await followingRef.set(followData);
                    await followerRef.set({
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        userName: currentUser.displayName,
                        userAvatar: currentUser.photoURL
                    });
                    
                    showToast('Following user! üë•');
                }
                
                // Refresh profile view
                showUserProfile(userId);
                
            } catch (error) {
                console.error('Error toggling follow:', error);
                showToast('Failed to update follow status');
            }
        };

        // Profile tab switching
        window.switchProfileTab = function(tabName) {
            currentProfileTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.profile-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.profile-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected tab
            const tabButton = [...document.querySelectorAll('.profile-tab')].find(tab => 
                tab.textContent.toLowerCase().includes(tabName.toLowerCase())
            );
            if (tabButton) tabButton.classList.add('active');
            
            const contentId = `profile${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Content`;
            const content = document.getElementById(contentId);
            if (content) content.classList.add('active');
        };

        // Load followers list
        async function loadFollowersList(userId) {
            try {
                const snapshot = await database.ref('followers').child(userId).once('value');
                const followersList = document.getElementById('followersList');
                
                if (!snapshot.exists()) {
                    followersList.innerHTML = '<div class="empty-state"><h3>No followers yet</h3><p>Be the first to follow this user!</p></div>';
                    return;
                }
                
                let followersHtml = '';
                snapshot.forEach((childSnapshot) => {
                    const follower = childSnapshot.val();
                    const followerId = childSnapshot.key;
                    
                    followersHtml += `
                        <div style="display: flex; align-items: center; gap: 12px; padding: 16px; background: white; border-radius: 12px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <img src="${follower.userAvatar || 'https://via.placeholder.com/48'}" alt="${follower.userName}" style="width: 48px; height: 48px; border-radius: 50%; cursor: pointer;" onclick="navigateTo('user/${followerId}')">
                            <div style="flex: 1; cursor: pointer;" onclick="navigateTo('user/${followerId}')">
                                <h4 style="margin: 0; font-size: 16px; color: #333;">${follower.userName}</h4>
                                <p style="margin: 0; font-size: 14px; color: #666;">Followed ${new Date(follower.timestamp).toLocaleDateString()}</p>
                            </div>
                        </div>
                    `;
                });
                
                followersList.innerHTML = followersHtml;
                
            } catch (error) {
                console.error('Error loading followers:', error);
                document.getElementById('followersList').innerHTML = '<div class="empty-state"><h3>Error loading followers</h3></div>';
            }
        }

        // Load following list
        async function loadFollowingList(userId) {
            try {
                const snapshot = await database.ref('following').child(userId).once('value');
                const followingList = document.getElementById('followingList');
                
                if (!snapshot.exists()) {
                    followingList.innerHTML = '<div class="empty-state"><h3>Not following anyone yet</h3><p>Discover and follow other users!</p></div>';
                    return;
                }
                
                let followingHtml = '';
                snapshot.forEach((childSnapshot) => {
                    const following = childSnapshot.val();
                    const followingId = childSnapshot.key;
                    
                    followingHtml += `
                        <div style="display: flex; align-items: center; gap: 12px; padding: 16px; background: white; border-radius: 12px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <img src="${following.userAvatar || 'https://via.placeholder.com/48'}" alt="${following.userName}" style="width: 48px; height: 48px; border-radius: 50%; cursor: pointer;" onclick="navigateTo('user/${followingId}')">
                            <div style="flex: 1; cursor: pointer;" onclick="navigateTo('user/${followingId}')">
                                <h4 style="margin: 0; font-size: 16px; color: #333;">${following.userName}</h4>
                                <p style="margin: 0; font-size: 14px; color: #666;">Following since ${new Date(following.timestamp).toLocaleDateString()}</p>
                            </div>
                        </div>
                    `;
                });
                
                followingList.innerHTML = followingHtml;
                
            } catch (error) {
                console.error('Error loading following:', error);
                document.getElementById('followingList').innerHTML = '<div class="empty-state"><h3>Error loading following</h3></div>';
            }
        }

        // Load saved pixs
        async function loadSavedPixs() {
            if (!currentUser) return;
            
            try {
                const snapshot = await database.ref('pixs').once('value');
                const savedPixs = [];
                
                snapshot.forEach((childSnapshot) => {
                    const pix = childSnapshot.val();
                    if (pix.savedBy && pix.savedBy[currentUser.uid]) {
                        savedPixs.push(pix);
                    }
                });
                
                const savedPixGrid = document.getElementById('savedPixGrid');
                if (savedPixs.length > 0) {
                    renderPixs(savedPixs.reverse(), 'savedPixGrid');
                } else {
                    savedPixGrid.innerHTML = '<div class="empty-state"><h3>No saved Pixs</h3><p>Save Pixs you love to see them here!</p></div>';
                }
                
            } catch (error) {
                console.error('Error loading saved pixs:', error);
            }
        }

        // Insert ads function
        function insertAds() {
            const adBanners = [
                {
                    title: "üé® Creative Tools",
                    description: "Discover amazing design tools to create stunning visuals",
                    cta: "Explore Now"
                },
                {
                    title: "üì∏ Photography Course",
                    description: "Learn professional photography techniques from experts",
                    cta: "Start Learning"
                },
                {
                    title: "üõçÔ∏è Fashion Deals",
                    description: "Get up to 50% off on trending fashion items",
                    cta: "Shop Now"
                },
                {
                    title: "üè† Home Decor Ideas",
                    description: "Transform your space with these amazing decor tips",
                    cta: "Get Inspired"
                }
            ];
            
            // Insert ads randomly in the page
            const containers = document.querySelectorAll('.masonry-grid');
            containers.forEach((container, index) => {
                if (Math.random() > 0.7) { // 30% chance to show ad
                    const randomAd = adBanners[Math.floor(Math.random() * adBanners.length)];
                    const adElement = document.createElement('div');
                    adElement.className = 'ad-banner';
                    adElement.innerHTML = `
                        <div class="ad-content">
                            <h3 class="ad-title">${randomAd.title}</h3>
                            <p class="ad-description">${randomAd.description}</p>
                            <button class="ad-cta" onclick="showToast('This is a demo ad! üì¢')">${randomAd.cta}</button>
                        </div>
                    `;
                    
                    // Insert ad after some content
                    setTimeout(() => {
                        if (container.children.length > 3) {
                            const insertPosition = Math.floor(container.children.length / 2);
                            container.insertBefore(adElement, container.children[insertPosition]);
                        }
                    }, 1000);
                }
            });
        }

        // Initial load
        initializeApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98fef31bf74a5a08',t:'MTc2MDY5NTIzNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
